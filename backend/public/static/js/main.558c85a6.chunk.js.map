{"version":3,"sources":["pages/Homepage.tsx","components/AspectRatioSelector.tsx","pages/image-editor/PaletteButton.tsx","components/PendingImagesThumbnail.tsx","components/PendingImages.tsx","components/CopyToClipboardIcon.tsx","components/ImagePopup.tsx","pages/image-editor/enhance-tool.tsx","client/api.ts","client/base.ts","client/common.ts","pages/image-editor/smudge-tool.tsx","pages/image-editor/inpaint-tool.tsx","pages/image-editor/ImageEditor.tsx","pages/image-editor/renderer.ts","lib/aspecRatios.ts","pages/image-editor/mask-editor-controls.tsx","pages/image-editor/import-export.tsx","pages/image-editor/augment-tool.tsx","components/OutOfCreditsModal.tsx","components/PaymentStatusModal.tsx","lib/imageutil.ts","components/BusyModal.tsx","lib/localImagesStore.ts","pages/Login.tsx","components/TokenRefresher.tsx","components/Healthchecker.tsx","pages/admin/GenerateCode.tsx","pages/admin/GlobalSettings.tsx","pages/admin/Admin.tsx","pages/DeletedImages.tsx","pages/DiscordLogin.tsx","pages/LocalDeletedImages.tsx","lib/kvstore.ts","pages/SavedImagesPage.tsx","lib/imagesCache.ts","pages/TestPage.tsx","components/CreditsBalance.tsx","pages/pricing/PricingCard.tsx","pages/pricing/RedeemPopup.tsx","pages/pricing/PricingPage.tsx","App.tsx","config.ts","reportWebVitals.ts","index.tsx","pages/image-editor/zoomHelper.tsx","pages/image-editor/tool.ts","lib/apisocket.ts","lib/recentList.ts","components/CostIndicator.tsx","components/ImageThumbnail.tsx","lib/supportedModels.ts","components/SeedInput.tsx","components/TextInputWithHistory.tsx","components/ImagePrompt.tsx","components/ProgressBar.tsx","lib/sleep.ts","lib/credits.ts","components/ModelList.tsx","lib/localcache.ts","components/ModelSelector.tsx","components/ResetToDefaultIcon.tsx","components/Alerts.tsx","pages/image-editor/ColorPicker.tsx","pages/image-editor/pencil-tool.tsx","pages/image-editor/selection-tool.tsx","lib/upscale.ts"],"names":["anonymousClient","axios","create","defaults","headers","common","Homepage","api","assetsUrl","apiSocket","localImages","paymentStatus","useState","creating","setCreating","selectedImage","setSelectedImage","parentImage","setParentImage","loadingParent","setLoadingParent","savingImage","setSavingImage","uploadProgress","setUploadingProgress","showPendingImages","setShowPendingImages","images","setImages","err","setErr","errTime","setErrTime","success","setSuccess","successTime","setSuccessTime","hasMore","setHasMore","search","setSearch","searchDebounce","setSearchDebounce","bulkDeleteSelecting","setBulkDeleteSelecting","bulkDeleting","setBulkDeleting","bulkDeleteIds","setBulkDeleteIds","censorNSFW","setCensorNSFW","outOfCredits","setOutOfCredits","id","useParams","history","useHistory","location","useLocation","onError","moment","valueOf","useEffect","handle","setTimeout","clearTimeout","image","find","getImage","then","replace","onSubmit","input","a","window","scrollTo","encoded_image","convertPNGToJPG","encodedJpg","createTemporaryImage","tmpInitImage","binaryImageData","Buffer","from","put","data","upload_url","onUploadProgress","progressEvent","percentCompleted","loaded","total","undefined","tmp_jpg_id","createImage","newImages","saveImage","sort","sortImages","console","error","response","message","includes","onEditNewImage","encodedImage","newImage","created_at","updated_at","created_by","params","steps","width","height","prompt","negative_prompt","denoising_strength","label","uuid","model","negative_score","nsfw","parent","score","status","StatusEnum","Completed","temporary","imageData","push","onNSFW","updatedImage","map","loadImages","log","cursor","add","listImages","resp","lock","pollImages","pendingOrProcessingImages","filter","length","pendingById","reduce","acc","batchGetImages","ids","updatedImages","statusChange","i","img","Error","deleteImage","getImageDownloadUrls","downloadUrls","get","image_url","responseType","base64ImageData","toString","src","timerHandle","setInterval","clearInterval","qs","parse","ignoreQueryPrefix","loadParent","isPendingOrProcessing","Pending","Processing","b","aScore","bScore","trim","onLoadMore","minUpdatedAt","forEach","Math","min","imagesById","deleted_at","onDelete","onFork","onSave","createInput","count","Saved","split","createEncodedThumbnail","encodedThumbnail","binaryThumbnailData","createResp","imageId","getImageUploadUrls","uploadUrls","thumbnail_url","hardDeleteImage","onEdit","onThumbnailClicked","onConfirmBulkDelete","promises","Object","keys","Promise","all","completedOrSavedImages","pendingImages","processingImages","style","fontSize","textAlign","timestamp","onCancel","className","marginTop","paddingBottom","marginBottom","value","type","placeholder","onChange","e","target","float","display","onClick","marginLeft","Toggle","variant","Menu","Item","dataLength","next","loader","pendingCount","processingCount","bulkDelete","onClose","show","title","progress","onDeleteImage","onHide","AspectRatioSelector","aspectRatio","disabled","aspectRatioDetails","aspectRatios","minHeight","alignItems","border","margin","displayName","max","parseInt","PaletteButton","selectedColor","color","backgroundColor","PendingImagesThumbnail","hover","setHover","icon","onMouseEnter","onMouseLeave","backgroundImage","backgroundSize","background","lineHeight","PendingImages","imageIcon","pendingDiv","phrases","substring","Header","closeButton","Title","Body","Footer","CopyToClipboardIcon","text","copied","setCopied","onCopy","ImagePopup","useRef","showNSFW","setShowNSFW","current","onerror","indexOf","Modal","size","ref","maxWidth","maxHeight","marginRight","alt","displayStatus","charAt","toUpperCase","slice","position","top","statusBadge","href","seed","eraserWidthModifier","EnhanceTool","renderer","selectionTool","pencilTool","negativePrompt","variationStrength","_dirty","worker","idCounter","_state","stateHandler","selectionControlsListener","maskHandler","selectedImageDataIndex","selectedImageData","panning","erasing","progressListener","errorListener","dirtyListener","SelectionTool","PencilTool","selectSupported","state","selectionArgs","getArgs","selectionOverlay","x","y","getWidth","getHeight","updateArgs","brushColor","setCursor","ImageUtilWorker","this","dirty","listener","handler","destroy","outpaint","getUpscaleLevel","event","zoomHelper","translateMouseToCanvasCoordinates","nativeEvent","offsetX","offsetY","button","ImageData","erasePoint","onMouseDown","getSelectionOverlay","baseWidth","eraserRadius","floor","relX","relY","startX","startY","endX","endY","j","index","distance","sqrt","pow","alphaPct","alpha","setEditImage","featherWidth","radius","onPan","updateCursor","onMouseMove","onMouseUp","onWheel","args","maskData","loadImageDataElement","imageElement","canvas","document","createElement","ctx","getContext","drawImage","getImageData","newId","req","alphaMode","feather","pixels","alphaPixels","processRequest","updatedImageData","remove","isMasked","deleteMask","createMask","apisocket","notifyError","getEncodedImage","encodedMask","getEncodedMask","defaultArgs","updateProgress","tmpMaskImage","binaryMaskData","tmp_mask_id","ceil","completed","lastUpdate","onMessage","msg","JSON","NOTIFICATION_IMAGE_UPDATED","loadImageData","addMessageListener","startTime","lastCheck","completeCount","sleep","diff","pendingIds","updatedImagesResult","byId","updated","isAfter","removeMessageListener","direction","saveListener","commitSelection","negative_phrases","BaseTool","EnhanceControls","tool","setCount","setDirty","setVariationStrength","setPrompt","setNegativePrompt","setModel","selectingModel","setSelectingModel","setState","setIsMasked","setProgress","setError","onChangeState","onChangeMask","onProgress","onDirty","cost","calculateImagesCost","role","data-dismiss","aria-label","aria-hidden","lockAspectRatio","htmlFor","step","round","parseFloat","imagesCost","onConfirm","onRevert","cancel","confirm","erase","submit","mask","when","onSelectModel","initialSelectedModel","inpainting","AddMetricItemTypeEnum","HealthcheckStatusEnum","ImageParamsControlnetTypeEnum","ImageParamsAugmentationEnum","UpsertWorkerInputStatusEnum","WorkerStatusEnum","BASE_PATH","BaseAPI","configuration","basePath","globalAxios","RequiredError","field","name","DUMMY_BASE_URL","assertParamExists","functionName","paramName","paramValue","setSearchParams","url","searchParams","URLSearchParams","objects","object","key","Array","isArray","delete","item","append","set","serializeDataIfNeeded","requestOptions","nonString","isJsonMime","stringify","toPathString","pathname","hash","createRequestFunction","axiosArgs","axiosRequestArgs","options","request","AIBrushApiFp","localVarAxiosParamCreator","addMetrics","addMetricsInput","localVarUrlObj","URL","baseOptions","localVarRequestOptions","method","localVarQueryParameter","localVarHeaderParameter","query","headersFromBaseOptions","fields","batchGetImagesInput","createDepositCode","createDepositCodeInput","createImageInput","createInviteCode","createStripeSession","createStripeSessionInput","format","localVarPath","encodeURIComponent","String","discordLogin","getAssetsUrl","getCredits","getFeatures","getGlobalSettings","getMaskData","getModels","getThumbnailData","healthcheck","isAdmin","limit","login","loginInput","redeemDepositCode","code","refresh","refreshLoginInput","updateGlobalSettings","updateGlobalSettingsRequest","updateImage","updateImageInput","uploadImageData","body","uploadThumbnailData","verify","verifyLoginInput","AIBrushApiAxiosParamCreator","localVarAxiosArgs","AIBrushApi","SmudgeTool","brushSize","brushOpacity","lastX","lastY","smudging","sync","smudgeLine","copyEditImageFromBaseImage","SmudgeControls","setBrushSize","setBrushOpacity","visibility","InpaintTool","imageWidth","imageHeight","selectionWidth","render","alphaMask","snapshot","undo","clearRedoStack","expandToOverlay","tmpImagePromises","tmpImages","binaryImages","uploadPromises","tmpImage","binaryImage","tmp_image_id","closestAspectRatio","getClosestAspectRatio","selection_overlay","InpaintControls","setoutpaint","checked","ImageEditor","showSelectionControls","setShowSelectionControls","tools","iconClass","constructor","r","renderControls","t","onShowSelectionControls","colors","defaultColors","setImage","setRenderer","setTool","canUndo","setCanUndo","canRedo","setCanRedo","busyMessage","setBusyMessage","canvasRef","onSelectTool","toolconfig","newTool","onSaveImage","saveNewImage","newArgs","renderTool","buttonClass","isSelected","preventDefault","localImage","imageSrc","download_urls","Image","onload","createRenderer","setBaseImage","loadImage","onSnapshot","addEventListener","removeEventListener","redo","verticalAlign","touchAction","userSelect","onTouchStart","onTouchMove","onTouchEnd","select","left","transform","resetView","Renderer","undoStack","redoStack","currentSnapshot","backgroundLayer","baseImageLayer","editLayer","maskLayer","selectionOverlayPreview","hasSelection","zoom","snapshotListener","allowRedo","pop","clearRect","putImageData","notifySnapshotListener","shift","context","setTransform","globalAlpha","drawOverlay","resetMask","fillStyle","fillRect","pattern","createPattern","createCheckeredPattern","color1","color2","updateSelectionOverlay","initializeBackgroundLayer","setSelectionOverlay","updateZoomAndOffset","lineWidth","strokeStyle","strokeRect","beginPath","arc","PI","stroke","fill","moveTo","lineTo","result","toDataURL","selection","imageDataToEncodedImage","erasure","layer","convertErasureToMask","imageLayer","brushx","brushy","absx","leftEdge","rightEdge","topEdge","bottomEdge","absy","contains","x1","y1","x2","y2","lineCap","unitVector","totalRed","totalGreen","totalBlue","averageRed","averageGreen","averageBlue","pixel","g","rgbToHex","minX","minY","newCanvas","AspectRatio","cfg","newWidth","newHeight","DEFAULT_ASPECT_RATIO","tests","aRatio","bRatio","abs","MaskEditor","setBrushColor","flexDirection","flexWrap","invertMask","ImportExportControls","backupImage","setBackupImage","files","byteString","atob","buffer","ArrayBuffer","intArray","Uint8Array","charCodeAt","blob","Blob","saveAs","onExport","AugmentControls","activeAugmentation","setActiveAugmentation","imageWorker","setImageWorker","lastError","setLastError","augmentImageData","augmentation","c","imageDataToCanvas","Upscale","FaceRestore","processingImage","checkResp","imageDataResp","binaryImageToDataBase64","decodeImage","upscaleFactor","newImageData","onAugment","fixImageSize","OutOfCreditsModal","centered","to","PaymentStatusModal","setShow","handleClose","resolve","reject","dataUrl","urls","catch","splitImage","initImage","tile_size","num_tiles_x","num_tiles_y","tiles","x0","y0","tile","numTilesX","numTilesY","tileSize","mergeTiles","splitResult","tileCanvas","resizeImage","numWorkers","workers","callbacks","Worker","process","bind","postMessage","terminate","cropWidth","cropHeight","cropX","cropY","base64","resizeEncodedImage","encodedImageToBlob","binaryString","arr","uploadBlob","signedUrl","xhr","XMLHttpRequest","open","setRequestHeader","send","BusyModal","children","backdrop","keyboard","LocalImagesStore","db","indexedDB","onupgradeneeded","evt","imagesStore","objectStoreNames","transaction","objectStore","createObjectStore","keyPath","createIndex","unique","onsuccess","_","legacyImage","join","stable_diffusion_strength","iterations","store","hydrateImage","cleanupDeletedImages","range","IDBKeyRange","lowerBound","upperBound","openCursor","toLowerCase","continue","imagesRequest","clear","olderThan","getDeletedImages","deletedImages","subtract","Login","props","email","setEmail","emailSubmitted","setEmailSubmitted","setCode","inviteCode","onLogin","match","client","invite_code","onVerify","fontWeight","aria-describedby","host","protocol","redirectUri","discordLink","TokenRefresher","onCredentialsRefreshed","onCredentialsExpired","credentials","interval","refreshToken","loginResult","Healthchecker","healthCheck","setHealthCheck","GenerateCode","amount","setAmount","generatedCode","setGeneratedCode","handleSubmit","Form","InputGroup","Control","Append","Button","Alert","GlobalSettings","minimum_worker_allocations","stable_diffusion","stable_diffusion_inpainting","swinir","workerSettings","setWorkerSettings","saving","setSaving","loadWorkerSettings","settings","settings_json","saveWorkerSettings","Admin","DeletedImages","deleting","setDeleting","onDeleteAllImages","onRestoreImage","goBack","borderBottom","ImageThumbnail","paddingTop","DiscordLogin","accessToken","LocalDeletedImages","clearDeletedImages","KVStore","dbConfig","dbName","storeName","createDB","getDB","savedImagesCache","kvstore","order","batchGetIds","deleteItem","getItem","savedImage","batchResult","setItem","SavedImagesPage","imagesResult","latestCursor","findIndex","deletedIds","uniqueIds","Set","payload","NOTIFICATION_IMAGE_DELETED","Dropdown","res","TestPage","originalImage","setOriginalImage","upscaledImage","setUpscaledImage","upscaleImageData","onImageSelected","originalImageData","upscaledTile","upscaledImageData","upscale","feathered","upscaledCanvas","CreditsBalance","free_credits","paid_credits","credits","setCredits","fetchCredits","pollHandle","NOTIFICATION_CREDITS_UPDATED","PricingCard","price","description","buttonText","onButtonClick","Card","Text","paddingRight","RedeemPopup","Spinner","animation","getContent","PricingPage","redeemingState","setRedeemingState","stripe","setStripe","handleBuy","product","alert","baseUrl","product_id","success_url","cancel_url","redirectToCheckout","sessionId","session_id","loadStripe","stripeInstance","loadStripeLibrary","justifyContent","Row","Col","lg","Group","controlId","config","apiUrl","httpClient","localStorage","ApiSocket","updateHttpClient","App","setCredentials","setAssetsUrl","setIsAdmin","features","setFeatures","onLogout","removeItem","init","assets_url","storedCredentials","is_admin","updateToken","connect","path","exact","bottom","privacy_uri","terms_uri","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById","ZoomHelper","startTouches","startZoom","startOffsetX","startOffsetY","originalZoom","getZoom","getOffsetX","getOffsetY","canvasPoint","deltaY","xDiff","yDiff","movementX","movementY","rect","getBoundingClientRect","touches","canvasRect","getCanvas","startTouch1","startTouch2","touch1","touch2","startDistance","clientX","clientY","startCenterX","startCenterY","centerX","centerY","startCanvasPoint","xDiff2","yDiff2","mouseX","mouseY","touchHandle","_pinchZooming","_panning","_updateCursor","touch","identifier","pageX","pageY","screenX","screenY","messageListeners","l","close","WebSocket","onopen","onmessage","onclose","RecentList","listSize","modelsJson","models","recentModels","getRecentItems","modelIndex","splice","unshift","saveRecentItems","recentNegativePrompts","CostIndicator","retry","setRetry","backgroundRepeat","backgroundPosition","readOnly","supportedModels","controlnetTypes","SeedInput","setSeed","useCustomSeed","setUseCustomSeed","FormGroup","FormCheck","random","FormControl","TextInputWithHistory","onBlur","onSelect","eventKey","padding","overflow","defaultNegativePrompt","encoded_mask","getItems","ImagePrompt","setAspectRatio","parentId","setParentId","advancedView","setAdvancedView","setEncodedImage","controlnetType","setControlnetType","cfgScale","setCfgScale","setSize","defaultAspectRatio","setAspectRatioDetails","originalWidth","setOriginalWidth","originalHeight","setOriginalHeight","resetState","addItem","controlnet_type","cfg_scale","bestMatch","scale","file","HTMLCanvasElement","scaledAspectRatio","borderTopLeftRadius","textDecoration","aspectRatioId","toFixed","ModelSelector","ProgressBar","aria-valuenow","aria-valuemin","aria-valuemax","ms","ModelList","selectedModel","innerWidth","innerHeight","setMaxHeight","handleResize","ListGroup","overflowY","active","cache","storage","ttl","expiry","Date","now","itemStr","initialValue","cachedValue","setValue","useCache","setModels","setSelectedModel","searchTerm","setSearchTerm","filteredModels","setSortedModels","recentModelNames","recentModelIndices","sortedModels","aIndex","bIndex","values","sm","showcases","ResetToDefaultIcon","placement","overlay","alertType","timeout","ErrorNotification","SuccessNotification","ColorPicker","onColorSelected","displayColorPicker","setDisplayColorPicker","tmpColor","setTmpColor","zIndex","right","hex","onChangeComplete","isDrawing","colorPicking","lastPickedColor","colorPickedListener","drawPoint","getPixel","drawLine","Controls","palette","setPalette","addToPalette","onColorPicked","beginColorpicker","clamp","setSelectionOverlayPreview","upscaleLevel"],"mappings":"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","file":"static/js/main.558c85a6.chunk.js","sourcesContent":["// V2 page\nimport { FC, useState, useEffect } from \"react\";\nimport * as uuid from \"uuid\";\nimport axios from \"axios\";\nimport qs from \"qs\";\nimport Dropdown from \"react-bootstrap/Dropdown\";\nimport { useParams, useHistory, Link, useLocation } from \"react-router-dom\";\nimport moment from \"moment\";\nimport ScrollToTop from \"react-scroll-to-top\";\nimport { AIBrushApi } from \"../client\";\nimport { CreateImageInput, StatusEnum, TemporaryImage } from \"../client/api\";\nimport { ImageThumbnail } from \"../components/ImageThumbnail\";\nimport { ImagePrompt, defaultArgs } from \"../components/ImagePrompt\";\nimport {\n    convertPNGToJPG,\n    createEncodedThumbnail,\n    encodedImageToBlob,\n    uploadBlob,\n} from \"../lib/imageutil\";\n\nimport InfiniteScroll from \"react-infinite-scroll-component\";\nimport { ImagePopup } from \"../components/ImagePopup\";\nimport { BusyModal } from \"../components/BusyModal\";\nimport { PendingImagesThumbnail } from \"../components/PendingImagesThumbnail\";\nimport { PendingImages } from \"../components/PendingImages\";\nimport { ApiSocket } from \"../lib/apisocket\";\nimport { LocalImagesStore, LocalImage } from \"../lib/localImagesStore\";\nimport { ErrorNotification, SuccessNotification } from \"../components/Alerts\";\nimport { sleep } from \"../lib/sleep\";\nimport { ProgressBar } from \"../components/ProgressBar\";\nimport OutOfCreditsModal from \"../components/OutOfCreditsModal\";\nimport PaymentStatusModal from \"../components/PaymentStatusModal\";\n\nexport const anonymousClient = axios.create();\ndelete anonymousClient.defaults.headers.common[\"Authorization\"];\n\ninterface Props {\n    api: AIBrushApi;\n    apiSocket: ApiSocket;\n    assetsUrl: string;\n    localImages: LocalImagesStore;\n    paymentStatus?: \"success\" | \"canceled\";\n}\n\nexport const Homepage: FC<Props> = ({\n    api,\n    apiSocket,\n    assetsUrl,\n    localImages,\n    paymentStatus,\n}) => {\n    const [creating, setCreating] = useState(false);\n    const [selectedImage, setSelectedImage] = useState<LocalImage | null>(null);\n    const [parentImage, setParentImage] = useState<LocalImage | null>(null);\n    const [loadingParent, setLoadingParent] = useState(false);\n    const [savingImage, setSavingImage] = useState(false);\n    const [uploadProgress, setUploadingProgress] = useState(0);\n\n    const [showPendingImages, setShowPendingImages] = useState(false);\n\n    const [images, setImages] = useState<Array<LocalImage>>([]);\n    const [err, setErr] = useState<string | null>(null);\n    const [errTime, setErrTime] = useState<number>(0);\n    const [success, setSuccess] = useState<string | null>(null);\n    const [successTime, setSuccessTime] = useState<number>(0);\n\n    const [hasMore, setHasMore] = useState<boolean>(true);\n    const [search, setSearch] = useState<string>(\"\");\n    const [searchDebounce, setSearchDebounce] = useState<string>(\"\");\n\n    const [bulkDeleteSelecting, setBulkDeleteSelecting] = useState(false);\n    const [bulkDeleting, setBulkDeleting] = useState(false);\n    const [bulkDeleteIds, setBulkDeleteIds] = useState<{\n        [key: string]: boolean;\n    }>({});\n\n    const [censorNSFW, setCensorNSFW] = useState(true);\n    const [outOfCredits, setOutOfCredits] = useState(false);\n\n    const { id } = useParams<{ id?: string }>();\n    const history = useHistory();\n    const location = useLocation();\n\n    const onError = (err: string) => {\n        setErr(err);\n        setErrTime(moment().valueOf());\n    };\n\n    useEffect(() => {\n        let handle = setTimeout(() => {\n            setSearch(searchDebounce);\n        }, 500);\n        return () => {\n            clearTimeout(handle);\n        };\n    }, [searchDebounce]);\n\n    useEffect(() => {\n        if (id) {\n            // check if the image is already loaded\n            const image = images.find((image) => image.id === id);\n            if (image) {\n                setSelectedImage(image);\n            }\n            // refresh\n            localImages.getImage(id).then((image) => {\n                setSelectedImage(image);\n                if (!image) {\n                    history.replace(\"/\");\n                }\n            });\n        } else {\n            setSelectedImage(null);\n        }\n    }, [id]);\n\n    const onSubmit = async (input: CreateImageInput) => {\n        setCreating(true);\n        setParentImage(null);\n        setErr(null);\n        window.scrollTo(0, 0);\n        setUploadingProgress(0);\n        try {\n            if (input.encoded_image) {\n                const encodedJpg = await convertPNGToJPG(input.encoded_image);\n                const tmpInitImage = await api.createTemporaryImage(\"jpg\");\n                // convert base64 to binary\n                const binaryImageData = Buffer.from(\n                    encodedJpg,\n                    \"base64\"\n                );\n                await anonymousClient.put(\n                    tmpInitImage.data.upload_url,\n                    binaryImageData,\n                    {\n                        headers: {\n                            \"Content-Type\": \"image/jpeg\",\n                        },\n                        onUploadProgress: (progressEvent: any) => {\n                            const percentCompleted =\n                                progressEvent.loaded / progressEvent.total;\n                            setUploadingProgress(percentCompleted);\n                        },\n                    }\n                );\n                input.encoded_image = undefined;\n                input.tmp_jpg_id = tmpInitImage.data.id;\n            }\n\n            const newImages = await api.createImage(input);\n            if (newImages.data.images) {\n                for (let image of newImages.data.images || []) {\n                    localImages.saveImage(image);\n                }\n                setImages((images) => {\n                    return [...newImages.data.images!, ...images].sort(\n                        sortImages\n                    );\n                });\n            } else {\n                onError(\"Could not create images\");\n            }\n        } catch (e: any) {\n            console.error(e);\n            if (e.response?.data?.message?.includes(\"credits\")) {\n                setOutOfCredits(true);\n                return;\n            }\n            onError(\"Error creating images\");\n        } finally {\n            setCreating(false);\n        }\n    };\n\n    const onEditNewImage = async (input: CreateImageInput) => {\n        setCreating(true);\n        setParentImage(null);\n        setErr(null);\n        window.scrollTo(0, 0);\n        try {\n            const encodedImage = input.encoded_image!;\n            const newImage: LocalImage = {\n                created_at: moment().valueOf(),\n                updated_at: moment().valueOf(),\n                created_by: \"\",\n                params: {\n                    steps: 20,\n                    width: input.params.width,\n                    height: input.params.height,\n                    prompt: input.params.prompt,\n                    negative_prompt: input.params.negative_prompt,\n                    denoising_strength: input.params.denoising_strength,\n                },\n                label: \"\",\n                id: uuid.v4(),\n                model: input.model!,\n                negative_score: 0,\n                nsfw: !!input.nsfw,\n                parent: input.parent!,\n                score: 0,\n                status: StatusEnum.Completed,\n                temporary: false,\n                imageData: `data:image/png;base64,${encodedImage}`,\n            };\n            await localImages.saveImage(newImage);\n\n            history.push(`/image-editor/${newImage.id}`);\n        } catch (e: any) {\n            console.error(e);\n            onError(\"Error creating image\");\n        } finally {\n            setCreating(false);\n        }\n    };\n\n    const onNSFW = async (updatedImage: LocalImage, nsfw: boolean) => {\n        updatedImage = {\n            ...updatedImage,\n            nsfw,\n        };\n        await localImages.saveImage(updatedImage);\n        setImages((images) => {\n            return images.map((image) => {\n                if (updatedImage.id === image.id) {\n                    return {\n                        ...image,\n                        nsfw,\n                    };\n                }\n                return image;\n            });\n        });\n        setSelectedImage(updatedImage);\n    };\n\n    const loadImages = async (search: string) => {\n        console.log(\"Initial load images\");\n        // clear error\n        setErr(null);\n        setHasMore(true);\n        try {\n            const cursor = moment().add(1, \"minutes\").valueOf();\n            const resp = await localImages.listImages(\n                cursor,\n                \"prev\",\n                100,\n                search\n            );\n            setImages(resp.sort(sortImages));\n            return;\n        } catch (err) {\n            onError(\"Could not load images\");\n            console.error(err);\n        }\n    };\n\n    useEffect(() => {\n        loadImages(search);\n    }, [search]);\n\n    useEffect(() => {\n        if (!api) {\n            return;\n        }\n        let lock = false;\n\n        const pollImages = async (images: Array<LocalImage>) => {\n            if (lock) {\n                return;\n            }\n            lock = true;\n\n            const pendingOrProcessingImages = images.filter((image) => {\n                return (\n                    image.status === \"pending\" || image.status === \"processing\"\n                );\n            });\n            if (pendingOrProcessingImages.length === 0) {\n                return;\n            }\n\n            const pendingById = pendingOrProcessingImages.reduce(\n                (acc, image) => {\n                    acc[image.id] = image;\n                    return acc;\n                },\n                {} as Record<string, LocalImage>\n            );\n\n            try {\n                const resp = await api.batchGetImages(\"id,status,nsfw,error\", {\n                    ids: pendingOrProcessingImages.map((image) => image.id),\n                });\n\n                if (resp.data.images) {\n                    const updatedImages: Array<LocalImage> =\n                        resp.data.images || [];\n                    let statusChange = false;\n                    for (let i = 0; i < updatedImages.length; i++) {\n                        let img = updatedImages[i];\n                        if (pendingById[img.id].status !== img.status) {\n                            statusChange = true;\n                        }\n                        img = {\n                            ...pendingById[img.id],\n                            ...img,\n                        };\n                        updatedImages[i] = img;\n\n                        if (img.status == StatusEnum.Error) {\n                            onError(\n                                img.error ||\n                                    \"Some images failed to generate, please make sure your prompt doesn't violate our terms of service\"\n                            );\n                            await api.deleteImage(img.id);\n                            await localImages.deleteImage(img.id);\n                            continue;\n                        }\n\n                        if (img.status === StatusEnum.Completed) {\n                            const downloadUrls = await api.getImageDownloadUrls(\n                                img.id\n                            );\n                            const resp = await anonymousClient.get(\n                                downloadUrls.data.image_url!,\n                                {\n                                    responseType: \"arraybuffer\",\n                                }\n                            );\n                            const binaryImageData = Buffer.from(\n                                resp.data,\n                                \"binary\"\n                            );\n                            const base64ImageData =\n                                binaryImageData.toString(\"base64\");\n                            const src = `data:image/png;base64,${base64ImageData}`;\n                            img.imageData = src;\n                        }\n                        await localImages.saveImage(img);\n                    }\n                    if (statusChange) {\n                        setImages((images) => {\n                            return [\n                                ...images.map((image) => {\n                                    const updatedImage = updatedImages.find(\n                                        (i) => i.id === image.id\n                                    );\n                                    if (updatedImage) {\n                                        return updatedImage;\n                                    }\n                                    return image;\n                                }),\n                            ].sort(sortImages);\n                        });\n                    }\n                }\n            } catch (err) {\n                onError(\"Could not load images\");\n                console.error(err);\n            } finally {\n                lock = false;\n            }\n        };\n\n        const timerHandle = setInterval(() => {\n            pollImages(images);\n        }, 2 * 1000);\n        return () => {\n            clearInterval(timerHandle);\n        };\n    }, [api, images, search]);\n\n    // load parent image from saved images if an id is on the query string\n    useEffect(() => {\n        const loadParent = async () => {\n            const search = qs.parse(location.search, {\n                ignoreQueryPrefix: true,\n            });\n            if (search.parent) {\n                setLoadingParent(true);\n                try {\n                    const parentImage = await api.getImage(\n                        search.parent as string\n                    );\n                    if (parentImage.data) {\n                        const downloadUrls = await api.getImageDownloadUrls(\n                            parentImage.data.id\n                        );\n                        const resp = await anonymousClient.get(\n                            downloadUrls.data.image_url!,\n                            {\n                                responseType: \"arraybuffer\",\n                            }\n                        );\n                        const binaryImageData = Buffer.from(\n                            resp.data,\n                            \"binary\"\n                        );\n                        const base64ImageData =\n                            binaryImageData.toString(\"base64\");\n                        const src = `data:image/png;base64,${base64ImageData}`;\n                        setParentImage({\n                            ...parentImage.data,\n                            imageData: src,\n                        });\n                        history.push(\"/\");\n                    }\n                } finally {\n                    setLoadingParent(false);\n                }\n            }\n        };\n        loadParent();\n    }, [location.search]);\n\n    const isPendingOrProcessing = (image: LocalImage) => {\n        return (\n            image.status === StatusEnum.Pending ||\n            image.status === StatusEnum.Processing\n        );\n    };\n\n    const sortImages = (a: LocalImage, b: LocalImage) => {\n        // pending and processing images always come first\n        if (isPendingOrProcessing(a) && !isPendingOrProcessing(b)) {\n            return -1;\n        } else if (!isPendingOrProcessing(a) && isPendingOrProcessing(b)) {\n            return 1;\n        }\n        // if the parent is the same, sort by score descending\n        // otherwise, sort by updated_at\n        if (\n            a.parent === b.parent &&\n            a.params.prompt == b.params.prompt &&\n            a.status !== StatusEnum.Pending &&\n            b.status !== StatusEnum.Pending\n        ) {\n            // if the score is the same, sort by updated_at\n            let aScore = a.score;\n            let bScore = b.score;\n            // working around a bug where negative score was assigned\n            // for an empty negative prompt.\n            if (a.params.prompt!.trim() !== \"\") {\n                aScore = aScore - a.negative_score;\n            }\n            if (b.params.prompt!.trim() !== \"\") {\n                bScore = bScore - b.negative_score;\n            }\n            if (aScore == bScore) {\n                return b.updated_at - a.updated_at;\n            }\n            return bScore - aScore;\n        }\n\n        return b.updated_at - a.updated_at;\n    };\n\n    const onLoadMore = async () => {\n        // get the minimum updated_at from images\n        let minUpdatedAt = moment().valueOf();\n        images.forEach((image) => {\n            minUpdatedAt = Math.min(minUpdatedAt, image.updated_at);\n        });\n        // load images in descending order from updated_at\n        let resp = await localImages.listImages(\n            minUpdatedAt - 1,\n            \"prev\",\n            100,\n            search\n        );\n        if (resp.length > 0) {\n            // combine images with new images and sort by updated_at descending\n            setImages((images) => {\n                // filtering is required due to a race condition\n                const imagesById = images.reduce((acc, image) => {\n                    acc[image.id] = image;\n                    return acc;\n                }, {} as { [key: string]: LocalImage });\n                resp = resp.filter((image) => !imagesById[image.id]);\n                return [...images, ...resp]\n                    .filter((image) => !image.deleted_at)\n                    .sort(sortImages);\n            });\n        } else {\n            setHasMore(false);\n        }\n    };\n\n    const onDelete = async (image: LocalImage) => {\n        try {\n            // await api.deleteImage(image.id);\n            await localImages.deleteImage(image.id);\n            setImages((images) => {\n                return images.filter((i) => i.id !== image.id);\n            });\n            history.push(\"/\");\n        } catch (e) {\n            console.error(e);\n            onError(\"Error deleting image\");\n        }\n    };\n\n    const onFork = async (image: LocalImage) => {\n        setParentImage(image);\n        // setSelectedImage(null);\n        history.push(\"/\");\n        window.scrollTo(0, 0);\n    };\n\n    const onSave = async (image: LocalImage) => {\n        setSavingImage(true);\n        try {\n            history.push(\"/\");\n            const createInput: CreateImageInput = {\n                count: 1,\n                // encoded_image: image.imageData!.split(\",\")[1],\n                params: image.params,\n                status: StatusEnum.Saved,\n                temporary: false,\n                label: \"\",\n                model: image.model,\n            };\n\n            const encodedImage = image.imageData!.split(\",\")[1];\n\n            // convert base64 to binary\n            const binaryImageData = Buffer.from(encodedImage, \"base64\");\n            const encodedThumbnail = await createEncodedThumbnail(encodedImage);\n            const binaryThumbnailData = Buffer.from(encodedThumbnail, \"base64\");\n\n            const createResp = await api.createImage(createInput);\n            const imageId = createResp.data.images![0].id;\n            const uploadUrls = await api.getImageUploadUrls(imageId);\n            await anonymousClient.put(\n                uploadUrls.data.thumbnail_url!,\n                binaryThumbnailData,\n                {\n                    headers: {\n                        \"Content-Type\": \"image/png\",\n                    },\n                    onUploadProgress: (progressEvent: any) => {\n                        const percentCompleted =\n                            progressEvent.loaded / progressEvent.total;\n                        setUploadingProgress(percentCompleted / 2);\n                    },\n                }\n            );\n            await anonymousClient.put(\n                uploadUrls.data.image_url!,\n                binaryImageData,\n                {\n                    headers: {\n                        \"Content-Type\": \"image/png\",\n                    },\n                    onUploadProgress: (progressEvent: any) => {\n                        const percentCompleted =\n                            progressEvent.loaded / progressEvent.total;\n                        setUploadingProgress(percentCompleted / 2 + 0.5);\n                    },\n                }\n            );\n\n            await localImages.hardDeleteImage(image.id);\n            setImages((images) => {\n                return images.filter((i) => i.id !== image.id);\n            });\n            setSuccess(\"Image saved\");\n            setSuccessTime(moment().valueOf());\n        } catch (e) {\n            console.error(e);\n            onError(\"Error saving image\");\n        } finally {\n            setSavingImage(false);\n        }\n    };\n\n    const onEdit = async (image: LocalImage) => {\n        history.push(`/image-editor/${image.id}`);\n    };\n\n    const onThumbnailClicked = (image: LocalImage) => {\n        // setSelectedImage(image);\n        if (bulkDeleteSelecting) {\n            setBulkDeleteIds({\n                ...bulkDeleteIds,\n                [image.id]: !bulkDeleteIds[image.id],\n            });\n        } else {\n            history.push(`/images/${image.id}`);\n        }\n    };\n\n    const handleCancelFork = () => {\n        setParentImage(null);\n        window.scrollTo(0, 0);\n    };\n\n    const onConfirmBulkDelete = async () => {\n        try {\n            setBulkDeleting(true);\n            const promises = Object.keys(bulkDeleteIds).map((id) => {\n                return localImages.deleteImage(id);\n            });\n            await Promise.all(promises);\n            setImages((images) => {\n                return images.filter((image) => !bulkDeleteIds[image.id]);\n            });\n            setBulkDeleteIds({});\n            setBulkDeleteSelecting(false);\n        } catch (e) {\n            console.error(e);\n            onError(\"Error deleting images\");\n        } finally {\n            setBulkDeleting(false);\n        }\n    };\n\n    const completedOrSavedImages = images.filter((image) => {\n        return (\n            !image.deleted_at &&\n            (image.status === StatusEnum.Completed ||\n                image.status === StatusEnum.Saved)\n        );\n    });\n\n    const pendingOrProcessingImages = images.filter(\n        (image) =>\n            !image.deleted_at &&\n            (image.status === StatusEnum.Pending ||\n                image.status === StatusEnum.Processing)\n    );\n\n    const pendingImages = pendingOrProcessingImages.filter(\n        (image) => image.status === StatusEnum.Pending\n    );\n\n    const processingImages = pendingOrProcessingImages.filter(\n        (image) => image.status === StatusEnum.Processing\n    );\n\n    return (\n        <>\n            <h1 style={{ fontSize: \"40px\", textAlign: \"left\" }}>\n                Welcome to AiBrush - Home\n            </h1>\n\n            <ErrorNotification message={err} timestamp={errTime} />\n            <SuccessNotification message={success} timestamp={successTime} />\n\n            <ImagePrompt\n                api={api}\n                assetsUrl={assetsUrl}\n                creating={creating}\n                onSubmit={onSubmit}\n                onEdit={onEditNewImage}\n                parent={parentImage}\n                onCancel={() => handleCancelFork()}\n            />\n            <hr />\n\n            <div\n                className=\"homepage-images\"\n                style={{ marginTop: \"48px\", paddingBottom: \"48px\" }}\n            >\n                <div style={{ textAlign: \"left\" }}>\n                    <div\n                        className=\"input-group\"\n                        style={{ marginBottom: \"16px\" }}\n                    >\n                        <input\n                            style={{}}\n                            value={searchDebounce}\n                            type=\"search\"\n                            className=\"form-control image-search\"\n                            placeholder=\"Search...\"\n                            onChange={(e) => setSearchDebounce(e.target.value)}\n                        />\n\n                        <div\n                            style={{\n                                float: \"right\",\n                            }}\n                        >\n                            {!bulkDeleteSelecting && (\n                                <>\n                                    <button\n                                        style={{ display: \"inline\" }}\n                                        className=\"btn btn-primary image-popup-button\"\n                                        onClick={() =>\n                                            setCensorNSFW(!censorNSFW)\n                                        }\n                                    >\n                                        {!censorNSFW && (\n                                            <i className=\"fas fa-eye\"></i>\n                                        )}\n                                        {censorNSFW && (\n                                            <i className=\"fas fa-eye-slash\"></i>\n                                        )}\n                                    </button>\n                                    <Dropdown\n                                        style={{\n                                            display: \"inline\",\n                                            marginLeft: \"8px\",\n                                        }}\n                                    >\n                                        <Dropdown.Toggle variant=\"danger\">\n                                            <i className=\"fas fa-trash\"></i>\n                                        </Dropdown.Toggle>\n\n                                        <Dropdown.Menu>\n                                            <Dropdown.Item\n                                                onClick={() =>\n                                                    setBulkDeleteSelecting(true)\n                                                }\n                                            >\n                                                Bulk Delete\n                                            </Dropdown.Item>\n                                            <Dropdown.Item\n                                                onClick={() =>\n                                                    history.push(\n                                                        \"/local-deleted-images\"\n                                                    )\n                                                }\n                                            >\n                                                View Deleted Images\n                                            </Dropdown.Item>\n                                        </Dropdown.Menu>\n                                    </Dropdown>\n                                </>\n                            )}\n                            {bulkDeleteSelecting && (\n                                <>\n                                    <button\n                                        className=\"btn btn-primary image-popup-button\"\n                                        onClick={() => {\n                                            setBulkDeleteSelecting(false);\n                                            setBulkDeleteIds({});\n                                        }}\n                                    >\n                                        Cancel\n                                    </button>\n                                    <button\n                                        style={{ marginLeft: \"8px\" }}\n                                        className=\"btn image-popup-delete-button\"\n                                        onClick={() => {\n                                            onConfirmBulkDelete();\n                                        }}\n                                    >\n                                        Delete\n                                    </button>\n                                </>\n                            )}\n                        </div>\n                    </div>\n                </div>\n                <InfiniteScroll\n                    dataLength={images.length}\n                    next={onLoadMore}\n                    hasMore={hasMore}\n                    loader={\n                        <>\n                            <hr />\n                            <h4>Loading...</h4>\n                        </>\n                    }\n                >\n                    {pendingOrProcessingImages.length > 0 && (\n                        <PendingImagesThumbnail\n                            pendingCount={pendingImages.length}\n                            processingCount={processingImages.length}\n                            onClick={() => {\n                                setShowPendingImages(true);\n                            }}\n                        />\n                    )}\n                    {completedOrSavedImages.map((image) => (\n                        <ImageThumbnail\n                            key={image.id}\n                            image={image}\n                            assetsUrl={assetsUrl}\n                            onClick={onThumbnailClicked}\n                            bulkDelete={\n                                bulkDeleteSelecting && bulkDeleteIds[image.id]\n                            }\n                            censorNSFW={censorNSFW}\n                        />\n                    ))}\n                </InfiniteScroll>\n            </div>\n\n            {selectedImage && (\n                <ImagePopup\n                    assetsUrl={assetsUrl}\n                    image={selectedImage}\n                    onClose={() => history.push(\"/\")}\n                    onDelete={(image) => {\n                        onDelete(image);\n                        setImages(images.filter((i) => i.id !== image.id));\n                        history.push(\"/\");\n                    }}\n                    onFork={(image) => {\n                        onFork(image);\n                        history.push(\"/\");\n                    }}\n                    onEdit={(image) => {\n                        onEdit(image);\n                    }}\n                    onSave={(image) => {\n                        onSave(image);\n                    }}\n                    onNSFW={onNSFW}\n                    censorNSFW={censorNSFW}\n                />\n            )}\n            <ScrollToTop />\n            <BusyModal show={creating} title=\"Creating images\">\n                <p>Please wait while we create your image.</p>\n                <ProgressBar progress={uploadProgress} />\n            </BusyModal>\n            <BusyModal show={bulkDeleting} title=\"Deleting images\">\n                <p>Please wait while we delete your images.</p>\n            </BusyModal>\n            <BusyModal show={loadingParent} title=\"Loading parent image\">\n                <p>Please wait while we load the parent image.</p>\n            </BusyModal>\n            <BusyModal show={savingImage} title=\"Saving image\">\n                {/* bootstrap progress bar for uploadProgress (0-1 value) */}\n                <ProgressBar progress={uploadProgress} />\n            </BusyModal>\n            <PendingImages\n                images={pendingOrProcessingImages}\n                onCancel={() => setShowPendingImages(false)}\n                show={showPendingImages}\n                onDeleteImage={(image) => {\n                    onDelete(image);\n                    setImages(images.filter((i) => i.id !== image.id));\n                }}\n            />\n            <OutOfCreditsModal\n                show={outOfCredits}\n                onHide={() => setOutOfCredits(false)}\n            />\n            <PaymentStatusModal paymentStatus={paymentStatus} />\n        </>\n    );\n};\n","import React, { FC, useEffect, useRef, useState } from \"react\";\n\nimport { aspectRatios, DEFAULT_ASPECT_RATIO, getClosestAspectRatio } from \"../lib/aspecRatios\";\n\ninterface Props {\n    aspectRatio: number;\n    onChange: (aspectRatio: number) => void;\n    disabled?: boolean;\n}\n\nexport const AspectRatioSelector: FC<Props> = ({ aspectRatio, onChange, disabled }) => {\n    const aspectRatioDetails = aspectRatios[aspectRatio];\n    return (\n        <div className=\"form-group\">\n            <div\n                style={{\n                    minHeight: \"140px\",\n                    display: \"flex\",\n                    alignItems: \"center\",\n                }}\n            >\n                {/* aspect ratio slider, goes from 0 -> aspectRatios.length - 1 */}\n                <div\n                    style={{\n                        width: aspectRatioDetails.width / 8,\n                        height: aspectRatioDetails.height / 8,\n                        // dotted line options: dotted, dashed, solid, double, groove, ridge, inset, outset, none, hidden\n                        border: \"1px dashed white\",\n                        margin: \"auto\",\n                    }}\n                ></div>\n            </div>\n            <label style={{width: \"100%\"}}>\n                Aspect Ratio\n                <small className=\"form-text text-muted\" style={{float: \"right\"}}>\n                    {aspectRatioDetails.displayName}\n                </small>\n            </label>\n            <input\n                type=\"range\"\n                disabled={disabled}\n                className=\"form-control-range\"\n                min={0}\n                max={aspectRatios.length - 1}\n                value={aspectRatio}\n                onChange={(e) => {\n                    onChange(parseInt(e.target.value));\n                }}\n            />\n        </div>\n    );\n};\n","import React, { FC, useState, useEffect } from \"react\";\n\ninterface Props {\n    selectedColor: string;\n    color: string;\n    onClick: (color: string) => void;\n}\n\nexport const PaletteButton: FC<Props> = ({ selectedColor, color, onClick }) => {\n    let className = \"palette-button\";\n    if (selectedColor === color) {\n        className += \" selected\";\n    } else if (color == \"#000000\") {\n        className += \" black\";\n    }\n    return (\n        <div\n            className={className}\n            style={{ backgroundColor: color }}\n            onClick={() => onClick(color)}\n        ></div>\n    );\n};\n","import React, { FC, useEffect, useState } from \"react\";\n\ninterface Props {\n    pendingCount: number;\n    processingCount: number;\n    onClick?: () => void;\n}\n\nexport const PendingImagesThumbnail: FC<Props> = ({\n    pendingCount,\n    processingCount,\n    onClick,\n}) => {\n    const [hover, setHover] = useState(false);\n\n    // on mouse in/out, set hover state\n    const onMouseEnter = () => setHover(true);\n    const onMouseLeave = () => setHover(false);\n    let icon = (\n        <i style={{ marginTop: \"20px\" }} className=\"fa fa-hourglass-half\"></i>\n    );\n\n    if (processingCount > 0) {\n        icon = (\n            <i style={{ marginTop: \"20px\" }} className=\"fa fa-cog fa-spin\"></i>\n        );\n    }\n\n    return (\n        <div\n            onMouseEnter={onMouseEnter}\n            onMouseLeave={onMouseLeave}\n            style={{\n                backgroundImage: `url(/images/default.png)`,\n                backgroundSize: \"contain\",\n                width: \"128px\",\n                height: \"128px\",\n                margin: \"8px\",\n                float: \"left\",\n                cursor: \"pointer\",\n            }}\n            onClick={onClick}\n        >\n            {hover && (\n                <div\n                    style={{\n                        background: \"rgba(255, 255, 255, 0.5)\",\n                        color: \"black\",\n                        width: \"100%\",\n                        height: \"100%\",\n                        lineHeight: \"1\",\n                        fontSize: \"20px\",\n                    }}\n                >\n                    <br/>\n                    {pendingCount > 0 && (\n                        <div style={{ marginBottom: \"24px\" }}>\n                            {pendingCount} pending\n                        </div>\n                    )}\n                    {processingCount > 0 && (\n                        <div>{processingCount} processing</div>\n                    )}\n                </div>\n            )}\n            {!hover && (\n                <div\n                    style={{\n                        background: \"rgba(255, 255, 255, 0.3)\",\n                        color: \"#555\",\n                        width: \"100%\",\n                        height: \"100%\",\n                        fontSize: \"80px\",\n                    }}\n                >\n                    {icon}\n                </div>\n            )}\n        </div>\n    );\n};\n","import React, {FC, useEffect, useState} from \"react\";\nimport { Modal } from \"react-bootstrap\";\nimport { Image } from \"../client/api\";\n\ninterface Props {\n    images: Image[];\n    onDeleteImage: (image: Image) => void;\n    onCancel: () => void;\n    show: boolean;\n}\n\nexport const PendingImages: FC<Props> = ({\n    images,\n    onDeleteImage,\n    onCancel,\n    show,\n}) => {\n\n    function imageIcon(image: Image) {\n        if (image.status === \"pending\") {\n            return <i className=\"fa fa-hourglass-half\"></i>;\n        } else if (image.status === \"processing\") {\n            return <i className=\"fa fa-cog fa-spin\"></i>;\n        }\n    }\n\n    const truncate = (phrases: string) => {\n        if (phrases.length > 35) {\n            return phrases.substring(0, 35) + \"...\";\n        }\n        return phrases;\n    }\n\n    // refactor from table to div layout\n    const pendingDiv = (\n        <div>\n            <div style={{marginBottom: \"8px\"}}>\n                <div style={{display: \"inline-block\", width: \"100px\"}}>\n                    Status\n                </div>\n                <div style={{display: \"inline-block\", width: \"250px\"}}>\n                    Phrases\n                </div>\n                <div style={{display: \"inline-block\", width: \"100px\"}}>\n                    Action\n                </div>\n            </div>\n            {images.map((image) => (\n                <div key={image.id} style={{marginBottom: \"8px\"}}>\n                    <div style={{display: \"inline-block\", width: \"100px\"}}>\n                        {imageIcon(image)}&nbsp;{image.status}\n                    </div>\n                    <div style={{display: \"inline-block\", width: \"250px\"}}>\n                        {/* if more than 30 chars, truncate with ellipsis*/}\n                        {truncate(image.params.prompt || \"\")}\n                    </div>\n                    <div style={{display: \"inline-block\", width: \"100px\"}}>\n                        <button\n                            className=\"btn btn-danger btn-sm image-popup-delete-button\"\n                            onClick={() => onDeleteImage(image)}\n                        >\n                            <i className=\"fa fa-trash\"></i>&nbsp;Delete\n                        </button>\n                    </div>\n                </div>\n            ))}\n        </div>\n    );\n\n    return (\n        <Modal show={show} onHide={onCancel}>\n            <Modal.Header closeButton>\n                <Modal.Title>Pending Images</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                {pendingDiv}\n            </Modal.Body>\n            <Modal.Footer>\n                <button className=\"btn btn-secondary\" onClick={onCancel}>\n                    Close\n                </button>\n            </Modal.Footer>\n        </Modal>\n    );\n};","import React, { useState } from 'react';\nimport { CopyToClipboard } from 'react-copy-to-clipboard';\n\ninterface CopyToClipboardIconProps {\n  text: string;\n}\n\nconst CopyToClipboardIcon: React.FC<CopyToClipboardIconProps> = ({ text }) => {\n  const [copied, setCopied] = useState(false);\n\n  const handleCopy = () => {\n    setCopied(true);\n    setTimeout(() => setCopied(false), 5000); // Reset icon after 5 seconds\n  };\n\n  return (\n    <CopyToClipboard text={text} onCopy={handleCopy}>\n      <span style={{cursor: \"pointer\", marginLeft: \"8px\"}}>\n        {/* <FontAwesomeIcon icon={copied ? faCheck : faCopy} style={{ color: copied ? 'green' : undefined }} /> */}\n        <i className={`fas fa-${copied ? 'check' : 'copy'}`} style={{ color: copied ? 'green' : undefined }} />\n      </span>\n    </CopyToClipboard>\n  );\n};\n\nexport default CopyToClipboardIcon;\n","import React, { FC, useEffect, useRef, useState } from \"react\";\nimport { Modal } from \"react-bootstrap\";\nimport { CreateImageInput, Image, StatusEnum } from \"../client/api\";\nimport { LocalImage } from \"../lib/localImagesStore\";\nimport CopyToClipboard from \"react-copy-to-clipboard\";\nimport CopyToClipboardIcon from \"./CopyToClipboardIcon\";\n\ninterface ImagePopupProps {\n    assetsUrl: string;\n    image: LocalImage;\n    censorNSFW: boolean;\n    onClose: () => void;\n    onDelete?: (image: LocalImage) => void;\n    onFork?: (image: LocalImage) => void;\n    onEdit?: (image: LocalImage) => void;\n    onNSFW?: (image: LocalImage, nsfw: boolean) => void;\n    onSave?: (image: LocalImage) => void;\n}\n\nexport const ImagePopup: FC<ImagePopupProps> = ({\n    assetsUrl,\n    image,\n    censorNSFW,\n    onClose,\n    onDelete,\n    onFork,\n    onEdit,\n    onNSFW,\n    onSave,\n}) => {\n    const img = useRef<HTMLImageElement>(null);\n    let src = `${assetsUrl}/${image.id}.image.png?updated_at=${image.updated_at}`;\n    if (image.imageData) {\n        src = image.imageData;\n    }\n    let score = image.score;\n    if (image.params.negative_prompt && image.negative_score != 0) {\n        score -= image.negative_score;\n    }\n    const [showNSFW, setShowNSFW] = useState(false);\n\n    const statusBadge = (status: string) => {\n        const displayStatus = status.charAt(0).toUpperCase() + status.slice(1);\n        let icon = \"fa fa-question-circle\";\n        switch (status) {\n            case StatusEnum.Pending:\n                icon = \"fas fa-hourglass-half\";\n                break;\n            case StatusEnum.Processing:\n                icon = \"fas fa-cog fa-spin\";\n                break;\n            case StatusEnum.Completed:\n                icon = \"fas fa-check\";\n                break;\n            case StatusEnum.Saved:\n                icon = \"fas fa-save\";\n                break;\n            case StatusEnum.Error:\n                icon = \"fas fa-exclamation-circle\";\n                break;\n        }\n        return (\n            <>\n                <span style={{ fontSize: \"24px\" }}>\n                    <i\n                        className={`${icon} status-badge status-badge-${status}`}\n                        style={{\n                            fontSize: \"10px\",\n                            position: \"relative\",\n                            top: \"-1px\",\n                        }}\n                    ></i>\n                    &nbsp;{displayStatus}\n                </span>\n            </>\n        );\n    };\n\n    useEffect(() => {\n        if (!img.current) {\n            return;\n        }\n        img.current.onerror = () => {\n            if (!img.current) {\n                return;\n            }\n            img.current.src = \"/images/default.png\";\n        };\n    }, [img]);\n\n    let title = image.label;\n    if (!title) {\n        title = image.params.prompt!;\n    }\n    if (title.indexOf(\",\") > 0) {\n        title = title.substring(0, title.indexOf(\",\"));\n    }\n\n    // if open, show modal with image\n    return (\n        <Modal show={true} onHide={onClose} size=\"xl\">\n            <Modal.Header closeButton>\n                <Modal.Title>{title}</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <img\n                    ref={img}\n                    style={{\n                        maxWidth: \"100%\",\n                        maxHeight: \"1024px\",\n                        display: \"block\",\n                        marginLeft: \"auto\",\n                        marginRight: \"auto\",\n                        filter:\n                            image.nsfw && censorNSFW && !showNSFW\n                                ? \"blur(30px)\"\n                                : \"\",\n                    }}\n                    id={`image-popup-${image.id}`}\n                    src={src}\n                    alt={image.label}\n                />\n                {/* List these fields: status, iterations, phrases */}\n                <div className=\"row\">\n                    <div className=\"col-lg-12\"></div>\n                </div>\n                {/* controls */}\n                <div className=\"row\">\n                    <div className=\"col-lg-12\">\n                        <div\n                            className=\"image-popup-controls\"\n                            style={{ marginTop: \"40px\" }}\n                        >\n                            {statusBadge(image.status)}\n                            <div style={{ float: \"right\" }}>\n                                {onFork &&\n                                    (image.status === StatusEnum.Saved ||\n                                        image.status ===\n                                            StatusEnum.Completed) && (\n                                        <button\n                                            className=\"btn btn-secondary btn-sm image-popup-button\"\n                                            onClick={() => onFork(image)}\n                                            style={{ marginRight: \"5px\" }}\n                                        >\n                                            <i className=\"fas fa-code-branch\"></i>\n                                            &nbsp;VARIATIONS\n                                        </button>\n                                    )}\n                                {onDelete && (\n                                    <button\n                                        className=\"btn btn-danger btn-sm image-popup-delete-button\"\n                                        onClick={() =>\n                                            onDelete && onDelete(image)\n                                        }\n                                        style={{ marginRight: \"5px\" }}\n                                    >\n                                        <i className=\"fas fa-trash-alt\"></i>\n                                        &nbsp;DELETE\n                                    </button>\n                                )}\n                                {onEdit && (\n                                    <button\n                                        className=\"btn btn-primary btn-sm image-popup-button edit-button\"\n                                        onClick={() => onEdit && onEdit(image)}\n                                        style={{ marginRight: \"5px\" }}\n                                    >\n                                        <i className=\"fas fa-edit\"></i>\n                                        &nbsp;EDIT\n                                    </button>\n                                )}\n                                {onSave && (\n                                    <button\n                                        className=\"btn btn-primary btn-sm image-popup-button\"\n                                        onClick={() => onSave && onSave(image)}\n                                        style={{ marginRight: \"5px\" }}\n                                    >\n                                        <i className=\"fas fa-save\"></i>\n                                        &nbsp;SAVE\n                                    </button>\n                                )}\n                                {image.nsfw && censorNSFW && (\n                                    <button\n                                        className=\"btn btn-primary btn-sm image-popup-button\"\n                                        onClick={() => setShowNSFW(!showNSFW)}\n                                        style={{ marginRight: \"5px\" }}\n                                    >\n                                        <i className=\"fas fa-eye\"></i>\n                                        &nbsp;{showNSFW ? \"HIDE\" : \"SHOW\"}\n                                    </button>\n                                )}\n                            </div>\n                        </div>\n                        <div\n                            className=\"image-popup-controls\"\n                            style={{ marginTop: \"28px\", marginBottom: \"85px\" }}\n                        >\n                            {/* Horde interface doesn't support score yet */}\n                            {/* <div>\n                                Similarity to prompt: {(score * 200).toFixed(2)}\n                                %\n                            </div> */}\n                            <div>\n                                Image dimensions: {image.params.width} x{\" \"}\n                                {image.params.height}\n                            </div>\n                            <div>Model: {image.model}</div>\n                            {image.nsfw && (\n                                <>\n                                    <div>\n                                        {/* alert warning icon */}\n                                        <i\n                                            className=\"fas fa-exclamation-triangle\"\n                                            style={{\n                                                color: \"orange\",\n                                                fontSize: \"18px\",\n                                                position: \"relative\",\n                                                top: \"2px\",\n                                            }}\n                                        ></i>\n                                        &nbsp;May contain NSFW content\n                                    </div>\n                                    {onNSFW && (\n                                        <a\n                                            href=\"javascript:void(0)\"\n                                            onClick={() => onNSFW(image, false)}\n                                        >\n                                            Mark as Safe for Work\n                                        </a>\n                                    )}\n                                </>\n                            )}\n                            {image.params.seed && (\n                                <div>Seed: {image.params.seed}</div>\n                            )}\n                            {!image.nsfw && (\n                                <>\n                                    <div>\n                                        {/* green check icon */}\n                                        <i\n                                            className=\"fas fa-check\"\n                                            style={{\n                                                color: \"green\",\n                                                fontSize: \"18px\",\n                                                position: \"relative\",\n                                                top: \"2px\",\n                                            }}\n                                        ></i>\n                                        &nbsp;Safe for Work\n                                    </div>\n                                    {onNSFW && (\n                                        <a\n                                            href=\"javascript:void(0)\"\n                                            onClick={() => onNSFW(image, true)}\n                                        >\n                                            Mark as Not Safe for Work\n                                        </a>\n                                    )}\n                                </>\n                            )}\n                            <div style={{marginTop: \"8px\"}}>\n                                Prompt: {image.params.prompt}\n                                <CopyToClipboardIcon text={image.params.prompt!} />\n                            </div>\n                            <div style={{marginTop: \"8px\"}}>\n                                Negative Prompt: {image.params.negative_prompt}\n                                <CopyToClipboardIcon text={image.params.negative_prompt!} />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </Modal.Body>\n        </Modal>\n    );\n};\n","import React, { FC, useState, useEffect, useRef } from \"react\";\nimport axios from \"axios\";\nimport { Prompt } from \"react-router\";\nimport { loadImageAsync } from \"../../lib/loadImage\";\n\nimport { sleep } from \"../../lib/sleep\";\nimport { defaultArgs } from \"../../components/ImagePrompt\";\nimport { Tool, BaseTool } from \"./tool\";\nimport { Renderer } from \"./renderer\";\nimport { Cursor, Rect } from \"./models\";\nimport {\n    AIBrushApi,\n    CreateImageInput,\n    Image as APIImage,\n    ImageList,\n    StatusEnum,\n} from \"../../client\";\nimport { ZoomHelper } from \"./zoomHelper\";\nimport { getClosestAspectRatio } from \"../../lib/aspecRatios\";\nimport { convertPNGToJPG, ImageUtilWorker, ImageWorkerRequest, loadImageDataElement } from \"../../lib/imageutil\";\nimport { SelectionTool, Controls as SelectionControls } from \"./selection-tool\";\nimport { getUpscaleLevel } from \"../../lib/upscale\";\nimport { ApiSocket, NOTIFICATION_IMAGE_UPDATED } from \"../../lib/apisocket\";\nimport moment from \"moment\";\nimport { supportedModels } from \"../../lib/supportedModels\";\nimport { ProgressBar } from \"../../components/ProgressBar\";\nimport { calculateImagesCost } from \"../../lib/credits\";\nimport { CostIndicator } from \"../../components/CostIndicator\";\nimport ModelSelector from \"../../components/ModelSelector\";\nimport { PencilTool } from \"./pencil-tool\";\nimport { MaskEditor } from \"./mask-editor-controls\";\nimport { ResetToDefaultIcon } from \"../../components/ResetToDefaultIcon\";\n\nconst anonymousClient = axios.create();\n\ntype EnhanceToolState =\n    | \"select\"\n    | \"default\"\n    | \"uploading\"\n    | \"processing\"\n    | \"confirm\"\n    | \"erase\"\n    | \"mask\";\n\n// eraser width modifier adds a solid core with a feather edge\n// equal to the what is used on enhanced selections\nconst eraserWidthModifier = 1.3;\n\ninterface ImageWithData extends APIImage {\n    data?: ImageData;\n}\n\nexport class EnhanceTool extends BaseTool implements Tool {\n    readonly selectionTool: SelectionTool;\n    readonly pencilTool: PencilTool;\n\n    private prompt: string = \"\";\n    private negativePrompt: string = \"\";\n    private model: string = \"Epic Diffusion\";\n    private count: number = 4;\n    private variationStrength: number = 0.35;\n    private _dirty = false;\n    private worker: ImageUtilWorker;\n    private idCounter = 0;\n\n    private _state: EnhanceToolState = \"default\";\n    private stateHandler: (state: EnhanceToolState) => void = () => {};\n    private selectionControlsListener: (show: boolean) => void = () => {};\n    private maskHandler: (isMasked: boolean) => void = () => {};\n\n    private imageData: Array<ImageData> = [];\n    private selectedImageDataIndex: number = -1;\n    private selectedImageData: ImageData | null = null;\n    private panning = false;\n    private erasing = false;\n    private progressListener?: (progress: number) => void;\n    private errorListener?: (error: string | null) => void;\n    private dirtyListener?: (dirty: boolean) => void;\n\n    set dirty(dirty: boolean) {\n        this._dirty = dirty;\n        if (this.dirtyListener) {\n            this.dirtyListener(dirty);\n        }\n    }\n\n    get dirty() {\n        return this._dirty;\n    }\n\n    onDirty(listener: (dirty: boolean) => void): void {\n        this.dirtyListener = listener;\n    }\n\n    onError(handler: (error: string | null) => void) {\n        this.errorListener = handler;\n    }\n\n    private notifyError(error: string | null) {\n        if (this.errorListener) {\n            this.errorListener(error);\n        }\n    }\n\n    get state(): EnhanceToolState {\n        return this._state;\n    }\n\n    set state(state: EnhanceToolState) {\n        if (state !== this._state) {\n            this.renderer.setCursor(undefined);\n            if (this._state == \"select\") {\n                this.selectionTool.destroy();\n            }\n            // if (this._state === \"mask\") {\n            //     this.renderer.setCursor(undefined);\n            // }\n            // if (this._state === \"erase\") {\n            //     this.renderer.setCursor(undefined);\n            // }\n            this._state = state;\n            this.stateHandler(state);\n            if (state == \"confirm\") {\n                this.selectionControlsListener(true);\n            } else {\n                this.selectionControlsListener(false);\n                if (state == \"select\") {\n                    this.selectionTool.updateArgs({\n                        ...this.selectionTool.getArgs(),\n                        outpaint: false,\n                    });\n                }\n            }\n        }\n    }\n\n    selectSupported(): boolean {\n        return !(\n            getUpscaleLevel(\n                this.renderer.getWidth(),\n                this.renderer.getHeight()\n            ) === 0 && this.renderer.getWidth()\n        );\n    }\n\n    constructor(renderer: Renderer) {\n        super(renderer, \"enhance\");\n        this.selectionTool = new SelectionTool(renderer);\n        this.pencilTool = new PencilTool(\n            renderer,\n            \"mask\",\n            \"#FFFFFF\",\n            \"mask-editor\"\n        );\n        if (this.selectSupported()) {\n            this.state = \"select\";\n        } else {\n            this.state = \"default\";\n        }\n        let selectionArgs = this.selectionTool.getArgs();\n        if (!this.selectSupported()) {\n            selectionArgs = {\n                ...selectionArgs,\n                selectionOverlay: {\n                    x: 0,\n                    y: 0,\n                    width: this.renderer.getWidth(),\n                    height: this.renderer.getHeight(),\n                },\n            };\n        }\n        this.selectionTool.updateArgs(selectionArgs);\n        this.pencilTool.updateArgs({\n            ...this.pencilTool.getArgs(),\n            brushColor: \"#FFFFFF\",\n        });\n        // unset the cursor from the pencil tool (hack)\n        this.renderer.setCursor(undefined);\n        this.worker = new ImageUtilWorker();\n    }\n\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseDown(event);\n            return;\n        }\n        if (this.state == \"mask\") {\n            this.pencilTool.onMouseDown(event);\n            return;\n        }\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        if (event.button === 1) {\n            this.panning = true;\n            return;\n        }\n        if (this.state == \"erase\" && this.selectedImageData) {\n            this.erasing = true;\n            // clone selected ImageData\n            this.selectedImageData = new ImageData(\n                this.selectedImageData.data.slice(),\n                this.selectedImageData.width,\n                this.selectedImageData.height\n            );\n\n            this.erasePoint(x, y);\n        }\n    }\n\n    // TODO: on erase cancel and on erase confirm\n    // either restore the image data from the array\n    // or overwrite the array with the new image data\n\n    private erasePoint(x: number, y: number) {\n        const selectionOverlay = this.renderer.getSelectionOverlay()!;\n        const baseWidth = Math.min(\n            selectionOverlay.width,\n            selectionOverlay.height\n        );\n        const eraserRadius = Math.floor((baseWidth / 8) * eraserWidthModifier);\n\n        const relX = x - selectionOverlay.x;\n        const relY = y - selectionOverlay.y;\n        const imageData = this.selectedImageData!;\n\n        const startX = Math.max(0, relX - eraserRadius);\n        const startY = Math.max(0, relY - eraserRadius);\n        const endX = Math.min(imageData.width, relX + eraserRadius);\n        const endY = Math.min(imageData.height, relY + eraserRadius);\n\n        // relX=64.28541697636388, relY=64.24464312259761, startX=0.28541697636387653, startY=0.24464312259760845, endX=128.28541697636388, endY=128.2446431225976\n\n        for (let i = startX; i < endX; i++) {\n            for (let j = startY; j < endY; j++) {\n                const index = (j * imageData.width + i) * 4;\n                const distance = Math.sqrt(\n                    Math.pow(i - relX, 2) + Math.pow(j - relY, 2)\n                );\n                if (distance < eraserRadius) {\n                    // set alpha to a linear gradient from the center,\n                    // 100% in the middle and 0% at the edge\n                    const alphaPct =\n                        (distance / eraserRadius) * eraserWidthModifier -\n                        (eraserWidthModifier - 1);\n\n                    const alpha = Math.min(\n                        Math.floor(alphaPct * 255),\n                        imageData.data[index + 3]\n                    );\n                    imageData.data[index + 3] = alpha;\n                }\n            }\n        }\n        this.renderer.setEditImage(imageData);\n    }\n\n    private updateCursor(x: number, y: number) {\n        if (this.state == \"erase\" && this.selectedImageData) {\n            const selectionOverlay = this.renderer.getSelectionOverlay()!;\n            const baseWidth = Math.min(\n                selectionOverlay.width,\n                selectionOverlay.height\n            );\n            const featherWidth = Math.floor(baseWidth / 8);\n            this.renderer.setCursor({\n                color: \"white\",\n                radius: featherWidth * eraserWidthModifier,\n                type: \"circle\",\n                x,\n                y,\n            });\n        } else {\n            this.renderer.setCursor({\n                color: \"white\",\n                radius: 10,\n                type: \"crosshairs\",\n                x,\n                y,\n            });\n        }\n    }\n\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseMove(event);\n            return;\n        }\n        if (this.state == \"mask\") {\n            this.pencilTool.onMouseMove(event);\n            return;\n        }\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        if (this.panning) {\n            this.zoomHelper.onPan(event);\n        }\n\n        this.updateCursor(x, y);\n        if (this.erasing) {\n            this.erasePoint(x, y);\n        }\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseUp(event);\n        }\n        if (this.state == \"mask\") {\n            this.pencilTool.onMouseUp(event);\n        }\n        this.panning = false;\n        this.erasing = false;\n    }\n\n    onMouseLeave(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseLeave(event);\n        }\n        if (this.state == \"mask\") {\n            this.pencilTool.onMouseLeave(event);\n        }\n        this.panning = false;\n        this.erasing = false;\n    }\n\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.offsetX,\n            event.offsetY\n        );\n        this.updateCursor(x, y);\n    }\n\n    updateArgs(args: any) {\n        args = {\n            ...this.getArgs(),\n            ...args,\n        };\n        this.prompt = args.prompt || \"\";\n        this.negativePrompt = args.negativePrompt || \"\";\n        this.model = args.model || \"Epic Diffusion\";\n        this.count = args.count || 4;\n        this.variationStrength = args.variationStrength || 0.75;\n        console.log(\"updateArgs\", args);\n    }\n\n    onChangeState(handler: (state: EnhanceToolState) => void) {\n        this.stateHandler = handler;\n    }\n\n    onChangeMask(handler: (isMasked: boolean) => void) {\n        this.maskHandler = handler;\n    }\n\n    onShowSelectionControls(listener: (show: boolean) => void): void {\n        this.selectionControlsListener = listener;\n    }\n\n    onProgress(listener: (progress: number) => void): void {\n        this.progressListener = listener;\n    }\n\n    private newId(): string {\n        return `${this.idCounter++}`;\n    }\n\n    private async loadImageData(\n        api: AIBrushApi,\n        imageId: string,\n        maskData: ImageData | undefined,\n        selectionOverlay: Rect\n    ): Promise<ImageData> {\n        const imageElement = await loadImageDataElement(api, imageId);\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = selectionOverlay.width;\n        canvas.height = selectionOverlay.height;\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) {\n            throw new Error(\"Failed to get canvas context\");\n        }\n        ctx.drawImage(\n            imageElement,\n            0,\n            0,\n            selectionOverlay.width,\n            selectionOverlay.height\n        );\n        const imageData = ctx.getImageData(\n            0,\n            0,\n            selectionOverlay.width,\n            selectionOverlay.height\n        );\n        const id = this.newId();\n        const req: ImageWorkerRequest = {\n            id,\n            alphaMode: \"none\",\n            feather: true,\n            height: this.renderer.getHeight(),\n            width: this.renderer.getWidth(),\n            pixels: imageData.data,\n            selectionOverlay,\n        }\n        if (maskData) {\n            req.alphaMode = \"mask\";\n            req.alphaPixels = maskData.data;\n        }\n        const resp = await this.worker.processRequest(req);\n        const updatedImageData = new ImageData(\n            resp.pixels,\n            imageData.width,\n            imageData.height\n        );\n        // remove canvas\n        canvas.remove();\n        return updatedImageData;\n    }\n\n    cancel() {\n        if (this.state == \"erase\") {\n            this.state = \"confirm\";\n            this.selectedImageData =\n                this.imageData[this.selectedImageDataIndex];\n            this.renderer.setEditImage(this.selectedImageData);\n        } else {\n            if (this.selectSupported()) {\n                this.state = \"select\";\n            } else {\n                this.state = \"default\";\n            }\n            this.imageData = [];\n            this.renderer.setEditImage(null);\n            this.dirty = false;\n        }\n    }\n\n    erase() {\n        this.state = \"erase\";\n    }\n\n    mask() {\n        if (this.renderer.isMasked()) {\n            this.renderer.deleteMask();\n        }\n        this.renderer.createMask();\n        this.state = \"mask\";\n        this.maskHandler(true);\n    }\n\n    deleteMask() {\n        this.renderer.deleteMask();\n        if (this.state == \"mask\") {\n            this.state = \"default\";\n        }\n        this.maskHandler(false);\n    }\n\n    private updateProgress(progress: number) {\n        if (this.progressListener) {\n            this.progressListener(progress);\n        }\n    }\n\n    async submit(api: AIBrushApi, apisocket: ApiSocket, image: APIImage) {\n        this.dirty = true;\n        this.notifyError(null);\n        const selectionOverlay = this.renderer.getSelectionOverlay();\n        let encodedImage = this.renderer.getEncodedImage(selectionOverlay!);\n        if (!encodedImage) {\n            console.error(\"No selection\");\n            return;\n        }\n        encodedImage = await convertPNGToJPG(encodedImage);\n        let encodedMask: string | undefined;\n        let maskData: ImageData | undefined;\n        if (this.renderer.isMasked()) {\n            encodedMask = this.renderer.getEncodedMask(selectionOverlay!, \"mask\");\n            maskData = this.renderer.getImageData(selectionOverlay!, \"mask\");\n        }\n\n        const input: CreateImageInput = defaultArgs();\n\n        const tmpInitImage = await api.createTemporaryImage(\"jpg\");\n        // convert base64 to binary\n        const binaryImageData = Buffer.from(encodedImage, \"base64\");\n        this.state = \"uploading\";\n        this.updateProgress(0);\n        await anonymousClient.put(\n            tmpInitImage.data.upload_url,\n            binaryImageData,\n            {\n                headers: {\n                    \"Content-Type\": \"image/jpeg\",\n                },\n                onUploadProgress: (progressEvent: any) => {\n                    let percentCompleted =\n                        progressEvent.loaded / progressEvent.total;\n                    if (encodedMask) {\n                        percentCompleted /= 2;\n                    }\n                    this.updateProgress(percentCompleted);\n                },\n            }\n        );\n        input.tmp_jpg_id = tmpInitImage.data.id;\n\n        if (encodedMask) {\n            const tmpMaskImage = await api.createTemporaryImage(\"png\");\n            const binaryMaskData = Buffer.from(encodedMask, \"base64\");\n            await anonymousClient.put(tmpMaskImage.data.upload_url, binaryMaskData, {\n                headers: {\n                    \"Content-Type\": \"image/png\",\n                },\n                onUploadProgress: (progressEvent: any) => {\n                    let percentCompleted = 0.5 + progressEvent.loaded / progressEvent.total / 2;\n                    this.updateProgress(percentCompleted);\n                },\n            });\n            input.tmp_mask_id = tmpMaskImage.data.id;\n        }\n\n        input.label = \"\";\n        input.parent = image.id;\n        input.params.prompt = this.prompt || image.params.prompt;\n        input.params.negative_prompt =\n            this.negativePrompt || image.params.negative_prompt;\n        input.params.denoising_strength = this.variationStrength;\n        input.count = this.count;\n        input.model = this.model;\n        input.nsfw = image.nsfw;\n\n        input.params.width = selectionOverlay!.width;\n        input.params.height = selectionOverlay!.height;\n        // round width and height up to the nearest multiple of 64\n        input.params.width = Math.ceil(input.params.width / 64) * 64;\n        input.params.height = Math.ceil(input.params.height / 64) * 64;\n        input.temporary = true;\n\n        let resp: ImageList | null = null;\n\n        try {\n            resp = (await api.createImage(input)).data;\n        } catch (err) {\n            console.error(\"Error creating images\", err);\n            this.notifyError(\"Failed to create image\");\n            this.state = \"default\";\n            return;\n        }\n        this.state = \"processing\";\n        let newImages: Array<ImageWithData> | undefined = resp.images;\n        if (!newImages || newImages.length === 0) {\n            this.state = \"default\";\n            throw new Error(\"No images returned\");\n        }\n        let completed = false;\n\n        let lastUpdate = moment();\n\n        const onMessage = async (msg: string) => {\n            const img = JSON.parse(msg) as any;\n            if (\n                img.type === NOTIFICATION_IMAGE_UPDATED &&\n                img.status === StatusEnum.Completed\n            ) {\n                lastUpdate = moment();\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (newImages![i].id === img.id) {\n                        const imageData = await this.loadImageData(\n                            api,\n                            newImages![i].id,\n                            maskData,\n                            selectionOverlay!\n                        );\n                        newImages![i].data = imageData;\n                        newImages![i].status = StatusEnum.Completed;\n                    }\n                }\n            } else if (img.status == StatusEnum.Error) {\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (newImages![i].id === img.id) {\n                        newImages![i].status = StatusEnum.Error;\n                    }\n                }\n            }\n        };\n        apisocket.addMessageListener(onMessage);\n        try {\n            let startTime = moment();\n            let lastCheck = moment();\n\n            while (!completed) {\n                let completeCount = 0;\n                await sleep(1000);\n                // poll for completion\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (\n                        newImages![i].status === StatusEnum.Completed ||\n                        newImages![i].status === StatusEnum.Error\n                    ) {\n                        completeCount++;\n                        continue;\n                    }\n                }\n                this.updateProgress(completeCount / newImages!.length);\n                if (completeCount === newImages!.length) {\n                    completed = true;\n                }\n\n                // fallback if sockets don't catch one\n                if (moment().diff(lastCheck, \"seconds\") > 10) {\n                    // get list of ids that aren't completed and batch get them.\n                    const pendingIds = newImages\n                        .filter(\n                            (img) =>\n                                img.status === StatusEnum.Pending ||\n                                img.status === StatusEnum.Processing\n                        )\n                        .map((img) => img.id);\n                    console.log(\"Checking pending images\", pendingIds);\n                    const updatedImagesResult = await api.batchGetImages(\n                        undefined,\n                        {\n                            ids: pendingIds,\n                        }\n                    );\n                    const updatedImages = updatedImagesResult.data.images;\n                    const byId = updatedImages!.reduce((acc, img) => {\n                        acc[img.id] = img;\n                        return acc;\n                    }, {} as Record<string, APIImage>);\n                    for (let i = 0; i < newImages!.length; i++) {\n                        if (\n                            newImages![i].status === StatusEnum.Pending ||\n                            newImages![i].status === StatusEnum.Processing\n                        ) {\n                            const updated = byId[newImages![i].id];\n                            if (updated) {\n                                newImages![i].status = updated.status;\n                                if (updated.status === StatusEnum.Completed) {\n                                    lastUpdate = moment();\n                                    const imageData = await this.loadImageData(\n                                        api,\n                                        newImages![i].id,\n                                        maskData,\n                                        selectionOverlay!\n                                    );\n                                    newImages![i].data = imageData;\n                                }\n                            }\n                        }\n                    }\n                    lastCheck = moment();\n                }\n                // timeout of 2 minutes\n                if (\n                    (lastUpdate.isAfter(startTime) &&\n                        moment().diff(lastUpdate, \"seconds\") > 30) ||\n                    moment().diff(startTime, \"minutes\") > 2\n                ) {\n                    completed = true;\n                }\n            }\n        } finally {\n            apisocket.removeMessageListener(onMessage);\n        }\n\n        // sort images by score descending\n        newImages!.sort((a, b) => {\n            return b.score - a.score;\n        });\n        newImages = newImages!.filter((img) => {\n            return img.status === StatusEnum.Completed;\n        });\n\n        this.imageData = [];\n        for (let i = 0; i < newImages!.length; i++) {\n            if (newImages![i].data) {\n                this.imageData.push(newImages![i].data as ImageData);\n            }\n        }\n        if (this.imageData.length === 0) {\n            this.state = \"default\";\n            this.notifyError(\"No images returned\");\n            return;\n        }\n        this.renderer.setEditImage(this.imageData[0]);\n        this.selectedImageDataIndex = 0;\n        this.selectedImageData = this.imageData[0];\n        this.state = \"confirm\";\n        this.deleteMask();\n    }\n\n    select(direction: \"left\" | \"right\") {\n        if (direction == \"left\") {\n            this.selectedImageDataIndex--;\n            if (this.selectedImageDataIndex < -1) {\n                this.selectedImageDataIndex = this.imageData.length - 1;\n            }\n        }\n        if (direction == \"right\") {\n            this.selectedImageDataIndex++;\n            if (this.selectedImageDataIndex >= this.imageData.length) {\n                this.selectedImageDataIndex = -1;\n            }\n        }\n        if (this.selectedImageDataIndex === -1) {\n            this.selectedImageData = null;\n        } else {\n            this.selectedImageData =\n                this.imageData[this.selectedImageDataIndex];\n        }\n        this.renderer.setEditImage(this.selectedImageData);\n    }\n\n    onSaveImage(listener: (encodedImage: string, args?: any) => void): void {\n        this.saveListener = listener;\n    }\n\n    confirm() {\n        this.renderer.commitSelection();\n        if (this.selectSupported()) {\n            this.state = \"select\";\n        } else {\n            this.state = \"default\";\n        }\n        this.imageData = [];\n        const encodedImage = this.renderer.getEncodedImage(null);\n        if (encodedImage && this.saveListener) {\n            this.saveListener(encodedImage, {\n                phrases: [this.prompt],\n                negative_phrases: [this.negativePrompt],\n                model: this.model,\n            });\n        }\n        this.dirty = false;\n    }\n\n    destroy(): boolean {\n        if (this.renderer.isMasked()) {\n            this.renderer.deleteMask();\n        }\n        this.renderer.setCursor(undefined);\n        this.worker.destroy();\n        return true;\n    }\n}\n\ninterface ControlsProps {\n    api: AIBrushApi;\n    apisocket: ApiSocket;\n    image: APIImage;\n    renderer: Renderer;\n    tool: EnhanceTool;\n}\n\nexport const EnhanceControls: FC<ControlsProps> = ({\n    api,\n    apisocket,\n    image,\n    renderer,\n    tool,\n}) => {\n    const [count, setCount] = useState(4);\n    const [dirty, setDirty] = useState(false);\n    const [variationStrength, setVariationStrength] = useState(0.35);\n    const [prompt, setPrompt] = useState(image.params.prompt || \"\");\n    const [negativePrompt, setNegativePrompt] = useState(\n        image.params.negative_prompt || \"\"\n    );\n    const [model, setModel] = useState(\n        image.model == \"swinir\" || image.model == \"stable_diffusion\"\n            ? \"Epic Diffusion\"\n            : image.model\n    );\n    const [selectingModel, setSelectingModel] = useState<boolean>(false);\n    const [state, setState] = useState<EnhanceToolState>(tool.state);\n    const [isMasked, setIsMasked] = useState<boolean>(tool.renderer.isMasked());\n    const [progress, setProgress] = useState(0);\n    const [error, setError] = useState<string | null>(null);\n\n    tool.onChangeState(setState);\n    tool.onChangeMask(setIsMasked);\n    tool.onProgress(setProgress);\n    tool.onError(setError);\n    tool.onDirty(setDirty);\n\n    const selectionOverlay: Rect =\n        tool.selectionTool.getArgs().selectionOverlay;\n    let cost = count;\n    if (selectionOverlay) {\n        cost = calculateImagesCost(\n            count,\n            selectionOverlay.width,\n            selectionOverlay.height\n        );\n    }\n\n    if (state == \"processing\" || state == \"uploading\") {\n        return (\n            <div style={{ marginTop: \"16px\" }}>\n                <i className=\"fa fa-spinner fa-spin\"></i>&nbsp;{\" \"}\n                {state === \"processing\" ? \"Enhancing...\" : \"Uploading...\"}\n                <br />\n                <ProgressBar progress={progress} />\n            </div>\n        );\n    }\n\n    return (\n        <div\n            style={{\n                marginTop: \"16px\",\n                marginBottom: \"8px\",\n                marginLeft: \"16px\",\n            }}\n        >\n            {error && (\n                <div className=\"alert alert-danger\" role=\"alert\">\n                    {/* dismiss button */}\n                    <button\n                        type=\"button\"\n                        className=\"close\"\n                        data-dismiss=\"alert\"\n                        aria-label=\"Close\"\n                        onClick={() => setError(null)}\n                    >\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                    {error}\n                </div>\n            )}\n            {state === \"select\" && (\n                <>\n                    <p>\n                        {/* info icon */}\n                        <i className=\"fa fa-info-circle\"></i>&nbsp; Move the\n                        selection rectangle to the area that you want to enhance\n                    </p>\n                    <SelectionControls\n                        renderer={renderer}\n                        tool={tool.selectionTool}\n                        lockAspectRatio={true}\n                    />\n                </>\n            )}\n            {state === \"default\" && (\n                <>\n                    <p>\n                        {/* info icon */}\n                        <i className=\"fa fa-info-circle\"></i>&nbsp; Confirm the\n                        parameters below and continue\n                    </p>\n                    {/* prompt */}\n                    <div className=\"form-group\">\n                        <label htmlFor=\"prompt\">\n                            Prompt&nbsp;\n                            <ResetToDefaultIcon onClick={() => setPrompt(image.params.prompt || \"\")} />\n                        </label>\n                        {/* refresh icon */}\n                        \n                        <input\n                            type=\"text\"\n                            className=\"form-control\"\n                            id=\"prompt\"\n                            value={prompt}\n                            onChange={(e) => {\n                                setPrompt(e.target.value);\n                            }}\n                        />\n                        \n                        <small className=\"form-text text-muted\">\n                            Customize the text prompt here\n                        </small>\n                    </div>\n                    {/* negative prompt */}\n                    <div className=\"form-group\">\n                        <label htmlFor=\"negative-prompt\">\n                            Negative Prompt&nbsp;\n                            <ResetToDefaultIcon onClick={() => setNegativePrompt(image.params.negative_prompt || \"\")} />\n                        </label>\n                        <input\n                            type=\"text\"\n                            className=\"form-control\"\n                            id=\"negative-prompt\"\n                            value={negativePrompt}\n                            onChange={(e) => {\n                                setNegativePrompt(e.target.value);\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            Customize the negative text prompt here\n                        </small>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"count\">Count: {count}</label>\n                        <input\n                            type=\"range\"\n                            className=\"form-control-range\"\n                            id=\"count\"\n                            min=\"1\"\n                            max=\"10\"\n                            step=\"1\"\n                            value={count}\n                            onChange={(e) => {\n                                setCount(parseInt(e.target.value));\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            Number of enhancement options\n                        </small>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"variation-strength\">\n                            Variation Strength:{\" \"}\n                            {Math.round(variationStrength * 100)}%\n                        </label>\n                        <input\n                            type=\"range\"\n                            className=\"form-control-range\"\n                            id=\"variation-strength\"\n                            min=\"0\"\n                            max=\"1\"\n                            step=\"0.05\"\n                            value={variationStrength}\n                            onChange={(e) => {\n                                setVariationStrength(\n                                    parseFloat(e.target.value)\n                                );\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            How much variation to use\n                        </small>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"model\">Model</label>\n                        {/* <select\n                            className=\"form-control\"\n                            id=\"model\"\n                            value={model}\n                            onChange={(e) => setModel(e.target.value)}\n                        >\n                            {supportedModels.map((model) => (\n                                <option value={model} key={`model-${model}`}>\n                                    {model}\n                                </option>\n                            ))}\n                        </select> */}\n                        <div>\n                            <button\n                                type=\"button\"\n                                className=\"btn btn-secondary light-button\"\n                                onClick={() => setSelectingModel(true)}\n                            >\n                                {model}&nbsp;\n                                <i className=\"fas fa-caret-down\"></i>\n                            </button>\n                        </div>\n                        <small className=\"form-text text-muted\">\n                            Select the model to use\n                        </small>\n                    </div>\n                    <div className=\"form-group\">\n                        <CostIndicator imagesCost={cost} />\n                    </div>\n                </>\n            )}\n            {state === \"erase\" && (\n                <p>\n                    {/* info icon */}\n                    <i className=\"fa fa-info-circle\"></i>&nbsp; Erase any\n                    undesired sections before saving\n                </p>\n            )}\n            {state === \"mask\" && (\n                <MaskEditor\n                    onConfirm={() => (tool.state = \"default\")}\n                    onRevert={() => {\n                        tool.deleteMask();\n                    }}\n                    tool={tool.pencilTool}\n                />\n            )}\n\n            <div className=\"form-group\">\n                {state === \"select\" && (\n                    <button\n                        type=\"button\"\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => {\n                            tool.state = \"default\";\n                        }}\n                        style={{ marginRight: \"8px\" }}\n                    >\n                        {/* magic icon */}\n                        <i className=\"fa fa-magic\"></i>&nbsp; Continue\n                    </button>\n                )}\n                {((state === \"default\" && tool.selectSupported()) ||\n                    state === \"confirm\" ||\n                    state === \"erase\") && (\n                    <button\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => {\n                            tool.cancel();\n                        }}\n                        style={{ marginRight: \"8px\" }}\n                    >\n                        {/* cancel icon */}\n                        <i className=\"fa fa-times\"></i>&nbsp; Revert\n                    </button>\n                )}\n                {(state === \"confirm\" || state === \"erase\") && (\n                    <button\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => tool.confirm()}\n                        style={{ marginRight: \"8px\" }}\n                    >\n                        <i className=\"fa fa-save\"></i>&nbsp; Save\n                    </button>\n                )}\n                {state === \"confirm\" && (\n                    <>\n                        <button\n                            className=\"btn btn-primary btn-sm\"\n                            onClick={() => tool.erase()}\n                            style={{ marginRight: \"8px\" }}\n                        >\n                            <i className=\"fa fa-eraser\"></i>&nbsp; Erase\n                        </button>\n                    </>\n                )}\n                {state === \"default\" && (\n                    <>\n                        <button\n                            className=\"btn btn-primary btn-sm\"\n                            onClick={() => {\n                                tool.updateArgs({\n                                    count,\n                                    variationStrength,\n                                    prompt,\n                                    negativePrompt,\n                                    model,\n                                });\n                                tool.submit(api, apisocket, image);\n                            }}\n                            style={{ marginRight: \"8px\" }}\n                        >\n                            <i className=\"fa fa-magic\"></i>&nbsp; Enhance\n                        </button>\n                        <button\n                            className=\"btn btn-primary btn-sm\"\n                            onClick={() => tool.mask()}\n                            style={{ marginRight: \"8px\" }}\n                        >\n                            <i className=\"fa fa-cut\"></i>&nbsp; Mask\n                        </button>\n                        {isMasked && (\n                            <button\n                                className=\"btn btn-danger btn-sm\"\n                                onClick={() => tool.deleteMask()}\n                                style={{ marginRight: \"8px\" }}\n                            >\n                                <i className=\"fa fa-cut\"></i>&nbsp; Unmask\n                            </button>\n                        )}\n                    </>\n                )}\n            </div>\n            <Prompt\n                when={dirty}\n                message=\"Are you sure you want to leave? Your changes will be lost.\"\n            />\n            {selectingModel && (\n                <ModelSelector\n                    api={api}\n                    onCancel={() => setSelectingModel(false)}\n                    onSelectModel={(model) => {\n                        setModel(model);\n                        setSelectingModel(false);\n                    }}\n                    initialSelectedModel={model}\n                    inpainting={false}\n                />\n            )}\n        </div>\n    );\n};\n","/* tslint:disable */\n/* eslint-disable */\n/**\n * AIBrush API\n * Orchestration backend for AI Brush\n *\n * The version of the OpenAPI document: 1.0.0\n * Contact: admin@aibrush.art\n *\n * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).\n * https://openapi-generator.tech\n * Do not edit the class manually.\n */\n\n\nimport { Configuration } from './configuration';\nimport globalAxios, { AxiosPromise, AxiosInstance } from 'axios';\n// Some imports not used depending on template conditions\n// @ts-ignore\nimport { DUMMY_BASE_URL, assertParamExists, setApiKeyToObject, setBasicAuthToObject, setBearerAuthToObject, setOAuthToObject, setSearchParams, serializeDataIfNeeded, toPathString, createRequestFunction } from './common';\n// @ts-ignore\nimport { BASE_PATH, COLLECTION_FORMATS, RequestArgs, BaseAPI, RequiredError } from './base';\n\n/**\n * \n * @export\n * @interface AddMetricItem\n */\nexport interface AddMetricItem {\n    /**\n     * \n     * @type {string}\n     * @memberof AddMetricItem\n     */\n    name: string;\n    /**\n     * \n     * @type {number}\n     * @memberof AddMetricItem\n     */\n    value: number;\n    /**\n     * \n     * @type {string}\n     * @memberof AddMetricItem\n     */\n    type: AddMetricItemTypeEnum;\n    /**\n     * \n     * @type {Array<MetricAttribute>}\n     * @memberof AddMetricItem\n     */\n    attributes: Array<MetricAttribute>;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum AddMetricItemTypeEnum {\n    Gauge = 'gauge',\n    Count = 'count'\n}\n\n/**\n * \n * @export\n * @interface AddMetricsInput\n */\nexport interface AddMetricsInput {\n    /**\n     * \n     * @type {Array<AddMetricItem>}\n     * @memberof AddMetricsInput\n     */\n    metrics: Array<AddMetricItem>;\n}\n/**\n * \n * @export\n * @interface AssetsUrl\n */\nexport interface AssetsUrl {\n    /**\n     * \n     * @type {string}\n     * @memberof AssetsUrl\n     */\n    assets_url: string;\n}\n/**\n * \n * @export\n * @interface BatchGetImagesInput\n */\nexport interface BatchGetImagesInput {\n    /**\n     * \n     * @type {Array<string>}\n     * @memberof BatchGetImagesInput\n     */\n    ids: Array<string>;\n}\n/**\n * \n * @export\n * @interface CreateDepositCodeInput\n */\nexport interface CreateDepositCodeInput {\n    /**\n     * \n     * @type {number}\n     * @memberof CreateDepositCodeInput\n     */\n    amount: number;\n}\n/**\n * \n * @export\n * @interface CreateImageInput\n */\nexport interface CreateImageInput {\n    /**\n     * \n     * @type {StatusEnum}\n     * @memberof CreateImageInput\n     */\n    status?: StatusEnum;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    label?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    parent?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    encoded_image?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    encoded_mask?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    tmp_image_id?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    tmp_jpg_id?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    tmp_mask_id?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    tmp_thumbnail_id?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    model: string;\n    /**\n     * \n     * @type {ImageParams}\n     * @memberof CreateImageInput\n     */\n    params: ImageParams;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    count: number;\n    /**\n     * \n     * @type {boolean}\n     * @memberof CreateImageInput\n     */\n    nsfw?: boolean;\n    /**\n     * \n     * @type {boolean}\n     * @memberof CreateImageInput\n     */\n    temporary?: boolean;\n}\n/**\n * \n * @export\n * @interface CreateStripeSessionInput\n */\nexport interface CreateStripeSessionInput {\n    /**\n     * \n     * @type {string}\n     * @memberof CreateStripeSessionInput\n     */\n    product_id: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateStripeSessionInput\n     */\n    success_url: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateStripeSessionInput\n     */\n    cancel_url: string;\n}\n/**\n * \n * @export\n * @interface Credits\n */\nexport interface Credits {\n    /**\n     * \n     * @type {number}\n     * @memberof Credits\n     */\n    free_credits: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Credits\n     */\n    paid_credits: number;\n}\n/**\n * \n * @export\n * @interface DepositCode\n */\nexport interface DepositCode {\n    /**\n     * \n     * @type {string}\n     * @memberof DepositCode\n     */\n    code: string;\n    /**\n     * \n     * @type {number}\n     * @memberof DepositCode\n     */\n    amount: number;\n}\n/**\n * \n * @export\n * @interface DepositRequest\n */\nexport interface DepositRequest {\n    /**\n     * Amount in credits\n     * @type {number}\n     * @memberof DepositRequest\n     */\n    amount: number;\n}\n/**\n * \n * @export\n * @interface DiscordLogin\n */\nexport interface DiscordLogin {\n    /**\n     * \n     * @type {string}\n     * @memberof DiscordLogin\n     */\n    code: string;\n}\n/**\n * \n * @export\n * @interface FeatureList\n */\nexport interface FeatureList {\n    /**\n     * \n     * @type {string}\n     * @memberof FeatureList\n     */\n    terms_uri?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof FeatureList\n     */\n    privacy_uri?: string;\n}\n/**\n * \n * @export\n * @interface GlobalSettings\n */\nexport interface GlobalSettings {\n    /**\n     * \n     * @type {string}\n     * @memberof GlobalSettings\n     */\n    settings_key: string;\n    /**\n     * \n     * @type {object}\n     * @memberof GlobalSettings\n     */\n    settings_json: object;\n}\n/**\n * \n * @export\n * @interface Healthcheck\n */\nexport interface Healthcheck {\n    /**\n     * \n     * @type {string}\n     * @memberof Healthcheck\n     */\n    status?: HealthcheckStatusEnum;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum HealthcheckStatusEnum {\n    Ok = 'ok'\n}\n\n/**\n * \n * @export\n * @interface Image\n */\nexport interface Image {\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    id: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    created_at: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    created_by: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    updated_at: number;\n    /**\n     * \n     * @type {ImageParams}\n     * @memberof Image\n     */\n    params: ImageParams;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    label: string;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    parent: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    score: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    negative_score: number;\n    /**\n     * \n     * @type {StatusEnum}\n     * @memberof Image\n     */\n    status: StatusEnum;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    model: string;\n    /**\n     * \n     * @type {boolean}\n     * @memberof Image\n     */\n    nsfw: boolean;\n    /**\n     * \n     * @type {boolean}\n     * @memberof Image\n     */\n    temporary: boolean;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    deleted_at?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    error?: string;\n}\n/**\n * \n * @export\n * @interface ImageList\n */\nexport interface ImageList {\n    /**\n     * \n     * @type {Array<Image>}\n     * @memberof ImageList\n     */\n    images?: Array<Image>;\n}\n/**\n * \n * @export\n * @interface ImageParams\n */\nexport interface ImageParams {\n    /**\n     * \n     * @type {string}\n     * @memberof ImageParams\n     */\n    prompt?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof ImageParams\n     */\n    steps?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof ImageParams\n     */\n    negative_prompt?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof ImageParams\n     */\n    width?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof ImageParams\n     */\n    height?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof ImageParams\n     */\n    denoising_strength?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof ImageParams\n     */\n    cfg_scale?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof ImageParams\n     */\n    seed?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof ImageParams\n     */\n    controlnet_type?: ImageParamsControlnetTypeEnum;\n    /**\n     * \n     * @type {string}\n     * @memberof ImageParams\n     */\n    augmentation?: ImageParamsAugmentationEnum;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum ImageParamsControlnetTypeEnum {\n    Canny = 'canny',\n    Hed = 'hed',\n    Depth = 'depth',\n    Normal = 'normal',\n    Openpose = 'openpose',\n    Seg = 'seg',\n    Scribble = 'scribble',\n    Fakescribbles = 'fakescribbles',\n    Hough = 'hough'\n}\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum ImageParamsAugmentationEnum {\n    FaceRestore = 'face_restore',\n    RemoveBackground = 'remove_background',\n    Upscale = 'upscale'\n}\n\n/**\n * \n * @export\n * @interface ImageUrls\n */\nexport interface ImageUrls {\n    /**\n     * \n     * @type {string}\n     * @memberof ImageUrls\n     */\n    init_image_url?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof ImageUrls\n     */\n    image_url?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof ImageUrls\n     */\n    mask_url?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof ImageUrls\n     */\n    thumbnail_url?: string;\n}\n/**\n * \n * @export\n * @interface InviteCode\n */\nexport interface InviteCode {\n    /**\n     * \n     * @type {string}\n     * @memberof InviteCode\n     */\n    id?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof InviteCode\n     */\n    created_at?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof InviteCode\n     */\n    created_by?: string;\n}\n/**\n * \n * @export\n * @interface IsAdminResponse\n */\nexport interface IsAdminResponse {\n    /**\n     * \n     * @type {boolean}\n     * @memberof IsAdminResponse\n     */\n    is_admin?: boolean;\n}\n/**\n * \n * @export\n * @interface LoginInput\n */\nexport interface LoginInput {\n    /**\n     * \n     * @type {string}\n     * @memberof LoginInput\n     */\n    email?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof LoginInput\n     */\n    invite_code?: string;\n}\n/**\n * \n * @export\n * @interface LoginResult\n */\nexport interface LoginResult {\n    /**\n     * \n     * @type {string}\n     * @memberof LoginResult\n     */\n    accessToken?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof LoginResult\n     */\n    refreshToken?: string;\n}\n/**\n * \n * @export\n * @interface MetricAttribute\n */\nexport interface MetricAttribute {\n    /**\n     * \n     * @type {string}\n     * @memberof MetricAttribute\n     */\n    name?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof MetricAttribute\n     */\n    value?: string;\n}\n/**\n * \n * @export\n * @interface Order\n */\nexport interface Order {\n    /**\n     * \n     * @type {string}\n     * @memberof Order\n     */\n    id: string;\n    /**\n     * \n     * @type {string}\n     * @memberof Order\n     */\n    created_by: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Order\n     */\n    created_at: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Order\n     */\n    ends_at: number;\n    /**\n     * \n     * @type {boolean}\n     * @memberof Order\n     */\n    is_active: boolean;\n    /**\n     * \n     * @type {number}\n     * @memberof Order\n     */\n    gpu_count: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Order\n     */\n    amount_paid_cents: number;\n}\n/**\n * \n * @export\n * @interface RefreshLoginInput\n */\nexport interface RefreshLoginInput {\n    /**\n     * \n     * @type {string}\n     * @memberof RefreshLoginInput\n     */\n    refreshToken?: string;\n}\n/**\n * \n * @export\n * @interface StableDiffusionModel\n */\nexport interface StableDiffusionModel {\n    /**\n     * The name of the model\n     * @type {string}\n     * @memberof StableDiffusionModel\n     */\n    name: string;\n    /**\n     * The baseline model used\n     * @type {string}\n     * @memberof StableDiffusionModel\n     */\n    baseline: string;\n    /**\n     * The type of the model (e.g., ckpt)\n     * @type {string}\n     * @memberof StableDiffusionModel\n     */\n    type: string;\n    /**\n     * A short description of the model\n     * @type {string}\n     * @memberof StableDiffusionModel\n     */\n    description: string;\n    /**\n     * Tags associated with the model\n     * @type {Array<string>}\n     * @memberof StableDiffusionModel\n     */\n    tags: Array<string>;\n    /**\n     * A list of URIs for showcase images\n     * @type {Array<string>}\n     * @memberof StableDiffusionModel\n     */\n    showcases: Array<string>;\n    /**\n     * The version of the model\n     * @type {string}\n     * @memberof StableDiffusionModel\n     */\n    version: string;\n    /**\n     * The style of the model (e.g., anime, furry)\n     * @type {string}\n     * @memberof StableDiffusionModel\n     */\n    style: string;\n    /**\n     * Whether the model is Not Safe For Work (NSFW)\n     * @type {boolean}\n     * @memberof StableDiffusionModel\n     */\n    nsfw: boolean;\n    /**\n     * Whether to download all model files\n     * @type {boolean}\n     * @memberof StableDiffusionModel\n     */\n    download_all: boolean;\n    /**\n     * Configuration information for the model\n     * @type {object}\n     * @memberof StableDiffusionModel\n     */\n    config: object;\n    /**\n     * Whether the model is available for use\n     * @type {boolean}\n     * @memberof StableDiffusionModel\n     */\n    available: boolean;\n    /**\n     * Whether the model is an inpainting model\n     * @type {boolean}\n     * @memberof StableDiffusionModel\n     */\n    inpainting: boolean;\n}\n/**\n * \n * @export\n * @enum {string}\n */\n\nexport enum StatusEnum {\n    Pending = 'pending',\n    Processing = 'processing',\n    Completed = 'completed',\n    Saved = 'saved',\n    Error = 'error',\n    Deleted = 'deleted'\n}\n\n/**\n * \n * @export\n * @interface StripeSession\n */\nexport interface StripeSession {\n    /**\n     * \n     * @type {string}\n     * @memberof StripeSession\n     */\n    session_id: string;\n}\n/**\n * \n * @export\n * @interface TemporaryImage\n */\nexport interface TemporaryImage {\n    /**\n     * \n     * @type {string}\n     * @memberof TemporaryImage\n     */\n    id: string;\n    /**\n     * \n     * @type {string}\n     * @memberof TemporaryImage\n     */\n    upload_url: string;\n}\n/**\n * \n * @export\n * @interface UpdateGlobalSettingsRequest\n */\nexport interface UpdateGlobalSettingsRequest {\n    /**\n     * \n     * @type {object}\n     * @memberof UpdateGlobalSettingsRequest\n     */\n    settings_json: object;\n}\n/**\n * \n * @export\n * @interface UpdateImageInput\n */\nexport interface UpdateImageInput {\n    /**\n     * \n     * @type {string}\n     * @memberof UpdateImageInput\n     */\n    label?: string;\n    /**\n     * \n     * @type {StatusEnum}\n     * @memberof UpdateImageInput\n     */\n    status?: StatusEnum;\n    /**\n     * \n     * @type {string}\n     * @memberof UpdateImageInput\n     */\n    encoded_image?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof UpdateImageInput\n     */\n    encoded_npy?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof UpdateImageInput\n     */\n    score?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof UpdateImageInput\n     */\n    negative_score?: number;\n    /**\n     * \n     * @type {boolean}\n     * @memberof UpdateImageInput\n     */\n    nsfw?: boolean;\n    /**\n     * \n     * @type {number}\n     * @memberof UpdateImageInput\n     */\n    deleted_at?: number | null;\n    /**\n     * \n     * @type {string}\n     * @memberof UpdateImageInput\n     */\n    error?: string;\n}\n/**\n * \n * @export\n * @interface UpsertWorkerConfigInput\n */\nexport interface UpsertWorkerConfigInput {\n    /**\n     * \n     * @type {Array<WorkerGpuConfig>}\n     * @memberof UpsertWorkerConfigInput\n     */\n    gpu_configs?: Array<WorkerGpuConfig>;\n}\n/**\n * \n * @export\n * @interface UpsertWorkerInput\n */\nexport interface UpsertWorkerInput {\n    /**\n     * \n     * @type {string}\n     * @memberof UpsertWorkerInput\n     */\n    display_name?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof UpsertWorkerInput\n     */\n    status?: UpsertWorkerInputStatusEnum;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum UpsertWorkerInputStatusEnum {\n    Idle = 'idle',\n    Active = 'active'\n}\n\n/**\n * \n * @export\n * @interface User\n */\nexport interface User {\n    /**\n     * \n     * @type {string}\n     * @memberof User\n     */\n    id?: string;\n    /**\n     * \n     * @type {boolean}\n     * @memberof User\n     */\n    active?: boolean;\n    /**\n     * \n     * @type {string}\n     * @memberof User\n     */\n    customer_id?: string;\n}\n/**\n * \n * @export\n * @interface VerifyLoginInput\n */\nexport interface VerifyLoginInput {\n    /**\n     * \n     * @type {string}\n     * @memberof VerifyLoginInput\n     */\n    email?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof VerifyLoginInput\n     */\n    code?: string;\n}\n/**\n * \n * @export\n * @interface Worker\n */\nexport interface Worker {\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    id: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Worker\n     */\n    created_at: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    display_name: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Worker\n     */\n    last_ping?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    status?: WorkerStatusEnum;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    login_code?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    engine?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Worker\n     */\n    num_gpus?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    cloud_instance_id?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    gpu_type?: string;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum WorkerStatusEnum {\n    Idle = 'idle',\n    Active = 'active'\n}\n\n/**\n * \n * @export\n * @interface WorkerConfig\n */\nexport interface WorkerConfig {\n    /**\n     * \n     * @type {string}\n     * @memberof WorkerConfig\n     */\n    worker_id: string;\n    /**\n     * \n     * @type {Array<WorkerGpuConfig>}\n     * @memberof WorkerConfig\n     */\n    gpu_configs?: Array<WorkerGpuConfig>;\n}\n/**\n * \n * @export\n * @interface WorkerGpuConfig\n */\nexport interface WorkerGpuConfig {\n    /**\n     * \n     * @type {number}\n     * @memberof WorkerGpuConfig\n     */\n    gpu_num: number;\n    /**\n     * \n     * @type {string}\n     * @memberof WorkerGpuConfig\n     */\n    model: string;\n}\n/**\n * \n * @export\n * @interface WorkerList\n */\nexport interface WorkerList {\n    /**\n     * \n     * @type {Array<Worker>}\n     * @memberof WorkerList\n     */\n    workers?: Array<Worker>;\n}\n/**\n * \n * @export\n * @interface WorkerLoginCode\n */\nexport interface WorkerLoginCode {\n    /**\n     * \n     * @type {string}\n     * @memberof WorkerLoginCode\n     */\n    login_code: string;\n}\n\n/**\n * AIBrushApi - axios parameter creator\n * @export\n */\nexport const AIBrushApiAxiosParamCreator = function (configuration?: Configuration) {\n    return {\n        /**\n         * Add Metrics\n         * @param {AddMetricsInput} [addMetricsInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        addMetrics: async (addMetricsInput?: AddMetricsInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/metrics`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(addMetricsInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get a list of saved images by id\n         * @param {string} [fields] Comma-separated list of fields to include in the response images. For example: \\&quot;id,params,created_at\\&quot; \n         * @param {BatchGetImagesInput} [batchGetImagesInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        batchGetImages: async (fields?: string, batchGetImagesInput?: BatchGetImagesInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/batch-get-images`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n            if (fields !== undefined) {\n                localVarQueryParameter['fields'] = fields;\n            }\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(batchGetImagesInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Create a new deposit code\n         * @param {CreateDepositCodeInput} [createDepositCodeInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createDepositCode: async (createDepositCodeInput?: CreateDepositCodeInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/deposit-codes`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(createDepositCodeInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Create a new image\n         * @param {CreateImageInput} [createImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createImage: async (createImageInput?: CreateImageInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/images`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(createImageInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Create a new invite code\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createInviteCode: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/invite-codes`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Create a new Stripe session\n         * @param {CreateStripeSessionInput} [createStripeSessionInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createStripeSession: async (createStripeSessionInput?: CreateStripeSessionInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/stripe-sessions`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(createStripeSessionInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Create a new temporary image\n         * @param {string} format \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createTemporaryImage: async (format: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'format' is not null or undefined\n            assertParamExists('createTemporaryImage', 'format', format)\n            const localVarPath = `/api/temporary-images`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n            if (format !== undefined) {\n                localVarQueryParameter['format'] = format;\n            }\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Delete a saved image\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        deleteImage: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('deleteImage', 'id', id)\n            const localVarPath = `/api/images/{id}`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'DELETE', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Log in with Discord\n         * @param {DiscordLogin} [discordLogin] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        discordLogin: async (discordLogin?: DiscordLogin, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/discord-login`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(discordLogin, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the assets url\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getAssetsUrl: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/assets-url`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the user\\'s credit balance\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getCredits: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/credits`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the features\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getFeatures: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/features`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the global settings\n         * @param {string} key \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getGlobalSettings: async (key: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'key' is not null or undefined\n            assertParamExists('getGlobalSettings', 'key', key)\n            const localVarPath = `/api/global-settings/{key}`\n                .replace(`{${\"key\"}}`, encodeURIComponent(String(key)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get a saved image by id\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImage: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getImage', 'id', id)\n            const localVarPath = `/api/images/{id}`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the binary image data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageData: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getImageData', 'id', id)\n            const localVarPath = `/api/images/{id}.image.png`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get download urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageDownloadUrls: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getImageDownloadUrls', 'id', id)\n            const localVarPath = `/api/images/{id}/download-urls`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get upload urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageUploadUrls: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getImageUploadUrls', 'id', id)\n            const localVarPath = `/api/images/{id}/upload-urls`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the binary mask data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getMaskData: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getMaskData', 'id', id)\n            const localVarPath = `/api/images/{id}.mask.png`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * \n         * @summary Get available models\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getModels: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/stable-diffusion-models`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the binary thumbnail data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getThumbnailData: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getThumbnailData', 'id', id)\n            const localVarPath = `/api/images/{id}.thumbnail.png`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Healthcheck\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        healthcheck: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/healthcheck`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Check if the user is admin\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        isAdmin: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/is-admin`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get a list of saved images\n         * @param {number} [cursor] \n         * @param {string} [filter] \n         * @param {number} [limit] \n         * @param {'asc' | 'desc'} [direction] \n         * @param {string} [fields] Comma-separated list of fields to include in the response images. For example: \\&quot;id,params,created_at\\&quot; \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        listImages: async (cursor?: number, filter?: string, limit?: number, direction?: 'asc' | 'desc', fields?: string, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/images`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n            if (cursor !== undefined) {\n                localVarQueryParameter['cursor'] = cursor;\n            }\n\n            if (filter !== undefined) {\n                localVarQueryParameter['filter'] = filter;\n            }\n\n            if (limit !== undefined) {\n                localVarQueryParameter['limit'] = limit;\n            }\n\n            if (direction !== undefined) {\n                localVarQueryParameter['direction'] = direction;\n            }\n\n            if (fields !== undefined) {\n                localVarQueryParameter['fields'] = fields;\n            }\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Login by email\n         * @param {LoginInput} [loginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        login: async (loginInput?: LoginInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/auth/login`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(loginInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Redeem a deposit code\n         * @param {string} code \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        redeemDepositCode: async (code: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'code' is not null or undefined\n            assertParamExists('redeemDepositCode', 'code', code)\n            const localVarPath = `/api/deposit-codes/{code}`\n                .replace(`{${\"code\"}}`, encodeURIComponent(String(code)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Refresh Login code\n         * @param {RefreshLoginInput} [refreshLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        refresh: async (refreshLoginInput?: RefreshLoginInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/auth/refresh`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(refreshLoginInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Update the global settings\n         * @param {string} key \n         * @param {UpdateGlobalSettingsRequest} [updateGlobalSettingsRequest] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateGlobalSettings: async (key: string, updateGlobalSettingsRequest?: UpdateGlobalSettingsRequest, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'key' is not null or undefined\n            assertParamExists('updateGlobalSettings', 'key', key)\n            const localVarPath = `/api/global-settings/{key}`\n                .replace(`{${\"key\"}}`, encodeURIComponent(String(key)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'PUT', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(updateGlobalSettingsRequest, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Update a saved image\n         * @param {string} id \n         * @param {UpdateImageInput} [updateImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateImage: async (id: string, updateImageInput?: UpdateImageInput, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('updateImage', 'id', id)\n            const localVarPath = `/api/images/{id}`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'PATCH', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(updateImageInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Upload the binary image data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        uploadImageData: async (id: string, body?: any, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('uploadImageData', 'id', id)\n            const localVarPath = `/api/images/{id}.image.png`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'PUT', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'image/png';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(body, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Upload the binary thumbnail data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        uploadThumbnailData: async (id: string, body?: any, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('uploadThumbnailData', 'id', id)\n            const localVarPath = `/api/images/{id}.thumbnail.png`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'PUT', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'image/png';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(body, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Verify Login code\n         * @param {VerifyLoginInput} [verifyLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        verify: async (verifyLoginInput?: VerifyLoginInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/auth/verify`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(verifyLoginInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n    }\n};\n\n/**\n * AIBrushApi - functional programming interface\n * @export\n */\nexport const AIBrushApiFp = function(configuration?: Configuration) {\n    const localVarAxiosParamCreator = AIBrushApiAxiosParamCreator(configuration)\n    return {\n        /**\n         * Add Metrics\n         * @param {AddMetricsInput} [addMetricsInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async addMetrics(addMetricsInput?: AddMetricsInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.addMetrics(addMetricsInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get a list of saved images by id\n         * @param {string} [fields] Comma-separated list of fields to include in the response images. For example: \\&quot;id,params,created_at\\&quot; \n         * @param {BatchGetImagesInput} [batchGetImagesInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async batchGetImages(fields?: string, batchGetImagesInput?: BatchGetImagesInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<ImageList>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.batchGetImages(fields, batchGetImagesInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Create a new deposit code\n         * @param {CreateDepositCodeInput} [createDepositCodeInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async createDepositCode(createDepositCodeInput?: CreateDepositCodeInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<DepositCode>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.createDepositCode(createDepositCodeInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Create a new image\n         * @param {CreateImageInput} [createImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async createImage(createImageInput?: CreateImageInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<ImageList>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.createImage(createImageInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Create a new invite code\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async createInviteCode(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<InviteCode>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.createInviteCode(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Create a new Stripe session\n         * @param {CreateStripeSessionInput} [createStripeSessionInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async createStripeSession(createStripeSessionInput?: CreateStripeSessionInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<StripeSession>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.createStripeSession(createStripeSessionInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Create a new temporary image\n         * @param {string} format \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async createTemporaryImage(format: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<TemporaryImage>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.createTemporaryImage(format, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Delete a saved image\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async deleteImage(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.deleteImage(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Log in with Discord\n         * @param {DiscordLogin} [discordLogin] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async discordLogin(discordLogin?: DiscordLogin, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<LoginResult>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.discordLogin(discordLogin, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the assets url\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getAssetsUrl(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<AssetsUrl>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getAssetsUrl(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the user\\'s credit balance\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getCredits(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Credits>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getCredits(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the features\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getFeatures(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<FeatureList>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getFeatures(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the global settings\n         * @param {string} key \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getGlobalSettings(key: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<GlobalSettings>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getGlobalSettings(key, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get a saved image by id\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getImage(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Image>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getImage(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the binary image data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getImageData(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<any>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getImageData(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get download urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getImageDownloadUrls(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<ImageUrls>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getImageDownloadUrls(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get upload urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getImageUploadUrls(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<ImageUrls>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getImageUploadUrls(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the binary mask data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getMaskData(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<any>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getMaskData(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * \n         * @summary Get available models\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getModels(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<{ [key: string]: StableDiffusionModel; }>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getModels(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the binary thumbnail data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getThumbnailData(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<any>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getThumbnailData(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Healthcheck\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async healthcheck(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Healthcheck>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.healthcheck(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Check if the user is admin\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async isAdmin(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<IsAdminResponse>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.isAdmin(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get a list of saved images\n         * @param {number} [cursor] \n         * @param {string} [filter] \n         * @param {number} [limit] \n         * @param {'asc' | 'desc'} [direction] \n         * @param {string} [fields] Comma-separated list of fields to include in the response images. For example: \\&quot;id,params,created_at\\&quot; \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async listImages(cursor?: number, filter?: string, limit?: number, direction?: 'asc' | 'desc', fields?: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<ImageList>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.listImages(cursor, filter, limit, direction, fields, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Login by email\n         * @param {LoginInput} [loginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async login(loginInput?: LoginInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.login(loginInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Redeem a deposit code\n         * @param {string} code \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async redeemDepositCode(code: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.redeemDepositCode(code, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Refresh Login code\n         * @param {RefreshLoginInput} [refreshLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async refresh(refreshLoginInput?: RefreshLoginInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<LoginResult>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.refresh(refreshLoginInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Update the global settings\n         * @param {string} key \n         * @param {UpdateGlobalSettingsRequest} [updateGlobalSettingsRequest] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async updateGlobalSettings(key: string, updateGlobalSettingsRequest?: UpdateGlobalSettingsRequest, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<GlobalSettings>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.updateGlobalSettings(key, updateGlobalSettingsRequest, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Update a saved image\n         * @param {string} id \n         * @param {UpdateImageInput} [updateImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async updateImage(id: string, updateImageInput?: UpdateImageInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Image>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.updateImage(id, updateImageInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Upload the binary image data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async uploadImageData(id: string, body?: any, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.uploadImageData(id, body, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Upload the binary thumbnail data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async uploadThumbnailData(id: string, body?: any, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.uploadThumbnailData(id, body, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Verify Login code\n         * @param {VerifyLoginInput} [verifyLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async verify(verifyLoginInput?: VerifyLoginInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<LoginResult>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.verify(verifyLoginInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n    }\n};\n\n/**\n * AIBrushApi - factory interface\n * @export\n */\nexport const AIBrushApiFactory = function (configuration?: Configuration, basePath?: string, axios?: AxiosInstance) {\n    const localVarFp = AIBrushApiFp(configuration)\n    return {\n        /**\n         * Add Metrics\n         * @param {AddMetricsInput} [addMetricsInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        addMetrics(addMetricsInput?: AddMetricsInput, options?: any): AxiosPromise<void> {\n            return localVarFp.addMetrics(addMetricsInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get a list of saved images by id\n         * @param {string} [fields] Comma-separated list of fields to include in the response images. For example: \\&quot;id,params,created_at\\&quot; \n         * @param {BatchGetImagesInput} [batchGetImagesInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        batchGetImages(fields?: string, batchGetImagesInput?: BatchGetImagesInput, options?: any): AxiosPromise<ImageList> {\n            return localVarFp.batchGetImages(fields, batchGetImagesInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Create a new deposit code\n         * @param {CreateDepositCodeInput} [createDepositCodeInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createDepositCode(createDepositCodeInput?: CreateDepositCodeInput, options?: any): AxiosPromise<DepositCode> {\n            return localVarFp.createDepositCode(createDepositCodeInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Create a new image\n         * @param {CreateImageInput} [createImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createImage(createImageInput?: CreateImageInput, options?: any): AxiosPromise<ImageList> {\n            return localVarFp.createImage(createImageInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Create a new invite code\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createInviteCode(options?: any): AxiosPromise<InviteCode> {\n            return localVarFp.createInviteCode(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Create a new Stripe session\n         * @param {CreateStripeSessionInput} [createStripeSessionInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createStripeSession(createStripeSessionInput?: CreateStripeSessionInput, options?: any): AxiosPromise<StripeSession> {\n            return localVarFp.createStripeSession(createStripeSessionInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Create a new temporary image\n         * @param {string} format \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createTemporaryImage(format: string, options?: any): AxiosPromise<TemporaryImage> {\n            return localVarFp.createTemporaryImage(format, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Delete a saved image\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        deleteImage(id: string, options?: any): AxiosPromise<void> {\n            return localVarFp.deleteImage(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Log in with Discord\n         * @param {DiscordLogin} [discordLogin] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        discordLogin(discordLogin?: DiscordLogin, options?: any): AxiosPromise<LoginResult> {\n            return localVarFp.discordLogin(discordLogin, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the assets url\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getAssetsUrl(options?: any): AxiosPromise<AssetsUrl> {\n            return localVarFp.getAssetsUrl(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the user\\'s credit balance\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getCredits(options?: any): AxiosPromise<Credits> {\n            return localVarFp.getCredits(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the features\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getFeatures(options?: any): AxiosPromise<FeatureList> {\n            return localVarFp.getFeatures(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the global settings\n         * @param {string} key \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getGlobalSettings(key: string, options?: any): AxiosPromise<GlobalSettings> {\n            return localVarFp.getGlobalSettings(key, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get a saved image by id\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImage(id: string, options?: any): AxiosPromise<Image> {\n            return localVarFp.getImage(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the binary image data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageData(id: string, options?: any): AxiosPromise<any> {\n            return localVarFp.getImageData(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get download urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageDownloadUrls(id: string, options?: any): AxiosPromise<ImageUrls> {\n            return localVarFp.getImageDownloadUrls(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get upload urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageUploadUrls(id: string, options?: any): AxiosPromise<ImageUrls> {\n            return localVarFp.getImageUploadUrls(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the binary mask data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getMaskData(id: string, options?: any): AxiosPromise<any> {\n            return localVarFp.getMaskData(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * \n         * @summary Get available models\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getModels(options?: any): AxiosPromise<{ [key: string]: StableDiffusionModel; }> {\n            return localVarFp.getModels(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the binary thumbnail data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getThumbnailData(id: string, options?: any): AxiosPromise<any> {\n            return localVarFp.getThumbnailData(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Healthcheck\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        healthcheck(options?: any): AxiosPromise<Healthcheck> {\n            return localVarFp.healthcheck(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Check if the user is admin\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        isAdmin(options?: any): AxiosPromise<IsAdminResponse> {\n            return localVarFp.isAdmin(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get a list of saved images\n         * @param {number} [cursor] \n         * @param {string} [filter] \n         * @param {number} [limit] \n         * @param {'asc' | 'desc'} [direction] \n         * @param {string} [fields] Comma-separated list of fields to include in the response images. For example: \\&quot;id,params,created_at\\&quot; \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        listImages(cursor?: number, filter?: string, limit?: number, direction?: 'asc' | 'desc', fields?: string, options?: any): AxiosPromise<ImageList> {\n            return localVarFp.listImages(cursor, filter, limit, direction, fields, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Login by email\n         * @param {LoginInput} [loginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        login(loginInput?: LoginInput, options?: any): AxiosPromise<void> {\n            return localVarFp.login(loginInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Redeem a deposit code\n         * @param {string} code \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        redeemDepositCode(code: string, options?: any): AxiosPromise<void> {\n            return localVarFp.redeemDepositCode(code, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Refresh Login code\n         * @param {RefreshLoginInput} [refreshLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        refresh(refreshLoginInput?: RefreshLoginInput, options?: any): AxiosPromise<LoginResult> {\n            return localVarFp.refresh(refreshLoginInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Update the global settings\n         * @param {string} key \n         * @param {UpdateGlobalSettingsRequest} [updateGlobalSettingsRequest] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateGlobalSettings(key: string, updateGlobalSettingsRequest?: UpdateGlobalSettingsRequest, options?: any): AxiosPromise<GlobalSettings> {\n            return localVarFp.updateGlobalSettings(key, updateGlobalSettingsRequest, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Update a saved image\n         * @param {string} id \n         * @param {UpdateImageInput} [updateImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateImage(id: string, updateImageInput?: UpdateImageInput, options?: any): AxiosPromise<Image> {\n            return localVarFp.updateImage(id, updateImageInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Upload the binary image data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        uploadImageData(id: string, body?: any, options?: any): AxiosPromise<void> {\n            return localVarFp.uploadImageData(id, body, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Upload the binary thumbnail data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        uploadThumbnailData(id: string, body?: any, options?: any): AxiosPromise<void> {\n            return localVarFp.uploadThumbnailData(id, body, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Verify Login code\n         * @param {VerifyLoginInput} [verifyLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        verify(verifyLoginInput?: VerifyLoginInput, options?: any): AxiosPromise<LoginResult> {\n            return localVarFp.verify(verifyLoginInput, options).then((request) => request(axios, basePath));\n        },\n    };\n};\n\n/**\n * AIBrushApi - object-oriented interface\n * @export\n * @class AIBrushApi\n * @extends {BaseAPI}\n */\nexport class AIBrushApi extends BaseAPI {\n    /**\n     * Add Metrics\n     * @param {AddMetricsInput} [addMetricsInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public addMetrics(addMetricsInput?: AddMetricsInput, options?: any) {\n        return AIBrushApiFp(this.configuration).addMetrics(addMetricsInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get a list of saved images by id\n     * @param {string} [fields] Comma-separated list of fields to include in the response images. For example: \\&quot;id,params,created_at\\&quot; \n     * @param {BatchGetImagesInput} [batchGetImagesInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public batchGetImages(fields?: string, batchGetImagesInput?: BatchGetImagesInput, options?: any) {\n        return AIBrushApiFp(this.configuration).batchGetImages(fields, batchGetImagesInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Create a new deposit code\n     * @param {CreateDepositCodeInput} [createDepositCodeInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public createDepositCode(createDepositCodeInput?: CreateDepositCodeInput, options?: any) {\n        return AIBrushApiFp(this.configuration).createDepositCode(createDepositCodeInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Create a new image\n     * @param {CreateImageInput} [createImageInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public createImage(createImageInput?: CreateImageInput, options?: any) {\n        return AIBrushApiFp(this.configuration).createImage(createImageInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Create a new invite code\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public createInviteCode(options?: any) {\n        return AIBrushApiFp(this.configuration).createInviteCode(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Create a new Stripe session\n     * @param {CreateStripeSessionInput} [createStripeSessionInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public createStripeSession(createStripeSessionInput?: CreateStripeSessionInput, options?: any) {\n        return AIBrushApiFp(this.configuration).createStripeSession(createStripeSessionInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Create a new temporary image\n     * @param {string} format \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public createTemporaryImage(format: string, options?: any) {\n        return AIBrushApiFp(this.configuration).createTemporaryImage(format, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Delete a saved image\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public deleteImage(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).deleteImage(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Log in with Discord\n     * @param {DiscordLogin} [discordLogin] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public discordLogin(discordLogin?: DiscordLogin, options?: any) {\n        return AIBrushApiFp(this.configuration).discordLogin(discordLogin, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the assets url\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getAssetsUrl(options?: any) {\n        return AIBrushApiFp(this.configuration).getAssetsUrl(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the user\\'s credit balance\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getCredits(options?: any) {\n        return AIBrushApiFp(this.configuration).getCredits(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the features\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getFeatures(options?: any) {\n        return AIBrushApiFp(this.configuration).getFeatures(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the global settings\n     * @param {string} key \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getGlobalSettings(key: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getGlobalSettings(key, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get a saved image by id\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getImage(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getImage(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the binary image data\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getImageData(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getImageData(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get download urls for image assets\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getImageDownloadUrls(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getImageDownloadUrls(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get upload urls for image assets\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getImageUploadUrls(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getImageUploadUrls(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the binary mask data\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getMaskData(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getMaskData(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * \n     * @summary Get available models\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getModels(options?: any) {\n        return AIBrushApiFp(this.configuration).getModels(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the binary thumbnail data\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getThumbnailData(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getThumbnailData(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Healthcheck\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public healthcheck(options?: any) {\n        return AIBrushApiFp(this.configuration).healthcheck(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Check if the user is admin\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public isAdmin(options?: any) {\n        return AIBrushApiFp(this.configuration).isAdmin(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get a list of saved images\n     * @param {number} [cursor] \n     * @param {string} [filter] \n     * @param {number} [limit] \n     * @param {'asc' | 'desc'} [direction] \n     * @param {string} [fields] Comma-separated list of fields to include in the response images. For example: \\&quot;id,params,created_at\\&quot; \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public listImages(cursor?: number, filter?: string, limit?: number, direction?: 'asc' | 'desc', fields?: string, options?: any) {\n        return AIBrushApiFp(this.configuration).listImages(cursor, filter, limit, direction, fields, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Login by email\n     * @param {LoginInput} [loginInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public login(loginInput?: LoginInput, options?: any) {\n        return AIBrushApiFp(this.configuration).login(loginInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Redeem a deposit code\n     * @param {string} code \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public redeemDepositCode(code: string, options?: any) {\n        return AIBrushApiFp(this.configuration).redeemDepositCode(code, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Refresh Login code\n     * @param {RefreshLoginInput} [refreshLoginInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public refresh(refreshLoginInput?: RefreshLoginInput, options?: any) {\n        return AIBrushApiFp(this.configuration).refresh(refreshLoginInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Update the global settings\n     * @param {string} key \n     * @param {UpdateGlobalSettingsRequest} [updateGlobalSettingsRequest] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public updateGlobalSettings(key: string, updateGlobalSettingsRequest?: UpdateGlobalSettingsRequest, options?: any) {\n        return AIBrushApiFp(this.configuration).updateGlobalSettings(key, updateGlobalSettingsRequest, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Update a saved image\n     * @param {string} id \n     * @param {UpdateImageInput} [updateImageInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public updateImage(id: string, updateImageInput?: UpdateImageInput, options?: any) {\n        return AIBrushApiFp(this.configuration).updateImage(id, updateImageInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Upload the binary image data\n     * @param {string} id \n     * @param {any} [body] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public uploadImageData(id: string, body?: any, options?: any) {\n        return AIBrushApiFp(this.configuration).uploadImageData(id, body, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Upload the binary thumbnail data\n     * @param {string} id \n     * @param {any} [body] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public uploadThumbnailData(id: string, body?: any, options?: any) {\n        return AIBrushApiFp(this.configuration).uploadThumbnailData(id, body, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Verify Login code\n     * @param {VerifyLoginInput} [verifyLoginInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public verify(verifyLoginInput?: VerifyLoginInput, options?: any) {\n        return AIBrushApiFp(this.configuration).verify(verifyLoginInput, options).then((request) => request(this.axios, this.basePath));\n    }\n}\n\n\n","/* tslint:disable */\n/* eslint-disable */\n/**\n * AIBrush API\n * Orchestration backend for AI Brush\n *\n * The version of the OpenAPI document: 1.0.0\n * Contact: admin@aibrush.art\n *\n * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).\n * https://openapi-generator.tech\n * Do not edit the class manually.\n */\n\n\nimport { Configuration } from \"./configuration\";\n// Some imports not used depending on template conditions\n// @ts-ignore\nimport globalAxios, { AxiosPromise, AxiosInstance } from 'axios';\n\nexport const BASE_PATH = \"https://www.aibrush.art\".replace(/\\/+$/, \"\");\n\n/**\n *\n * @export\n */\nexport const COLLECTION_FORMATS = {\n    csv: \",\",\n    ssv: \" \",\n    tsv: \"\\t\",\n    pipes: \"|\",\n};\n\n/**\n *\n * @export\n * @interface RequestArgs\n */\nexport interface RequestArgs {\n    url: string;\n    options: any;\n}\n\n/**\n *\n * @export\n * @class BaseAPI\n */\nexport class BaseAPI {\n    protected configuration: Configuration | undefined;\n\n    constructor(configuration?: Configuration, protected basePath: string = BASE_PATH, protected axios: AxiosInstance = globalAxios) {\n        if (configuration) {\n            this.configuration = configuration;\n            this.basePath = configuration.basePath || this.basePath;\n        }\n    }\n};\n\n/**\n *\n * @export\n * @class RequiredError\n * @extends {Error}\n */\nexport class RequiredError extends Error {\n    name: \"RequiredError\" = \"RequiredError\";\n    constructor(public field: string, msg?: string) {\n        super(msg);\n    }\n}\n","/* tslint:disable */\n/* eslint-disable */\n/**\n * AIBrush API\n * Orchestration backend for AI Brush\n *\n * The version of the OpenAPI document: 1.0.0\n * Contact: admin@aibrush.art\n *\n * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).\n * https://openapi-generator.tech\n * Do not edit the class manually.\n */\n\n\nimport { Configuration } from \"./configuration\";\nimport { RequiredError,RequestArgs } from \"./base\";\nimport { AxiosInstance } from 'axios';\n\n/**\n *\n * @export\n */\nexport const DUMMY_BASE_URL = 'https://example.com'\n\n/**\n *\n * @throws {RequiredError}\n * @export\n */\nexport const assertParamExists = function (functionName: string, paramName: string, paramValue: unknown) {\n    if (paramValue === null || paramValue === undefined) {\n        throw new RequiredError(paramName, `Required parameter ${paramName} was null or undefined when calling ${functionName}.`);\n    }\n}\n\n/**\n *\n * @export\n */\nexport const setApiKeyToObject = async function (object: any, keyParamName: string, configuration?: Configuration) {\n    if (configuration && configuration.apiKey) {\n        const localVarApiKeyValue = typeof configuration.apiKey === 'function'\n            ? await configuration.apiKey(keyParamName)\n            : await configuration.apiKey;\n        object[keyParamName] = localVarApiKeyValue;\n    }\n}\n\n/**\n *\n * @export\n */\nexport const setBasicAuthToObject = function (object: any, configuration?: Configuration) {\n    if (configuration && (configuration.username || configuration.password)) {\n        object[\"auth\"] = { username: configuration.username, password: configuration.password };\n    }\n}\n\n/**\n *\n * @export\n */\nexport const setBearerAuthToObject = async function (object: any, configuration?: Configuration) {\n    if (configuration && configuration.accessToken) {\n        const accessToken = typeof configuration.accessToken === 'function'\n            ? await configuration.accessToken()\n            : await configuration.accessToken;\n        object[\"Authorization\"] = \"Bearer \" + accessToken;\n    }\n}\n\n/**\n *\n * @export\n */\nexport const setOAuthToObject = async function (object: any, name: string, scopes: string[], configuration?: Configuration) {\n    if (configuration && configuration.accessToken) {\n        const localVarAccessTokenValue = typeof configuration.accessToken === 'function'\n            ? await configuration.accessToken(name, scopes)\n            : await configuration.accessToken;\n        object[\"Authorization\"] = \"Bearer \" + localVarAccessTokenValue;\n    }\n}\n\n/**\n *\n * @export\n */\nexport const setSearchParams = function (url: URL, ...objects: any[]) {\n    const searchParams = new URLSearchParams(url.search);\n    for (const object of objects) {\n        for (const key in object) {\n            if (Array.isArray(object[key])) {\n                searchParams.delete(key);\n                for (const item of object[key]) {\n                    searchParams.append(key, item);\n                }\n            } else {\n                searchParams.set(key, object[key]);\n            }\n        }\n    }\n    url.search = searchParams.toString();\n}\n\n/**\n *\n * @export\n */\nexport const serializeDataIfNeeded = function (value: any, requestOptions: any, configuration?: Configuration) {\n    const nonString = typeof value !== 'string';\n    const needsSerialization = nonString && configuration && configuration.isJsonMime\n        ? configuration.isJsonMime(requestOptions.headers['Content-Type'])\n        : nonString;\n    return needsSerialization\n        ? JSON.stringify(value !== undefined ? value : {})\n        : (value || \"\");\n}\n\n/**\n *\n * @export\n */\nexport const toPathString = function (url: URL) {\n    return url.pathname + url.search + url.hash\n}\n\n/**\n *\n * @export\n */\nexport const createRequestFunction = function (axiosArgs: RequestArgs, globalAxios: AxiosInstance, BASE_PATH: string, configuration?: Configuration) {\n    return (axios: AxiosInstance = globalAxios, basePath: string = BASE_PATH) => {\n        const axiosRequestArgs = {...axiosArgs.options, url: (configuration?.basePath || basePath) + axiosArgs.url};\n        return axios.request(axiosRequestArgs);\n    };\n}\n","import React, { FC, useState, useEffect } from \"react\";\nimport { Renderer } from \"./renderer\";\nimport { BaseTool, Tool } from \"./tool\";\nimport { ZoomHelper } from \"./zoomHelper\";\n\nexport class SmudgeTool extends BaseTool implements Tool {\n    private brushSize = 10;\n    private brushOpacity = 0.2;\n\n    private lastX = 0;\n    private lastY = 0;\n    private panning = false;\n    private smudging = false;\n    private _dirty = false;\n\n    set dirty(dirty: boolean) {\n        this._dirty = dirty;\n        if (this.dirtyListener) {\n            this.dirtyListener(dirty);\n        }\n    }\n\n    get dirty() {\n        return this._dirty;\n    }\n\n    private dirtyListener?: (dirty: boolean) => void;\n\n    constructor(renderer: Renderer) {\n        super(renderer, \"smudge\");\n    }\n\n    private sync() {\n        this.renderer.setCursor({\n            type: \"circle\",\n            color: \"white\",\n            radius: this.brushSize / 2,\n            x: this.lastX,\n            y: this.lastY,\n        });\n    }\n\n    updateArgs(args: any) {\n        super.updateArgs(args);\n        this.brushSize = args.brushSize || 10;\n        this.brushOpacity = args.brushOpacity || 0.2;\n        this.sync();\n    }\n\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void {\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n\n        if (this.panning) {\n            this.zoomHelper.onPan(event);\n        } else if (this.smudging) {\n            this.renderer.smudgeLine(\n                this.lastX,\n                this.lastY,\n                x,\n                y,\n                this.brushSize,\n                this.brushOpacity\n            );\n            this.dirty = true;\n        }\n\n        this.lastX = x;\n        this.lastY = y;\n        this.sync();\n    }\n\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n        this.sync();\n    }\n\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (event.button === 0) {\n            this.smudging = true;\n            if (!this.dirty) {\n                this.renderer.copyEditImageFromBaseImage();\n            }\n            this.dirty = true;\n            let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n                event.nativeEvent.offsetX,\n                event.nativeEvent.offsetY\n            );\n            this.lastX = x;\n            this.lastY = y;\n            this.sync();\n        } else if (event.button === 1) {\n            this.panning = true;\n        }\n        this.sync();\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        this.smudging = false;\n        this.panning = false;\n        this.sync();\n    }\n\n    onSaveImage(listener: (encodedImage: string) => void): void {\n        this.saveListener = listener;\n    }\n\n    onDirty(listener: (dirty: boolean) => void): void {\n        this.dirtyListener = listener;\n    }\n\n    cancel() {\n        // kind of a hack, clears the selection layer\n        this.renderer.setEditImage(null);\n        this.dirty = false;\n    }\n\n    confirm() {\n        this.renderer.commitSelection();\n        const encodedImage = this.renderer.getEncodedImage(null);\n        if (encodedImage && this.saveListener) {\n            this.saveListener(encodedImage);\n        }\n        this.dirty = false;\n    }\n\n    destroy(): boolean {\n        if (this.dirty) {\n            this.renderer.commitSelection();\n        }\n        return true;\n    }\n}\n\ninterface Props {\n    renderer: Renderer;\n    tool: SmudgeTool;\n}\n\nexport const SmudgeControls: FC<Props> = ({ renderer, tool }) => {\n    const [brushSize, setBrushSize] = useState(10);\n    const [brushOpacity, setBrushOpacity] = useState(0.2);\n    const [dirty, setDirty] = useState(false);\n\n    tool.onDirty(setDirty);\n\n    useEffect(() => {\n        tool.updateArgs({\n            brushSize,\n            brushOpacity,\n        });\n    }, [brushSize, brushOpacity]);\n\n    return (\n        <div style={{ marginTop: \"16px\" }}>\n            <div className=\"form-group\">\n                <label style={{ width: \"100%\" }}>\n                    Brush size\n                    <small\n                        className=\"form-text text-muted\"\n                        style={{ float: \"right\" }}\n                    >\n                        {brushSize}px\n                    </small>\n                </label>\n                <input\n                    type=\"range\"\n                    className=\"form-control-range\"\n                    min=\"1\"\n                    max=\"100\"\n                    value={brushSize}\n                    onChange={(e) => setBrushSize(parseInt(e.target.value))}\n                />\n            </div>\n            <div className=\"form-group\">\n                <label style={{ width: \"100%\" }}>\n                    Brush opacity\n                    <small\n                        className=\"form-text text-muted\"\n                        style={{ float: \"right\" }}\n                    >\n                        {Math.round(brushOpacity * 100)}%\n                    </small>\n                </label>\n                <input\n                    type=\"range\"\n                    className=\"form-control-range\"\n                    min=\"0\"\n                    max=\"1\"\n                    step=\"0.01\"\n                    value={brushOpacity}\n                    onChange={(e) =>\n                        setBrushOpacity(parseFloat(e.target.value))\n                    }\n                />\n            </div>\n            <div\n                className=\"form-group\"\n                style={{\n                    marginTop: \"16px\",\n                    visibility: dirty ? \"visible\" : \"hidden\",\n                }}\n            >\n                <button\n                    className=\"btn btn-secondary\"\n                    onClick={() => tool.cancel()}\n                >\n                    Revert\n                </button>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => tool.confirm()}\n                    style={{ marginLeft: \"8px\" }}\n                >\n                    Save\n                </button>\n            </div>\n        </div>\n    );\n};\n","import React, { FC, useState, useEffect, useRef } from \"react\";\nimport axios from \"axios\";\nimport { Prompt } from \"react-router\";\n\nimport { sleep } from \"../../lib/sleep\";\nimport { defaultArgs } from \"../../components/ImagePrompt\";\nimport { Tool, BaseTool } from \"./tool\";\nimport { Renderer } from \"./renderer\";\nimport { SelectionTool } from \"./selection-tool\";\nimport { Cursor, Rect } from \"./models\";\nimport {\n    AIBrushApi,\n    CreateImageInput,\n    Image as APIImage,\n    ImageList,\n    StatusEnum,\n} from \"../../client\";\nimport { ZoomHelper } from \"./zoomHelper\";\nimport { getClosestAspectRatio } from \"../../lib/aspecRatios\";\nimport { getUpscaleLevel } from \"../../lib/upscale\";\nimport {\n    applyAlphaMask,\n    featherEdges,\n    ImageUtilWorker,\n    loadImageDataElement,\n} from \"../../lib/imageutil\";\nimport { ApiSocket, NOTIFICATION_IMAGE_UPDATED } from \"../../lib/apisocket\";\nimport moment from \"moment\";\nimport { ProgressBar } from \"../../components/ProgressBar\";\nimport { calculateImagesCost } from \"../../lib/credits\";\nimport { CostIndicator } from \"../../components/CostIndicator\";\nimport ModelSelector from \"../../components/ModelSelector\";\nimport { ResetToDefaultIcon } from \"../../components/ResetToDefaultIcon\";\n\nconst anonymousClient = axios.create();\n\ntype InpaintToolState =\n    | \"select\"\n    | \"erase\"\n    | \"inpaint\"\n    | \"uploading\"\n    | \"processing\"\n    | \"confirm\"\n    | undefined;\n\ninterface ImageWithData extends APIImage {\n    data?: ImageData;\n}\n\nexport class InpaintTool extends BaseTool implements Tool {\n    private selectionTool: SelectionTool;\n    private prompt: string = \"\";\n    private negativePrompt: string = \"\";\n    private count: number = 4;\n    private brushSize: number = 10;\n    private _dirty = false;\n    private worker: ImageUtilWorker;\n    private idCounter = 0;\n\n    private _state: InpaintToolState;\n    private stateHandler: (state: InpaintToolState) => void = () => {};\n    private selectionControlsListener: (show: boolean) => void = () => {};\n\n    private imageData: Array<ImageData> = [];\n    private selectedImageDataIndex: number = -1;\n    private selectedImageData: ImageData | null = null;\n    private panning = false;\n    private erasing = false;\n    private progressListener?: (progress: number) => void;\n    private errorListener?: (error: string | null) => void;\n    private dirtyListener?: (dirty: boolean) => void;\n\n    set dirty(dirty: boolean) {\n        this._dirty = dirty;\n        if (this.dirtyListener) {\n            this.dirtyListener(dirty);\n        }\n    }\n\n    get dirty() {\n        return this._dirty;\n    }\n\n    private newId(): string {\n        return `${this.idCounter++}`;\n    }\n\n    onError(handler: (error: string | null) => void) {\n        this.errorListener = handler;\n    }\n\n    private notifyError(error: string | null) {\n        if (this.errorListener) {\n            this.errorListener(error);\n        }\n    }\n\n    get state(): InpaintToolState {\n        return this._state;\n    }\n\n    set state(state: InpaintToolState) {\n        if (state != this._state) {\n            if (this._state == \"select\") {\n                this.selectionTool.destroy();\n            }\n            if (this._state === \"erase\") {\n                this.renderer.setCursor(undefined);\n            }\n            this._state = state;\n            this.stateHandler(state);\n\n            if (state == \"confirm\") {\n                this.selectionControlsListener(true);\n            } else {\n                this.selectionControlsListener(false);\n                if (state == \"select\") {\n                    const imageWidth = this.renderer.getWidth();\n                    const imageHeight = this.renderer.getHeight();\n                    const selectionWidth = Math.min(\n                        imageWidth,\n                        imageHeight,\n                        512\n                    );\n                    this.selectionTool.updateArgs({\n                        selectionOverlay: {\n                            x: 0,\n                            y: 0,\n                            width: selectionWidth,\n                            height: selectionWidth,\n                        },\n                    });\n                }\n            }\n        }\n    }\n\n    selectSupported(): boolean {\n        // return !(\n        //     this.renderer.getWidth() == this.renderer.getHeight() &&\n        //     getUpscaleLevel(\n        //         this.renderer.getWidth(),\n        //         this.renderer.getHeight()\n        //     ) === 0\n        // );\n        return true;\n    }\n\n    constructor(renderer: Renderer) {\n        super(renderer, \"inpaint\");\n        this.selectionTool = new SelectionTool(renderer);\n        if (this.selectSupported()) {\n            this.state = \"select\";\n            this.selectionTool.updateArgs({\n                outpaint: this.getArgs().outpaint,\n            });\n        } else {\n            this.state = \"erase\";\n        }\n        this.worker = new ImageUtilWorker();\n    }\n\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseDown(event);\n            return;\n        }\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        if (event.button === 1) {\n            this.panning = true;\n            return;\n        }\n        if (this.state == \"erase\") {\n            this.erasing = true;\n            this.erasePoint(x, y);\n        }\n    }\n\n    private erasePoint(x: number, y: number) {\n        if (!this.dirty) {\n            this.dirty = true;\n        }\n        this.renderer.erasePoint(x, y, this.brushSize);\n        this.renderer.render();\n    }\n\n    private updateCursor(x: number, y: number) {\n        if (this.state == \"erase\") {\n            this.renderer.setCursor({\n                color: \"white\",\n                radius: this.brushSize / 2,\n                type: \"circle\",\n                x,\n                y,\n            });\n        } else {\n            this.renderer.setCursor({\n                color: \"white\",\n                radius: 10,\n                type: \"crosshairs\",\n                x,\n                y,\n            });\n        }\n    }\n\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        this.updateCursor(x, y);\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseMove(event);\n            return;\n        }\n\n        if (this.panning) {\n            this.zoomHelper.onPan(event);\n        }\n\n        if (this.erasing) {\n            this.erasePoint(x, y);\n        }\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseUp(event);\n        }\n        this.panning = false;\n        this.erasing = false;\n    }\n\n    onMouseLeave(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseLeave(event);\n        }\n        this.panning = false;\n        this.erasing = false;\n    }\n\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.offsetX,\n            event.offsetY\n        );\n        this.updateCursor(x, y);\n    }\n\n    updateArgs(args: any) {\n        args = {\n            ...this.getArgs(),\n            ...args,\n        };\n        super.updateArgs(args);\n        this.prompt = args.prompt || \"\";\n        this.negativePrompt = args.negativePrompt || \"\";\n        this.count = args.count || 4;\n        this.brushSize = args.brushSize || 10;\n\n        this.updateCursor(\n            this.renderer.getWidth() / 2,\n            this.renderer.getHeight() / 2\n        );\n        this.selectionTool.updateArgs({\n            outpaint: args.outpaint,\n        });\n    }\n\n    onChangeState(handler: (state: InpaintToolState) => void) {\n        this.stateHandler = handler;\n    }\n\n    onShowSelectionControls(listener: (show: boolean) => void): void {\n        this.selectionControlsListener = listener;\n    }\n\n    onProgress(listener: (progress: number) => void): void {\n        this.progressListener = listener;\n    }\n\n    private async loadImageData(\n        api: AIBrushApi,\n        imageId: string,\n        alphaMask: ImageData,\n        selectionOverlay: Rect\n    ): Promise<ImageData> {\n        const imageElement = await loadImageDataElement(api, imageId);\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = selectionOverlay.width;\n        canvas.height = selectionOverlay.height;\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) {\n            throw new Error(\"Failed to get canvas context\");\n        }\n        ctx.drawImage(\n            imageElement,\n            0,\n            0,\n            selectionOverlay.width,\n            selectionOverlay.height\n        );\n        const imageData = ctx.getImageData(\n            0,\n            0,\n            selectionOverlay.width,\n            selectionOverlay.height\n        );\n\n        const id = this.newId();\n        const resp = await this.worker.processRequest({\n            id,\n            alphaMode: \"alpha\",\n            alphaPixels: alphaMask.data,\n            feather: true,\n            height: this.renderer.getHeight(),\n            width: this.renderer.getWidth(),\n            pixels: imageData.data,\n            selectionOverlay,\n            featherWidth: 10,\n        });\n        const updatedImageData = new ImageData(\n            resp.pixels,\n            imageData.width,\n            imageData.height\n        );\n        // remove canvas\n        canvas.remove();\n        return updatedImageData;\n    }\n\n    cancel() {\n        if (this.selectSupported()) {\n            this.state = \"select\";\n        } else {\n            this.state = \"erase\";\n        }\n        this.renderer.snapshot();\n        this.renderer.undo();\n        this.renderer.clearRedoStack();\n        this.imageData = [];\n        this.renderer.setEditImage(null);\n        this.dirty = false;\n    }\n\n    private updateProgress(progress: number) {\n        if (this.progressListener) {\n            this.progressListener(progress);\n        }\n    }\n\n    async submit(\n        api: AIBrushApi,\n        apisocket: ApiSocket,\n        image: APIImage,\n        model: string\n    ) {\n        this.notifyError(null);\n        let selectionOverlay = this.renderer.getSelectionOverlay();\n        if (!selectionOverlay) {\n            console.error(\"No selection\");\n            return;\n        }\n\n        if (this.getArgs().outpaint) {\n            // check if selection overlay is out of renderer bounds (width, height)\n            if (\n                selectionOverlay.x < 0 ||\n                selectionOverlay.y < 0 ||\n                selectionOverlay.x + selectionOverlay.width >\n                    this.renderer.getWidth() ||\n                selectionOverlay.y + selectionOverlay.height >\n                    this.renderer.getHeight()\n            ) {\n                this.renderer.expandToOverlay();\n                selectionOverlay = this.renderer.getSelectionOverlay()!;\n            }\n        }\n\n        this.state = \"uploading\";\n        this.updateProgress(0);\n\n        // get the erased area, then undo the erase to get the original image\n        const encodedMask = this.renderer.getEncodedMask(selectionOverlay);\n        const maskData = this.renderer.getImageData(selectionOverlay);\n        // hack to restore the image\n        this.renderer.snapshot();\n        this.renderer.undo();\n        this.renderer.clearRedoStack();\n\n        const encodedImage = this.renderer.getEncodedImage(selectionOverlay);\n\n        // upload temporary images in parallel\n        const tmpImagePromises = [\n            api.createTemporaryImage(\"png\"),\n            api.createTemporaryImage(\"png\"),\n        ];\n        const tmpImages = await Promise.all(tmpImagePromises);\n        const binaryImages = [\n            Buffer.from(encodedImage!, \"base64\"),\n            Buffer.from(encodedMask!, \"base64\"),\n        ];\n        const progress = [0, 0];\n        const uploadPromises: Array<Promise<any>> = [];\n        for (let i = 0; i < tmpImages.length; i++) {\n            const tmpImage = tmpImages[i].data;\n            const binaryImage = binaryImages[i];\n            uploadPromises.push(\n                anonymousClient.put(tmpImage.upload_url, binaryImage, {\n                    headers: {\n                        \"Content-Type\": \"image/png\",\n                    },\n                    onUploadProgress: (e) => {\n                        progress[i] = e.loaded / e.total;\n                        this.updateProgress((progress[0] + progress[1]) / 2);\n                    },\n                })\n            );\n        }\n        await Promise.all(uploadPromises);\n\n        const input: CreateImageInput = defaultArgs();\n        input.label = \"\";\n        // input.encoded_image = encodedImage;\n        // input.encoded_mask = encodedMask;\n        input.tmp_image_id = tmpImages[0].data.id;\n        input.tmp_mask_id = tmpImages[1].data.id;\n        input.parent = image.id;\n        input.params.prompt = this.prompt || image.params.prompt;\n        input.params.negative_prompt =\n            this.negativePrompt || image.params.negative_prompt;\n        input.params.denoising_strength = 1;\n        input.count = this.count;\n        input.model = model;\n\n        const closestAspectRatio = getClosestAspectRatio(\n            selectionOverlay!.width,\n            selectionOverlay!.height\n        );\n        input.params.width = closestAspectRatio.width;\n        input.params.height = closestAspectRatio.height;\n        input.temporary = true;\n\n        let resp: ImageList | null = null;\n\n        try {\n            resp = (await api.createImage(input)).data;\n        } catch (err) {\n            console.error(\"Error creating images\", err);\n            this.notifyError(\"Failed to create image\");\n            this.state = \"select\";\n            return;\n        }\n        this.state = \"processing\";\n        this.updateProgress(0);\n        let newImages: Array<ImageWithData> | undefined = resp.images;\n        if (!newImages || newImages.length === 0) {\n            this.state = \"select\";\n            throw new Error(\"No images returned\");\n        }\n        let completed = false;\n        let lastUpdate = moment();\n\n        const onMessage = async (msg: string) => {\n            console.log(\"inpaint onMessage\", msg);\n            const img = JSON.parse(msg) as any;\n            if (\n                img.type === NOTIFICATION_IMAGE_UPDATED &&\n                img.status === StatusEnum.Completed\n            ) {\n                lastUpdate = moment();\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (newImages![i].id === img.id) {\n                        const imageData = await this.loadImageData(\n                            api,\n                            newImages![i].id,\n                            maskData!,\n                            selectionOverlay!\n                        );\n                        newImages![i].data = imageData;\n                        newImages![i].status = StatusEnum.Completed;\n                    }\n                }\n            } else if (img.status === StatusEnum.Error) {\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (newImages![i].id === img.id) {\n                        newImages![i].status = StatusEnum.Error;\n                    }\n                }\n            }\n        };\n        apisocket.addMessageListener(onMessage);\n        try {\n            let startTime = moment();\n            let lastCheck = moment();\n            while (!completed) {\n                let completeCount = 0;\n                await sleep(100);\n                // poll for completion\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (\n                        newImages![i].status === StatusEnum.Completed ||\n                        newImages![i].status === StatusEnum.Error\n                    ) {\n                        completeCount++;\n                        continue;\n                    }\n                }\n                this.updateProgress(completeCount / newImages!.length);\n                if (completeCount === newImages!.length) {\n                    completed = true;\n                    continue;\n                }\n\n                // fallback if sockets don't catch one\n                if (moment().diff(lastCheck, \"seconds\") > 10) {\n                    // get list of ids that aren't completed and batch get them.\n                    const pendingIds = newImages\n                        .filter(\n                            (img) =>\n                                img.status === StatusEnum.Pending ||\n                                img.status === StatusEnum.Processing\n                        )\n                        .map((img) => img.id);\n                    console.log(\"Checking pending images\", pendingIds);\n                    const updatedImagesResult = await api.batchGetImages(\n                        undefined,\n                        {\n                            ids: pendingIds,\n                        }\n                    );\n                    const updatedImages = updatedImagesResult.data.images;\n                    const byId = updatedImages!.reduce((acc, img) => {\n                        acc[img.id] = img;\n                        return acc;\n                    }, {} as Record<string, APIImage>);\n                    for (let i = 0; i < newImages!.length; i++) {\n                        if (\n                            newImages![i].status === StatusEnum.Pending ||\n                            newImages![i].status === StatusEnum.Processing\n                        ) {\n                            const updated = byId[newImages![i].id];\n                            if (updated) {\n                                newImages![i].status = updated.status;\n                                if (updated.status === StatusEnum.Completed) {\n                                    lastUpdate = moment();\n                                    const imageData = await this.loadImageData(\n                                        api,\n                                        newImages![i].id,\n                                        maskData!,\n                                        selectionOverlay!\n                                    );\n                                    newImages![i].data = imageData;\n                                }\n                            }\n                        }\n                    }\n                    lastCheck = moment();\n                }\n                // timeout of 2 minutes\n                if (\n                    (lastUpdate.isAfter(startTime) &&\n                        moment().diff(lastUpdate, \"seconds\") > 30) ||\n                    moment().diff(startTime, \"minutes\") > 2\n                ) {\n                    completed = true;\n                }\n            }\n        } finally {\n            apisocket.removeMessageListener(onMessage);\n        }\n\n        // sort images by score descending\n        newImages!.sort((a, b) => {\n            return b.score - a.score;\n        });\n        newImages = newImages!.filter((img) => {\n            return img.status === StatusEnum.Completed;\n        });\n\n        this.imageData = [];\n        for (let i = 0; i < newImages!.length; i++) {\n            if (newImages![i].data) {\n                this.imageData.push(newImages![i].data as ImageData);\n            }\n        }\n        if (this.imageData.length === 0) {\n            this.state = \"select\";\n            this.notifyError(\"No images returned\");\n            return;\n        }\n        this.renderer.setEditImage(this.imageData[0]);\n        this.selectedImageDataIndex = 0;\n        this.selectedImageData = this.imageData[0];\n        this.state = \"confirm\";\n    }\n\n    onDirty(listener: (dirty: boolean) => void): void {\n        this.dirtyListener = listener;\n    }\n\n    select(direction: \"left\" | \"right\") {\n        if (direction == \"left\") {\n            this.selectedImageDataIndex--;\n            if (this.selectedImageDataIndex < -1) {\n                this.selectedImageDataIndex = this.imageData.length - 1;\n            }\n        }\n        if (direction == \"right\") {\n            this.selectedImageDataIndex++;\n            if (this.selectedImageDataIndex >= this.imageData.length) {\n                this.selectedImageDataIndex = -1;\n            }\n        }\n        if (this.selectedImageDataIndex === -1) {\n            this.selectedImageData = null;\n        } else {\n            this.selectedImageData =\n                this.imageData[this.selectedImageDataIndex];\n        }\n        this.renderer.setEditImage(this.selectedImageData);\n    }\n\n    onSaveImage(listener: (encodedImage: string, args?: any) => void): void {\n        this.saveListener = listener;\n    }\n\n    confirm() {\n        this.renderer.commitSelection();\n\n        this.imageData = [];\n        const encodedImage = this.renderer.getEncodedImage(null);\n        if (encodedImage && this.saveListener) {\n            this.saveListener(encodedImage, {\n                phrases: [this.prompt],\n                negative_phrases: [this.negativePrompt],\n                selection_overlay: this.renderer.getSelectionOverlay(),\n            });\n        }\n        this.dirty = false;\n        if (this.selectSupported()) {\n            this.state = \"select\";\n        } else {\n            this.state = \"erase\";\n        }\n    }\n\n    destroy(): boolean {\n        if (this.dirty) {\n            if (!window.confirm(\"Discard changes?\")) {\n                return false;\n            }\n        }\n        this.renderer.setCursor(undefined);\n        this.renderer.setEditImage(null);\n        this.worker.destroy();\n        return true;\n    }\n}\n\ninterface ControlsProps {\n    api: AIBrushApi;\n    apisocket: ApiSocket;\n    image: APIImage;\n    renderer: Renderer;\n    tool: InpaintTool;\n}\n\nexport const InpaintControls: FC<ControlsProps> = ({\n    api,\n    apisocket,\n    image,\n    renderer,\n    tool,\n}) => {\n    const [count, setCount] = useState(4);\n    const [prompt, setPrompt] = useState(image.params.prompt || \"\");\n    const [negativePrompt, setNegativePrompt] = useState(\n        image.params.negative_prompt || \"\"\n    );\n    const [state, setState] = useState<InpaintToolState>(tool.state);\n    const [progress, setProgress] = useState(0);\n    const [error, setError] = useState<string | null>(null);\n    const [brushSize, setBrushSize] = useState(10);\n    const [dirty, setDirty] = useState(false);\n    const [outpaint, setoutpaint] = useState<boolean | undefined>(\n        tool.getArgs().outpaint\n    );\n    const [model, setModel] = useState(\"Deliberate Inpainting\");\n    const [selectingModel, setSelectingModel] = useState(false);\n\n    useEffect(() => {\n        tool.updateArgs({\n            brushSize,\n        });\n    }, [brushSize]);\n\n    tool.onChangeState(setState);\n    tool.onProgress(setProgress);\n    tool.onError(setError);\n    tool.onDirty(setDirty);\n\n    const onSelectModel = (model: string) => {\n        setModel(model);\n        setSelectingModel(false);\n    };\n\n    if (state === \"uploading\" || state === \"processing\") {\n        return (\n            <div style={{ marginTop: \"16px\" }}>\n                <i className=\"fa fa-spinner fa-spin\"></i>&nbsp;{\" \"}\n                {state === \"uploading\" ? \"Uploading...\" : \"Inpainting...\"}\n                <br />\n                <ProgressBar progress={progress} />\n            </div>\n        );\n    }\n    return (\n        <div\n            style={{\n                marginTop: \"16px\",\n                marginBottom: \"8px\",\n                marginLeft: \"16px\",\n            }}\n        >\n            {error && (\n                <div className=\"alert alert-danger\" role=\"alert\">\n                    {/* dismiss button */}\n                    <button\n                        type=\"button\"\n                        className=\"close\"\n                        data-dismiss=\"alert\"\n                        aria-label=\"Close\"\n                        onClick={() => setError(null)}\n                    >\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                    {error}\n                </div>\n            )}\n            {state === \"select\" && (\n                <>\n                    <p>\n                        {/* info icon */}\n                        <i className=\"fa fa-info-circle\"></i>&nbsp; Move the\n                        selection rectangle to the area that you want to\n                        inpaint. For outpainting, try zooming out.\n                    </p>\n                    <div className=\"form-group\">\n                        {/* allow outpaint checkbox */}\n                        <div className=\"form-check\">\n                            <input\n                                className=\"form-check-input\"\n                                type=\"checkbox\"\n                                id=\"allowoutpaint\"\n                                checked={!!outpaint}\n                                onChange={(e) => {\n                                    setoutpaint(e.target.checked);\n                                    tool.updateArgs({\n                                        outpaint: e.target.checked,\n                                    });\n                                }}\n                            />\n                            <label\n                                className=\"form-check-label\"\n                                htmlFor=\"allowoutpaint\"\n                            >\n                                Allow outpainting\n                            </label>\n                        </div>\n                    </div>\n                </>\n            )}\n\n            {state === \"erase\" && (\n                <>\n                    <p>\n                        {/* info icon */}\n                        <i className=\"fa fa-info-circle\"></i>&nbsp; Erase the\n                        area that you want to inpaint.\n                    </p>\n                    <div className=\"form-group\">\n                        <label style={{ width: \"100%\" }}>\n                            Brush size\n                            <small\n                                className=\"form-text text-muted\"\n                                style={{ float: \"right\" }}\n                            >\n                                {brushSize}px\n                            </small>\n                        </label>\n                        <input\n                            type=\"range\"\n                            className=\"form-control-range\"\n                            min=\"1\"\n                            max=\"100\"\n                            value={brushSize}\n                            onChange={(e) =>\n                                setBrushSize(parseInt(e.target.value))\n                            }\n                        />\n                    </div>\n                </>\n            )}\n\n            {state === \"inpaint\" && (\n                <>\n                    <p>\n                        {/* info icon */}\n                        <i className=\"fa fa-info-circle\"></i>&nbsp; Confirm the\n                        parameters below and continue\n                    </p>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"prompt\">\n                            Prompt&nbsp;\n                            <ResetToDefaultIcon onClick={() => setPrompt(image.params.prompt || \"\")} />\n                        </label>\n                        <input\n                            type=\"text\"\n                            className=\"form-control\"\n                            id=\"prompt\"\n                            value={prompt}\n                            onChange={(e) => {\n                                setPrompt(e.target.value);\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            Customize the text prompt here\n                        </small>\n                    </div>\n                    {/* negative prompt */}\n                    <div className=\"form-group\">\n                        <label htmlFor=\"negativeprompt\">\n                            Negative prompt&nbsp;\n                            <ResetToDefaultIcon onClick={() => setNegativePrompt(image.params.negative_prompt || \"\")} />\n                        </label>\n                        <input\n                            type=\"text\"\n                            className=\"form-control\"\n                            value={negativePrompt}\n                            onChange={(e) => {\n                                setNegativePrompt(e.target.value);\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            Customize the negative text prompt here\n                        </small>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"count\">Count: {count}</label>\n                        <input\n                            type=\"range\"\n                            className=\"form-control-range\"\n                            id=\"count\"\n                            min=\"1\"\n                            max=\"10\"\n                            step=\"1\"\n                            value={count}\n                            onChange={(e) => {\n                                setCount(parseInt(e.target.value));\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            Number of inpaint options\n                        </small>\n                    </div>\n                    {/* select model dropdown */}\n                    {/* options: stable_diffusion_inpainting, \"Epic Diffusion\", \"Deliberate\" */}\n                    <div className=\"form-group\">\n                        <label htmlFor=\"model\">Model</label>\n                        <div>\n                            <button\n                                type=\"button\"\n                                className=\"btn btn-secondary light-button\"\n                                onClick={() => setSelectingModel(true)}\n                            >\n                                {model}&nbsp;\n                                <i className=\"fas fa-caret-down\"></i>\n                            </button>\n                        </div>\n                        <small className=\"form-text text-muted\">\n                            Select the inpaint model\n                        </small>\n                    </div>\n                    <div className=\"form-group\">\n                        <CostIndicator imagesCost={count} />\n                    </div>\n                </>\n            )}\n\n            {state === \"confirm\" && (\n                <>\n                    <p>\n                        Use the <i className=\"fa fa-arrow-left\"></i> and{\" \"}\n                        <i className=\"fa fa-arrow-right\"></i> buttons to\n                        navigate between the inpaint options\n                    </p>\n                </>\n            )}\n\n            <div className=\"form-group\">\n                {(dirty ||\n                    state === \"confirm\" ||\n                    (state == \"erase\" && tool.selectSupported()) ||\n                    state == \"inpaint\") && (\n                    <button\n                        style={{ marginRight: \"8px\" }}\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => {\n                            tool.cancel();\n                        }}\n                    >\n                        {/* cancel icon */}\n                        <i className=\"fa fa-times\"></i>&nbsp; Revert\n                    </button>\n                )}\n\n                {state === \"confirm\" && (\n                    <>\n                        <button\n                            className=\"btn btn-primary btn-sm\"\n                            onClick={() => tool.confirm()}\n                            style={{ marginRight: \"8px\" }}\n                        >\n                            {/* save icon */}\n                            <i className=\"fa fa-save\"></i>&nbsp; Save\n                        </button>\n                    </>\n                )}\n                {state == \"select\" && (\n                    <button\n                        style={{ marginRight: \"8px\" }}\n                        type=\"button\"\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => (tool.state = \"erase\")}\n                    >\n                        <i className=\"fa fa-eraser\"></i>&nbsp; Continue\n                    </button>\n                )}\n                {state == \"erase\" && (\n                    <button\n                        style={{ marginRight: \"8px\" }}\n                        type=\"button\"\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => (tool.state = \"inpaint\")}\n                    >\n                        <i className=\"fa fa-paint-brush\"></i>&nbsp; Continue\n                    </button>\n                )}\n                {state === \"inpaint\" && (\n                    <button\n                        style={{ marginRight: \"8px\" }}\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => {\n                            tool.updateArgs({\n                                count,\n                                prompt,\n                                negativePrompt,\n                            });\n                            tool.submit(api, apisocket, image, model);\n                        }}\n                    >\n                        {/* paint icon */}\n                        <i className=\"fa fa-paint-brush\"></i>&nbsp; Inpaint\n                    </button>\n                )}\n            </div>\n            <Prompt\n                when={dirty}\n                message=\"Are you sure you want to leave? Your changes will be lost.\"\n            />\n            {selectingModel && (\n                <ModelSelector\n                    api={api}\n                    onCancel={() => setSelectingModel(false)}\n                    onSelectModel={onSelectModel}\n                    initialSelectedModel={model}\n                    inpainting={true}\n                />\n            )}\n        </div>\n    );\n};\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport axios, { AxiosInstance } from \"axios\";\nimport * as uuid from \"uuid\";\n\nimport { AIBrushApi } from \"../../client\";\nimport { getUpscaleLevel } from \"../../lib/upscale\";\nimport \"./ImageEditor.css\";\nimport { createRenderer, Renderer } from \"./renderer\";\nimport { Tool, BaseTool } from \"./tool\";\nimport { SelectionTool, Controls as SelectionControls } from \"./selection-tool\";\nimport { EnhanceTool, EnhanceControls } from \"./enhance-tool\";\nimport { PencilTool, Controls as PencilControls, defaultColors } from \"./pencil-tool\";\nimport { SmudgeTool, SmudgeControls } from \"./smudge-tool\";\nimport { ImportExportControls } from \"./import-export\";\nimport { InpaintControls, InpaintTool } from \"./inpaint-tool\";\nimport { AugmentControls } from \"./augment-tool\";\nimport { defaultArgs } from \"../../components/ImagePrompt\";\nimport { ApiSocket } from \"../../lib/apisocket\";\nimport {\n    createEncodedThumbnail,\n    encodedImageToBlob,\n    uploadBlob,\n} from \"../../lib/imageutil\";\nimport { BusyModal } from \"../../components/BusyModal\";\nimport { LocalImage, LocalImagesStore } from \"../../lib/localImagesStore\";\nimport { render } from \"@testing-library/react\";\n\ninterface CanPreventDefault {\n    preventDefault: () => void;\n}\n\ninterface Props {\n    api: AIBrushApi;\n    apisocket: ApiSocket;\n    assetsUrl: string;\n    localImages: LocalImagesStore;\n}\n\ninterface ToolConfig {\n    name: string;\n    iconClass: string;\n    constructor: (r: Renderer) => Tool;\n    renderControls: (t: Tool, renderer: Renderer) => JSX.Element;\n    defaultArgs: any;\n}\n\nexport const anonymousClient = axios.create();\ndelete anonymousClient.defaults.headers.common[\"Authorization\"];\n\nexport const ImageEditor: React.FC<Props> = ({\n    api,\n    apisocket,\n    localImages,\n}) => {\n    const [showSelectionControls, setShowSelectionControls] = useState(false);\n    const tools: Array<ToolConfig> = [\n        {\n            name: \"inpaint\",\n            iconClass: \"fas fa-paint-brush\",\n            constructor: (r: Renderer) => new InpaintTool(r),\n            defaultArgs: {},\n            renderControls: (t: Tool, renderer: Renderer) => {\n                t.onShowSelectionControls(setShowSelectionControls);\n                return (\n                    <InpaintControls\n                        tool={t as InpaintTool}\n                        renderer={renderer}\n                        api={api}\n                        apisocket={apisocket}\n                        image={image!}\n                    />\n                );\n            },\n        },\n        {\n            name: \"enhance\",\n            iconClass: \"fas fa-magic\",\n            constructor: (r: Renderer) => new EnhanceTool(r),\n            defaultArgs: {\n                variationStrength: 0.75,\n            },\n            renderControls: (t: Tool, renderer: Renderer) => {\n                t.onShowSelectionControls(setShowSelectionControls);\n                return (\n                    <EnhanceControls\n                        tool={t as EnhanceTool}\n                        renderer={renderer}\n                        api={api}\n                        apisocket={apisocket}\n                        image={image!}\n                    />\n                );\n            },\n        },\n        {\n            name: \"pencil\",\n            iconClass: \"fas fa-pencil-alt\",\n            constructor: (r: Renderer) => new PencilTool(r, \"base\"),\n            defaultArgs: {},\n            renderControls: (t: Tool, renderer: Renderer) => {\n                return (\n                    <PencilControls\n                        tool={t as PencilTool}\n                        renderer={renderer}\n                        colors={defaultColors}\n                    />\n                );\n            },\n        },\n        {\n            name: \"smudge\",\n            // finger icon\n            iconClass: \"fas fa-hand-pointer\",\n            constructor: (r: Renderer) => new SmudgeTool(r),\n            defaultArgs: {},\n            renderControls: (t: Tool, renderer: Renderer) => {\n                return (\n                    <SmudgeControls\n                        tool={t as SmudgeTool}\n                        renderer={renderer}\n                    />\n                );\n            },\n        },\n        {\n            name: \"import-export\",\n            iconClass: \"fas fa-file-import\",\n            constructor: (r: Renderer) => new BaseTool(r, \"import-export\"),\n            defaultArgs: {},\n            renderControls: (t: Tool, renderer: Renderer) => {\n                return (\n                    <ImportExportControls\n                        renderer={renderer}\n                        tool={t as BaseTool}\n                        api={api}\n                    />\n                );\n            },\n        },\n        {\n            name: \"augment\",\n            iconClass: \"fas fa-image\",\n            constructor: (r: Renderer) => new BaseTool(r, \"augment\"),\n            defaultArgs: {},\n            renderControls: (t: Tool, renderer: Renderer) => {\n                return (\n                    <AugmentControls\n                        renderer={renderer}\n                        tool={t as BaseTool}\n                        api={api}\n                        image={image!}\n                    />\n                );\n            },\n        },\n    ];\n\n    const [image, setImage] = useState<LocalImage | null>(null);\n    const [renderer, setRenderer] = useState<Renderer | null>(null);\n    const [tool, setTool] = useState<Tool | null>(null);\n    const [canUndo, setCanUndo] = useState(false);\n    const [canRedo, setCanRedo] = useState(false);\n    const [busyMessage, setBusyMessage] = useState<string | null>(null);\n\n    const { id } = useParams<{ id: string }>();\n    const history = useHistory();\n\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n\n    const onSelectTool = (toolconfig: ToolConfig) => {\n        if (renderer) {\n            if (tool) {\n                if (!tool.destroy()) {\n                    return;\n                }\n            }\n            const newTool = toolconfig.constructor(renderer);\n            setTool(newTool);\n            newTool.onSaveImage((encodedImage, args = {}) => {\n                console.log(\"Saving image...\");\n                saveNewImage(encodedImage, args);\n            });\n        }\n    };\n\n    /**\n     * Saves a new image to the server\n     *\n     * @param encodedImage base64 encoded image\n     * @param newArgs may contain new phrases and negative phrases\n     */\n    const saveNewImage = async (encodedImage: string, newArgs: any) => {\n        if (!image || !encodedImage) {\n            throw new Error(\"Cannot save new image without existing image\");\n        }\n        if (!renderer) {\n            throw new Error(\"Cannot save new image without renderer\");\n        }\n        setBusyMessage(\"Saving image...\");\n        try {\n            const newImage: LocalImage = {\n                ...image,\n                params: {\n                    ...image.params,\n                    width: renderer!.getWidth() as any,\n                    height: renderer!.getHeight() as any,\n                },\n                id: uuid.v4(),\n                imageData: `data:image/png;base64,${encodedImage}`,\n            };\n            await localImages.saveImage(newImage);\n\n            // switch url and state to new image\n            setImage(newImage);\n            history.replace(`/image-editor/${newImage.id}`);\n        } finally {\n            setBusyMessage(null);\n        }\n    };\n\n    useEffect(() => {\n        if (image) {\n            return;\n        }\n\n        async function loadImage() {\n            const localImage = await localImages.getImage(id);\n            let imageSrc = \"\";\n            if (localImage) {\n                setImage(localImage);\n                imageSrc = localImage.imageData!;\n            } else {\n                const image = (await api.getImage(id)).data;\n                setImage(image);\n                const download_urls = await api.getImageDownloadUrls(id);\n                // Loading up data as binary, base64 encoding into image url\n                // bypasses browser security nonsense about cross-domain images\n                const resp = await anonymousClient.get(\n                    download_urls.data.image_url!,\n                    {\n                        responseType: \"arraybuffer\",\n                    }\n                );\n                const binaryImageData = Buffer.from(resp.data, \"binary\");\n                const base64ImageData = binaryImageData.toString(\"base64\");\n                imageSrc = `data:image/png;base64,${base64ImageData}`;\n            }\n\n            const imageElement = new Image();\n            imageElement.src = imageSrc;\n            imageElement.onload = () => {\n                if (!canvasRef.current) {\n                    console.error(\"Failed to get canvas\");\n                    return;\n                }\n                const renderer = createRenderer(canvasRef.current);\n                renderer.setBaseImage(imageElement);\n                setRenderer(renderer);\n            };\n        }\n        loadImage();\n    }, [image, id]);\n\n    // this covers the case that an image is upscaled to max, the upscale tool needs to\n    // be hidden and deselected.\n    useEffect(() => {\n        if (\n            image &&\n            tool &&\n            tool.name == \"upscale\" &&\n            image.params.width! * image.params.height! >= 2048 * 2048\n        ) {\n            onSelectTool(tools[0]);\n        }\n    }, [image, tool]);\n\n    useEffect(() => {\n        if (renderer) {\n            onSelectTool(tools[0]);\n            renderer.onSnapshot(() => {\n                setCanUndo(renderer.canUndo());\n                setCanRedo(renderer.canRedo());\n            });\n        }\n    }, [renderer]);\n\n    useEffect(() => {\n        if (canvasRef.current) {\n            const listener = (e: WheelEvent) => {\n                if (tool) {\n                    e.preventDefault();\n                    tool.onWheel(e);\n                }\n            };\n            canvasRef.current.addEventListener(\"wheel\", listener);\n            return () => {\n                canvasRef.current?.removeEventListener(\"wheel\", listener);\n            };\n        }\n    }, [tool, canvasRef.current]);\n\n    function renderTool(t: ToolConfig) {\n        if (!image) {\n            return null;\n        }\n        if (\n            t.name == \"upscale\" &&\n            image.params.width! * image.params.height! >= 2048 * 2048\n        ) {\n            return null;\n        }\n        let buttonClass = `btn btn-secondary light-button image-editor-tool-button`;\n        const isSelected = tool && tool.name == t.name;\n        if (isSelected) {\n            buttonClass = `btn btn-primary image-editor-tool-button`;\n        }\n        return (\n            <div className=\"form-group\" key={t.name}>\n                <button className={buttonClass} onClick={() => onSelectTool(t)}>\n                    <i className={t.iconClass}></i>\n                </button>\n                {/* capitalize tool name */}\n                <label>\n                    {t.name.charAt(0).toUpperCase() + t.name.slice(1)}\n                </label>\n                {isSelected && t.renderControls(tool!, renderer!)}\n            </div>\n        );\n    }\n\n    function preventDefault(e: CanPreventDefault): boolean {\n        e.preventDefault();\n        return true;\n    }\n\n    return (\n        <>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <h1 style={{ fontSize: \"40px\", textAlign: \"left\" }}>\n                        <i\n                            style={{ cursor: \"pointer\" }}\n                            onClick={() => history.push(`/images/${id}`)}\n                            className=\"fas fa-chevron-left\"\n                        ></i>\n                        &nbsp; AI Edit\n                    </h1>\n                </div>\n            </div>\n            <div\n                className=\"row\"\n                style={{ marginTop: \"32px\", paddingBottom: \"120px\" }}\n            >\n                <div className=\"col-lg-3\">\n                    {renderer && (\n                        <>\n                            {tools.map((tool) => renderTool(tool))}\n                            {(canRedo || canUndo) && (\n                                <div className=\"form-group\">\n                                    <div className=\"btn-group\">\n                                        <button\n                                            className=\"btn btn-primary image-popup-button\"\n                                            disabled={!renderer || !canUndo}\n                                            onClick={() =>\n                                                renderer && renderer.undo()\n                                            }\n                                        >\n                                            {/* undo */}\n                                            <i className=\"fas fa-undo\"></i>\n                                        </button>\n                                        <button\n                                            className=\"btn btn-primary image-popup-button\"\n                                            disabled={!renderer || !canRedo}\n                                            onClick={() =>\n                                                renderer && renderer.redo()\n                                            }\n                                        >\n                                            <i className=\"fas fa-redo\"></i>\n                                        </button>\n                                    </div>\n                                </div>\n                            )}\n                        </>\n                    )}\n                </div>\n                <div className=\"col-lg-9\">\n                    <div style={{ verticalAlign: \"middle\" }}>\n                        <div>\n                            <canvas\n                                style={{\n                                    cursor: \"none\",\n                                    touchAction: \"none\",\n                                    userSelect: \"none\",\n                                }}\n                                ref={canvasRef}\n                                className=\"image-editor-canvas\"\n                                onMouseDown={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onMouseDown(e)\n                                }\n                                onMouseMove={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onMouseMove(e)\n                                }\n                                onMouseUp={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onMouseUp(e)\n                                }\n                                onMouseLeave={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onMouseLeave(e)\n                                }\n                                onTouchStart={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onTouchStart(e)\n                                }\n                                onTouchMove={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onTouchMove(e)\n                                }\n                                onTouchEnd={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onTouchEnd(e)\n                                }\n                            ></canvas>\n                            {showSelectionControls && (\n                                <>\n                                    <button\n                                        className=\"btn btn-secondary canvas-select-left\"\n                                        onClick={() => tool!.select(\"left\")}\n                                    >\n                                        <i className=\"fas fa-chevron-left\"></i>\n                                    </button>\n                                    <button\n                                        className=\"btn btn-secondary canvas-select-right\"\n                                        onClick={() => tool!.select(\"right\")}\n                                    >\n                                        <i className=\"fas fa-chevron-right\"></i>\n                                    </button>\n                                </>\n                            )}\n                        </div>\n                    </div>\n                    <div className=\"row\">\n                        <button\n                            className=\"btn btn-primary\"\n                            // center horizontally\n                            style={{\n                                position: \"absolute\",\n                                left: \"50%\",\n                                transform: \"translate(-50%, 0)\",\n                            }}\n                            onClick={() => {\n                                if (renderer) {\n                                    renderer.resetView();\n                                }\n                            }}\n                        >\n                            {/* reset zoom */}\n                            <i className=\"fas fa-search-plus\"></i>&nbsp; Reset\n                            View\n                        </button>\n                        {/* redo */}\n                    </div>\n                    {/* vertically center button within the div */}\n                </div>\n            </div>\n            {busyMessage && (\n                <BusyModal show={true} title=\"Please Wait\">\n                    {busyMessage}\n                </BusyModal>\n            )}\n        </>\n    );\n};\n","import { Cursor, Rect } from \"./models\";\n\nconst maxSnapshots = 10;\n\nexport class Renderer {\n    private undoStack: ImageData[] = [];\n    private redoStack: ImageData[] = [];\n    private currentSnapshot: ImageData | undefined;\n\n    private backgroundLayer: HTMLCanvasElement;\n    private baseImageLayer: HTMLCanvasElement;\n    private editLayer: HTMLCanvasElement;\n    private maskLayer: HTMLCanvasElement | undefined;\n    // private overlayLayer: HTMLCanvasElement;\n\n    private selectionOverlay: Rect | undefined;\n    private selectionOverlayPreview: Rect | undefined;\n    private hasSelection: boolean = false;\n    private cursor: Cursor | undefined;\n\n    private zoom: number;\n    private offsetX: number;\n    private offsetY: number;\n    private width = 0;\n    private height = 0;\n\n    private snapshotListener: (() => void) | null = null;\n\n    constructor(private readonly canvas: HTMLCanvasElement) {\n        canvas.width = 512;\n        canvas.height = 512;\n        // invisible canvas elements\n        this.backgroundLayer = document.createElement(\"canvas\");\n        this.backgroundLayer.width = 512;\n        this.backgroundLayer.height = 512;\n        this.baseImageLayer = document.createElement(\"canvas\");\n        this.editLayer = document.createElement(\"canvas\");\n        // this.overlayLayer = document.createElement(\"canvas\");\n\n        this.zoom = 1;\n        this.offsetX = 0;\n        this.offsetY = 0;\n    }\n\n    undo(allowRedo: boolean = true) {\n        if (this.undoStack.length > 0 && this.currentSnapshot) {\n            const imageData = this.undoStack.pop()!;\n            if (allowRedo) {\n                this.redoStack.push(this.currentSnapshot);\n            }\n            this.currentSnapshot = imageData;\n            // set as base image\n            const ctx = this.baseImageLayer.getContext(\"2d\");\n            if (ctx) {\n                ctx.clearRect(\n                    0,\n                    0,\n                    this.baseImageLayer.width,\n                    this.baseImageLayer.height\n                );\n                ctx.putImageData(imageData, 0, 0);\n                this.render();\n            }\n            this.notifySnapshotListener();\n        }\n    }\n\n    redo() {\n        if (this.redoStack.length > 0 && this.currentSnapshot) {\n            this.undoStack.push(this.currentSnapshot);\n            const imageData = this.redoStack.pop()!;\n            this.currentSnapshot = imageData;\n\n            // set as base image\n            const ctx = this.baseImageLayer.getContext(\"2d\");\n            if (ctx) {\n                ctx.putImageData(imageData, 0, 0);\n                this.render();\n            }\n            this.notifySnapshotListener();\n        }\n    }\n\n    clearRedoStack() {\n        this.redoStack = [];\n        this.notifySnapshotListener();\n    }\n\n    canUndo(): boolean {\n        return !this.hasSelection && this.undoStack.length > 0;\n    }\n\n    canRedo(): boolean {\n        return !this.hasSelection && this.redoStack.length > 0;\n    }\n\n    onSnapshot(listener: () => void) {\n        this.snapshotListener = listener;\n    }\n\n    snapshot() {\n        const ctx = this.baseImageLayer.getContext(\"2d\");\n        if (ctx) {\n            const snapshot = ctx.getImageData(\n                0,\n                0,\n                this.baseImageLayer.width,\n                this.baseImageLayer.height\n            );\n            if (this.currentSnapshot) {\n                this.undoStack.push(this.currentSnapshot);\n                this.currentSnapshot = snapshot;\n                if (this.redoStack.length > 0) {\n                    this.redoStack = [];\n                }\n                if (this.undoStack.length > maxSnapshots) {\n                    this.undoStack.shift();\n                }\n            } else {\n                this.currentSnapshot = snapshot;\n            }\n\n            this.notifySnapshotListener();\n        }\n    }\n\n    private notifySnapshotListener() {\n        if (this.snapshotListener) {\n            this.snapshotListener();\n        }\n    }\n\n    render() {\n        const context = this.canvas.getContext(\"2d\");\n        if (context) {\n            context.clearRect(0, 0, this.width, this.height);\n            context.drawImage(this.backgroundLayer, 0, 0);\n            // apply zoom and offset\n            context.setTransform(\n                this.zoom,\n                0,\n                0,\n                this.zoom,\n                this.offsetX * this.zoom,\n                this.offsetY * this.zoom\n            );\n            // context.drawImage(this.backgroundLayer, 0, 0);\n            context.drawImage(this.baseImageLayer, 0, 0);\n            context.drawImage(this.editLayer, 0, 0);\n            // draw this.maskLayer at 0.3 opacity\n            if (this.maskLayer) {\n                context.globalAlpha = 0.3;\n                context.drawImage(this.maskLayer, 0, 0);\n                context.globalAlpha = 1;\n            }\n\n            // context.drawImage(this.overlayLayer, 0, 0);\n            this.drawOverlay(context, this.width, this.height);\n            context.setTransform(1, 0, 0, 1, 0, 0);\n        }\n    }\n\n    createMask() {\n        this.maskLayer = document.createElement(\"canvas\");\n        this.maskLayer.width = this.width;\n        this.maskLayer.height = this.height;\n        this.resetMask();\n    }\n\n    resetMask() {\n        if (this.maskLayer) {\n            const ctx = this.maskLayer.getContext(\"2d\");\n            if (ctx) {\n                ctx.fillStyle = \"#000000\";\n                ctx.fillRect(0, 0, this.width, this.height);\n            }\n            this.render();\n        }\n    }\n\n    invertMask() {\n        if (this.maskLayer) {\n            const ctx = this.maskLayer.getContext(\"2d\");\n            if (ctx) {\n                // change black to white, white to black\n                const imageData = ctx.getImageData(\n                    0,\n                    0,\n                    this.width,\n                    this.height\n                );\n                for (let i = 0; i < imageData.data.length; i += 4) {\n                    imageData.data[i] = 255 - imageData.data[i];\n                    imageData.data[i + 1] = 255 - imageData.data[i + 1];\n                    imageData.data[i + 2] = 255 - imageData.data[i + 2];\n                }\n                ctx.putImageData(imageData, 0, 0);\n            }\n            this.render();\n        }\n    }\n\n    deleteMask() {\n        this.maskLayer = undefined;\n        this.render();\n    }\n\n    isMasked() {\n        return this.maskLayer !== undefined;\n    }\n\n    getCanvas(): HTMLCanvasElement {\n        return this.canvas;\n    }\n\n    private initializeBackgroundLayer() {\n        // checkered background\n        // #DEDEDE\n        // #FFFFFF\n        // 10x10 pixel squares\n        const ctx = this.backgroundLayer.getContext(\"2d\");\n        if (ctx) {\n            const pattern = ctx.createPattern(\n                this.createCheckeredPattern(20, 20, \"#808080\", \"#AAAAAA\"),\n                \"repeat\"\n            );\n            if (pattern) {\n                ctx.fillStyle = pattern;\n                ctx.fillRect(\n                    0,\n                    0,\n                    this.backgroundLayer.width,\n                    this.backgroundLayer.height\n                );\n            }\n        }\n    }\n\n    private createCheckeredPattern(\n        width: number,\n        height: number,\n        color1: string,\n        color2: string\n    ): HTMLCanvasElement {\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = width;\n        canvas.height = height;\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx) {\n            ctx.fillStyle = color1;\n            ctx.fillRect(0, 0, width, height);\n            ctx.fillStyle = color2;\n            ctx.fillRect(0, 0, width / 2, height / 2);\n            ctx.fillRect(width / 2, height / 2, width / 2, height / 2);\n        }\n        return canvas;\n    }\n\n    setBaseImage(\n        image: HTMLImageElement | HTMLCanvasElement,\n        updateSelectionOverlay = true\n    ) {\n        const context = this.baseImageLayer.getContext(\"2d\");\n        if (context) {\n            // set size of all layers\n            // TODO: adapt for an always-square canvas\n            this.initializeBackgroundLayer();\n\n            this.baseImageLayer.width = image.width;\n            this.baseImageLayer.height = image.height;\n            this.editLayer.width = image.width;\n            this.editLayer.height = image.height;\n            this.maskLayer = undefined;\n            // set image size\n            this.width = image.width;\n            this.height = image.height;\n            // this.canvas.width = image.width;\n            // this.canvas.height = image.height;\n            context.drawImage(image, 0, 0);\n\n            if (updateSelectionOverlay) {\n                // set 512x512 selection overlay at the center of the image\n                this.setSelectionOverlay({\n                    x: (image.width - 512) / 2,\n                    y: (image.height - 512) / 2,\n                    width: 512,\n                    height: 512,\n                });\n            }\n            this.resetView();\n            // this.render(); // already called by updateZoomAndOffset\n            this.snapshot();\n        }\n    }\n\n    resetView() {\n        // determine zoom based on image difference from canvas size\n        const maxWidth = Math.max(this.width, this.height);\n        const zoom = this.canvas.width / maxWidth;\n\n        let offsetX = 0;\n        let offsetY = 0;\n\n        if (this.width > this.height) {\n            offsetY = (this.width - this.height) / 2;\n        } else if (this.height > this.width) {\n            offsetX = (this.height - this.width) / 2;\n        }\n\n        this.updateZoomAndOffset(zoom, offsetX, offsetY);\n    }\n\n    setEditImage(imageData: ImageData | null) {\n        this.hasSelection = !!imageData;\n        const context = this.editLayer.getContext(\"2d\");\n        if (context && this.selectionOverlay) {\n            context.clearRect(\n                0,\n                0,\n                this.editLayer.width,\n                this.editLayer.height\n            );\n            if (imageData) {\n                context.putImageData(\n                    imageData,\n                    this.selectionOverlay.x,\n                    this.selectionOverlay.y\n                );\n            }\n            // edit image makes the selection rect and preview disappear\n            // so redraw the overlay\n            this.hasSelection = !!imageData;\n            this.render();\n        }\n        this.notifySnapshotListener();\n    }\n\n    private drawOverlay(\n        context: CanvasRenderingContext2D,\n        width: number,\n        height: number\n    ) {\n        const lineWidth = Math.max(this.width / 512, this.height / 512);\n        if (context) {\n            context.strokeStyle = \"white\";\n            context.lineWidth = lineWidth;\n            context.strokeRect(0, 0, width, height);\n\n            if (!this.hasSelection && this.selectionOverlay) {\n                context.strokeStyle = \"white\";\n                context.lineWidth = lineWidth;\n                context.strokeRect(\n                    this.selectionOverlay.x,\n                    this.selectionOverlay.y,\n                    this.selectionOverlay.width,\n                    this.selectionOverlay.height\n                );\n            }\n            if (!this.hasSelection && this.selectionOverlayPreview) {\n                context.strokeStyle = \"cyan\";\n                context.lineWidth = lineWidth;\n                context.strokeRect(\n                    this.selectionOverlayPreview.x,\n                    this.selectionOverlayPreview.y,\n                    this.selectionOverlayPreview.width,\n                    this.selectionOverlayPreview.height\n                );\n            }\n            if (this.cursor) {\n                if (this.cursor.type === \"circle\") {\n                    context.lineWidth = lineWidth;\n                    context.strokeStyle = this.cursor.color;\n                    // context.globalAlpha = 0.5;\n                    context.beginPath();\n                    context.arc(\n                        this.cursor.x,\n                        this.cursor.y,\n                        this.cursor.radius,\n                        0,\n                        2 * Math.PI\n                    );\n                    context.stroke();\n                } else if (this.cursor.type === \"circle-fill\") {\n                    context.fillStyle = this.cursor.color;\n                    context.strokeStyle = this.cursor.color;\n                    // context.lineWidth = lineWidth;\n                    // context.globalAlpha = 0.5;\n                    context.beginPath();\n                    context.arc(\n                        this.cursor.x,\n                        this.cursor.y,\n                        this.cursor.radius,\n                        0,\n                        2 * Math.PI\n                    );\n                    context.stroke();\n                    // set alpha to 0.5 and fill\n                    context.globalAlpha = 0.5;\n                    context.beginPath();\n                    context.arc(\n                        this.cursor.x,\n                        this.cursor.y,\n                        this.cursor.radius,\n                        0,\n                        2 * Math.PI\n                    );\n                    context.fill();\n                    context.globalAlpha = 1;\n                } else if (this.cursor.type == \"crosshairs\") {\n                    // draw crosshairs based on cursor radius\n                    context.strokeStyle = this.cursor.color;\n                    context.lineWidth = lineWidth;\n                    context.beginPath();\n                    context.moveTo(\n                        this.cursor.x - this.cursor.radius,\n                        this.cursor.y\n                    );\n                    context.lineTo(\n                        this.cursor.x + this.cursor.radius,\n                        this.cursor.y\n                    );\n                    context.moveTo(\n                        this.cursor.x,\n                        this.cursor.y - this.cursor.radius\n                    );\n                    context.lineTo(\n                        this.cursor.x,\n                        this.cursor.y + this.cursor.radius\n                    );\n                    context.stroke();\n                } else if (this.cursor.type === \"colorpicker\") {\n                    // TODO: add croshairs\n                    context.lineWidth = this.cursor.radius * 0.75;\n                    context.strokeStyle = this.cursor.color;\n                    // context.globalAlpha = 0.5;\n                    context.beginPath();\n                    context.arc(\n                        this.cursor.x,\n                        this.cursor.y,\n                        this.cursor.radius,\n                        0,\n                        2 * Math.PI\n                    );\n                    context.stroke();\n\n                    // draw crosshairs (black)\n                    context.lineWidth = lineWidth;\n                    context.strokeStyle = \"black\";\n                    context.beginPath();\n                    context.moveTo(\n                        this.cursor.x - this.cursor.radius,\n                        this.cursor.y\n                    );\n                    context.lineTo(\n                        this.cursor.x + this.cursor.radius,\n                        this.cursor.y\n                    );\n                    context.moveTo(\n                        this.cursor.x,\n                        this.cursor.y - this.cursor.radius\n                    );\n                    context.lineTo(\n                        this.cursor.x,\n                        this.cursor.y + this.cursor.radius\n                    );\n                    context.stroke();\n                }\n            }\n        }\n    }\n\n    setSelectionOverlay(selectionOverlay: Rect | undefined) {\n        this.selectionOverlay = selectionOverlay;\n        this.render();\n    }\n\n    setSelectionOverlayPreview(selectionOverlayPreview: Rect | undefined) {\n        this.selectionOverlayPreview = selectionOverlayPreview;\n        this.render();\n    }\n\n    setCursor(cursor: Cursor | undefined) {\n        this.cursor = cursor;\n        this.render();\n    }\n\n    getSelectionOverlay(): Rect | undefined {\n        return this.selectionOverlay;\n    }\n\n    getZoom(): number {\n        return this.zoom;\n    }\n\n    getOffsetX(): number {\n        return this.offsetX;\n    }\n\n    getOffsetY(): number {\n        return this.offsetY;\n    }\n\n    updateZoomAndOffset(zoom: number, offsetX: number, offsetY: number) {\n        // console.log(`zoom: ${zoom}, offset: ${offsetX}, ${offsetY}`)\n        this.zoom = zoom;\n        this.offsetX = offsetX;\n        this.offsetY = offsetY;\n        this.render();\n    }\n\n    getWidth(): number {\n        return this.width;\n    }\n\n    getHeight(): number {\n        return this.height;\n    }\n\n    private imageDataToEncodedImage(imageData: ImageData): string | undefined {\n        // create a canvas and draw the image data on it\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = imageData.width;\n        canvas.height = imageData.height;\n        const context = canvas.getContext(\"2d\");\n        if (context) {\n            context.putImageData(imageData, 0, 0);\n            // return the data url of the canvas\n            const result = canvas.toDataURL(\"image/png\");\n            // cleanup the canvas\n            canvas.remove();\n            // extract base64 data from data url\n            return result.split(\",\")[1];\n        }\n    }\n\n    getEncodedImage(selection: Rect | null): string | undefined {\n        const imageData = this.getImageData(selection);\n        if (imageData) {\n            return this.imageDataToEncodedImage(imageData);\n        }\n    }\n\n    private convertErasureToMask(\n        erasure: ImageData,\n    ): ImageData {\n        // for each pixel, if alpha < 255, set to white, otherwise set to black\n        const mask = erasure;\n        for (let i = 0; i < erasure.data.length; i += 4) {\n            let white = erasure.data[i + 3] < 255;\n            if (white) {\n                mask.data[i] = 255;\n                mask.data[i + 1] = 255;\n                mask.data[i + 2] = 255;\n                mask.data[i + 3] = 255;\n            } else {\n                mask.data[i] = 0;\n                mask.data[i + 1] = 0;\n                mask.data[i + 2] = 0;\n                mask.data[i + 3] = 255;\n            }\n        }\n        return mask;\n    }\n\n    getEncodedMask(\n        selection: Rect | null,\n        layer: \"base\" | \"mask\" = \"base\"\n    ): string | undefined {\n        const imageData = this.getImageData(selection, layer)!;\n        if (!imageData) {\n            return;\n        }\n        if (layer === \"base\") {\n            const mask = this.convertErasureToMask(imageData);\n            return this.imageDataToEncodedImage(mask);\n        } else {\n            return this.imageDataToEncodedImage(imageData);\n        }\n    }\n\n    getImageData(\n        selection: Rect | null,\n        layer: \"base\" | \"mask\" = \"base\"\n    ): ImageData | undefined {\n        if (!selection) {\n            selection = {\n                x: 0,\n                y: 0,\n                width: this.width,\n                height: this.height,\n            };\n        }\n        // get image data of the selection\n        const imageLayer =\n            layer === \"base\" ? this.baseImageLayer : this.maskLayer;\n        if (!imageLayer) {\n            return;\n        }\n        let context = imageLayer.getContext(\"2d\");\n        if (context) {\n            const imageData = context.getImageData(\n                selection.x,\n                selection.y,\n                selection.width,\n                selection.height\n            );\n            return imageData;\n        }\n    }\n\n    commitSelection() {\n        // draw the selection overlay on the base image layer\n        const context = this.baseImageLayer.getContext(\"2d\");\n        if (context) {\n            context.drawImage(this.editLayer, 0, 0);\n            this.setEditImage(null);\n            this.snapshot();\n        }\n    }\n\n    drawPoint(x: number, y: number, brushSize: number, color: string, layer: \"base\" | \"mask\" = \"base\"): void {\n        // draw on selection layer\n        const imageLayer = layer === \"base\" ? this.editLayer : this.maskLayer;\n        if (!imageLayer) {\n            return;\n        }\n        const context = imageLayer.getContext(\"2d\");\n        if (context) {\n            context.fillStyle = color;\n            context.beginPath();\n            context.arc(x, y, brushSize / 2, 0, 2 * Math.PI);\n            context.fill();\n        }\n        this.render();\n    }\n\n    erasePoint(brushx: number, brushy: number, brushSize: number): void {\n        if (!this.selectionOverlay) {\n            throw new Error(\"No selection overlay\");\n        }\n        // get image data centered on x, y with brushSize width and height\n        const context = this.baseImageLayer.getContext(\"2d\");\n        if (context) {\n            const imageData = context.getImageData(\n                brushx - brushSize / 2,\n                brushy - brushSize / 2,\n                brushSize,\n                brushSize\n            );\n            // set alpha to 0 in a circle centered on x, y with radius brushSize / 2\n            for (let i = 0; i < imageData.data.length; i += 4) {\n                const x = (i / 4) % brushSize;\n                const y = Math.floor(i / 4 / brushSize);\n\n                const absx = x - brushSize / 2 + brushx;\n                // three pixel barrier on each edge UNLESS the selection overlay borders that edge\n                let leftEdge = this.selectionOverlay.x;\n                if (leftEdge > 0) {\n                    leftEdge += 10;\n                }\n                let rightEdge =\n                    this.selectionOverlay.x + this.selectionOverlay.width;\n                if (rightEdge < this.width) {\n                    rightEdge -= 10;\n                }\n                let topEdge = this.selectionOverlay.y;\n                if (topEdge > 0) {\n                    topEdge += 10;\n                }\n                let bottomEdge =\n                    this.selectionOverlay.y + this.selectionOverlay.height;\n                if (bottomEdge < this.canvas.height) {\n                    bottomEdge -= 10;\n                }\n\n                const containsx = absx > leftEdge && absx < rightEdge;\n                const absy = y - brushSize / 2 + brushy;\n                const containsy = absy > topEdge && absy < bottomEdge;\n                const contains = containsx && containsy;\n\n                // check if x, y is within the selection overlay\n                if (this.selectionOverlay && !contains) {\n                    continue;\n                }\n\n                const distance = Math.sqrt(\n                    Math.pow(x - brushSize / 2, 2) +\n                        Math.pow(y - brushSize / 2, 2)\n                );\n                if (distance < brushSize / 2) {\n                    imageData.data[i + 3] = 0;\n                }\n            }\n            // draw the image data on the selection layer\n            context.putImageData(\n                imageData,\n                brushx - brushSize / 2,\n                brushy - brushSize / 2\n            );\n        }\n    }\n\n    drawLine(\n        x1: number,\n        y1: number,\n        x2: number,\n        y2: number,\n        brushSize: number,\n        color: string,\n        layer: \"base\" | \"mask\" = \"base\"\n    ): void {\n        const imageLayer = layer === \"base\" ? this.editLayer : this.maskLayer;\n        if (!imageLayer) {\n            return;\n        }\n        // draw on selection layer\n        const context = imageLayer.getContext(\"2d\");\n        if (context) {\n            context.strokeStyle = color;\n            context.lineWidth = brushSize;\n            context.lineCap = \"round\";\n            context.beginPath();\n            context.moveTo(x1, y1);\n            context.lineTo(x2, y2);\n            context.stroke();\n        }\n        this.render();\n    }\n\n    smudgeLine(\n        x1: number,\n        y1: number,\n        x2: number,\n        y2: number,\n        brushSize: number,\n        brushOpacity: number\n    ): void {\n        const unitVector = {\n            x: x2 - x1,\n            y: y2 - y1,\n        };\n        const length = Math.sqrt(\n            unitVector.x * unitVector.x + unitVector.y * unitVector.y\n        );\n        unitVector.x /= length;\n        unitVector.y /= length;\n\n        // for each point on the line, get image data (brushSize x brushSize) from edit layer\n        // average pixel values that are within the brush circle.\n        // update the image data with the averaged pixel values in the\n        // brush circle, then put the image data back on the edit layer\n        // at the point on the line\n\n        const context = this.editLayer.getContext(\"2d\");\n        if (context) {\n            for (let i = 0; i < length; i++) {\n                const x = x1 + i * unitVector.x;\n                const y = y1 + i * unitVector.y;\n\n                const imageData = context.getImageData(\n                    x - brushSize / 2,\n                    y - brushSize / 2,\n                    brushSize,\n                    brushSize\n                );\n\n                let totalRed = 0;\n                let totalGreen = 0;\n                let totalBlue = 0;\n                let count = 0.0;\n\n                // average pixel values\n                for (let y = 0; y < imageData.height; y++) {\n                    for (let x = 0; x < imageData.width; x++) {\n                        const index = (y * imageData.width + x) * 4;\n                        const distance = Math.sqrt(\n                            (x - brushSize / 2) * (x - brushSize / 2) +\n                                (y - brushSize / 2) * (y - brushSize / 2)\n                        );\n                        if (distance <= brushSize / 2) {\n                            // get the pixel value from the image data\n                            const r = imageData.data[index];\n                            const g = imageData.data[index + 1];\n                            const b = imageData.data[index + 2];\n\n                            totalRed += r;\n                            totalGreen += g;\n                            totalBlue += b;\n                            count++;\n                        }\n                    }\n                }\n\n                // update the image data with the averaged pixel values\n                // these need to be weighted by the brush opacity\n                const averageRed = totalRed / count;\n                const averageGreen = totalGreen / count;\n                const averageBlue = totalBlue / count;\n                for (let y = 0; y < imageData.height; y++) {\n                    for (let x = 0; x < imageData.width; x++) {\n                        const index = (y * imageData.width + x) * 4;\n                        const distance = Math.sqrt(\n                            (x - brushSize / 2) * (x - brushSize / 2) +\n                                (y - brushSize / 2) * (y - brushSize / 2)\n                        );\n                        if (distance <= brushSize / 2) {\n                            imageData.data[index] =\n                                averageRed * brushOpacity +\n                                imageData.data[index] * (1 - brushOpacity);\n                            imageData.data[index + 1] =\n                                averageGreen * brushOpacity +\n                                imageData.data[index + 1] * (1 - brushOpacity);\n                            imageData.data[index + 2] =\n                                averageBlue * brushOpacity +\n                                imageData.data[index + 2] * (1 - brushOpacity);\n                        }\n                    }\n                }\n\n                // put the image data back on the edit layer\n                context.putImageData(\n                    imageData,\n                    x - brushSize / 2,\n                    y - brushSize / 2\n                );\n            }\n        }\n        this.render();\n    }\n\n    getPixel(x: number, y: number): string {\n        const context = this.baseImageLayer.getContext(\"2d\");\n        // get pixel as hex string\n        if (context) {\n            const pixel = context.getImageData(x, y, 1, 1).data;\n            return (\n                \"#\" +\n                (\"000000\" + rgbToHex(pixel[0], pixel[1], pixel[2])).slice(-6)\n            );\n        }\n        return \"#000000\";\n    }\n\n    copyEditImageFromBaseImage(): void {\n        // copy the base image to the edit layer\n        const context = this.editLayer.getContext(\"2d\");\n        if (context) {\n            context.drawImage(this.baseImageLayer, 0, 0);\n        }\n        this.render();\n        this.hasSelection = true;\n        this.notifySnapshotListener();\n    }\n\n    expandToOverlay() {\n        if (!this.selectionOverlay) {\n            throw new Error(\"No selection overlay\");\n        }\n        const minX = Math.min(0, this.selectionOverlay.x);\n        const minY = Math.min(0, this.selectionOverlay.y);\n        const maxX = Math.max(\n            this.selectionOverlay.x + this.selectionOverlay.width,\n            this.baseImageLayer.width\n        );\n        const maxY = Math.max(\n            this.selectionOverlay.y + this.selectionOverlay.height,\n            this.baseImageLayer.height\n        );\n        const width = maxX - minX;\n        const height = maxY - minY;\n\n        // create a new canvas with the expanded size\n        const newCanvas = document.createElement(\"canvas\");\n        newCanvas.width = width;\n        newCanvas.height = height;\n        // draw the base image on the new canvas.\n        // if overlay.x is negative, image.x is overlay.x * -1\n        // if overlay.x is 0 or positive, image.x is 0\n        // if overlay.y is negative, image.y is overlay.y * -1\n        // if overlay.y is 0 or positive, image.y is 0\n        const context = newCanvas.getContext(\"2d\");\n        if (context) {\n            context.drawImage(\n                this.baseImageLayer,\n                Math.max(0, this.selectionOverlay.x * -1),\n                Math.max(0, this.selectionOverlay.y * -1)\n            );\n        }\n        if (this.selectionOverlay.x < 0) {\n            this.selectionOverlay.x = 0;\n        }\n        if (this.selectionOverlay.y < 0) {\n            this.selectionOverlay.y = 0;\n        }\n        console.log(`new Canvas size: ${width} x ${height}`);\n        this.setBaseImage(newCanvas, false);\n    }\n}\n\nfunction rgbToHex(r: number, g: number, b: number) {\n    if (r > 255 || g > 255 || b > 255) throw \"Invalid color component\";\n    return ((r << 16) | (g << 8) | b).toString(16);\n}\n\nexport function createRenderer(canvas: HTMLCanvasElement): Renderer {\n    return new Renderer(canvas);\n}\n","// export interface AspectRatio {\n//     displayName: string;\n//     width: number;\n//     height: number;\n//     id: number;\n\n//     scale: (size: number) => AspectRatio;\n// }\n\nexport class AspectRatio implements AspectRatio {\n    readonly displayName: string;\n    readonly width: number;\n    readonly height: number;\n    readonly id: number;\n\n    constructor(cfg: any) {\n        this.displayName = cfg.displayName;\n        this.width = cfg.width;\n        this.height = cfg.height;\n        this.id = cfg.id;\n    }\n\n    scale(size: number): AspectRatio {\n        const newWidth = this.width * size;\n        const newHeight = this.height * size;\n\n        return new AspectRatio({\n            id: this.id,\n            displayName: this.displayName,\n            // round width and height up to the nearest multiple of 64\n            width: Math.ceil(newWidth / 64) * 64,\n            height: Math.ceil(newHeight / 64) * 64,\n        });\n    }\n}\n\nexport const DEFAULT_ASPECT_RATIO = 5;\n\nexport const aspectRatios: AspectRatio[] = [\n    {\n        displayName: \"4:1\",\n        width: 1024,\n        height: 256,\n        id: 0,\n    },\n    {\n        displayName: \"3:1\",\n        width: 768,\n        height: 256,\n        id: 1,\n    },\n    {\n        displayName: \"2:1\",\n        width: 640,\n        height: 320,\n        id: 2,\n    },\n    {\n        displayName: \"3:2\",\n        width: 576,\n        height: 384,\n        id: 3,\n    },\n    {\n        displayName: \"5:4\",\n        width: 640,\n        height: 512,\n        id: 4,\n    },\n    {\n        displayName: \"1:1\",\n        width: 512,\n        height: 512,\n        id: 5,\n    },\n    {\n        displayName: \"4:5\",\n        width: 512,\n        height: 640,\n        id: 6,\n    },\n    {\n        displayName: \"2:3\",\n        width: 384,\n        height: 576,\n        id: 7,\n    },\n    {\n        displayName: \"1:2\",\n        width: 320,\n        height: 640,\n        id: 8,\n    },\n    {\n        displayName: \"1:3\",\n        width: 256,\n        height: 768,\n        id: 9,\n    },\n    {\n        displayName: \"1:4\",\n        width: 256,\n        height: 1024,\n        id: 10,\n    }\n].map((cfg) => new AspectRatio(cfg));\n\nexport function getClosestAspectRatio(width: number, height: number): AspectRatio {\n    const aspectRatio = width / height;\n\n    const tests = [...aspectRatios];\n    tests.sort((a, b) => {\n        const aRatio = a.width / a.height;\n        const bRatio = b.width / b.height;\n        return (\n            Math.abs(aRatio - aspectRatio) -\n            Math.abs(bRatio - aspectRatio)\n        );\n    });\n    const bestMatch = tests[0];\n    return bestMatch;\n}\n\n\n","import { FC, useEffect, useState } from \"react\";\nimport { PaletteButton } from \"./PaletteButton\";\nimport { PencilTool } from \"./pencil-tool\";\nimport { Renderer } from \"./renderer\";\n\ninterface MaskEditorProps {\n    // renderer: Renderer;\n    tool: PencilTool;\n    onConfirm: () => void;\n    onRevert: () => void;\n}\n\nconst colors = [\"#FFFFFF\", \"#000000\"];\n\nexport const MaskEditor: FC<MaskEditorProps> = ({\n    // renderer,\n    tool,\n    onConfirm,\n    onRevert,\n}) => {\n    const [brushSize, setBrushSize] = useState(10);\n    const [brushColor, setBrushColor] = useState(colors[0]);\n\n    useEffect(() => {\n        tool.updateArgs({\n            brushSize,\n            brushColor,\n        });\n    }, [brushSize, brushColor]);\n\n    return (\n        <div style={{ marginTop: \"16px\" }}>\n            <div className=\"form-group\">\n                <label style={{ width: \"100%\" }}>\n                    Brush size\n                    <small\n                        className=\"form-text text-muted\"\n                        style={{ float: \"right\" }}\n                    >\n                        {brushSize}px\n                    </small>\n                </label>\n                <input\n                    type=\"range\"\n                    className=\"form-control-range\"\n                    min=\"1\"\n                    max=\"100\"\n                    value={brushSize}\n                    onChange={(e) => setBrushSize(parseInt(e.target.value))}\n                />\n            </div>\n            <div\n                style={{\n                    display: \"flex\",\n                    flexDirection: \"row\",\n                    flexWrap: \"wrap\",\n                }}\n            >\n                {colors.map((color, i) => (\n                    <PaletteButton\n                        key={i}\n                        selectedColor={brushColor}\n                        color={color}\n                        onClick={(color) => setBrushColor(color)}\n                    />\n                ))}\n            </div>\n            <div className=\"form-group\" style={{ marginTop: \"16px\" }}>\n                <i className=\"fa fa-info-circle\"></i>&nbsp;Masking: areas that\n                are painted white will be changed, areas that are painted black\n                will be left unchanged.\n            </div>\n            <div className=\"form-group\" style={{ marginTop: \"16px\" }}>\n                <button\n                    className=\"btn btn-secondary\"\n                    onClick={() => tool.renderer.invertMask()}\n                >\n                    Invert\n                </button>\n                <button\n                    className=\"btn btn-secondary\"\n                    onClick={onRevert}\n                    style={{ marginLeft: \"8px\" }}\n                >\n                    Cancel\n                </button>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={onConfirm}\n                    style={{ marginLeft: \"8px\" }}\n                >\n                    Save\n                </button>\n            </div>\n        </div>\n    );\n};\n","import React, { FC, useState, useEffect } from \"react\";\nimport loadImage from \"blueimp-load-image\";\nimport saveAs from \"file-saver\";\n\nimport { AIBrushApi } from \"../../client\";\nimport { Renderer } from \"./renderer\";\nimport { BaseTool, Tool } from \"./tool\";\n\ninterface Props {\n    renderer: Renderer;\n    tool: BaseTool;\n    api: AIBrushApi;\n}\n\nexport const ImportExportControls: FC<Props> = ({ renderer, tool }) => {\n\n    const [backupImage, setBackupImage] = useState<string | undefined>();\n\n    const onImageSelected = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const files = event.target.files;\n        if (files && files.length > 0) {\n            loadImage(\n                files[0],\n                (img) => {\n                    const backupImage = renderer.getEncodedImage(null);\n                    setBackupImage(backupImage);\n                    renderer.setBaseImage(img as HTMLImageElement);\n                },\n                { canvas: false }\n            );\n        }\n    };\n\n    const onExport = () => {\n        const encodedImage = renderer.getEncodedImage(null);\n        if (encodedImage) {\n            // base64 decode\n            const byteString = atob(encodedImage);\n            // save as file\n            const buffer = new ArrayBuffer(byteString.length);\n            const intArray = new Uint8Array(buffer);\n            for (let i = 0; i < byteString.length; i++) {\n                intArray[i] = byteString.charCodeAt(i);\n            }\n            const blob = new Blob([intArray], { type: \"image/png\" });\n            saveAs(blob, \"image.png\");\n        }\n    };\n\n    if (backupImage) {\n        return (\n            <div className=\"form-group\" style={{marginTop: \"16px\"}}>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => {\n                        setBackupImage(undefined);\n                        const img = new Image();\n                        // set src as data uri\n                        const src = \"data:image/png;base64,\" + backupImage;\n                        img.src = src;\n                        img.onload = () => {\n                            renderer.setBaseImage(img);\n                        };\n                    }}\n                >\n                    {/* cancel icon */}\n                    <i className=\"fas fa-times\"></i>&nbsp;\n                    Revert\n                </button>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => {\n                        setBackupImage(undefined);\n                        if (tool.saveListener) {\n                            const encodedImage = renderer.getEncodedImage(null);\n                            if (encodedImage) {\n                                tool.saveListener(encodedImage);\n                            }\n                        }\n                    }}\n                    style={{marginLeft: \"8px\"}}\n                >\n                    {/* save icon */}\n                    <i className=\"fas fa-save\"></i>&nbsp;\n                    Save\n                </button>\n            </div>\n        );\n    }\n\n    // Show buttons for import and export and \"save a copy\"\n    return (\n        <>\n            <div className=\"form-group\" style={{marginTop: \"16px\"}}>\n                <label\n                    id=\"loadimage-wrapper\"\n                    className={`btn btn-primary `}\n                    style={{ display: \"inline\" }}\n                >\n                    {/* upload image */}\n                    <i className=\"fas fa-upload\"></i>&nbsp; Import Image\n                    <input\n                        id=\"loadimage\"\n                        type=\"file\"\n                        style={{ display: \"none\" }}\n                        onChange={onImageSelected}\n                    />\n                </label>\n            </div>\n            <div className=\"form-group\">\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => {\n                        onExport();\n                    }}\n                    style={{ marginLeft: \"8px\"}}\n                >\n                    <i className=\"fas fa-download\"></i>&nbsp; Export Image\n                </button>\n            </div>\n        </>\n    );\n};\n","import React, { FC, useState, useEffect } from \"react\";\nimport loadImage from \"blueimp-load-image\";\nimport saveAs from \"file-saver\";\nimport axios from \"axios\";\nimport * as uuid from \"uuid\";\n\nimport { sleep } from \"../../lib/sleep\";\n\nimport {\n    AIBrushApi,\n    CreateImageInput,\n    ImageParamsAugmentationEnum,\n    Image as APIImage,\n    StatusEnum,\n} from \"../../client\";\nimport { Renderer } from \"./renderer\";\nimport { BaseTool, Tool } from \"./tool\";\nimport {\n    splitImage,\n    mergeTiles,\n    ImageUtilWorker,\n    imageDataToCanvas,\n    fixImageSize,\n    decodeImage,\n    binaryImageToDataBase64,\n    SplitResult,\n} from \"../../lib/imageutil\";\nimport { defaultArgs } from \"../../components/ImagePrompt\";\nimport { ErrorNotification } from \"../../components/Alerts\";\nimport moment from \"moment\";\nimport { calculateImagesCost } from \"../../lib/credits\";\nimport { CostIndicator } from \"../../components/CostIndicator\";\n\nexport const anonymousClient = axios.create();\n\ninterface Props {\n    renderer: Renderer;\n    tool: BaseTool;\n    api: AIBrushApi;\n    image: APIImage;\n}\n\nexport const AugmentControls: FC<Props> = ({ renderer, tool, api, image }) => {\n    const [backupImage, setBackupImage] = useState<string | undefined>();\n    const [activeAugmentation, setActiveAugmentation] = useState<\n        \"upscale\" | \"face_restore\" | null\n    >(null);\n    const [imageWorker, setImageWorker] = useState<\n        ImageUtilWorker | undefined\n    >();\n    const [error, setError] = useState<string | null>(null);\n    const [lastError, setLastError] = useState<number>(0);\n\n    useEffect(() => {\n        const imageWorker = new ImageUtilWorker();\n        setImageWorker(imageWorker);\n        return () => {\n            imageWorker.destroy();\n        };\n    }, []);\n\n    const augmentImageData = async (\n        imageData: ImageData,\n        augmentation: \"upscale\" | \"face_restore\"\n    ): Promise<ImageData> => {\n        if (!imageWorker) {\n            throw new Error(\"Image worker not initialized\");\n        }\n        let c = imageDataToCanvas(imageData);\n        let encodedImage = c.toDataURL(\"image/png\").split(\",\")[1];\n        c.remove();\n        const input: CreateImageInput = defaultArgs();\n        input.label = \"\";\n        // input.encoded_image = encodedImage;\n\n        const tmpInitImage = await api.createTemporaryImage(\"png\");\n        const binaryImageData = Buffer.from(encodedImage, \"base64\");\n        await anonymousClient.put(\n            tmpInitImage.data.upload_url!,\n            binaryImageData,\n            {\n                headers: {\n                    \"Content-Type\": \"image/png\",\n                },\n            }\n        );\n\n        input.tmp_image_id = tmpInitImage.data.id;\n        input.params.prompt = image.params.prompt;\n        input.params.negative_prompt = image.params.negative_prompt;\n        input.params.denoising_strength = 0.05;\n        input.count = 1;\n        input.model = \"stable_diffusion\";\n        input.nsfw = true;\n        input.temporary = true;\n        input.params.width = imageData.width;\n        input.params.height = imageData.height;\n        input.params.augmentation =\n            augmentation === \"upscale\"\n                ? ImageParamsAugmentationEnum.Upscale\n                : ImageParamsAugmentationEnum.FaceRestore;\n\n        const createResp = await api.createImage(input);\n        let processingImage = createResp.data.images![0];\n        while (processingImage.status !== StatusEnum.Completed) {\n            await sleep(2000);\n            const checkResp = await api.getImage(processingImage.id);\n            processingImage = checkResp.data;\n            if (processingImage.status === StatusEnum.Error) {\n                throw new Error(\"Augmentation failed\");\n            }\n        }\n        const downloadUrls = await api.getImageDownloadUrls(processingImage.id);\n\n        // download image data, convert to canvas and resize to 2x original,\n        // convert back to image data and return.\n        const imageDataResp = await anonymousClient.get(\n            downloadUrls.data.image_url!,\n            {\n                responseType: \"arraybuffer\",\n            }\n        );\n        encodedImage = binaryImageToDataBase64(imageDataResp.data);\n        const img = await decodeImage(encodedImage);\n        c = document.createElement(\"canvas\");\n        const upscaleFactor = augmentation === \"upscale\" ? 2 : 1;\n        c.width = imageData.width * upscaleFactor;\n        c.height = imageData.height * upscaleFactor;\n        const ctx = c.getContext(\"2d\")!;\n        ctx.drawImage(img, 0, 0, c.width, c.height);\n        const newImageData = ctx.getImageData(0, 0, c.width, c.height);\n        c.remove();\n        return newImageData;\n    };\n\n    const onAugment = async (augmentation: \"upscale\" | \"face_restore\") => {\n        setActiveAugmentation(augmentation);\n        setError(null);\n        try {\n            const backupImage = renderer.getEncodedImage(null);\n            setBackupImage(backupImage);\n            let imageData = renderer.getImageData(null);\n            if (!imageData) {\n                return;\n            }\n            // ensure width and height are multiples of 64\n            if ((imageData.width % 64) + (imageData.height % 64) !== 0) {\n                const c = fixImageSize(imageDataToCanvas(imageData));\n                imageData = c\n                    .getContext(\"2d\")!\n                    .getImageData(0, 0, c.width, c.height);\n            }\n\n            const newImageData = await augmentImageData(\n                imageData,\n                augmentation\n            );\n            const newCanvas = imageDataToCanvas(newImageData);\n            renderer.setBaseImage(newCanvas);\n            newCanvas.remove();\n        } catch (err: any) {\n            setError(err.message || \"Augmentation failed\");\n            setLastError(moment().valueOf());\n        } finally {\n            setActiveAugmentation(null);\n        }\n    };\n\n    if (activeAugmentation) {\n        return (\n            <div className=\"form-group\" style={{ marginTop: \"16px\" }}>\n                <i className=\"fas fa-spinner fa-spin\"></i>&nbsp;{\" \"}\n                {activeAugmentation === \"upscale\"\n                    ? \"Upscaling...\"\n                    : \"Restoring faces...\"}\n            </div>\n        );\n    }\n\n    if (backupImage) {\n        return (\n            <div className=\"form-group\" style={{ marginTop: \"16px\" }}>\n                <ErrorNotification message={error} timestamp={lastError} />\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => {\n                        setBackupImage(undefined);\n                        const img = new Image();\n                        // set src as data uri\n                        const src = \"data:image/png;base64,\" + backupImage;\n                        img.src = src;\n                        img.onload = () => {\n                            renderer.setBaseImage(img);\n                        };\n                    }}\n                >\n                    {/* cancel icon */}\n                    <i className=\"fas fa-times\"></i>&nbsp; Revert\n                </button>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => {\n                        setBackupImage(undefined);\n                        if (tool.saveListener) {\n                            const encodedImage = renderer.getEncodedImage(null);\n                            if (encodedImage) {\n                                tool.saveListener(encodedImage);\n                            }\n                        }\n                    }}\n                    style={{ marginLeft: \"8px\" }}\n                >\n                    {/* save icon */}\n                    <i className=\"fas fa-save\"></i>&nbsp; Save\n                </button>\n            </div>\n        );\n    }\n\n    const maxSize = 2048 * 2048;\n    if (renderer.getWidth() * renderer.getHeight() > maxSize) {\n        return (\n            <div style={{ marginTop: \"16px\" }}>\n                This image is too large to augment.\n            </div>\n        );\n    }\n\n    const cost = calculateImagesCost(1, image.params.width!, image.params.height!);\n\n    // Show buttons for import and export and \"save a copy\"\n    return (\n        <>\n            <ErrorNotification message={error} timestamp={lastError} />\n            <div className=\"form-group\" style={{ marginTop: \"16px\" }}>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => {\n                        onAugment(\"upscale\");\n                    }}\n                    style={{ marginLeft: \"8px\" }}\n                >\n                    {/* upscale icon */}\n                    <i className=\"fas fa-arrows-alt\"></i>&nbsp; Upscale Image 2x\n                </button>\n            </div>\n            <div className=\"form-group\" style={{ marginTop: \"16px\" }}>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => {\n                        onAugment(\"face_restore\");\n                    }}\n                    style={{ marginLeft: \"8px\" }}\n                >\n                    {/* face restore icon */}\n                    <i className=\"fas fa-smile\"></i>&nbsp; Restore Faces\n                </button>\n            </div>\n            <div className=\"form-group\" style={{ marginTop: \"16px\" }}>\n                <CostIndicator imagesCost={cost} />\n            </div>\n        </>\n    );\n};\n","import React from \"react\";\nimport { Modal, Button } from \"react-bootstrap\";\nimport { Link, useHistory } from \"react-router-dom\";\n\ninterface OutOfCreditsModalProps {\n    show: boolean;\n    onHide: () => void;\n}\n\nconst OutOfCreditsModal: React.FC<OutOfCreditsModalProps> = ({\n    show,\n    onHide,\n}) => {\n    const history = useHistory();\n\n    const redirectToPricing = () => {\n        onHide();\n        history.push(\"/pricing\");\n    };\n\n    return (\n        <Modal show={show} onHide={onHide} centered>\n            <Modal.Header closeButton>\n                <Modal.Title>Out of Credits</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                Oops! It looks like you've run out of credits for today. But\n                don't worry, you'll receive 100 free credits tomorrow to\n                continue creating amazing images. Can't wait? Check out our\n                affordable <Link to=\"/pricing\">pricing options</Link> to get instant access to more credits\n                and unleash your creativity without limits!\n            </Modal.Body>\n            <Modal.Footer>\n                <Button variant=\"secondary\" onClick={onHide}>\n                    Close\n                </Button>\n                <Button variant=\"primary\" onClick={redirectToPricing}>\n                    Visit Pricing Page\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n};\n\nexport default OutOfCreditsModal;\n","import React, { useEffect, useState } from \"react\";\nimport { Modal, Button } from \"react-bootstrap\";\nimport { useHistory } from \"react-router-dom\";\n\ninterface PaymentStatusModalProps {\n    paymentStatus?: \"success\" | \"canceled\";\n}\n\nconst PaymentStatusModal: React.FC<PaymentStatusModalProps> = ({\n    paymentStatus,\n}) => {\n    const [show, setShow] = useState(false);\n    const history = useHistory();\n\n    useEffect(() => {\n        if (paymentStatus) {\n            setShow(true);\n        }\n    }, [paymentStatus]);\n\n    const handleClose = () => {\n        setShow(false);\n        history.push(\"/\");\n    };\n\n    return (\n        <Modal show={show} onHide={handleClose}>\n            <Modal.Header closeButton>\n                <Modal.Title>Payment Status</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                {paymentStatus === \"success\"\n                    ? \"Payment succeeded!\"\n                    : \"Payment canceled.\"}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button variant=\"secondary\" onClick={handleClose}>\n                    Close\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n};\n\nexport default PaymentStatusModal;\n","import axios from \"axios\";\nimport { AIBrushApi } from \"../client\";\nimport { Rect } from \"../pages/image-editor/models\";\n\nconst anonymousClient = axios.create();\n\nexport interface SplitResult {\n    numTilesX: number;\n    numTilesY: number;\n    tileSize: number;\n    imageWidth: number;\n    imageHeight: number;\n    tiles: ImageData[][]; // [x][y]\n}\n\nexport function convertPNGToJPG(encodedImage: string): Promise<string> {\n    return new Promise((resolve, reject) => {\n        const image = new Image();\n        image.onload = () => {\n            const canvas = document.createElement(\"canvas\");\n            try {\n                canvas.width = image.width;\n                canvas.height = image.height;\n                const ctx = canvas.getContext(\"2d\");\n                if (!ctx) {\n                    throw new Error(\"Could not get canvas context\");\n                }\n                ctx.drawImage(image, 0, 0);\n                const dataUrl = canvas.toDataURL(\"image/jpeg\");\n                resolve(dataUrl.split(\",\")[1]);\n            } finally {\n                canvas.remove();\n            }\n        };\n        image.src = `data:image/png;base64,${encodedImage}`\n    });\n}\n\nexport function loadImageDataElement(\n    api: AIBrushApi,\n    imageId: string\n): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n        api.getImageDownloadUrls(imageId)\n            .then((urls) => {\n                anonymousClient\n                    .get(urls.data.image_url!, {\n                        responseType: \"arraybuffer\",\n                    })\n                    .then((resp) => {\n                        const binaryImageData = Buffer.from(\n                            resp.data,\n                            \"binary\"\n                        );\n                        const base64ImageData =\n                            binaryImageData.toString(\"base64\");\n                        const src = `data:image/png;base64,${base64ImageData}`;\n                        const imageElement = new Image();\n                        imageElement.src = src;\n                        imageElement.onload = () => {\n                            resolve(imageElement);\n                        };\n                    })\n                    .catch((err) => reject(err));\n            })\n            .catch((err) => reject(err));\n    });\n}\n\n// split image for individual upscales\nexport function splitImage(initImage: ImageData) {\n    // Check if the image area is larger than 512x512\n    if (initImage.width * initImage.height > 512 * 512) {\n        // use a temporary canvas to split the image\n        const canvas = document.createElement(\"canvas\");\n        try {\n            canvas.width = initImage.width;\n            canvas.height = initImage.height;\n            const ctx = canvas.getContext(\"2d\");\n            if (!ctx) {\n                throw new Error(\"Could not get canvas context\");\n            }\n            ctx.putImageData(initImage, 0, 0);\n            const tile_size = Math.min(initImage.width, initImage.height, 512);\n            // split the image into 512x512 tiles\n            // they need to overlap by at least 32 pixels\n            // so that the edges can be merged\n\n            // calculate the number of tiles in each dimension\n            const num_tiles_x = Math.ceil(initImage.width / (tile_size - 32));\n            const num_tiles_y = Math.ceil(initImage.height / (tile_size - 32));\n\n            const tiles: ImageData[][] = [];\n            for (let x = 0; x < num_tiles_x; x++) {\n                tiles.push([]);\n                for (let y = 0; y < num_tiles_y; y++) {\n                    // calculate the bounding box of the tile\n                    const x0 = x * (tile_size - 32);\n                    const y0 = y * (tile_size - 32);\n                    const x1 = Math.min(x0 + tile_size, initImage.width);\n                    const y1 = Math.min(y0 + tile_size, initImage.height);\n                    // crop the tile\n                    const tile = ctx.getImageData(x0, y0, x1 - x0, y1 - y0);\n                    tiles[x].push(tile);\n                }\n            }\n            return {\n                numTilesX: num_tiles_x,\n                numTilesY: num_tiles_y,\n                tileSize: tile_size,\n                imageWidth: initImage.width,\n                imageHeight: initImage.height,\n                tiles,\n            };\n        } finally {\n            canvas.remove();\n        }\n    } else {\n        return null;\n    }\n}\n\n// merge the tiles back into a single image\n// tiles should be 2x original size\nexport function mergeTiles(splitResult: SplitResult): ImageData {\n    // create a new image\n    const canvas = document.createElement(\"canvas\");\n    try {\n        canvas.width = splitResult.imageWidth;\n        canvas.height = splitResult.imageHeight;\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) {\n            throw new Error(\"Could not get canvas context\");\n        }\n        for (let x = 0; x < splitResult.numTilesX; x++) {\n            for (let y = 0; y < splitResult.numTilesY; y++) {\n                // load the tile\n                const tile = splitResult.tiles[x][y];\n                const tileCanvas = imageDataToCanvas(tile);\n\n                // paste the tile into the new image\n                ctx.drawImage(\n                    tileCanvas,\n                    x * (splitResult.tileSize - 64),\n                    y * (splitResult.tileSize - 64)\n                );\n            }\n        }\n        return ctx.getImageData(\n            0,\n            0,\n            splitResult.imageWidth,\n            splitResult.imageHeight\n        );\n    } finally {\n        canvas.remove();\n    }\n}\n\nexport function imageDataToCanvas(imageData: ImageData): HTMLCanvasElement {\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = imageData.width;\n    canvas.height = imageData.height;\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) {\n        throw new Error(\"Could not get canvas context\");\n    }\n    ctx.putImageData(imageData, 0, 0);\n    return canvas;\n}\n\n// extract resizing logic from above function into a reusable resizeImage function\nexport function resizeImage(\n    image: HTMLCanvasElement,\n    width: number,\n    height: number\n): HTMLCanvasElement {\n    const canvas = document.createElement(\"canvas\");\n    try {\n        canvas.width = width;\n        canvas.height = height;\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) {\n            throw new Error(\"Could not get canvas context\");\n        }\n        ctx.drawImage(image, 0, 0, width, height);\n        return canvas;\n    } finally {\n        image.remove();\n    }\n}\n\n// re-implement fixImageSize using resizeImage\nexport function fixImageSize(image: HTMLCanvasElement): HTMLCanvasElement {\n    // if the width and the height are divisible by 64, return the image data\n    // otherwise, resize up to the next multiple of 64\n    const width = Math.ceil(image.width / 64) * 64;\n    const height = Math.ceil(image.height / 64) * 64;\n    if (width == image.width && height == image.height) {\n        return image;\n    }\n    return resizeImage(image, width, height);\n}\n\nexport function featherEdges(\n    selectionOverlay: Rect,\n    imageWidth: number,\n    imageHeight: number,\n    imageData: ImageData,\n    featherWidth?: number\n) {\n    const featherLeftEdge = selectionOverlay.x != 0;\n    const featherRightEdge =\n        selectionOverlay.x + selectionOverlay.width != imageWidth;\n    const featherTopEdge = selectionOverlay.y != 0;\n    const featherBottomEdge =\n        selectionOverlay.y + selectionOverlay.height != imageHeight;\n\n    const baseWidth = Math.min(selectionOverlay.width, selectionOverlay.height);\n    if (!featherWidth) {\n        featherWidth = Math.floor(baseWidth / 8);\n    }\n\n    if (featherTopEdge) {\n        for (let y = 0; y < featherWidth; y++) {\n            for (let x = 0; x < selectionOverlay.width; x++) {\n                const pixelIndex = (y * selectionOverlay.width + x) * 4;\n                const alpha = (y / featherWidth) * 255;\n                const existingAlpha = imageData.data[pixelIndex + 3];\n                imageData.data[pixelIndex + 3] = Math.min(alpha, existingAlpha);\n            }\n        }\n    }\n    if (featherBottomEdge) {\n        for (\n            let y = selectionOverlay.height - featherWidth;\n            y < selectionOverlay.height;\n            y++\n        ) {\n            for (let x = 0; x < selectionOverlay.width; x++) {\n                const pixelIndex = (y * selectionOverlay.width + x) * 4;\n                const alpha =\n                    ((selectionOverlay.height - y) / featherWidth) * 255;\n                const existingAlpha = imageData.data[pixelIndex + 3];\n                imageData.data[pixelIndex + 3] = Math.min(alpha, existingAlpha);\n            }\n        }\n    }\n    if (featherLeftEdge) {\n        for (let x = 0; x < featherWidth; x++) {\n            for (let y = 0; y < selectionOverlay.height; y++) {\n                const pixelIndex = (y * selectionOverlay.width + x) * 4;\n                const alpha = (x / featherWidth) * 255;\n                const existingAlpha = imageData.data[pixelIndex + 3];\n                imageData.data[pixelIndex + 3] = Math.min(alpha, existingAlpha);\n            }\n        }\n    }\n    if (featherRightEdge) {\n        for (\n            let x = selectionOverlay.width - featherWidth;\n            x < selectionOverlay.width;\n            x++\n        ) {\n            for (let y = 0; y < selectionOverlay.height; y++) {\n                const pixelIndex = (y * selectionOverlay.width + x) * 4;\n                const alpha =\n                    ((selectionOverlay.width - x) / featherWidth) * 255;\n                const existingAlpha = imageData.data[pixelIndex + 3];\n                imageData.data[pixelIndex + 3] = Math.min(alpha, existingAlpha);\n            }\n        }\n    }\n}\n\nexport function applyAlphaMask(imageData: ImageData, alphaMask: ImageData) {\n    if (\n        imageData.width != alphaMask.width ||\n        imageData.height != alphaMask.height\n    ) {\n        throw new Error(\"imageData and alphaMask are not the same size\");\n    }\n    const spread = 10;\n    for (let x = 0; x < imageData.width; x++) {\n        for (let y = 0; y < imageData.height; y++) {\n            // r, g, b, a\n            // if transparency within 10 pixels, set alpha to 1, otherwise to zero.\n            // binary alpha inversion with spread\n            let alpha = false;\n            for (\n                let x2 = Math.max(0, x - spread);\n                x2 < Math.min(imageData.width, x + spread);\n                x2++\n            ) {\n                for (\n                    let y2 = Math.max(0, y - spread);\n                    y2 < Math.min(imageData.height, y + spread);\n                    y2++\n                ) {\n                    const alphaValue =\n                        alphaMask.data[y2 * alphaMask.width * 4 + x2 * 4 + 3];\n                    if (alphaValue < 255) {\n                        alpha = true;\n                    }\n                }\n            }\n            const alphaIndex = y * imageData.width * 4 + x * 4 + 3;\n            if (alpha) {\n                imageData.data[alphaIndex] = 255;\n            } else {\n                imageData.data[alphaIndex] = 0;\n            }\n        }\n    }\n}\n\nexport interface ImageWorkerRequest {\n    id: string;\n    feather: boolean;\n    upscale?: boolean;\n    alphaMode: \"none\" | \"mask\" | \"alpha\";\n    pixels: Uint8ClampedArray;\n    alphaPixels?: Uint8ClampedArray;\n    width: number;\n    height: number;\n    featherWidth?: number;\n    selectionOverlay: Rect;\n}\n\nexport interface ImageWorkerResponse {\n    id: string;\n    pixels: Uint8ClampedArray;\n}\n\nexport class ImageUtilWorker {\n    private workers: Array<Worker> = [];\n    private callbacks: { [key: string]: (event: MessageEvent) => void } = {};\n    private cursor = 0;\n\n    constructor(numWorkers = 3) {\n        for (let i = 0; i < numWorkers; i++) {\n            this.workers[i] = new Worker(\n                `${process.env.PUBLIC_URL}/workers/imageutil.js`\n            );\n            this.workers[i].addEventListener(\n                \"message\",\n                this.onMessage.bind(this)\n            );\n        }\n    }\n\n    onMessage(event: MessageEvent) {\n        const resp = event.data as ImageWorkerResponse;\n        this.callbacks[resp.id](event);\n        delete this.callbacks[resp.id];\n    }\n\n    async processRequest(\n        request: ImageWorkerRequest\n    ): Promise<ImageWorkerResponse> {\n        return new Promise((resolve, reject) => {\n            this.callbacks[request.id] = (event) => {\n                resolve(event.data);\n            };\n            this.workers[this.cursor].postMessage({\n                ...request,\n            });\n            this.cursor = (this.cursor + 1) % this.workers.length;\n        });\n    }\n\n    destroy() {\n        for (let key in this.workers) {\n            this.workers[key].terminate();\n        }\n    }\n}\n\nexport function createEncodedThumbnail(encodedImage: string): Promise<string> {\n    return new Promise((resolve, reject) => {\n        // use html5 canvas\n        // crop to square aspect ratio on 128x128 canvas\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = 128;\n        canvas.height = 128;\n\n        const image = new Image();\n        image.src = `data:image/png;base64,${encodedImage}`;\n        image.onload = () => {\n            const context = canvas.getContext(\"2d\");\n            if (!context) {\n                throw new Error(\"Could not create canvas context\");\n            }\n            const width = 128;\n            const height = 128;\n            canvas.width = width;\n            canvas.height = height;\n\n            const aspectRatio = image.width / image.height;\n            const cropWidth =\n                aspectRatio > 1 ? image.width : image.height * aspectRatio;\n            const cropHeight =\n                aspectRatio > 1 ? image.width / aspectRatio : image.height;\n            const cropX = (image.width - cropWidth) / 2;\n            const cropY = (image.height - cropHeight) / 2;\n            context.drawImage(\n                image,\n                cropX,\n                cropY,\n                cropWidth,\n                cropHeight,\n                0,\n                0,\n                width,\n                height\n            );\n\n            // save to png\n            const imageUrl = canvas.toDataURL(\"image/png\");\n            const base64 = imageUrl.split(\",\")[1];\n            resolve(base64);\n        };\n    });\n}\n\nexport function decodeImage(encodedImage: string): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n        const image = new Image();\n        image.src = `data:image/png;base64,${encodedImage}`;\n        image.onload = () => {\n            resolve(image);\n        };\n    });\n}\n\nexport function binaryImageToDataBase64(binaryImage: any): string {\n    const buf = Buffer.from(binaryImage, \"binary\");\n    return buf.toString(\"base64\");\n}\n\nexport function resizeEncodedImage(\n    encodedImage: string,\n    width: number,\n    height: number,\n    format: \"png\" | \"jpeg\",\n): Promise<string> {\n    return new Promise((resolve, reject) => {\n        // use html5 canvas\n        // crop to square aspect ratio on 128x128 canvas\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = width;\n        canvas.height = height;\n\n        const image = new Image();\n        image.src = `data:image/${format};base64,${encodedImage}`;\n        image.onload = () => {\n            const context = canvas.getContext(\"2d\");\n            if (!context) {\n                throw new Error(\"Could not create canvas context\");\n            }\n            canvas.width = width;\n            canvas.height = height;\n\n            context.drawImage(\n                image,\n                0,\n                0,\n                image.width,\n                image.height,\n                0,\n                0,\n                width,\n                height\n            );\n\n            // save to png\n            const imageUrl = canvas.toDataURL(\"image/${format}\");\n            const base64 = imageUrl.split(\",\")[1];\n            resolve(base64);\n        };\n    });\n}\n\nexport function encodedImageToBlob(encodedImage: string): Blob {\n    const binaryString = atob(encodedImage);\n    const arr = [];\n    for (let i = 0; i < binaryString.length; i++) {\n        arr.push(binaryString.charCodeAt(i));\n    }\n    return new Blob([new Uint8Array(arr)], {\n        type: \"image/png\",\n    });\n}\n\n// This function is made to work with S3 presigned urls.\n// Solution found at https://stackoverflow.com/questions/22531114/how-to-upload-to-aws-s3-directly-from-browser-using-a-pre-signed-url-instead-of\nexport function uploadBlob(signedUrl: string, blob: Blob): Promise<void> {\n    return new Promise((resolve, reject) => {\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"PUT\", signedUrl, true);\n        xhr.setRequestHeader(\"Content-Type\", \"image/png\");\n        xhr.onload = () => {\n            if (xhr.status < 400) {\n                // success!\n                resolve();\n            }\n        };\n        xhr.onerror = (err) => {\n            // error...\n            reject(err);\n        };\n        xhr.send(blob); // `file` is a File object here\n    });\n}\n","import React, { FC, useEffect, useRef, useState } from \"react\";\nimport { Modal } from \"react-bootstrap\";\nimport { propTypes } from \"react-bootstrap/esm/Image\";\n\ninterface Props {\n    show: boolean;\n    title?: string;\n}\n\n// Show modal with child contents\nexport const BusyModal: FC<Props> = ({ show, title, children }) => {\n    return (\n        <Modal show={show} backdrop=\"static\" keyboard={false}>\n            <Modal.Header closeButton>\n                <Modal.Title>{title || \"Processing\"}</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                {children || (\n                    <div className=\"d-flex justify-content-center\">\n                        <div className=\"spinner-border\" role=\"status\">\n                            <span className=\"sr-only\">Please Wait...</span>\n                        </div>\n                    </div>\n                )}\n            </Modal.Body>\n        </Modal>\n    );\n};\n","import moment from \"moment\";\n\nimport { Image } from \"../client\";\n\nexport interface LocalImage extends Image {\n    imageData?: string;\n}\n\n/**\n * This class uses indexedDB to store images locally.\n */\nexport class LocalImagesStore {\n    private db: IDBDatabase | null = null;\n\n    init(): Promise<void> {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open(\"aibrush\", 4);\n            request.onupgradeneeded = (evt) => {\n                const db = request.result;\n                // create object store if it doesn't exist\n                // const imagesStore = db.createObjectStore(\"images\", { keyPath: \"id\" });\n                let imagesStore: IDBObjectStore;\n                if (!db.objectStoreNames.contains(\"images\")) {\n                    imagesStore = db.createObjectStore(\"images\", {\n                        keyPath: \"id\",\n                    });\n                } else {\n                    imagesStore = request.transaction?.objectStore(\n                        \"images\"\n                    ) as IDBObjectStore;\n                }\n                imagesStore.createIndex(\"updated_at\", \"updated_at\", {\n                    unique: false,\n                });\n                imagesStore.createIndex(\"deleted_at\", \"deleted_at\", {\n                    unique: false,\n                });\n                console.log(\"Local images store updated\");\n            };\n            request.onsuccess = (_) => {\n                this.db = request.result;\n                console.log(\"Local images store initialized\");\n                resolve();\n            };\n            request.onerror = (evt) => {\n                console.error(\"error opening indexeddb\", evt);\n                reject(evt);\n            };\n        });\n    }\n\n    // migrate old images to new format\n    private hydrateImage(image: LocalImage): LocalImage {\n        if (!image) {\n            return image;\n        }\n        if (!image.params) {\n            const legacyImage = image as any;\n            image.params = {\n                prompt: legacyImage.phrases.join(\", \"),\n                negative_prompt: legacyImage.negative_phrases.join(\", \"),\n                width: legacyImage.width,\n                height: legacyImage.height,\n                denoising_strength: legacyImage.stable_diffusion_strength,\n                steps: legacyImage.iterations,\n            }\n        }\n        return image;\n    }\n\n    async getImage(id: string): Promise<LocalImage | null> {\n        if (!this.db) {\n            throw new Error(\"not initialized\");\n        }\n        const transaction = this.db.transaction([\"images\"]);\n        const store = transaction.objectStore(\"images\");\n        const request = store.get(id);\n        return new Promise((resolve, reject) => {\n            request.onsuccess = (evt) => {\n                resolve(this.hydrateImage(request.result));\n            };\n            request.onerror = (evt) => {\n                console.error(\"error getting image\", evt);\n                reject(evt);\n            };\n        });\n    }\n\n    async saveImage(image: LocalImage): Promise<void> {\n        if (!this.db) {\n            throw new Error(\"not initialized\");\n        }\n        await this.cleanupDeletedImages();\n        const transaction = this.db.transaction([\"images\"], \"readwrite\");\n        const store = transaction.objectStore(\"images\");\n        const request = store.put({\n            ...image,\n            updated_at: moment().valueOf(),\n        });\n        return new Promise((resolve, reject) => {\n            request.onsuccess = (evt) => {\n                resolve();\n            };\n            request.onerror = (evt) => {\n                console.error(\"error saving image\", evt);\n                reject(evt);\n            };\n        });\n    }\n\n    async hardDeleteImage(id: string): Promise<void> {\n        if (!this.db) {\n            throw new Error(\"not initialized\");\n        }\n        const transaction = this.db.transaction([\"images\"], \"readwrite\");\n        const store = transaction.objectStore(\"images\");\n        const request = store.delete(id);\n        return new Promise((resolve, reject) => {\n            request.onsuccess = (evt) => {\n                console.log(`image ${id} permanently deleted`);\n                resolve();\n            };\n            request.onerror = (evt) => {\n                console.error(\"error deleting image\", evt);\n                reject(evt);\n            };\n        });\n    }\n\n    async deleteImage(id: string): Promise<void> {\n        if (!this.db) {\n            throw new Error(\"not initialized\");\n        }\n        // fetch the image first. If it has a deletedAt timestamp already, or if it's not\n        // in \"completed\" state, hard delete it. Otherwise, set the deletedAt timestamp.\n        const image = await this.getImage(id);\n        if (!image) {\n            console.error(\"image not found\", id);\n            return;\n        }\n        if (image.deleted_at || image.status !== \"completed\") {\n            return this.hardDeleteImage(id);\n        }\n        const transaction = this.db.transaction([\"images\"], \"readwrite\");\n        const store = transaction.objectStore(\"images\");\n        const request = store.put({\n            ...image,\n            deleted_at: moment().valueOf(),\n        });\n        return new Promise((resolve, reject) => {\n            request.onsuccess = (evt) => {\n                resolve();\n            };\n            request.onerror = (evt) => {\n                console.error(\"error deleting image\", evt);\n                reject(evt);\n            };\n        });\n    }\n\n    async listImages(\n        updated_at: number,\n        direction: IDBCursorDirection,\n        count: number,\n        search: string\n    ): Promise<LocalImage[]> {\n        // use updated_at index\n        if (!this.db) {\n            throw new Error(\"not initialized\");\n        }\n        const transaction = this.db.transaction([\"images\"]);\n        const store = transaction.objectStore(\"images\");\n        const index = store.index(\"updated_at\");\n        const range =\n            direction == \"next\"\n                ? IDBKeyRange.lowerBound(updated_at)\n                : IDBKeyRange.upperBound(updated_at);\n        const request = index.openCursor(range, direction);\n        return new Promise((resolve, reject) => {\n            const images: LocalImage[] = [];\n            request.onsuccess = (evt) => {\n                const cursor = request.result;\n                if (cursor) {\n                    const image: LocalImage = this.hydrateImage(cursor.value);\n                    const prompt = (image.params.prompt || \"\").toLowerCase();\n                    if (\n                        !image.deleted_at &&\n                        (!search || prompt.includes(search.toLowerCase()))\n                    ) {\n                        images.push(image);\n                    }\n                    if (images.length < count) {\n                        cursor.continue();\n                    } else {\n                        resolve(images);\n                    }\n                } else {\n                    resolve(images);\n                }\n            };\n            request.onerror = (evt) => {\n                console.error(\"error listing images\", evt);\n                reject(evt);\n            };\n        });\n    }\n\n    async clearImages(): Promise<void> {\n        // clear from both indexes\n        if (!this.db) {\n            throw new Error(\"not initialized\");\n        }\n        const transaction = this.db.transaction([\"images\"], \"readwrite\");\n        const imagesStore = transaction.objectStore(\"images\");\n        const imagesRequest = imagesStore.clear();\n        return new Promise((resolve, reject) => {\n            imagesRequest.onsuccess = (evt) => {\n                resolve();\n            };\n            imagesRequest.onerror = (evt) => {\n                console.error(\"error clearing images\", evt);\n                reject(evt);\n            };\n        });\n    }\n\n    async getDeletedImages(olderThan?: number): Promise<LocalImage[]> {\n        if (!this.db) {\n            throw new Error(\"not initialized\");\n        }\n        // refactor to use deleted_at index\n        const transaction = this.db.transaction([\"images\"]);\n        const store = transaction.objectStore(\"images\");\n        const index = store.index(\"deleted_at\");\n        // const request = index.openCursor();\n        // get cursor for all deleted_at values\n        const request = index.openCursor(\n            olderThan\n                ? IDBKeyRange.upperBound(olderThan)\n                : IDBKeyRange.lowerBound(1),\n            olderThan ? \"prev\" : \"next\"\n        );\n        return new Promise((resolve, reject) => {\n            const images: LocalImage[] = [];\n            request.onsuccess = (evt) => {\n                const cursor = request.result;\n                if (cursor) {\n                    const image: LocalImage = cursor.value;\n                    if (images.length < 50 && image.deleted_at) {\n                        images.push(cursor.value);\n                    }\n                    cursor.continue();\n                } else {\n                    resolve(images);\n                }\n            };\n            request.onerror = (evt) => {\n                console.error(\"error listing images\", evt);\n                reject(evt);\n            };\n        });\n    }\n\n    async clearDeletedImages(): Promise<void> {\n        if (!this.db) {\n            throw new Error(\"not initialized\");\n        }\n        let deletedImages = await this.getDeletedImages();\n        while (deletedImages.length > 0) {\n            // hard delete all deleted images\n            const promises = deletedImages.map((image) => {\n                return this.hardDeleteImage(image.id);\n            });\n            await Promise.all(promises);\n            deletedImages = await this.getDeletedImages();\n        }\n    }\n\n    async cleanupDeletedImages(): Promise<void> {\n        // delete images that are more than 1 day old\n        let deletedImages = await this.getDeletedImages(\n            moment().subtract(1, \"hours\").valueOf()\n        );\n        while (deletedImages.length > 0) {\n            // hard delete all deleted images\n            const promises = deletedImages.map((image) => {\n                return this.hardDeleteImage(image.id);\n            });\n            await Promise.all(promises);\n            deletedImages = await this.getDeletedImages(\n                moment().subtract(1, \"hours\").valueOf()\n            );\n        }\n    }\n}\n","// Login react component with hooks\nimport React, { useState, FC } from \"react\";\nimport * as axios from \"axios\";\nimport qs from \"qs\";\nimport { AIBrushApi, LoginResult } from \"../client/api\";\n\nconsole.log(process.env)\nconst DISCORD_CLIENT_ID = \"1043951225944678490\";\n\ninterface LoginProps {\n    client: AIBrushApi;\n    onLogin: (loginResult: LoginResult) => void;\n}\n\nexport const Login: FC<LoginProps> = (props) => {\n    // login form accepts email only\n    const [email, setEmail] = useState(\"\");\n    const [emailSubmitted, setEmailSubmitted] = useState(false);\n    const [code, setCode] = useState(\"\");\n    const [err, setErr] = useState(\"\");\n\n    // check query string for invite_code\n    const query = window.location.search;\n    const queryParams = qs.parse(query.substring(1));\n    const inviteCode = queryParams[\"invite_code\"];\n\n    const onLogin = async () => {\n        // clear error\n        setErr(\"\");\n        // validate valid email\n        if (!email.match(/^[^@]+@[^@]+\\.[^@]+$/)) {\n            setErr(\"Invalid email address\");\n            return;\n        }\n\n        try {\n            await props.client.login({\n                email: email,\n                invite_code: inviteCode as string,\n            });\n            setEmailSubmitted(true);\n        } catch (err) {\n            console.error(err);\n            setErr(\"Could not login\");\n        }\n    };\n\n    const discordLink = () => {\n        // localhost url:\n        // https://discord.com/api/oauth2/authorize?client_id=1043951225944678490&redirect_uri=http%3A%2F%2Flocalhost%3A3001%2Fdiscord-login&response_type=code&scope=identify%20email\n        // prod url:\n        // https://discord.com/api/oauth2/authorize?client_id=1043951225944678490&redirect_uri=https%3A%2F%2Fwww.aibrush.art%2Fdiscord-login&response_type=code&scope=identify%20email\n        const host = window.location.host;\n        const protocol = window.location.protocol;\n        const redirectUri = `${protocol}//${host}/discord-login`;\n        const url = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${redirectUri}&response_type=code&scope=identify%20email`;\n        return url;\n    };\n\n    const onVerify = async () => {\n        // clear error\n        setErr(\"\");\n        // attempt to verify code\n        try {\n            const result = await props.client.verify({\n                email,\n                code,\n            });\n            props.onLogin(result.data);\n        } catch (err) {\n            console.error(err);\n            setErr(\"Failed to verify code\");\n        }\n    };\n\n    // bootstrap login form\n    return (\n        <>\n            <div\n                className=\"row\"\n                style={{\n                    height: \"100vh\",\n                    marginLeft: \"0px\",\n                    marginRight: \"0px\",\n                }}\n            >\n                <div className=\"col-md-6 login-splash\">\n                    {/* <div className=\"center-cropped\" style={{backgroundImage: \"url(/images/scifi-dreamland.png)\"}}></div> */}\n                    <img\n                        className=\"center-cropped\"\n                        src=\"/images/scifi-dreamland.png\"\n                    />\n                </div>\n                <div className=\"col-md-6\">\n                    <div\n                        style={{\n                            fontWeight: 500,\n                            fontSize: \"48px\",\n                            marginTop: \"200px\",\n                        }}\n                    >\n                        AiBrush\n                    </div>\n\n                    <div\n                        style={{\n                            marginLeft: \"10%\",\n                            marginRight: \"10%\",\n                            marginTop: \"88px\",\n                            marginBottom: \"24px\",\n                        }}\n                    >\n                        Login With Email\n                    </div>\n                    {/* Display error if one is set */}\n                    {/* Use <p class=\"text-danger\" */}\n                    {err && <p className=\"text-danger\">{err}</p>}\n                    {err && (\n                        <p className=\"text-info\">\n                            If you don't have an account yet, request one by\n                            sending an email to{\" \"}\n                            <a href=\"mailto:admin@aibrush.art\">\n                                admin@aibrush.art\n                            </a>\n                        </p>\n                    )}\n                    <div\n                        style={{\n                            marginLeft: \"10%\",\n                            marginRight: \"10%\",\n                            marginTop: \"24px\",\n                            textAlign: \"left\",\n                        }}\n                    >\n                        {/* If email submitted, show verify code form*/}\n                        {emailSubmitted && (\n                            <>\n                                <div className=\"form-group\">\n                                    <label htmlFor=\"verifyCode\">\n                                        Verify Code\n                                    </label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"form-control\"\n                                        id=\"verifyCode\"\n                                        placeholder=\"Verification Code\"\n                                        value={code}\n                                        onChange={(e) =>\n                                            setCode(e.target.value)\n                                        }\n                                    />\n                                </div>\n                                {/* Cancel verification and go back to email */}\n                                <button\n                                    className=\"btn btn-secondary\"\n                                    onClick={() => setEmailSubmitted(false)}\n                                >\n                                    Cancel\n                                </button>\n                                &nbsp;\n                                {/* Verify code */}\n                                <button\n                                    type=\"button\"\n                                    className=\"btn btn-primary\"\n                                    onClick={(e) => {\n                                        e.preventDefault();\n                                        onVerify();\n                                    }}\n                                >\n                                    Verify\n                                </button>\n                            </>\n                        )}\n                        {/* Else, show login form */}\n                        {!emailSubmitted && (\n                            <>\n                                <div className=\"form-group\">\n                                    <label htmlFor=\"email\">Email address</label>\n                                    <input\n                                        type=\"email\"\n                                        className=\"form-control\"\n                                        id=\"email\"\n                                        aria-describedby=\"emailHelp\"\n                                        placeholder=\"Enter email\"\n                                        value={email}\n                                        onChange={(e) =>\n                                            setEmail(e.target.value.trim())\n                                        }\n                                    />\n                                </div>\n                                <button\n                                    type=\"button\"\n                                    className=\"btn btn-primary\"\n                                    style={{ float: \"right\" }}\n                                    onClick={(e) => {\n                                        e.preventDefault();\n                                        onLogin();\n                                    }}\n                                >\n                                    Login\n                                </button>\n                            </>\n                        )}\n                    </div>\n                    <div\n                        style={{\n                            marginLeft: \"10%\",\n                            marginRight: \"10%\",\n                            marginTop: \"88px\",\n                            marginBottom: \"24px\",\n                        }}\n                    >\n                        <hr/>\n                        OR\n                    </div>\n                    <div\n                        style={{\n                            marginLeft: \"10%\",\n                            marginRight: \"10%\",\n                            marginTop: \"24px\",\n                        }}\n                    >\n                        <a href={discordLink()} className=\"btn btn-primary\">\n                            <i className=\"fab fa-discord\"></i> Login With Discord\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </>\n    );\n};\n","// Given a set of credentials, this component will refresh them\n// every 5 minutes and invoke the onCredentialsRefreshed callback\n\nimport React, { useEffect, FC } from \"react\"\nimport { LoginResult, AIBrushApi } from \"../client/api\";\n\ninterface TokenRefresherProps {\n    onCredentialsRefreshed: (loginResult: LoginResult) => void;\n    onCredentialsExpired: () => void;\n    api: AIBrushApi;\n    credentials: LoginResult;\n}\n\nexport const TokenRefresher : FC<TokenRefresherProps> = ({ onCredentialsRefreshed, onCredentialsExpired, api, credentials }) => {\n    useEffect(() => {\n        const interval = setInterval(() => {\n            if (credentials && credentials.refreshToken) {\n                api.refresh({refreshToken: credentials.refreshToken}).then(loginResult => {\n                    onCredentialsRefreshed(loginResult.data);\n                }).catch(() => {\n                    onCredentialsExpired();\n                });\n            }\n\n        }, 5 * 60 * 1000);\n        return () => {\n            clearInterval(interval);\n        };\n    }, [credentials, api, onCredentialsRefreshed]);\n    return <div></div>;\n}","import React, { FC, useEffect, useState } from 'react';\nimport { AIBrushApi } from \"../client/api\";\n\ninterface HealthcheckerProps {\n    api: AIBrushApi;\n}\n\nexport const Healthchecker: FC<HealthcheckerProps> = ({ api }) => {\n    // automatically check health every 5 seconds\n    const [healthCheck, setHealthCheck] = useState(true);\n    \n    useEffect(() => {\n        const interval = setInterval(() => {\n            api.healthcheck().then(() => setHealthCheck(true)).catch(() => setHealthCheck(false));\n        }, 5000);\n\n        return () => clearInterval(interval);\n    }, [api]);\n\n    // only display bootstrap danger alert if healthcheck failed\n    // \"service is unavailable\"\n    return (\n        <div className=\"alert alert-danger\" role=\"alert\" style={{ display: healthCheck ? 'none' : 'block' }}>\n            <strong>Looks like we're having some trouble reaching the server.</strong>\n        </div>\n    );\n}\n\n","import React, { useState } from \"react\";\nimport { Button, Form, InputGroup, Alert } from \"react-bootstrap\";\nimport { AIBrushApi, CreateDepositCodeInput } from \"../../client/api\";\nimport CopyToClipboard from \"react-copy-to-clipboard\";\n\ninterface Props {\n    api: AIBrushApi;\n}\n\nconst GenerateCode: React.FC<Props> = ({ api }) => {\n    const [amount, setAmount] = useState<number>(100);\n    const [generatedCode, setGeneratedCode] = useState<string | null>(null);\n    const [copied, setCopied] = useState<boolean>(false);\n\n    const handleSubmit = async (event: React.FormEvent) => {\n        event.preventDefault();\n\n        const input: CreateDepositCodeInput = { amount };\n        const result = await api.createDepositCode(input);\n        setGeneratedCode(result.data.code);\n    };\n\n    const handleCopy = () => {\n        setCopied(true);\n        setTimeout(() => setCopied(false), 3000);\n    };\n\n    return (\n        <div>\n            <h4>Generate deposit code</h4>\n            <Form onSubmit={handleSubmit} style={{marginTop: \"16px\"}}>\n                <InputGroup className=\"mb-3\">\n                    {/* amount label */}\n                    <label style={{fontSize: \"24px\", marginRight: \"8px\"}}>Amount:</label>\n                    <Form.Control\n                        type=\"number\"\n                        placeholder=\"Amount\"\n                        value={amount}\n                        onChange={(e) => setAmount(parseInt(e.target.value))}\n                    />\n                    <InputGroup.Append>\n                        <Button\n                            variant=\"primary\"\n                            type=\"submit\"\n                            style={{ marginLeft: \"16px\" }}\n                        >\n                            Generate Code\n                        </Button>\n                    </InputGroup.Append>\n                </InputGroup>\n            </Form>\n\n            {generatedCode && (\n                <div className=\"mb-3\">\n                    <strong>Generated Code: </strong> {generatedCode}\n                    <CopyToClipboard text={generatedCode} onCopy={handleCopy}>\n                        <Button variant=\"secondary\" className=\"ml-2\">\n                            Copy to clipboard\n                        </Button>\n                    </CopyToClipboard>\n                </div>\n            )}\n\n            {copied && (\n                <Alert variant=\"success\">Code copied to clipboard!</Alert>\n            )}\n        </div>\n    );\n};\n\nexport default GenerateCode;\n","import { FC, useEffect, useState } from \"react\";\nimport { AIBrushApi } from \"../../client/api\";\nimport { WorkerSettings, WorkerSettingsJson } from \"../../lib/globalSettings\";\n\ninterface Props {\n    api: AIBrushApi;\n}\n\n// global settings all have a \"settings_key\" and \"settings_json\" field. settings_json is any.\n\n// default \"workers\" setting:\n// {\n//     \"minimum_worker_allocations\": {\n//         \"stable_diffusion\": 0,\n//         \"stable_diffusion_inpainting\": 0,\n//         \"swinir\": 0,\n//     }\n// }\n\nexport const GlobalSettings: FC<Props> = ({ api }) => {\n    const [workerSettings, setWorkerSettings] = useState<WorkerSettingsJson>({\n        minimum_worker_allocations: {\n            stable_diffusion: 0,\n            stable_diffusion_inpainting: 0,\n            swinir: 0,\n        },\n    });\n    const [saving, setSaving] = useState<boolean>(false);\n\n    const loadWorkerSettings = async () => {\n        const settings = await api.getGlobalSettings(\"workers\");\n        setWorkerSettings(settings.data.settings_json as any);\n    };\n\n    const saveWorkerSettings = async () => {\n        setSaving(true);\n        try {\n            await api.updateGlobalSettings(\"workers\", {\n                settings_json: workerSettings,\n            });\n        } finally {\n            setSaving(false);\n        }\n    };\n\n    useEffect(() => {\n        loadWorkerSettings();\n    }, []);\n\n    return (\n        <div style={{paddingBottom: \"48px\"}}>\n            {/* Header: Create new image */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <h1>Global Settings</h1>\n                </div>\n            </div>\n            {/* 50px vertical spacer */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <div className=\"spacer\" />\n                </div>\n            </div>\n            {/* slider from 0 to 10 for each model */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <label htmlFor=\"stable_diffusion\">\n                        stable_diffusion: {workerSettings.minimum_worker_allocations.stable_diffusion}\n                    </label>\n                    <input\n                        style={{marginLeft: \"16px\"}}\n                        type=\"range\"\n                        min={0}\n                        max={10}\n                        value={workerSettings.minimum_worker_allocations.stable_diffusion}\n                        className=\"form-range\"\n                        id=\"stable_diffusion\"\n                        onChange={(e) => {\n                            setWorkerSettings({\n                                ...workerSettings,\n                                minimum_worker_allocations: {\n                                    ...workerSettings.minimum_worker_allocations,\n                                    stable_diffusion: parseInt(e.target.value),\n                                },\n                            });\n                        }}\n                    />\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <label htmlFor=\"stable_diffusion_inpainting\">\n                        stable_diffusion_inpainting: {workerSettings.minimum_worker_allocations.stable_diffusion_inpainting}\n                    </label>\n                    <input\n                        style={{marginLeft: \"16px\"}}\n                        type=\"range\"\n                        min={0}\n                        max={10}\n                        value={workerSettings.minimum_worker_allocations.stable_diffusion_inpainting}\n                        className=\"form-range\"\n                        id=\"stable_diffusion_inpainting\"\n                        onChange={(e) => {\n                            setWorkerSettings({\n                                ...workerSettings,\n                                minimum_worker_allocations: {\n                                    ...workerSettings.minimum_worker_allocations,\n                                    stable_diffusion_inpainting: parseInt(e.target.value),\n                                },\n                            });\n                        }}\n                    />\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <label htmlFor=\"swinir\">\n                        swinir: {workerSettings.minimum_worker_allocations.swinir}\n                    </label>\n                    <input\n                        style={{marginLeft: \"16px\"}}\n                        type=\"range\"\n                        min={0}\n                        max={10}\n                        value={workerSettings.minimum_worker_allocations.swinir}\n                        className=\"form-range\"\n                        id=\"swinir\"\n                        onChange={(e) => {\n                            setWorkerSettings({\n                                ...workerSettings,\n                                minimum_worker_allocations: {\n                                    ...workerSettings.minimum_worker_allocations,\n                                    swinir: parseInt(e.target.value),\n                                },\n                            });\n                        }}\n                    />\n                </div>\n            </div>\n            \n            \n            {/* bottom row: save button */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <button className=\"btn btn-primary\" onClick={saveWorkerSettings} disabled={saving}>\n                        {saving ? <>\n                            <i className=\"fas fa-spinner fa-spin\" />\n                            &nbsp; Saving...\n                        </> : \"Save\"}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};","import React, { FC, useState, useEffect, useRef } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { AIBrushApi } from \"../../client/api\";\nimport GenerateCode from \"./GenerateCode\";\nimport { GlobalSettings } from \"./GlobalSettings\";\n\ninterface Props {\n    api: AIBrushApi;\n}\n\nexport const Admin: FC<Props> = ({ api }) => {\n    const [links, setLinks] = useState<string[]>([]);\n\n    const onGenerateLink = async () => {\n        const inviteCode = await api.createInviteCode();\n        setLinks([...links, `/?invite_code=${inviteCode.data.id}`]);\n    };\n\n    return (\n        <div style={{ paddingBottom: \"48px\" }}>\n            {/* Header: Create new image */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <h1>Admin features</h1>\n                </div>\n            </div>\n            {/* 50px vertical spacer */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <div className=\"spacer\" />\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <div\n                        className=\"d-flex justify-content-center align-items-center\"\n                        style={{ height: \"100%\" }}\n                    >\n                        <GenerateCode api={api} />\n                    </div>\n                </div>\n            </div>\n            <hr />\n            <GlobalSettings api={api} />\n        </div>\n    );\n};\n","import React, { FC, useEffect, useState } from \"react\";\nimport { AIBrushApi, Image } from \"../client\";\nimport moment from \"moment\";\nimport { ImageThumbnail } from \"../components/ImageThumbnail\";\nimport { useHistory } from \"react-router-dom\";\nimport { BusyModal } from \"../components/BusyModal\";\n\ninterface Props {\n    api: AIBrushApi;\n    assetsUrl: string;\n}\n\nexport const DeletedImages: FC<Props> = ({ api, assetsUrl }) => {\n    const [images, setImages] = useState<Image[]>([]);\n    const [deleting, setDeleting] = useState(false);\n\n    const history = useHistory();\n\n    const loadImages = async () => {\n        const cursor = moment().add(-24, \"hours\").valueOf();\n        // TODO: special api call for deleted images?\n        const resp = await api.listImages(cursor, \"\", 100, \"asc\");\n        setImages(\n            (\n                resp.data.images?.filter((image) => !!image.deleted_at) || []\n            ).sort((a, b) => {\n                if (a.deleted_at && b.deleted_at) {\n                    return b.deleted_at - a.deleted_at;\n                }\n                return 0;\n            })\n        );\n    };\n\n    const onDeleteImage = async (image: Image) => {\n        setImages(images.filter((i) => i.id !== image.id));\n        await api.deleteImage(image.id);\n    };\n\n    const onDeleteAllImages = async () => {\n        setDeleting(true);\n        try {\n            await Promise.all(images.map((image) => api.deleteImage(image.id)));\n            setImages([]);\n        } finally {\n            setDeleting(false);\n        }\n    };\n\n    const onRestoreImage = async (image: Image) => {\n        setImages(images.filter((i) => i.id !== image.id));\n        await api.updateImage(image.id, { deleted_at: null });\n    };\n\n    useEffect(() => {\n        loadImages();\n    }, [api]);\n\n    return (\n        <div>\n            <div>\n                <div className=\"row\">\n                    <div className=\"col-12\">\n                        <h1 style={{ fontSize: \"40px\", textAlign: \"left\" }}>\n                            <i\n                                style={{ cursor: \"pointer\" }}\n                                onClick={() => history.goBack()}\n                                className=\"fas fa-chevron-left\"\n                            ></i>\n                            &nbsp; Deleted Images\n                        </h1>\n                        {/* float right \"delete all\" button */}\n                        <button\n                            className=\"btn btn-danger btn-sm image-popup-delete-button\"\n                            onClick={onDeleteAllImages}\n                            style={{\n                                float: \"right\",\n                                marginRight: \"8px\",\n                            }}\n                        >\n                            <i className=\"fa fa-trash\"></i>&nbsp;Delete All\n                        </button>\n                    </div>\n                </div>\n                <div className=\"row\" style={{ marginTop: \"32px\" }}>\n                    <div className=\"col-sm-2 offset-sm-2\">Image</div>\n                    <div className=\"col-sm-8\">Action</div>\n                </div>\n                {images.map((image) => (\n                    <div\n                        className=\"row\"\n                        style={{\n                            marginTop: \"16px\",\n                            borderBottom: \"1px solid #303030\",\n                        }}\n                        key={image.id}\n                    >\n                        <div className=\"col-sm-2 offset-sm-2\">\n                            <ImageThumbnail\n                                assetsUrl={assetsUrl}\n                                image={image}\n                                censorNSFW={true}\n                            />\n                        </div>\n                        <div\n                            className=\"col-sm-8\"\n                            style={{\n                                paddingTop: \"64px\",\n                                paddingBottom: \"64px\",\n                            }}\n                        >\n                            <button\n                                className=\"btn btn-danger btn-sm image-popup-delete-button\"\n                                onClick={() => onDeleteImage(image)}\n                                style={{\n                                    marginRight: \"8px\",\n                                }}\n                            >\n                                <i className=\"fa fa-trash\"></i>&nbsp;Delete\n                            </button>\n                            <button\n                                className=\"btn btn-primary btn-sm image-popup-restore-button\"\n                                onClick={() => onRestoreImage(image)}\n                            >\n                                <i className=\"fa fa-undo\"></i>&nbsp;Restore\n                            </button>\n                        </div>\n                    </div>\n                ))}\n            </div>\n            <BusyModal show={deleting} title=\"Deleting Images\">\n                Please wait while we delete all images...\n            </BusyModal>\n        </div>\n    );\n};\n","import React, { useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { AIBrushApi, LoginResult } from \"../client\";\n\ninterface LoginProps {\n    client: AIBrushApi;\n    onLogin: (loginResult: LoginResult) => void;\n}\n\nexport const DiscordLogin: React.FC<LoginProps> = ({client, onLogin}) => {\n    const history = useHistory();\n    const code = new URLSearchParams(window.location.search).get(\"code\");\n    \n    useEffect(() => {\n        if (code) {\n            console.log(\"logging in with code\", code);\n            client.discordLogin({code}).then((result) => {\n                console.log(\"login result\", result);\n                if (result.data.accessToken) {\n                    onLogin(result.data);\n                }\n                \n                history.push(\"/\");\n            });\n        } else {\n            history.push(\"/\");\n        }\n    }, [])\n\n    return null;\n}","import React, { FC, useEffect, useState } from \"react\";\nimport { AIBrushApi, Image } from \"../client\";\nimport moment from \"moment\";\nimport { ImageThumbnail } from \"../components/ImageThumbnail\";\nimport { useHistory } from \"react-router-dom\";\nimport { LocalImagesStore } from \"../lib/localImagesStore\";\nimport { BusyModal } from \"../components/BusyModal\";\n\ninterface Props {\n    localImages: LocalImagesStore;\n}\n\nexport const LocalDeletedImages: FC<Props> = ({ localImages }) => {\n    const [images, setImages] = useState<Image[]>([]);\n    const [deleting, setDeleting] = useState(false);\n\n    const history = useHistory();\n\n    const loadImages = async () => {\n        const deletedImages = await localImages.getDeletedImages();\n        setImages(deletedImages);\n    };\n\n    const onDeleteImage = async (image: Image) => {\n        setImages(images.filter((i) => i.id !== image.id));\n        await localImages.deleteImage(image.id);\n        if (images.length <= 5) {\n            loadImages();\n        }\n    };\n\n    const onDeleteAllImages = async () => {\n        setDeleting(true);\n        try {\n            await localImages.clearDeletedImages();\n            setImages([]);\n        } finally {\n            setDeleting(false);\n        }\n    };\n\n    const onRestoreImage = async (image: Image) => {\n        setImages(images.filter((i) => i.id !== image.id));\n        await localImages.saveImage({\n            ...image,\n            deleted_at: undefined,\n        });\n    };\n\n    useEffect(() => {\n        loadImages();\n    }, [localImages]);\n\n    return (\n        <div>\n            <div>\n                <div className=\"row\">\n                    <div className=\"col-12\">\n                        <h1 style={{ fontSize: \"40px\", textAlign: \"left\" }}>\n                            <i\n                                style={{ cursor: \"pointer\" }}\n                                onClick={() => history.goBack()}\n                                className=\"fas fa-chevron-left\"\n                            ></i>\n                            &nbsp; Deleted Images\n                        </h1>\n                        <button\n                            className=\"btn btn-danger btn-sm image-popup-delete-button\"\n                            onClick={onDeleteAllImages}\n                            style={{\n                                float: \"right\",\n                                marginRight: \"8px\",\n                            }}\n                        >\n                            <i className=\"fa fa-trash\"></i>&nbsp;Delete All\n                        </button>\n                    </div>\n                </div>\n                <div className=\"row\" style={{ marginTop: \"32px\" }}>\n                    <div className=\"col-sm-2 offset-sm-2\">Image</div>\n                    <div className=\"col-sm-8\">Action</div>\n                </div>\n                {images.map((image) => (\n                    <div\n                        className=\"row\"\n                        style={{\n                            marginTop: \"16px\",\n                            borderBottom: \"1px solid #303030\",\n                        }}\n                        key={image.id}\n                    >\n                        <div className=\"col-sm-2 offset-sm-2\">\n                            <ImageThumbnail\n                                assetsUrl={\"\"}\n                                image={image}\n                                censorNSFW={true}\n                            />\n                        </div>\n                        <div\n                            className=\"col-sm-8\"\n                            style={{\n                                paddingTop: \"64px\",\n                                paddingBottom: \"64px\",\n                            }}\n                        >\n                            <button\n                                className=\"btn btn-danger btn-sm image-popup-delete-button\"\n                                onClick={() => onDeleteImage(image)}\n                                style={{\n                                    marginRight: \"8px\",\n                                }}\n                            >\n                                <i className=\"fa fa-trash\"></i>&nbsp;Delete\n                            </button>\n                            <button\n                                className=\"btn btn-primary btn-sm image-popup-restore-button\"\n                                onClick={() => onRestoreImage(image)}\n                            >\n                                <i className=\"fa fa-undo\"></i>&nbsp;Restore\n                            </button>\n                        </div>\n                    </div>\n                ))}\n            </div>\n            <BusyModal show={deleting} title=\"Deleting Images\">\n                Please wait while we delete all images...\n            </BusyModal>\n        </div>\n    );\n};\n","export interface DBConfig {\n    dbName: string;\n    storeName: string;\n};\n\nexport class KVStore<T> {\n    private dbConfig: DBConfig;\n    private db: IDBDatabase | null = null;\n\n    constructor(dbConfig: DBConfig) {\n        this.dbConfig = dbConfig;\n    }\n\n    private async createDB(): Promise<IDBDatabase> {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open(this.dbConfig.dbName);\n\n            request.onupgradeneeded = () => {\n                const db = request.result;\n                db.createObjectStore(this.dbConfig.storeName);\n            };\n\n            request.onsuccess = () => {\n                resolve(request.result);\n            };\n\n            request.onerror = () => {\n                reject(request.error);\n            };\n        });\n    }\n\n    private async getDB(): Promise<IDBDatabase> {\n        if (!this.db) {\n            this.db = await this.createDB();\n        }\n        return this.db;\n    }\n\n\n    async getItem(key: string): Promise<T | null> {\n        const db = await this.getDB();\n\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction(this.dbConfig.storeName);\n            const store = transaction.objectStore(this.dbConfig.storeName);\n            const request = store.get(key);\n\n            request.onsuccess = () => {\n                resolve(request.result);\n            };\n\n            request.onerror = () => {\n                resolve(null);\n            };\n        });\n    }\n\n    async setItem(key: string, value: T): Promise<void> {\n        const db = await this.getDB();\n\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction(\n                this.dbConfig.storeName,\n                \"readwrite\"\n            );\n            const store = transaction.objectStore(this.dbConfig.storeName);\n            const request = store.put(value, key);\n\n            request.onsuccess = () => {\n                resolve();\n            };\n\n            request.onerror = () => {\n                resolve();\n            };\n        });\n    }\n\n    async deleteItem(key: string): Promise<void> {\n        const db = await this.getDB();\n\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction(\n                this.dbConfig.storeName,\n                \"readwrite\"\n            );\n            const store = transaction.objectStore(this.dbConfig.storeName);\n            const request = store.delete(key);\n\n            request.onsuccess = () => {\n                resolve();\n            };\n\n            request.onerror = () => {\n                resolve();\n            };\n        });\n    }\n}\n","// V2 page\nimport React, { FC, useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport Dropdown from \"react-bootstrap/Dropdown\";\nimport { useParams, useHistory, Link } from \"react-router-dom\";\nimport moment from \"moment\";\nimport ScrollToTop from \"react-scroll-to-top\";\nimport { AIBrushApi } from \"../client\";\nimport { CreateImageInput, Image, StatusEnum } from \"../client/api\";\nimport { ImageThumbnail } from \"../components/ImageThumbnail\";\nimport { ImagePrompt, defaultArgs } from \"../components/ImagePrompt\";\nimport {\n    createEncodedThumbnail,\n    encodedImageToBlob,\n    uploadBlob,\n} from \"../lib/imageutil\";\n\nimport InfiniteScroll from \"react-infinite-scroll-component\";\nimport { ImagePopup } from \"../components/ImagePopup\";\nimport { BusyModal } from \"../components/BusyModal\";\nimport { PendingImagesThumbnail } from \"../components/PendingImagesThumbnail\";\nimport { PendingImages } from \"../components/PendingImages\";\nimport {\n    ApiSocket,\n    NOTIFICATION_IMAGE_DELETED,\n    NOTIFICATION_IMAGE_UPDATED,\n} from \"../lib/apisocket\";\nimport { KVStore } from \"../lib/kvstore\";\nimport { ImagesCache } from \"../lib/imagesCache\";\n\ninterface Props {\n    api: AIBrushApi;\n    apiSocket: ApiSocket;\n    assetsUrl: string;\n}\n\nconst savedImagesCache = new ImagesCache();\n\nexport const SavedImagesPage: FC<Props> = ({ api, apiSocket, assetsUrl }) => {\n    const [creating, setCreating] = useState(false);\n    const [selectedImage, setSelectedImage] = useState<Image | null>(null);\n    const [parentImage, setParentImage] = useState<Image | null>(null);\n\n    const [showPendingImages, setShowPendingImages] = useState(false);\n\n    const [images, setImages] = useState<Array<Image>>([]);\n    const [err, setErr] = useState<string | null>(null);\n    const [hasMore, setHasMore] = useState<boolean>(true);\n    const [search, setSearch] = useState<string>(\"\");\n    const [searchDebounce, setSearchDebounce] = useState<string>(\"\");\n\n    const [bulkDeleteSelecting, setBulkDeleteSelecting] = useState(false);\n    const [bulkDeleting, setBulkDeleting] = useState(false);\n    const [bulkDeleteIds, setBulkDeleteIds] = useState<{\n        [key: string]: boolean;\n    }>({});\n\n    const [censorNSFW, setCensorNSFW] = useState(true);\n\n    const { id } = useParams<{ id?: string }>();\n    const history = useHistory();\n\n    useEffect(() => {\n        let handle = setTimeout(() => {\n            setSearch(searchDebounce);\n        }, 500);\n        return () => {\n            clearTimeout(handle);\n        };\n    }, [searchDebounce]);\n\n    useEffect(() => {\n        if (id) {\n            // check if the image is already loaded\n            const image = images.find((image) => image.id === id);\n            if (image) {\n                setSelectedImage(image);\n            }\n            // refresh\n            api.getImage(id).then((image) => {\n                setSelectedImage(image.data);\n            });\n        } else {\n            setSelectedImage(null);\n        }\n    }, [id]);\n\n    const onSubmit = async (input: CreateImageInput) => {\n        setCreating(true);\n        setParentImage(null);\n        setErr(null);\n        window.scrollTo(0, 0);\n        try {\n            await api.createImage(input);\n        } catch (e: any) {\n            console.error(e);\n            setErr(\"Error creating image\");\n        } finally {\n            setCreating(false);\n        }\n    };\n\n    const onEditNewImage = async (input: CreateImageInput) => {\n        setCreating(true);\n        setParentImage(null);\n        setErr(null);\n        window.scrollTo(0, 0);\n        try {\n            const encodedImage = input.encoded_image!;\n            const encodedThumbnail = await createEncodedThumbnail(encodedImage);\n            const newImages = await api.createImage({\n                ...input,\n                encoded_image: undefined,\n            });\n            if (newImages.data.images) {\n                const image = newImages.data.images![0];\n                const uploadUrls = await api.getImageUploadUrls(image.id);\n                // convert base64 encoded image to binary to upload as image/png with axios\n                const blob = encodedImageToBlob(encodedImage);\n                const thumbnailBlob = encodedImageToBlob(encodedThumbnail);\n                const imagePromise = uploadBlob(\n                    uploadUrls.data.image_url!,\n                    blob\n                );\n                const thumbnailPromise = uploadBlob(\n                    uploadUrls.data.thumbnail_url!,\n                    thumbnailBlob\n                );\n                await Promise.all([imagePromise, thumbnailPromise]);\n\n                history.push(`/image-editor/${image.id}`);\n            }\n        } catch (e: any) {\n            console.error(e);\n            setErr(\"Error creating image\");\n        } finally {\n            setCreating(false);\n        }\n    };\n\n    const onNSFW = (image: Image, nsfw: boolean) => {\n        api.updateImage(image.id, { nsfw }).then((res) => {\n            setImages((images) => {\n                return images.map((i) => {\n                    if (i.id === image.id) {\n                        return res.data;\n                    }\n                    return i;\n                });\n            });\n            setSelectedImage(res.data);\n        });\n    };\n\n    useEffect(() => {\n        if (!api) {\n            return;\n        }\n        const loadImages = async () => {\n            console.log(\"Initial load images\");\n            // clear error\n            setErr(null);\n            setHasMore(true);\n            try {\n                const cursor = moment().add(1, \"minutes\").valueOf();\n                // const resp = await api.listImages(cursor, search, 100, \"desc\");\n                const imagesResult = await savedImagesCache.listImages(\n                    api,\n                    cursor,\n                    search,\n                    100,\n                    \"desc\"\n                );\n                if (imagesResult) {\n                    console.log(\"Initial load images\", imagesResult.length);\n                    setImages(imagesResult.sort(sortImages));\n                }\n                return 0;\n            } catch (err) {\n                setErr(\"Could not load images\");\n                console.error(err);\n            }\n        };\n        loadImages();\n    }, [api, search]);\n\n    useEffect(() => {\n        if (!api) {\n            return;\n        }\n\n        const pollImages = async (images: Array<Image>) => {\n            // clear error\n            setErr(null);\n            // set cursor to max updated_at from images\n            const cursor = images.reduce((max, image) => {\n                return Math.max(max, image.updated_at);\n            }, 0);\n\n            try {\n                const imagesResult = await savedImagesCache.listImages(\n                    api,\n                    cursor + 1,\n                    search,\n                    100,\n                    \"asc\"\n                );\n                if (imagesResult) {\n                    let latestCursor = cursor;\n                    for (let image of imagesResult) {\n                        if (image.updated_at > latestCursor) {\n                            latestCursor = image.updated_at;\n                        }\n                    }\n\n                    // split resp.data.images into \"new\" and \"updated\" lists\n                    // image is \"new\" if it's not in images\n                    const newImages = imagesResult.filter((image) => {\n                        return images.findIndex((i) => i.id === image.id) < 0;\n                    });\n                    const updatedImages = imagesResult.filter((image) => {\n                        return images.findIndex((i) => i.id === image.id) >= 0;\n                    });\n                    setImages((images) => {\n                        const deletedIds: { [key: string]: boolean } = {};\n                        for (let image of newImages) {\n                            if (image.deleted_at) {\n                                deletedIds[image.id] = true;\n                                console.log(\n                                    `Deleting image ${image.id} from list`\n                                );\n                            }\n                        }\n                        for (let image of updatedImages) {\n                            if (image.deleted_at) {\n                                deletedIds[image.id] = true;\n                                console.log(\n                                    `Deleting image ${image.id} from list`\n                                );\n                            }\n                        }\n                        images = images.filter(\n                            (image) => !deletedIds[image.id]\n                        );\n                        return [\n                            ...images.map((image) => {\n                                const updatedImage = updatedImages.find(\n                                    (i) => i.id === image.id\n                                );\n                                if (updatedImage) {\n                                    return updatedImage;\n                                }\n                                return image;\n                            }),\n                            ...newImages.filter((image) => !image.deleted_at),\n                        ].sort(sortImages);\n                    });\n                }\n                return images;\n            } catch (err) {\n                setErr(\"Could not load images\");\n                console.error(err);\n            }\n        };\n\n        // polling is now a fallback for when the websocket connection fails\n        const timerHandle = setInterval(() => {\n            pollImages(images);\n        }, 60 * 1000);\n        return () => {\n            clearInterval(timerHandle);\n        };\n    }, [api, images, search]);\n\n    useEffect(() => {\n        // de-duplicate images by id\n        // first check if there are any duplicates\n        // I know, I should figure out where the duplicates are coming from,\n        // but I'm lazy.\n        const ids = images.map((image) => image.id);\n        const uniqueIds = new Set(ids);\n        if (ids.length !== uniqueIds.size) {\n            setImages((images) => {\n                // there are duplicates\n                const uniqueImages = images.filter((image, index) => {\n                    return ids.indexOf(image.id) === index;\n                });\n                return uniqueImages.sort(sortImages);\n            });\n        }\n    }, [images]);\n\n    useEffect(() => {\n        const onMessage = async (message: string) => {\n            const payload = JSON.parse(message);\n            if (\n                payload.type === NOTIFICATION_IMAGE_UPDATED ||\n                payload.type === NOTIFICATION_IMAGE_DELETED\n            ) {\n                const updatedImage = await api.getImage(payload.id);\n                if (updatedImage.data.temporary) {\n                    return;\n                }\n                setImages((images) => {\n                    const index = images.findIndex(\n                        (image) => image.id === updatedImage.data.id\n                    );\n                    let updatedImages = images;\n                    if (index >= 0) {\n                        updatedImages = images.map((image) => {\n                            if (image.id === updatedImage.data.id) {\n                                return updatedImage.data;\n                            }\n                            return image;\n                        });\n                    } else {\n                        updatedImages = [...images, updatedImage.data];\n                    }\n                    return updatedImages.sort(sortImages);\n                });\n            }\n        };\n        apiSocket.addMessageListener(onMessage);\n        return () => {\n            apiSocket.removeMessageListener(onMessage);\n        };\n    }, [apiSocket]);\n\n    const isPendingOrProcessing = (image: Image) => {\n        return (\n            image.status === StatusEnum.Pending ||\n            image.status === StatusEnum.Processing\n        );\n    };\n\n    const sortImages = (a: Image, b: Image) => {\n        // pending and processing images always come first\n        if (isPendingOrProcessing(a) && !isPendingOrProcessing(b)) {\n            return -1;\n        } else if (!isPendingOrProcessing(a) && isPendingOrProcessing(b)) {\n            return 1;\n        }\n        // if the parent is the same, sort by score descending\n        // otherwise, sort by updated_at\n        if (\n            a.parent === b.parent &&\n            a.params.prompt == b.params.prompt &&\n            a.status !== StatusEnum.Pending &&\n            b.status !== StatusEnum.Pending\n        ) {\n            // if the score is the same, sort by updated_at\n            let aScore = a.score;\n            let bScore = b.score;\n            // working around a bug where negative score was assigned\n            // for an empty negative prompt.\n            if (a.params.prompt!.trim() !== \"\") {\n                aScore = aScore - a.negative_score;\n            }\n            if (b.params.prompt!.trim() !== \"\") {\n                bScore = bScore - b.negative_score;\n            }\n            if (aScore == bScore) {\n                return b.updated_at - a.updated_at;\n            }\n            return bScore - aScore;\n        }\n\n        return b.updated_at - a.updated_at;\n    };\n\n    const onLoadMore = async () => {\n        // get the minimum updated_at from images\n        let minUpdatedAt = moment().valueOf();\n        images.forEach((image) => {\n            minUpdatedAt = Math.min(minUpdatedAt, image.updated_at);\n        });\n        // load images in descending order from updated_at\n        let imagesResult = await savedImagesCache.listImages(\n            api,\n            minUpdatedAt - 1,\n            search,\n            100,\n            \"desc\"\n        );\n        if (imagesResult && imagesResult.length > 0) {\n            // combine images with new images and sort by updated_at descending\n            setImages((images) => {\n                const imagesById = images.reduce((acc, image) => {\n                    acc[image.id] = image;\n                    return acc;\n                }, {} as { [key: string]: Image });\n                imagesResult = (imagesResult || []).filter(\n                    (image) => !imagesById[image.id]\n                );\n                return [...images, ...(imagesResult || [])].sort(sortImages);\n            });\n        } else {\n            setHasMore(false);\n        }\n    };\n\n    const onDelete = async (image: Image) => {\n        try {\n            await api.deleteImage(image.id);\n        } catch (e) {\n            console.error(e);\n            setErr(\"Error deleting image\");\n        }\n    };\n\n    const onFork = async (image: Image) => {\n        history.push({\n            pathname: \"/\",\n            search: `?parent=${image.id}`,\n        });\n    };\n\n    const onEdit = async (image: Image) => {\n        history.push(`/image-editor/${image.id}`);\n    };\n\n    const onThumbnailClicked = (image: Image) => {\n        // setSelectedImage(image);\n        if (bulkDeleteSelecting) {\n            setBulkDeleteIds({\n                ...bulkDeleteIds,\n                [image.id]: !bulkDeleteIds[image.id],\n            });\n        } else {\n            history.push(`/saved/${image.id}`);\n        }\n    };\n\n    const handleCancelFork = () => {\n        setParentImage(null);\n        window.scrollTo(0, 0);\n    };\n\n    const onConfirmBulkDelete = async () => {\n        try {\n            setBulkDeleting(true);\n            // await api.deleteImages(Object.keys(bulkDeleteIds));\n            const promises = Object.keys(bulkDeleteIds).map((id) => {\n                return api.deleteImage(id);\n            });\n            await Promise.all(promises);\n            setImages((images) => {\n                return images.filter((image) => !bulkDeleteIds[image.id]);\n            });\n            setBulkDeleteIds({});\n            setBulkDeleteSelecting(false);\n        } catch (e) {\n            console.error(e);\n            setErr(\"Error deleting images\");\n        } finally {\n            setBulkDeleting(false);\n        }\n    };\n\n    const completedOrSavedImages = images.filter((image) => {\n        return (\n            !image.deleted_at &&\n            (image.status === StatusEnum.Completed ||\n                image.status === StatusEnum.Saved)\n        );\n    });\n\n    const pendingOrProcessingImages = images.filter(\n        (image) =>\n            !image.deleted_at &&\n            (image.status === StatusEnum.Pending ||\n                image.status === StatusEnum.Processing)\n    );\n\n    const pendingImages = pendingOrProcessingImages.filter(\n        (image) => image.status === StatusEnum.Pending\n    );\n\n    const processingImages = pendingOrProcessingImages.filter(\n        (image) => image.status === StatusEnum.Processing\n    );\n\n    return (\n        <>\n            <h1 style={{ fontSize: \"40px\", textAlign: \"left\" }}>\n                Welcome to AiBrush - Saved\n            </h1>\n\n            <div\n                className=\"saved-images\"\n                style={{ marginTop: \"48px\", paddingBottom: \"48px\" }}\n            >\n                <div style={{ textAlign: \"left\" }}>\n                    <div\n                        className=\"input-group\"\n                        style={{ marginBottom: \"16px\" }}\n                    >\n                        <input\n                            style={{}}\n                            value={searchDebounce}\n                            type=\"search\"\n                            className=\"form-control image-search\"\n                            placeholder=\"Search...\"\n                            onChange={(e) => setSearchDebounce(e.target.value)}\n                        />\n\n                        <div\n                            style={{\n                                float: \"right\",\n                            }}\n                        >\n                            {!bulkDeleteSelecting && (\n                                <>\n                                    <button\n                                        style={{ display: \"inline\" }}\n                                        className=\"btn btn-primary image-popup-button\"\n                                        onClick={() =>\n                                            setCensorNSFW(!censorNSFW)\n                                        }\n                                    >\n                                        {!censorNSFW && (\n                                            <i className=\"fas fa-eye\"></i>\n                                        )}\n                                        {censorNSFW && (\n                                            <i className=\"fas fa-eye-slash\"></i>\n                                        )}\n                                    </button>\n                                    <Dropdown\n                                        style={{\n                                            display: \"inline\",\n                                            marginLeft: \"8px\",\n                                        }}\n                                    >\n                                        <Dropdown.Toggle variant=\"danger\">\n                                            <i className=\"fas fa-trash\"></i>\n                                        </Dropdown.Toggle>\n\n                                        <Dropdown.Menu>\n                                            <Dropdown.Item\n                                                onClick={() =>\n                                                    setBulkDeleteSelecting(true)\n                                                }\n                                            >\n                                                Bulk Delete\n                                            </Dropdown.Item>\n                                            <Dropdown.Item\n                                                onClick={() =>\n                                                    history.push(\n                                                        \"/deleted-images\"\n                                                    )\n                                                }\n                                            >\n                                                View Deleted Images\n                                            </Dropdown.Item>\n                                        </Dropdown.Menu>\n                                    </Dropdown>\n                                </>\n                            )}\n                            {bulkDeleteSelecting && (\n                                <>\n                                    <button\n                                        className=\"btn btn-primary image-popup-button\"\n                                        onClick={() => {\n                                            setBulkDeleteSelecting(false);\n                                            setBulkDeleteIds({});\n                                        }}\n                                    >\n                                        Cancel\n                                    </button>\n                                    <button\n                                        style={{ marginLeft: \"8px\" }}\n                                        className=\"btn image-popup-delete-button\"\n                                        onClick={() => {\n                                            onConfirmBulkDelete();\n                                        }}\n                                    >\n                                        Delete\n                                    </button>\n                                </>\n                            )}\n                        </div>\n                    </div>\n                </div>\n                <InfiniteScroll\n                    dataLength={images.length}\n                    next={onLoadMore}\n                    hasMore={hasMore}\n                    loader={\n                        <>\n                            <hr />\n                            <h4>Loading...</h4>\n                        </>\n                    }\n                >\n                    {pendingOrProcessingImages.length > 0 && (\n                        <PendingImagesThumbnail\n                            pendingCount={pendingImages.length}\n                            processingCount={processingImages.length}\n                            onClick={() => {\n                                setShowPendingImages(true);\n                            }}\n                        />\n                    )}\n                    {completedOrSavedImages.map((image) => (\n                        <ImageThumbnail\n                            key={image.id}\n                            image={image}\n                            assetsUrl={assetsUrl}\n                            onClick={onThumbnailClicked}\n                            bulkDelete={\n                                bulkDeleteSelecting && bulkDeleteIds[image.id]\n                            }\n                            censorNSFW={censorNSFW}\n                        />\n                    ))}\n                </InfiniteScroll>\n            </div>\n\n            {selectedImage && (\n                <ImagePopup\n                    assetsUrl={assetsUrl}\n                    image={selectedImage}\n                    onClose={() => history.push(\"/saved\")}\n                    onDelete={(image) => {\n                        onDelete(image);\n                        setImages(images.filter((i) => i.id !== image.id));\n                        history.push(\"/saved\");\n                    }}\n                    onFork={(image) => {\n                        onFork(image);\n                    }}\n                    onEdit={(image) => {\n                        onEdit(image);\n                    }}\n                    onNSFW={onNSFW}\n                    censorNSFW={censorNSFW}\n                />\n            )}\n            <ScrollToTop />\n            <BusyModal show={creating} title=\"Creating images\">\n                <p>Please wait while we create your image.</p>\n            </BusyModal>\n            <BusyModal show={bulkDeleting} title=\"Deleting images\">\n                <p>Please wait while we delete your images.</p>\n            </BusyModal>\n            <PendingImages\n                images={pendingOrProcessingImages}\n                onCancel={() => setShowPendingImages(false)}\n                show={showPendingImages}\n                onDeleteImage={(image) => {\n                    onDelete(image);\n                    setImages(images.filter((i) => i.id !== image.id));\n                }}\n            />\n        </>\n    );\n};\n","\n\n// const imagesCache = new KVStore({\n//     dbName: \"saved-images\",\n//     storeName: \"images\",\n// })\n\nimport { AIBrushApi, Image } from \"../client\";\nimport { KVStore } from \"./kvstore\";\n\nexport class ImagesCache {\n\n    private kvstore: KVStore<Image>;\n\n    constructor() {\n        this.kvstore = new KVStore<Image>({\n            dbName: \"saved-images\",\n            storeName: \"images\",\n        });\n    }\n\n    async listImages(api: AIBrushApi, cursor: number, search: string, limit: number, order: \"asc\" | \"desc\"): Promise<Image[] | undefined> {\n        const resp = await api.listImages(cursor, search, limit, order, \"id,updated_at,deleted_at\");\n        if (!resp.data.images) {\n            return undefined;\n        }\n\n        const result: Image[] = [];\n        const batchGetIds: string[] = [];\n        for (const image of resp.data.images) {\n            if (image.deleted_at) {\n                await this.kvstore.deleteItem(image.id);\n            } else {\n                const savedImage = await this.kvstore.getItem(image.id);\n                if (savedImage && savedImage.updated_at === image.updated_at) {\n                    result.push(savedImage);\n                } else {\n                    batchGetIds.push(image.id);\n                }\n            }\n        }\n        if (batchGetIds.length > 0) {\n            const batchResult = await api.batchGetImages(undefined, {\n                ids: batchGetIds,\n            });\n            if (batchResult.data.images) {\n                for (const image of batchResult.data.images) {\n                    await this.kvstore.setItem(image.id, image);\n                    result.push(image);\n                }\n            }\n        }\n        return result;\n    }\n}","import { useEffect, useState, FC } from \"react\";\nimport loadImage from \"blueimp-load-image\";\nimport {\n    splitImage,\n    mergeTiles,\n    SplitResult,\n    ImageUtilWorker,\n} from \"../lib/imageutil\";\nimport * as uuid from \"uuid\";\n\nexport const TestPage: FC = () => {\n    const [originalImage, setOriginalImage] = useState<string | undefined>();\n    const [upscaledImage, setUpscaledImage] = useState<string | undefined>();\n    const [imageWorker, setImageWorker] = useState<\n        ImageUtilWorker | undefined\n    >();\n\n    useEffect(() => {\n        const imageWorker = new ImageUtilWorker();\n        setImageWorker(imageWorker);\n        return () => {\n            imageWorker.destroy();\n        };\n    }, []);\n\n    const imageDataToCanvas = (imageData: ImageData): HTMLCanvasElement => {\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = imageData.width;\n        canvas.height = imageData.height;\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) {\n            throw new Error(\"Could not get canvas context\");\n        }\n        ctx.putImageData(imageData, 0, 0);\n        return canvas;\n    };\n\n    const upscaleImageData = (imageData: ImageData): HTMLCanvasElement => {\n        console.log(\"upscaling image data\", imageData.width, imageData.height);\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = imageData.width * 2;\n        canvas.height = imageData.height * 2;\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) {\n            throw new Error(\"Could not get canvas context\");\n        }\n        const image = imageDataToCanvas(imageData);\n        ctx.drawImage(image, 0, 0, canvas.width, canvas.height);\n        return canvas;\n    };\n\n    const onImageSelected = async (\n        event: React.ChangeEvent<HTMLInputElement>\n    ) => {\n        if (!imageWorker) {\n            throw new Error(\"Image worker not initialized\");\n        }\n        const files = event.target.files;\n        if (files && files.length > 0) {\n            loadImage(\n                files[0],\n                async (img) => {\n                    const c = img as HTMLCanvasElement;\n                    const originalImage = c.toDataURL(\"image/png\");\n                    setOriginalImage(originalImage);\n\n                    const ctx = c.getContext(\"2d\");\n                    if (ctx) {\n                        const originalImageData = ctx.getImageData(\n                            0,\n                            0,\n                            c.width,\n                            c.height\n                        );\n                        const splitResult = splitImage(originalImageData);\n                        if (!splitResult) {\n                            setUpscaledImage(originalImage);\n                            return;\n                        }\n                        console.log(\"splitResult\", {\n                            numTilesX: splitResult.numTilesX,\n                            numTilesY: splitResult.numTilesY,\n                            tileSize: splitResult.tileSize,\n                        });\n                        splitResult.tileSize *= 2;\n                        splitResult.imageWidth *= 2;\n                        splitResult.imageHeight *= 2;\n                        for (let x = 0; x < splitResult.numTilesX; x++) {\n                            for (let y = 0; y < splitResult.numTilesY; y++) {\n                                const tile = splitResult.tiles[x][y];\n                                const upscaledTile = upscaleImageData(tile);\n                                const upscaledImageData = upscaledTile\n                                .getContext(\"2d\")!\n                                .getImageData(\n                                    0,\n                                    0,\n                                    upscaledTile.width,\n                                    upscaledTile.height\n                                );\n                                const id = uuid.v4();\n                                const feathered =\n                                    await imageWorker.processRequest({\n                                        id,\n                                        alphaMode: \"none\",\n                                        feather: true,\n                                        width: splitResult.imageWidth,\n                                        height: splitResult.imageHeight,\n                                        pixels: upscaledImageData.data,\n                                        selectionOverlay: {\n                                            x:\n                                                x *\n                                                (splitResult.tileSize - 64),\n                                            y:\n                                                y *\n                                                (splitResult.tileSize - 64),\n                                            width: upscaledTile.width,\n                                            height: upscaledTile.height,\n                                        },\n                                        upscale: true,\n                                        featherWidth: 64,\n                                    });\n\n                                splitResult.tiles[x][y] = new ImageData(feathered.pixels, upscaledTile.width, upscaledTile.height)\n                            }\n                        }\n                        const upscaledImageData = mergeTiles(splitResult);\n                        console.log(\n                            \"upscaled image data size\",\n                            upscaledImageData.width,\n                            upscaledImageData.height\n                        );\n                        const upscaledCanvas =\n                            imageDataToCanvas(upscaledImageData);\n                        const upscaledImage =\n                            upscaledCanvas.toDataURL(\"image/png\");\n                        setUpscaledImage(upscaledImage);\n                    }\n                },\n                { canvas: true }\n            );\n        }\n    };\n\n    return (\n        <div>\n            <input type=\"file\" onChange={onImageSelected} />\n            {originalImage && upscaledImage && (\n                <div>\n                    Original:\n                    <br />\n                    <img src={originalImage} />\n                    <br />\n                    Upscaled:\n                    <br />\n                    <img src={upscaledImage} />\n                </div>\n            )}\n        </div>\n    );\n};\n","import {FC, useEffect, useState} from \"react\";\nimport { AIBrushApi } from \"../client\";\nimport { ApiSocket, NOTIFICATION_CREDITS_UPDATED } from \"../lib/apisocket\";\n\ninterface Props {\n    api: AIBrushApi;\n    apisocket: ApiSocket;\n}\n\n// this component should fetch the credits balance {free_credits, paid_credits} from the server on mount.\n// it should also subscribe to the apisocket to receive updates to the credits balance (NOTIFICATION_CREDITS_UPDATED).\n// display paid credits above, free credits below.\n\nexport const CreditsBalance: FC<Props> = ({api, apisocket}) => {\n    const [credits, setCredits] = useState({free_credits: 0, paid_credits: 0});\n\n    useEffect(() => {\n        const fetchCredits = async () => {\n            const credits = await api.getCredits();\n            setCredits(credits.data);\n        };\n        fetchCredits();\n        const pollHandle = setInterval(fetchCredits, 60000);\n\n        const onMessage = (message: string) => {\n            const data = JSON.parse(message);\n            if (data.type === NOTIFICATION_CREDITS_UPDATED) {\n                fetchCredits();\n            }\n        }\n        apisocket.addMessageListener(onMessage);\n\n        return () => {\n            clearInterval(pollHandle);\n            apisocket.removeMessageListener(onMessage);\n        }\n    }, [api, apisocket]);\n\n    return (\n        <div>\n            <div style={{color: \"#00f0f0\"}}>\n                <span>Paid credits: </span>\n                <span>{credits.paid_credits}</span>\n            </div>\n            <div>\n                <span>Free credits: </span>\n                <span>{credits.free_credits}</span>\n            </div>\n        </div>\n    );\n};","import React from \"react\";\nimport { Card, Button } from \"react-bootstrap\";\n\nimport \"./PricingCard.css\";\n\ninterface PricingCardProps {\n    title: string;\n    price: number;\n    description: string;\n    buttonText: string;\n    onButtonClick: () => void;\n}\n\nconst PricingCard: React.FC<PricingCardProps> = ({\n    title,\n    price,\n    description,\n    buttonText,\n    onButtonClick,\n}) => {\n    return (\n        <Card style={{ width: \"18rem\", textAlign: \"center\" }} className=\"mb-4\">\n            <Card.Body>\n                <Card.Text style={{textAlign: \"right\", marginBottom: \"8px\"}}>\n                    <h3>${price}</h3>\n                </Card.Text>\n                <Card.Title style={{textAlign: \"left\", marginTop: \"0px\", marginBottom: \"24px\"}}>\n                    <i\n                        style={{fontSize: \"40px\", paddingRight: \"8px\"}}\n                        className={`font-weight-bold gradient-title`}\n                    >\n                        {title}\n                    </i>\n                </Card.Title>\n                <Card.Text>\n                    {description}\n                </Card.Text>\n                <Button variant=\"primary\" onClick={onButtonClick}>\n                    {buttonText}\n                </Button>\n            </Card.Body>\n        </Card>\n    );\n};\n\nexport default PricingCard;\n","// RedeemPopup.tsx\nimport React from 'react';\nimport { Modal, Button, Spinner } from 'react-bootstrap';\n\ninterface RedeemPopupProps {\n  state: 'busy' | 'success' | 'failure';\n  onHide: () => void;\n}\n\nconst RedeemPopup: React.FC<RedeemPopupProps> = ({ state, onHide }) => {\n  const getContent = () => {\n    switch (state) {\n      case 'busy':\n        return (\n          <>\n            <Modal.Header>\n              <Modal.Title>Redeeming Code</Modal.Title>\n            </Modal.Header>\n            <Modal.Body className=\"text-center\">\n              <Spinner animation=\"border\" />\n              <p>Processing your code...</p>\n            </Modal.Body>\n          </>\n        );\n      case 'success':\n        return (\n          <>\n            <Modal.Header>\n              <Modal.Title>Code Redeemed</Modal.Title>\n            </Modal.Header>\n            <Modal.Body className=\"text-center\">\n              <p>Your code has been successfully redeemed! You should see an update to your credits balance shortly.</p>\n            </Modal.Body>\n            <Modal.Footer>\n              <Button variant=\"primary\" onClick={onHide}>\n                Close\n              </Button>\n            </Modal.Footer>\n          </>\n        );\n      case 'failure':\n        return (\n          <>\n            <Modal.Header>\n              <Modal.Title>Code Redemption Failed</Modal.Title>\n            </Modal.Header>\n            <Modal.Body className=\"text-center\">\n              <p>Something went wrong. Please try again later or contact support.</p>\n            </Modal.Body>\n            <Modal.Footer>\n              <Button variant=\"danger\" onClick={onHide}>\n                Close\n              </Button>\n            </Modal.Footer>\n          </>\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Modal show onHide={state === 'busy' ? undefined : onHide} centered>\n      {getContent()}\n    </Modal>\n  );\n};\n\nexport default RedeemPopup;\n","import { FC, useEffect, useState } from \"react\";\nimport { Row, Col, Form, Button } from \"react-bootstrap\";\nimport { loadStripe, Stripe } from \"@stripe/stripe-js\";\nimport { AIBrushApi } from \"../../client\";\nimport PricingCard from \"./PricingCard\";\n\nimport \"./PricingPage.css\";\nimport RedeemPopup from \"./RedeemPopup\";\n\ninterface Props {\n    api: AIBrushApi;\n}\n\nexport const PricingPage: FC<Props> = ({ api }) => {\n    const [code, setCode] = useState<string>(\"\");\n    const [redeemingState, setRedeemingState] = useState<\n        \"busy\" | \"success\" | \"failure\" | undefined\n    >(undefined);\n    const [stripe, setStripe] = useState<Stripe | undefined>(undefined);\n\n    const handleRedeemCode = (event: React.FormEvent<HTMLFormElement>) => {\n        event.preventDefault();\n        setRedeemingState(\"busy\");\n        setCode(\"\");\n        api.redeemDepositCode(code)\n            .then(() => {\n                setRedeemingState(\"success\");\n            })\n            .catch(() => {\n                setRedeemingState(\"failure\");\n            });\n    };\n\n    const handleBuy = async (product: string) => {\n        if (!stripe) {\n            // alert the user that payments aren't working, and they need to contact support\n            alert(\"Payments are not working right now. Please contact support at admin@aibrush.art.\");\n            return;\n        }\n        console.log(\"buying product\", product);\n        const baseUrl = `${window.location.protocol}//${window.location.host}`;\n        const result = await api.createStripeSession({\n            product_id: product,\n            success_url: `${baseUrl}/stripe-success`,\n            cancel_url: `${baseUrl}/stripe-cancel`,\n        });\n        console.log(\"got session id\", result.data)\n        await stripe.redirectToCheckout({ sessionId: result.data.session_id });\n    };\n\n    useEffect(() => {\n        const loadStripeLibrary = async () => {\n            const stripeInstance = await loadStripe(\"pk_live_51MB0zEC2IU2ctHz653kY6uo9UcwgPxmcw2ISGzThAAQMtklAV2kfuceigzlL9LjCNyXCJkcIouVajlX8ErrRtWaz00Tqobzi2s\");\n            if (!stripeInstance) {\n                console.error(\"Failed to load Stripe library\");\n                return;\n            }\n            setStripe(stripeInstance);\n        };\n\n        loadStripeLibrary();\n    }, []);\n\n    return (\n        <>\n            <h2>Unlock the Power of AI</h2>\n            <div\n                style={{\n                    display: \"flex\",\n                    justifyContent: \"center\",\n                    marginTop: \"40px\",\n                }}\n            >\n                <p\n                    style={{\n                        fontSize: \"20px\",\n                        textAlign: \"center\",\n                    }}\n                    className=\"pricing-page-desc\"\n                >\n                    Generate stunning images with our state-of-the-art Stable\n                    Diffusion AI with over 100 models to choose from. Purchase\n                    credits to create your unique masterpieces without breaking\n                    the bank. Choose from our flexible credit packages and get\n                    started today!\n                </p>\n            </div>\n            <Row\n                className=\"justify-content-center\"\n                style={{ maxWidth: \"1200px\", margin: \"64px auto\" }}\n            >\n                {/* starter, creative, pro */}\n                <Col lg={4} className=\"d-flex justify-content-center\">\n                    <PricingCard\n                        title=\"Starter\"\n                        price={2}\n                        description=\"Dip your toes into the world of AI-generated art with 600 credits. Perfect for first-time users who want to explore the possibilities.\"\n                        buttonText=\"Buy Now\"\n                        onButtonClick={() => {\n                            handleBuy(\"starter\");\n                        }}\n                    />\n                </Col>\n                <Col lg={4} className=\"d-flex justify-content-center\">\n                    <PricingCard\n                        title=\"Creative\"\n                        price={5}\n                        description=\"Fuel your creativity with 2000 credits, offering great value for budding artists and enthusiasts. Unleash your potential!\"\n                        buttonText=\"Buy Now\"\n                        onButtonClick={() => {\n                            handleBuy(\"creative\");\n                        }}\n                    />\n                </Col>\n                <Col lg={4} className=\"d-flex justify-content-center\">\n                    <PricingCard\n                        title=\"Pro\"\n                        price={10}\n                        description=\"Get the ultimate AI art experience with 6000 credits. Ideal for professionals and prolific creators who demand the best.\"\n                        buttonText=\"Buy Now\"\n                        onButtonClick={() => {\n                            handleBuy(\"pro\");\n                        }}\n                    />\n                </Col>\n            </Row>\n            <Row className=\"justify-content-center mt-5\">\n                <Col lg={6}>\n                    <h2 className=\"text-center mb-4\">Redeem Code</h2>\n                    <p className=\"text-center\">\n                        Have a gift code from our awesome admin? Enter it here\n                        to redeem your free credits and start creating!\n                    </p>\n                    <Form onSubmit={handleRedeemCode}>\n                        <Form.Group controlId=\"redeemCode\">\n                            <Form.Control\n                                type=\"text\"\n                                placeholder=\"Enter code here\"\n                                value={code}\n                                onChange={(e) => setCode(e.target.value)}\n                            />\n                        </Form.Group>\n                        <div\n                            className=\"text-center\"\n                            style={{ marginBottom: \"50px\" }}\n                        >\n                            <Button variant=\"primary\" type=\"submit\">\n                                Redeem\n                            </Button>\n                        </div>\n                    </Form>\n                </Col>\n            </Row>\n            {redeemingState && (\n                <RedeemPopup\n                    state={redeemingState}\n                    onHide={() => setRedeemingState(undefined)}\n                />\n            )}\n        </>\n    );\n};\n","import React, { useState, useEffect } from \"react\";\nimport * as axios from \"axios\";\nimport { BrowserRouter, Switch, Route, Link } from \"react-router-dom\";\nimport \"./App.css\";\nimport \"./bootstrap.min.css\";\nimport { AIBrushApi, LoginResult, FeatureList } from \"./client/api\";\nimport { LocalImagesStore } from \"./lib/localImagesStore\";\nimport { getConfig } from \"./config\";\nimport { Login } from \"./pages/Login\";\nimport { TokenRefresher } from \"./components/TokenRefresher\";\nimport { Healthchecker } from \"./components/Healthchecker\";\nimport { Admin } from \"./pages/admin/Admin\";\nimport { ImageEditor } from \"./pages/image-editor/ImageEditor\";\nimport { DeletedImages } from \"./pages/DeletedImages\";\n\n// V2 UI\nimport { Homepage } from \"./pages/Homepage\";\nimport { ApiSocket } from \"./lib/apisocket\";\nimport { DiscordLogin } from \"./pages/DiscordLogin\";\nimport { LocalDeletedImages } from \"./pages/LocalDeletedImages\";\nimport { SavedImagesPage } from \"./pages/SavedImagesPage\";\nimport { TestPage } from \"./pages/TestPage\";\nimport { CreditsBalance } from \"./components/CreditsBalance\";\nimport { PricingPage } from \"./pages/pricing/PricingPage\";\n\nconst config = getConfig();\nconst httpClient = axios.default.create();\nconst client = new AIBrushApi(\n    undefined,\n    localStorage.getItem(\"apiUrl\") || config.apiUrl,\n    httpClient\n);\nconst apiSocket: ApiSocket = new ApiSocket();\nconst localImages = new LocalImagesStore();\n\nfunction updateHttpClient(loginResult: LoginResult) {\n    if (loginResult.accessToken) {\n        httpClient.defaults.headers.common[\n            \"Authorization\"\n        ] = `Bearer ${loginResult.accessToken}`;\n    }\n}\n\nfunction App() {\n    const [credentials, setCredentials] = useState<LoginResult | null>(null);\n    const [assetsUrl, setAssetsUrl] = useState<string>(\"/api/images\");\n    const [isAdmin, setIsAdmin] = useState<boolean>(false);\n    const [features, setFeatures] = useState<FeatureList | null>(null);\n\n    const onLogout = () => {\n        setCredentials(null);\n        localStorage.removeItem(\"credentials\");\n        httpClient.defaults.headers.common[\"Authorization\"] = undefined;\n    };\n\n    const init = async () => {\n        console.log(\"App.init\");\n        await localImages.init();\n        client\n            .getAssetsUrl()\n            .then((result) => setAssetsUrl(result.data.assets_url));\n        client.getFeatures().then((result) => setFeatures(result.data));\n        const storedCredentials = localStorage.getItem(\"credentials\");\n        if (storedCredentials) {\n            // attempt to refresh token\n            try {\n                const credentials = JSON.parse(\n                    storedCredentials\n                ) as LoginResult;\n                updateHttpClient(credentials);\n                const result = await client.refresh({\n                    refreshToken: credentials.refreshToken,\n                });\n                setCredentials(result.data);\n\n                // save to storage\n                localStorage.setItem(\n                    \"credentials\",\n                    JSON.stringify(result.data)\n                );\n                updateHttpClient(result.data);\n                const isAdmin = await client.isAdmin();\n                setIsAdmin(!!isAdmin.data.is_admin);\n                apiSocket.updateToken(result.data.accessToken!);\n                apiSocket.connect();\n            } catch (e) {\n                console.log(e);\n                localStorage.removeItem(\"credentials\");\n            }\n        }\n    };\n\n    const onLogin = async (credentials: LoginResult) => {\n        localStorage.setItem(\"credentials\", JSON.stringify(credentials));\n        setCredentials(credentials);\n        updateHttpClient(credentials);\n        apiSocket.updateToken(credentials.accessToken!);\n        apiSocket.connect();\n    };\n\n    const onCredentialsExpired = () => {\n        onLogout();\n    };\n\n    useEffect(() => {\n        init();\n    }, []);\n\n    return (\n        <div className=\"App\">\n            <TokenRefresher\n                api={client}\n                credentials={credentials as LoginResult}\n                onCredentialsRefreshed={onLogin}\n                onCredentialsExpired={onCredentialsExpired}\n            />\n            <Healthchecker api={client} />\n\n            <BrowserRouter>\n                {/* if credentials are not set, show Login component */}\n                {!credentials && (\n                    <Switch>\n                        <Route path=\"/\" exact={true}>\n                            <Login client={client} onLogin={onLogin} />\n                        </Route>\n                        <Route path=\"/discord-login\">\n                            <DiscordLogin client={client} onLogin={onLogin} />\n                        </Route>\n                        {/* fallback route is login page */}\n                        <Route path=\"*\">\n                            <Login client={client} onLogin={onLogin} />\n                        </Route>\n                    </Switch>\n                )}\n                {credentials && (\n                    <div className=\"container\">\n                        <div className=\"row\">\n                            <div className=\"col-lg-12\">\n                                {/* if credentials are set, show a bootstrap logout button a the far top right corner div */}\n                                {credentials && (\n                                    <>\n                                        <button\n                                            className=\"btn btn-primary top-button\"\n                                            onClick={() => onLogout()}\n                                        >\n                                            {/* font awesome logout icon */}\n                                            <i className=\"fas fa-sign-out-alt\"></i>\n                                        </button>\n                                        {/* saved images */}\n                                        <Link\n                                            className=\"btn btn-primary top-button\"\n                                            to=\"/saved\"\n                                        >\n                                            {/* font awesome save icon */}\n                                            <i className=\"fas fa-save\"></i>\n                                        </Link>\n                                        {/* home button */}\n                                        <Link\n                                            className=\"btn btn-primary top-button\"\n                                            to=\"/\"\n                                        >\n                                            {/* font awesome home icon */}\n                                            <i className=\"fas fa-home\"></i>\n                                        </Link>\n                                        {/* Link to discord */}\n                                        <a\n                                            className=\"btn btn-primary top-button\"\n                                            href=\"https://discord.gg/HYcFpDeqKJ\"\n                                            target=\"_blank\"\n                                        >\n                                            {/* font awesome discord icon */}\n                                            <i className=\"fab fa-discord\"></i>\n                                        </a>\n                                        <Link\n                                            className=\"btn top-button pulse\"\n                                            to=\"/pricing\"\n                                            style={{\n                                                width: \"47px\",\n                                            }}\n                                        >\n                                            {/* font awesome bolt icon */}\n                                            <i className=\"fas fa-bolt\"></i>\n                                        </Link>\n                                    </>\n                                )}\n                            </div>\n                            <div\n                                className=\"col-lg-12\"\n                                style={{ textAlign: \"right\" }}\n                            >\n                                <CreditsBalance\n                                    api={client}\n                                    apisocket={apiSocket}\n                                />\n                            </div>\n                        </div>\n\n                        {/* if credentials are set, show the rest of the app */}\n\n                        <Switch>\n                            <Route path=\"/\" exact={true}>\n                                {/* <MainMenu isAdmin={isAdmin} /> */}\n                                <Homepage\n                                    api={client}\n                                    apiSocket={apiSocket}\n                                    assetsUrl={assetsUrl}\n                                    localImages={localImages}\n                                />\n                            </Route>\n                            <Route path=\"/stripe-success\">\n                                <Homepage\n                                    api={client}\n                                    apiSocket={apiSocket}\n                                    assetsUrl={assetsUrl}\n                                    localImages={localImages}\n                                    paymentStatus=\"success\"\n                                />\n                            </Route>\n                            <Route path=\"/stripe-cancel\">\n                                <Homepage\n                                    api={client}\n                                    apiSocket={apiSocket}\n                                    assetsUrl={assetsUrl}\n                                    localImages={localImages}\n                                    paymentStatus=\"canceled\"\n                                />\n                            </Route>\n                            <Route path=\"/images/:id\">\n                                <Homepage\n                                    api={client}\n                                    apiSocket={apiSocket}\n                                    assetsUrl={assetsUrl}\n                                    localImages={localImages}\n                                />\n                            </Route>\n                            <Route path=\"/saved\" exact={true}>\n                                {/* <MainMenu isAdmin={isAdmin} /> */}\n                                <SavedImagesPage\n                                    api={client}\n                                    apiSocket={apiSocket}\n                                    assetsUrl={assetsUrl}\n                                />\n                            </Route>\n                            <Route path=\"/saved/:id\" exact={true}>\n                                {/* <MainMenu isAdmin={isAdmin} /> */}\n                                <SavedImagesPage\n                                    api={client}\n                                    apiSocket={apiSocket}\n                                    assetsUrl={assetsUrl}\n                                />\n                            </Route>\n                            <Route path=\"/image-editor/:id\">\n                                <ImageEditor\n                                    api={client}\n                                    apisocket={apiSocket}\n                                    assetsUrl={assetsUrl}\n                                    localImages={localImages}\n                                />\n                            </Route>\n                            <Route path=\"/deleted-images\">\n                                <DeletedImages\n                                    api={client}\n                                    assetsUrl={assetsUrl}\n                                />\n                            </Route>\n                            <Route path=\"/local-deleted-images\">\n                                <LocalDeletedImages localImages={localImages} />\n                            </Route>\n                            <Route path=\"/pricing\">\n                                <PricingPage api={client} />\n                            </Route>\n                            <Route path=\"/testpage\">\n                                <TestPage />\n                            </Route>\n                            {isAdmin && (\n                                <>\n                                    <Route path=\"/admin\">\n                                        <Admin api={client} />\n                                    </Route>\n                                </>\n                            )}\n                        </Switch>\n                        <div\n                            // style={{ marginTop: \"100px\", padding: \"50px\" }}\n\n                            // use position:fixed to make the footer stick to the bottom of the page\n                            style={{\n                                position: \"fixed\",\n                                bottom: \"0\",\n                                left: \"0\",\n                                width: \"100%\",\n                                height: \"50px\",\n                                paddingTop: \"16px\",\n                                backgroundColor: \"#000000\",\n                            }}\n                        >\n                            {/* show external popout pages to terms and privacy policy, if they are present in the features */}\n                            {features && features.privacy_uri && (\n                                <a href={features.privacy_uri} target=\"_blank\">\n                                    Privacy Policy\n                                </a>\n                            )}\n                            {features && features.terms_uri && (\n                                <a\n                                    href={features.terms_uri}\n                                    target=\"_blank\"\n                                    style={{ marginLeft: \"20px\" }}\n                                >\n                                    Terms of Service\n                                </a>\n                            )}\n                            {/* link to mail to admin@aibrush.art */}\n                            <a\n                                href=\"mailto:admin@aibrush.art\"\n                                style={{ marginLeft: \"20px\" }}\n                            >\n                                Contact\n                            </a>\n                            <span\n                                style={{ float: \"right\", marginRight: \"50px\" }}\n                            >\n                                Powered by the{\" \"}\n                                <a\n                                    href=\"https://stablehorde.net/\"\n                                    target=\"_blank\"\n                                >\n                                    Stable Horde\n                                </a>\n                            </span>\n                        </div>\n                    </div>\n                )}\n            </BrowserRouter>\n        </div>\n    );\n}\n\nexport default App;\n","export interface Config {\n    apiUrl: string;\n}\n\nexport function getConfig(): Config {\n    // if (process.env.REACT_APP_ENV === \"prod\") {\n    //     return {\n    //         apiUrl: \"https://aibrush.ngrok.io\"\n    //     };\n    // } else if (process.env.REACT_APP_ENV === \"alt\") {\n    //     return {\n    //         apiUrl: \"\"\n    //     };\n    // } else {\n    //     return {\n    //         apiUrl: \"http://localhost:3000\"\n    //     };\n    // }\n    return {\n        apiUrl: \"\"\n    };\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import { Renderer } from \"./renderer\";\n\nexport class ZoomHelper {\n\n    private startTouches: React.TouchList | null;\n    private startZoom = 1;\n    private startOffsetX = 0;\n    private startOffsetY = 0;\n\n    constructor(private renderer: Renderer) {\n        this.startTouches = null;\n    }\n\n    onWheel(event: WheelEvent) {\n        const originalZoom = this.renderer.getZoom();\n        let zoom = this.renderer.getZoom();\n        let offsetX = this.renderer.getOffsetX();\n        let offsetY = this.renderer.getOffsetY();\n\n        let canvasPoint = this.translateMouseToCanvasCoordinates(\n            event.offsetX,\n            event.offsetY\n        );\n        // console.log(\"x: \" + x + \", y: \" + y);\n        \n        if (event.deltaY < 0) {\n            zoom += 0.1 * zoom;\n        } else {\n            zoom -= 0.1 * zoom;\n        }\n        zoom = Math.max(0.1, Math.min(zoom, 8.0));\n\n        let xDiff = canvasPoint.x - -offsetX;\n        let yDiff = canvasPoint.y - -offsetY;\n\n        // offsetX = canvasPoint.x - xDiff * (zoom / originalZoom);\n        // offsetY = canvasPoint.y - yDiff * (zoom / originalZoom);\n        offsetX -= xDiff * (zoom / originalZoom) - xDiff;\n        offsetY -= yDiff * (zoom / originalZoom) - yDiff;\n\n        this.renderer.updateZoomAndOffset(zoom, offsetX, offsetY);\n    }\n\n    onPan(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        let movementX = event.movementX;\n        let movementY = event.movementY;\n        // translate offset to canvas coordinates\n        let rect = (\n            event.target as HTMLCanvasElement\n        ).getBoundingClientRect();\n        movementX = (movementX / rect.width) * 512;\n        movementY = (movementY / rect.height) * 512;\n\n        let zoom = this.renderer.getZoom();\n        let offsetX = this.renderer.getOffsetX();\n        let offsetY = this.renderer.getOffsetY();\n\n        offsetX += movementX / zoom;\n        offsetY += movementY / zoom;\n\n        this.renderer.updateZoomAndOffset(zoom, offsetX, offsetY);\n    }\n\n    onTouchStart(event: React.TouchEvent<HTMLCanvasElement>) {\n        if (event.touches.length === 2) {\n            this.startTouches = event.touches;\n            this.startZoom = this.renderer.getZoom();\n            this.startOffsetX = this.renderer.getOffsetX();\n            this.startOffsetY = this.renderer.getOffsetY();\n        }\n    }\n\n    onTouchMove(event: React.TouchEvent<HTMLCanvasElement>) {\n        if (this.startTouches) {\n            const canvasRect = this.renderer.getCanvas().getBoundingClientRect();\n            const startTouch1 = this.startTouches[0];\n            const startTouch2 = this.startTouches[1];\n            const touch1 = event.touches[0];\n            const touch2 = event.touches[1];\n\n            const startDistance = Math.sqrt(\n                Math.pow(startTouch1.clientX - startTouch2.clientX, 2) +\n                Math.pow(startTouch1.clientY - startTouch2.clientY, 2)\n            );\n            const distance = Math.sqrt(\n                Math.pow(touch1.clientX - touch2.clientX, 2) +\n                Math.pow(touch1.clientY - touch2.clientY, 2)\n            );\n            const zoom = this.startZoom * (distance / startDistance);\n\n            const startCenterX = (startTouch1.clientX + startTouch2.clientX) / 2;\n            const startCenterY = (startTouch1.clientY + startTouch2.clientY) / 2;\n            const centerX = (touch1.clientX + touch2.clientX) / 2;\n            const centerY = (touch1.clientY + touch2.clientY) / 2;\n\n            const startCanvasPoint = this.translateMouseToCanvasCoordinates(\n                startCenterX - canvasRect.left,\n                startCenterY - canvasRect.top\n            );\n            const canvasPoint = this.translateMouseToCanvasCoordinates(\n                centerX - canvasRect.left,\n                centerY - canvasRect.top\n            );\n\n            let offsetX = this.startOffsetX;\n            let offsetY = this.startOffsetY;\n\n            let xDiff = canvasPoint.x - startCanvasPoint.x;\n            let yDiff = canvasPoint.y - startCanvasPoint.y;\n\n            let xDiff2 = canvasPoint.x - -this.renderer.getOffsetX();\n            let yDiff2 = canvasPoint.y - -this.renderer.getOffsetY();\n\n            offsetX -= xDiff2 * (zoom / this.startZoom) - xDiff2 - (xDiff * (distance / startDistance));\n            offsetY -= yDiff2 * (zoom / this.startZoom) - yDiff2 - (yDiff * (distance / startDistance));\n\n            this.renderer.updateZoomAndOffset(zoom, offsetX, offsetY);\n        }\n    }\n\n    onTouchEnd(event: React.TouchEvent<HTMLCanvasElement>) {\n        this.startTouches = null;\n    }\n\n\n    translateMouseToCanvasCoordinates(mouseX: number, mouseY: number, zoom?: number, offsetX?: number, offsetY?: number) {\n        let x = mouseX;\n        let y = mouseY;\n        // adjust for zoom\n        zoom = zoom || this.renderer.getZoom();\n        offsetX = offsetX || this.renderer.getOffsetX();\n        offsetY = offsetY || this.renderer.getOffsetY();\n        x = x / zoom;\n        y = y / zoom;\n\n        // translate offset to canvas coordinates\n        let rect = this.renderer.getCanvas().getBoundingClientRect();\n\n        // x = (x / rect.width) * this.renderer.getWidth();\n        // y = (y / rect.height) * this.renderer.getHeight();\n\n        x = (x / rect.width) * 512;\n        y = (y / rect.height) * 512;\n\n        x = Math.round(x - offsetX);\n        y = Math.round(y - offsetY);\n\n        return { x: x, y: y };\n    }\n\n    translateCanvasToMouseCoordinates(x: number, y: number, zoom?: number, offsetX?: number, offsetY?: number) {\n        zoom = zoom || this.renderer.getZoom();\n        offsetX = offsetX || this.renderer.getOffsetX();\n        offsetY = offsetY || this.renderer.getOffsetY();\n        x = x + offsetX;\n        y = y + offsetY;\n        x = x * zoom;\n        y = y * zoom;\n\n        // translate offset to canvas coordinates\n        let rect = this.renderer.getCanvas().getBoundingClientRect();\n        x = Math.round((x / this.renderer.getWidth()) * rect.width);\n        y = Math.round((y / this.renderer.getHeight()) * rect.height);\n\n        return { x: x, y: y };\n    }\n}","import React from \"react\";\nimport { Renderer } from \"./renderer\";\nimport { ZoomHelper } from \"./zoomHelper\";\n\nexport interface Tool {\n    name: string;\n    getArgs(): any;\n    updateArgs(args: any): void;\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void;\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void;\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void;\n    onMouseLeave(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void;\n\n    onTouchStart(event: React.TouchEvent<HTMLCanvasElement>): void;\n    onTouchMove(event: React.TouchEvent<HTMLCanvasElement>): void;\n    onTouchEnd(event: React.TouchEvent<HTMLCanvasElement>): void;\n\n    onKeyDown(event: KeyboardEvent): void;\n    onKeyUp(event: KeyboardEvent): void;\n    onWheel(event: WheelEvent): void;\n    destroy(): boolean;\n    onShowSelectionControls(listener: (show: boolean) => void): void;\n    select(direction: \"left\" | \"right\"): void;\n    onSaveImage(listener: (encodedImage: string) => void): void;\n}\n\nexport class BaseTool implements Tool {\n    saveListener?: (encodedImage: string, args?: any) => void = () => {};\n\n    private touchHandle: number | undefined;\n\n    readonly zoomHelper: ZoomHelper;\n\n    private _pinchZooming = false;\n    private _panning = false;\n\n    constructor(readonly renderer: Renderer, readonly name: string) {\n        this.zoomHelper = new ZoomHelper(renderer);\n    }\n\n    getArgs(): any {\n        return JSON.parse(\n            localStorage.getItem(`tool_args_${this.name}`) || \"{}\"\n        );\n    }\n    updateArgs(args: any) {\n        localStorage.setItem(`tool_args_${this.name}`, JSON.stringify(args));\n    }\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (event.button === 1) {\n            this._panning = true;\n        }\n    }\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this._panning) {\n            this.zoomHelper.onPan(event);\n        }\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        this._updateCursor(x, y);\n    }\n\n    private _updateCursor(x: number, y: number) {\n        this.renderer.setCursor({\n            color: \"white\",\n            radius: 10,\n            type: \"crosshairs\",\n            x,\n            y,\n        });\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this._panning) {\n            this._panning = false;\n        }\n    }\n    onMouseLeave(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {}\n\n    onTouchStart(event: React.TouchEvent<HTMLCanvasElement>) {\n        if (this.touchHandle) {\n            window.clearTimeout(this.touchHandle);\n        }\n        const touches: React.Touch[] = [];\n        // make a deep copy so that the values live past the delay\n        for (let i = 0; i < event.touches.length; i++) {\n            const touch = event.touches[i];\n            touches.push({\n                identifier: touch.identifier,\n                clientX: touch.clientX,\n                clientY: touch.clientY,\n                pageX: touch.pageX,\n                pageY: touch.pageY,\n                screenX: touch.screenX,\n                screenY: touch.screenY,\n                target: null,\n            } as any);\n        }\n        event = {\n            touches,\n        } as any;\n        this.touchHandle = window.setTimeout(() => {\n            this.touchHandle = undefined;\n            if (event.touches.length === 2) {\n                this._pinchZooming = true;\n                this.zoomHelper.onTouchStart(event);\n            } else {\n                const rect = this.renderer.getCanvas().getBoundingClientRect();\n                const touch = event.touches[0];\n                if (touch) {\n                    this.onMouseDown({\n                        type: \"touch\",\n                        button: 0,\n                        nativeEvent: {\n                            offsetX: touch.clientX - rect.left,\n                            offsetY: touch.clientY - rect.top,\n                        },\n                    } as any);\n                }\n            }\n        }, 200);\n    }\n    onTouchMove(event: React.TouchEvent<HTMLCanvasElement>) {\n        if (event.touches.length === 2) {\n            this.zoomHelper.onTouchMove(event);\n        } else {\n            const rect = this.renderer.getCanvas().getBoundingClientRect();\n            const touch = event.touches[0];\n            if (touch) {\n                this.onMouseMove({\n                    type: \"touch\",\n                    button: 0,\n                    nativeEvent: {\n                        offsetX: touch.clientX - rect.left,\n                        offsetY: touch.clientY - rect.top,\n                    },\n                } as any);\n            }\n        }\n    }\n    onTouchEnd(event: React.TouchEvent<HTMLCanvasElement>) {\n        if (this._pinchZooming) {\n            this._pinchZooming = false;\n            this.zoomHelper.onTouchEnd(event);\n        } else {\n            this.onMouseUp({\n                button: 0,\n                type: \"touch\",\n            } as any);\n        }\n    }\n\n    onKeyDown(event: KeyboardEvent) {}\n    onKeyUp(event: KeyboardEvent) {}\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n    }\n    destroy(): boolean {\n        return true;\n    }\n    onShowSelectionControls(listener: (show: boolean) => void) {}\n    select(direction: \"left\" | \"right\") {}\n    onSaveImage(listener: (encodedImage: string) => void) {\n        this.saveListener = listener;\n    }\n}\n","\nexport const NOTIFICATION_IMAGE_UPDATED = \"image_updated\";\nexport const NOTIFICATION_IMAGE_DELETED = \"image_deleted\";\nexport const NOTIFICATION_PENDING_IMAGE = \"pending_image\";\nexport const NOTIFICATION_CREDITS_UPDATED = \"credits_updated\";\n\ntype MessageListener = (message: string) => void;\n\nexport class ApiSocket {\n    private client?: WebSocket;\n    private accessToken?: string\n    // private messageListener?: (message: string) => void;\n    private messageListeners: MessageListener[] = [];\n\n    updateToken(accessToken: string) {\n        this.accessToken = accessToken;\n    }\n\n    // onMessage(listener?: (message: string) => void) {\n    //     this.messageListener = listener;\n    // }\n\n    addMessageListener(listener: MessageListener) {\n        this.messageListeners.push(listener);\n    }\n\n    removeMessageListener(listener: MessageListener) {\n        this.messageListeners = this.messageListeners.filter(l => l !== listener);\n    }\n\n    connect() {\n        if (!this.accessToken) {\n            throw new Error(\"unauthenticated\");\n        }\n        if (this.client) {\n            // will reconnect in one second automatically\n            // this is called every time the auth refreshes\n            this.client.close();\n            return;\n        }\n        // let host = window.location.host;\n        let host = \"www.aibrush.art\";\n        let protocol = \"wss\";\n        // if (host.includes(\"localhost\")) {\n        //   host = \"localhost:3000\";\n        //   protocol = \"ws\";\n        // }\n        this.client = new WebSocket(`${protocol}://${host}`);\n        this.client.onerror = err => console.error(err);\n        this.client.onopen = () => {\n            console.log(\"websocket connected\");\n            this.client!.send(this.accessToken!);\n        }\n        this.client.onmessage = evt => {\n            console.log(\"server push\", evt.data);\n            for (const listener of this.messageListeners) {\n                listener(evt.data as string);\n            }\n        }\n        this.client.onclose = () => {\n          console.log(\"websocket closed\");\n          this.client = undefined;\n          setTimeout(() => this.connect(), 500);\n        }\n    }\n}\n","export class RecentList {\n    private key: string;\n    private listSize: number;\n\n    constructor(key: string, listSize: number) {\n        this.key = key;\n        this.listSize = listSize;\n    }\n\n    private getRecentItems(): string[] {\n        const modelsJson = localStorage.getItem(this.key);\n        return modelsJson ? JSON.parse(modelsJson) : [];\n    }\n\n    private saveRecentItems(models: string[]): void {\n        localStorage.setItem(this.key, JSON.stringify(models));\n    }\n\n    addItem(model: string): void {\n        const recentModels = this.getRecentItems();\n        const modelIndex = recentModels.indexOf(model);\n\n        if (modelIndex !== -1) {\n            recentModels.splice(modelIndex, 1);\n        }\n\n        recentModels.unshift(model);\n\n        if (recentModels.length > this.listSize) {\n            recentModels.pop();\n        }\n\n        this.saveRecentItems(recentModels);\n    }\n\n    getItems(): string[] {\n        return this.getRecentItems();\n    }\n}\n\nexport const recentModels = new RecentList(\"recent-models\", 20);\nexport const recentNegativePrompts = new RecentList(\"recent-negative-prompts\", 20);\nexport const recentPrompts = new RecentList(\"recent-positive-prompts\", 20);","import { FC } from \"react\";\n\ninterface Props {\n    imagesCost: number;\n}\n\nexport const CostIndicator: FC<Props> = ({ imagesCost }) => {\n    return (\n        <div style={{ textAlign: \"left\" }}>\n            <span className=\"helptext\" style={{ color: \"#00f0f0\" }}>\n                Cost: {imagesCost} credit{imagesCost > 1 ? \"s\" : \"\"}&nbsp;\n                <i\n                    className=\"fas fa-info-circle\"\n                    style={{ cursor: \"pointer\" }}\n                    onClick={() =>\n                        alert(\n                            \"The cost is based on the image count and the size of each image. A single 512x512 image costs 1 credit.\"\n                        )\n                    }\n                ></i>\n            </span>\n        </div>\n    );\n};\n","import React, { FC, useEffect, useState } from \"react\";\nimport moment from \"moment\";\nimport { Image, StatusEnum } from \"../client/api\";\nimport { LocalImage } from \"../lib/localImagesStore\";\n\ninterface Props {\n    assetsUrl: string;\n    image: LocalImage;\n    censorNSFW: boolean;\n    bulkDelete?: boolean;\n    onClick?: (image: Image) => void;\n}\n\nexport const ImageThumbnail: FC<Props> = ({ assetsUrl, image, censorNSFW, bulkDelete, onClick }) => {\n    const src = `${assetsUrl}/${image.id}.thumbnail.png?updated_at=${image.updated_at}`;\n    const [retry, setRetry] = useState(\"\");\n\n    useEffect(() => {\n        // This is to help deal with eventual consistency from S3.\n        // if image.updated_at (unix timestamp in milliseconds) is less than a minute ago, try to reload the image\n        if (moment().diff(moment(image.updated_at), \"minutes\") < 1) {\n            setRetry(\"\");\n            const t = setTimeout(() => {\n                setRetry(\"&retry\")\n            }, 3000);\n            return () => clearTimeout(t);\n        }\n    }, [image.id, image.updated_at])\n\n    let label = image.label;\n    if (image.label === \"\") {\n        label = image.params.prompt || \"\";\n    }\n    if (label.indexOf(\",\") !== -1) {\n        label = label.substring(0, label.indexOf(\",\"));\n    }\n    \n    let className = \"image-thumbnail\";\n    if (bulkDelete) {\n        className += \" bulk-delete\";\n    }\n\n    let backgroundImage = `url(${src}${retry}), url(/images/default.png)`;\n    if (image.imageData) {\n        backgroundImage = `url(${image.imageData}), url(/images/default.png)`;\n    }\n\n    return (\n        <div\n            className={className}\n            style={{\n                backgroundImage,\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"center\",\n                filter: (image.nsfw && censorNSFW) ? \"blur(8px)\" : undefined,\n            }}\n            onClick={() => onClick && onClick(image)}\n        >\n            {!bulkDelete && <div className=\"image-thumbnail-label\">\n                {label}\n            </div>}\n\n            {bulkDelete && <div className=\"image-thumbnail-label\">\n                <input type=\"checkbox\" style={{\n                    width: \"20px\",\n                    height: \"20px\",\n                    marginLeft: \"16px\",\n                    marginTop: \"16px\",\n                }} checked readOnly />\n            </div>}\n\n            {image.status === StatusEnum.Pending && <div className=\"image-thumbnail-pending\">\n                <i style={{marginTop: \"20px\"}} className=\"fa fa-hourglass-half\"></i>\n            </div>}\n            {\n                image.status === StatusEnum.Processing && <div className=\"image-thumbnail-pending\">\n                    <i style={{marginTop: \"20px\"}} className=\"fa fa-cog fa-spin\"></i>\n                </div>\n            }\n        </div>\n    );\n};\n","\nexport const supportedModels = [\n    \"Epic Diffusion\",\n    \"Rev Animated\",\n    \"Anything v3\",\n    \"Hentai Diffusion\",\n    \"Ranma Diffusion\",\n    \"URPM\",\n    \"Deliberate\",\n    \"GTA5 Artwork Diffusion\",\n    \"ChilloutMix\",\n    \"Realism Engine\",\n    \"AIO Pixel Art\",\n    \"Microworlds\",\n    \"Microchars\",\n    \"OrbAI\",\n    \"App Icon Diffusion\",\n];\n\n// canny, hed, depth, normal, openpose, seg, scribble, fakescribbles, hough\nexport const controlnetTypes = [\n    \"canny\",\n    \"hed\",\n    \"depth\",\n    \"normal\",\n    \"openpose\",\n    \"seg\",\n    \"scribble\",\n    \"fakescribbles\",\n    \"hough\",\n]","import { FC, useState, FormEvent } from \"react\";\nimport { Form, FormGroup, FormControl, FormText, FormCheck } from \"react-bootstrap\";\n\ninterface Props {\n    seed: string;\n    setSeed: (seed: string) => void;\n}\n\nexport const SeedInput: FC<Props> = ({seed, setSeed}) => {\n    const [useCustomSeed, setUseCustomSeed] = useState(false);\n\n    const onChangeCustomSeed = () => {\n        setUseCustomSeed(!useCustomSeed);\n        if (useCustomSeed) {\n            setSeed(\"\");\n        } else {\n            // set seed to a random number\n            setSeed(Math.floor(Math.random() * 1000000000).toString());\n        }\n    };\n\n    return (\n        <Form>\n            <FormGroup>\n                <FormCheck \n                    type=\"checkbox\"\n                    label=\"Use Custom Seed\"\n                    checked={useCustomSeed}\n                    onChange={(e) => onChangeCustomSeed()}\n                />\n            </FormGroup>\n\n            {useCustomSeed && (\n                <FormGroup>\n                    <FormControl\n                        type=\"text\"\n                        // value={seed}\n                        // onChange={(e) => setSeed(e.target.value)}\n                        placeholder=\"Enter seed\"\n                        value={seed}\n                        onChange={(e: any) => setSeed(e.target.value)}\n                    />\n                </FormGroup> \n            )}\n        </Form>\n    );\n};\n","import React, { useState } from \"react\";\nimport { InputGroup, FormControl, Dropdown } from \"react-bootstrap\";\n\ninterface TextInputWithHistoryProps {\n    value: string;\n    onChange: (newValue: string) => void;\n    history: string[];\n}\n\nconst TextInputWithHistory: React.FC<TextInputWithHistoryProps> = ({\n    value,\n    onChange,\n    history,\n}) => {\n    const [show, setShow] = useState(false);\n\n    const handleInputChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        onChange(event.target.value);\n    };\n\n    const handleDropdownSelect = (eventKey: string | null) => {\n        if (eventKey) {\n            onChange(eventKey);\n        }\n        setShow(false);\n    };\n\n    const handleInputClick = () => {\n        setShow(!show);\n    };\n\n    return (\n        <div>\n            <FormControl\n                value={value}\n                onChange={handleInputChange}\n                onClick={handleInputClick}\n                onBlur={() => {\n                    setTimeout(() => setShow(false), 200);\n                }}\n            />\n            <Dropdown show={show} onSelect={handleDropdownSelect}>\n                <Dropdown.Toggle\n                    variant=\"success\"\n                    id=\"dropdown-basic\"\n                    style={{ height: \"0px\", padding: \"0px\", visibility: \"hidden\", position: \"absolute\" }}\n                />\n                <Dropdown.Menu style={{width: \"100%\", overflow: \"hidden\"}}>\n                    {history.map((item, index) => (\n                        <Dropdown.Item eventKey={item} key={index}>\n                            {item}\n                        </Dropdown.Item>\n                    ))}\n                </Dropdown.Menu>\n            </Dropdown>\n        </div>\n    );\n};\n\nexport default TextInputWithHistory;\n","import React, { FC, useEffect, useState } from \"react\";\nimport { CreateImageInput, StatusEnum, Image, AIBrushApi } from \"../client\";\nimport {\n    aspectRatios,\n    DEFAULT_ASPECT_RATIO,\n    getClosestAspectRatio,\n    AspectRatio,\n} from \"../lib/aspecRatios\";\nimport loadImage from \"blueimp-load-image\";\nimport { AspectRatioSelector } from \"./AspectRatioSelector\";\nimport { getUpscaleLevel } from \"../lib/upscale\";\nimport { resizeEncodedImage } from \"../lib/imageutil\";\nimport { LocalImage } from \"../lib/localImagesStore\";\nimport { controlnetTypes, supportedModels } from \"../lib/supportedModels\";\nimport { SeedInput } from \"./SeedInput\";\nimport ModelSelector from \"./ModelSelector\";\nimport { calculateImagesCost } from \"../lib/credits\";\nimport { CostIndicator } from \"./CostIndicator\";\nimport { recentPrompts, recentNegativePrompts } from \"../lib/recentList\";\nimport TextInputWithHistory from \"./TextInputWithHistory\";\n\ninterface Props {\n    api: AIBrushApi;\n    parent: LocalImage | null;\n    creating: boolean;\n    assetsUrl: string;\n    onSubmit: (input: CreateImageInput) => void;\n    // go straight to editor without variations\n    onEdit: (input: CreateImageInput) => void;\n    onCancel: () => void;\n}\n\nexport function defaultArgs(): CreateImageInput {\n    return {\n        params: {\n            prompt: \"\",\n            negative_prompt: defaultNegativePrompt(),\n            width: 512,\n            height: 512,\n            steps: 20,\n            denoising_strength: 0.75,\n        },\n        label: \"\",\n        encoded_image: \"\",\n        encoded_mask: \"\",\n        model: \"Epic Diffusion\",\n        count: 4,\n    };\n}\n\nfunction defaultNegativePrompt(): string {\n    return recentNegativePrompts.getItems()[0] || \"low quality, distorted, deformed, dull, boring, plain, ugly, noise\";\n}\n\nexport const ImagePrompt: FC<Props> = ({\n    api,\n    parent,\n    creating,\n    assetsUrl,\n    onSubmit,\n    onCancel,\n    onEdit,\n}) => {\n    const [prompt, setPrompt] = useState<string>(\"\");\n    const [negativePrompt, setNegativePrompt] = useState<string>(\n        defaultNegativePrompt()\n    );\n    const [count, setCount] = useState<number>(4);\n    const [variationStrength, setVariationStrength] = useState<number>(0.75);\n    const [aspectRatio, setAspectRatio] =\n        useState<number>(DEFAULT_ASPECT_RATIO);\n    const [parentId, setParentId] = useState<string | null>(null);\n    const [advancedView, setAdvancedView] = useState<boolean>(false);\n    const [encodedImage, setEncodedImage] = useState<string>(\"\");\n    const [model, setModel] = useState<string>(\"Epic Diffusion\");\n\n    const [selectingModel, setSelectingModel] = useState<boolean>(false);\n\n    const [controlnetType, setControlnetType] = useState<string | undefined>();\n    const [cfgScale, setCfgScale] = useState<number>(7.5);\n    const [seed, setSeed] = useState<string>(\"\");\n    const [size, setSize] = useState<number>(1);\n    const defaultAspectRatio = aspectRatios[DEFAULT_ASPECT_RATIO];\n\n    const [aspectRatioDetails, setAspectRatioDetails] = useState<AspectRatio>(\n        aspectRatios[DEFAULT_ASPECT_RATIO]\n    );\n    let [originalWidth, setOriginalWidth] = useState<number>(\n        defaultAspectRatio.width\n    );\n    let [originalHeight, setOriginalHeight] = useState<number>(\n        defaultAspectRatio.height\n    );\n\n    // const aspectRatioDetails = aspectRatios[aspectRatio];\n\n    const resetState = () => {\n        setPrompt(\"\");\n        setNegativePrompt(recentNegativePrompts.getItems()[0] || defaultNegativePrompt);\n        // setCount(4);\n        setAdvancedView(false);\n        setParentId(null);\n        // setVariationStrength(0.75);\n        setAspectRatio(DEFAULT_ASPECT_RATIO);\n        setAspectRatioDetails(aspectRatios[DEFAULT_ASPECT_RATIO]);\n        setEncodedImage(\"\");\n        // setCfgScale(7.5);\n        setSeed(\"\");\n    };\n\n    const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n        if (negativePrompt) {\n            recentNegativePrompts.addItem(negativePrompt);\n        }\n        e.preventDefault();\n        const args = defaultArgs();\n        args.params.prompt = prompt || \"\";\n        args.params.negative_prompt = negativePrompt || \"\";\n        args.count = seed ? 1 : count;\n        args.parent = parentId || undefined;\n        args.params.denoising_strength = variationStrength;\n        args.nsfw = true;\n        args.model = model;\n        args.temporary = true;\n        args.params.controlnet_type = controlnetType as any;\n        args.params.cfg_scale = cfgScale;\n        args.params.seed = seed || undefined;\n        if (parent) {\n            const bestMatch = getClosestAspectRatio(\n                parent.params.width!,\n                parent.params.height!\n            ).scale(size);\n            args.params.width = bestMatch.width;\n            args.params.height = bestMatch.height;\n        } else {\n            const bestMatch = getClosestAspectRatio(\n                aspectRatioDetails.width,\n                aspectRatioDetails.height\n            ).scale(size);\n            args.params.width = bestMatch.width;\n            args.params.height = bestMatch.height;\n        }\n        if (encodedImage) {\n            args.encoded_image = await resizeEncodedImage(\n                encodedImage,\n                args.params.width,\n                args.params.height,\n                \"png\"\n            );\n        }\n\n        resetState();\n        onSubmit(args);\n    };\n\n    const handleEdit = () => {\n        if (!encodedImage) {\n            console.error(\"Cannot edit without existing image\");\n            return;\n        }\n        if (negativePrompt) {\n            recentNegativePrompts.addItem(negativePrompt);\n        }\n        const args = defaultArgs();\n        args.params.prompt = prompt || \"\";\n        args.params.negative_prompt = negativePrompt || \"\";\n        args.count = 1;\n        args.parent = parentId || undefined;\n        // args.stable_diffusion_strength = variationStrength;\n        args.params.denoising_strength = variationStrength;\n        args.status = StatusEnum.Completed;\n        args.params.width = originalWidth;\n        args.params.height = originalHeight;\n        args.params.cfg_scale = cfgScale;\n        args.nsfw = true;\n        args.model = model;\n        if (encodedImage) {\n            args.encoded_image = encodedImage;\n        }\n\n        resetState();\n        onEdit(args);\n    };\n\n    const handleCancel = () => {\n        resetState();\n        onCancel();\n    };\n\n    const onSelectModel = (model: string) => {\n        setModel(model);\n        setSelectingModel(false);\n    };\n\n    const onImageSelected = async (e: React.ChangeEvent<HTMLInputElement>) => {\n        const file = e.target.files && e.target.files[0];\n        if (!file) {\n            return;\n        }\n        loadImage(\n            file,\n            (img: Event | HTMLImageElement | HTMLCanvasElement) => {\n                if (!(img instanceof HTMLCanvasElement)) {\n                    return;\n                }\n                // try to match width and height to a supported aspect ratio\n                const width = img.width;\n                const height = img.height;\n                let bestMatch = getClosestAspectRatio(width, height);\n\n                const canvas = document.createElement(\"canvas\");\n                // canvas.width = bestMatch.width;\n                // canvas.height = bestMatch.height;\n                canvas.width = width;\n                canvas.height = height;\n                const ctx = canvas.getContext(\"2d\");\n                if (!ctx) {\n                    return;\n                }\n                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n\n                // convert image to base64\n                // const canvas = img as HTMLCanvasElement\n                const dataUrl = canvas.toDataURL(\"image/png\");\n                const base64 = dataUrl.split(\",\")[1];\n                setEncodedImage(base64);\n                // get the index of the best match\n                setAspectRatio(\n                    aspectRatios.findIndex((a) => a.id === bestMatch.id)\n                );\n                setAspectRatioDetails(bestMatch);\n                setOriginalWidth(width);\n                setOriginalHeight(height);\n                // remove canvas\n                canvas.remove();\n            },\n            {\n                maxWidth: 4096,\n                maxHeight: 4096,\n                canvas: true,\n            }\n        );\n    };\n\n    useEffect(() => {\n        if (parent) {\n            const imageData = parent.imageData;\n            if (imageData) {\n                setEncodedImage(imageData.split(\",\")[1]);\n            }\n            setPrompt(parent.params.prompt || \"\");\n            setNegativePrompt(\n                parent.params.negative_prompt || defaultNegativePrompt()\n            );\n            setCount(4);\n            setParentId(parent.id);\n            setAdvancedView(true);\n            setVariationStrength(parent.params.denoising_strength || 0.75);\n            setModel(\n                supportedModels.indexOf(parent.model) > -1\n                    ? parent.model\n                    : \"Epic Diffusion\"\n            );\n            setCfgScale(parent.params.cfg_scale || 7.5);\n        } else {\n            resetState();\n        }\n    }, [parent]);\n\n    // unset controlnet when encodedImage is null\n    useEffect(() => {\n        if (!encodedImage) {\n            setControlnetType(undefined);\n        }\n    }, [encodedImage]);\n\n    const scaledAspectRatio = aspectRatioDetails.scale(size);\n    const imagesCost = calculateImagesCost(\n        count,\n        scaledAspectRatio.width,\n        scaledAspectRatio.height\n    );\n\n    return (\n        <form onSubmit={handleSubmit}>\n            <div className=\"homepage-prompt\">\n                <div className=\"input-group\">\n                    <input\n                        className=\"form-control prompt\"\n                        placeholder=\"What would you like to create?\"\n                        value={prompt}\n                        onChange={(e) => setPrompt(e.target.value)}\n                    />\n\n                    <div className=\"input-group-append\">\n                        <select\n                            className=\"form-control prompt-count\"\n                            style={{ borderTopLeftRadius: \"0px\" }}\n                            value={seed ? 1 : count}\n                            onChange={(e) => setCount(parseInt(e.target.value))}\n                            disabled={!!seed}\n                        >\n                            <option value={1}>1</option>\n                            <option>2</option>\n                            <option>3</option>\n                            <option>4</option>\n                            <option>5</option>\n                            <option>6</option>\n                            <option>7</option>\n                            <option>8</option>\n                            <option>9</option>\n                            <option>10</option>\n                        </select>\n                        <button\n                            type=\"submit\"\n                            className=\"btn btn-secondary light-button\"\n                            style={{ marginLeft: \"8px\" }}\n                            disabled={!prompt || creating}\n                        >\n                            {/* paintbrush button */}\n                            {!creating && (\n                                <i className=\"fas fa-paint-brush\"></i>\n                            )}\n                            {/* spinner button */}\n                            {creating && (\n                                <i className=\"fas fa-spinner fa-spin\"></i>\n                            )}\n                        </button>\n                    </div>\n                </div>\n                <CostIndicator imagesCost={imagesCost} />\n                <div\n                    style={{\n                        marginTop: \"24px\",\n                    }}\n                >\n                    <a\n                        href=\"javascript:void(0)\"\n                        onClick={() => setAdvancedView(!advancedView)}\n                        style={{\n                            color: \"white\",\n                            textDecoration: \"underline\",\n                        }}\n                    >\n                        Advanced\n                    </a>\n                    &nbsp;\n                    {advancedView ? (\n                        <i className=\"fas fa-chevron-up\"></i>\n                    ) : (\n                        <i className=\"fas fa-chevron-down\"></i>\n                    )}\n                </div>\n                {advancedView && (\n                    <div className=\"homepage-prompt-advanced\">\n                        {encodedImage && (\n                            <div className=\"form-group\">\n                                <label>Init Image</label>\n                                <img\n                                    style={{\n                                        display: \"block\",\n                                        marginLeft: \"auto\",\n                                        marginRight: \"auto\",\n                                        maxWidth: \"100%\",\n                                    }}\n                                    src={`data:image/png;base64,${encodedImage}`}\n                                />\n                            </div>\n                        )}\n                        {!parent && !encodedImage && (\n                            <AspectRatioSelector\n                                aspectRatio={aspectRatio}\n                                onChange={(aspectRatioId) => {\n                                    setAspectRatio(aspectRatioId);\n                                    setAspectRatioDetails(\n                                        aspectRatios[aspectRatioId]\n                                    );\n                                }}\n                            />\n                        )}\n                        <div className=\"form-group\">\n                            <div\n                                style={{\n                                    display: \"block\",\n                                    maxWidth: encodedImage ? \"350px\" : \"180px\",\n                                    marginTop: \"40px\",\n                                    marginRight: \"auto\",\n                                    marginLeft: \"auto\",\n                                }}\n                            >\n                                <label\n                                    id=\"loadimage-wrapper\"\n                                    className={`btn btn-primary `}\n                                    style={{ display: \"inline\" }}\n                                >\n                                    {/* upload image */}\n                                    <i className=\"fas fa-upload\"></i>&nbsp;\n                                    {encodedImage || parent\n                                        ? \"Replace\"\n                                        : \"Upload\"}\n                                    <input\n                                        id=\"loadimage\"\n                                        type=\"file\"\n                                        style={{ display: \"none\" }}\n                                        onChange={onImageSelected}\n                                    />\n                                </label>\n                                {encodedImage && (\n                                    <label\n                                        className=\"btn btn-secondary\"\n                                        onClick={() => setEncodedImage(\"\")}\n                                        style={{ display: \"inline\" }}\n                                    >\n                                        {/* remove image */}\n                                        <i className=\"fas fa-trash\"></i>&nbsp;\n                                        Remove\n                                    </label>\n                                )}\n                            </div>\n                        </div>\n                        <div className=\"form-group\">\n                            <label htmlFor=\"model\">Model</label>\n                            <div>\n                                <button\n                                    type=\"button\"\n                                    className=\"btn btn-secondary light-button\"\n                                    onClick={() => setSelectingModel(true)}\n                                >\n                                    {model}&nbsp;\n                                    <i className=\"fas fa-caret-down\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div className=\"form-group\">\n                            {/* negative prompt */}\n                            <label htmlFor=\"negativePrompt\">\n                                Negative Prompt\n                            </label>\n                            {/* <input\n                                type=\"text\"\n                                className=\"form-control\"\n                                id=\"negativePrompt\"\n                                placeholder=\"What would you like to avoid?\"\n                                value={negativePrompt}\n                                onChange={(e) =>\n                                    setNegativePrompt(e.target.value)\n                                }\n                            /> */}\n                            <TextInputWithHistory\n                                history={recentNegativePrompts.getItems()}\n                                value={negativePrompt}\n                                onChange={setNegativePrompt}\n                            />\n                            <span className=\"helptext\">\n                                Try descriptive words like \"blurry\" or\n                                \"distorted\"\n                            </span>\n                        </div>\n                        {!seed && (\n                            <div className=\"form-group\">\n                                <label htmlFor=\"count\">Count: {count}</label>\n                                {/* range slider from 1 to 20 */}\n                                <input\n                                    type=\"range\"\n                                    className=\"form-control-range\"\n                                    id=\"count\"\n                                    min=\"1\"\n                                    max=\"10\"\n                                    value={count}\n                                    onChange={(e) =>\n                                        setCount(parseInt(e.target.value))\n                                    }\n                                />\n                                <span className=\"helptext\">\n                                    This is how many images you want to generate\n                                </span>\n                            </div>\n                        )}\n                        {/* size slider */}\n                        <div className=\"form-group\">\n                            <label htmlFor=\"size\">Size: {scaledAspectRatio.width} x {scaledAspectRatio.height}</label>\n                            {/* range slider from 1 to 2 in increments of 0.1 */}\n                            <input\n                                type=\"range\"\n                                className=\"form-control-range\"\n                                id=\"size\"\n                                min=\"1\"\n                                max=\"2\"\n                                step=\"0.1\"\n                                value={size}\n                                onChange={(e) =>\n                                    setSize(parseFloat(e.target.value))\n                                }\n                            />\n                            <span className=\"helptext\">\n                                This allows you to adjust the size of your images. Larger images cost more credits.\n                            </span>\n                        </div>\n\n                        {(parentId || encodedImage) && (\n                            <div className=\"form-group\">\n                                {/* variation strength */}\n                                <label htmlFor=\"variationStrength\">\n                                    Variation Strength:&nbsp;\n                                    {(variationStrength * 100).toFixed(0)}%\n                                </label>\n                                <input\n                                    type=\"range\"\n                                    className=\"form-control-range\"\n                                    id=\"variationStrength\"\n                                    min=\"0.05\"\n                                    max=\"0.95\"\n                                    step=\"0.05\"\n                                    value={variationStrength}\n                                    onChange={(e) =>\n                                        setVariationStrength(\n                                            parseFloat(e.target.value)\n                                        )\n                                    }\n                                />\n                                <span className=\"helptext\">\n                                    This is how much variation you want to see\n                                    from the parent image\n                                </span>\n                            </div>\n                        )}\n                        {encodedImage && (\n                            // controlnet type - canny, hed, depth, normal, openpose, seg, scribble, fakescribbles, hough\n                            <div className=\"form-group\">\n                                <label htmlFor=\"controlNetType\">\n                                    Control Net Type\n                                </label>\n                                <select\n                                    className=\"form-control\"\n                                    id=\"controlNetType\"\n                                    value={controlnetType}\n                                    onChange={(e) =>\n                                        setControlnetType(e.target.value)\n                                    }\n                                >\n                                    <option value=\"\">None</option>\n                                    {controlnetTypes.map((type) => (\n                                        <option\n                                            value={type}\n                                            key={`type-${type}`}\n                                        >\n                                            {type}\n                                        </option>\n                                    ))}\n                                </select>\n                                <span className=\"helptext\">\n                                    Controlnet is an advanced way of controlling\n                                    the output of image generation. You can read\n                                    more about it{\" \"}\n                                    <a\n                                        target=\"_blank\"\n                                        href=\"https://bootcamp.uxdesign.cc/controlnet-and-stable-diffusion-a-game-changer-for-ai-image-generation-83555cb942fc\"\n                                    >\n                                        here.\n                                    </a>\n                                </span>\n                            </div>\n                        )}\n                        {/* cfg scale. Slider from 1 to 20 in increments of 0.1 */}\n                        <div className=\"form-group\">\n                            <label>CFG Scale: {cfgScale.toFixed(1)}</label>\n                            <input\n                                type=\"range\"\n                                className=\"form-control-range\"\n                                min=\"1\"\n                                max=\"20\"\n                                step=\"0.5\"\n                                value={cfgScale}\n                                onChange={(e) =>\n                                    setCfgScale(parseFloat(e.target.value))\n                                }\n                            />\n                            <span className=\"helptext\">\n                                Adjust the CFG scale to control how much the\n                                image looks like the prompt.\n                            </span>\n                        </div>\n                        <SeedInput seed={seed} setSeed={setSeed} />\n\n                        <div\n                            className=\"form-group\"\n                            style={{ minHeight: \"20px\" }}\n                        >\n                            <div className=\"float-right\">\n                                {parent && (\n                                    <button\n                                        type=\"button\"\n                                        className=\"btn btn-secondary light-button\"\n                                        onClick={handleCancel}\n                                    >\n                                        <i className=\"fas fa-times\"></i>\n                                        &nbsp;CANCEL\n                                    </button>\n                                )}\n                                <button\n                                    type=\"submit\"\n                                    className=\"btn btn-primary\"\n                                    style={{ marginLeft: \"8px\" }}\n                                    disabled={!prompt || creating}\n                                >\n                                    {/* paintbrush button */}\n                                    {!creating && (\n                                        <i className=\"fas fa-paint-brush\"></i>\n                                    )}\n                                    {/* spinner button */}\n                                    {creating && (\n                                        <i className=\"fas fa-spinner fa-spin\"></i>\n                                    )}\n                                    &nbsp;PAINT\n                                </button>\n                                {encodedImage && (\n                                    <button\n                                        type=\"button\"\n                                        className=\"btn btn-secondary light-button\"\n                                        onClick={handleEdit}\n                                        style={{ marginLeft: \"8px\" }}\n                                        disabled={!prompt || creating}\n                                    >\n                                        <i className=\"fas fa-edit\"></i>\n                                        &nbsp;EDIT\n                                    </button>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                )}\n            </div>\n            {selectingModel && (\n                <ModelSelector\n                    api={api}\n                    onCancel={() => setSelectingModel(false)}\n                    onSelectModel={onSelectModel}\n                    initialSelectedModel={model}\n                    inpainting={false}\n                />\n            )}\n        </form>\n    );\n};\n","import { FC } from \"react\";\n\ninterface Props {\n    progress: number;\n}\n\nexport const ProgressBar: FC<Props> = ({ progress }) => {\n    return (\n        <div className=\"progress\" style={{ height: \"20px\", marginTop: \"16px\" }}>\n            <div\n                className=\"progress-bar\"\n                role=\"progressbar\"\n                style={{ width: `${progress * 100}%` }}\n                aria-valuenow={progress * 100}\n                aria-valuemin={0}\n                aria-valuemax={100}\n            >\n                {Math.round(progress * 100)}%\n            </div>\n        </div>\n    );\n};\n","export function sleep(ms: number): Promise<void> {\n    return new Promise(resolve => window.setTimeout(resolve, ms));\n}\n","const BASE_IMAGE_SIZE = 512 * 512;\n\nexport function calculateImagesCost(count: number, width: number, height: number): number {\n    // 512x512 = 1 credit\n    // floor(count * width * height / 512 / 512)\n    return Math.max(count * Math.floor(width * height / BASE_IMAGE_SIZE), 1);\n}","import { FC, useEffect, useState } from \"react\";\nimport { ListGroup } from \"react-bootstrap\";\nimport { StableDiffusionModel } from \"../client\";\n\ninterface Props {\n    models: StableDiffusionModel[];\n    onSelectModel: (model: StableDiffusionModel) => void;\n    selectedModel: string;\n}\n\nconst MOBILE_HEIGHT_PERCENT = 0.3;\n\nexport const ModelList: FC<Props> = ({ models, onSelectModel, selectedModel }) => {\n    const [maxHeight, setMaxHeight] = useState(window.innerWidth < 576 ? window.innerHeight * MOBILE_HEIGHT_PERCENT : window.innerHeight * 0.7); // Set maxHeight to 80% of the viewport height\n\n    useEffect(() => {\n        const handleResize = () => {\n            let maxHeight = window.innerHeight * 0.7;\n            if (window.innerWidth < 576) {\n                maxHeight = window.innerHeight * MOBILE_HEIGHT_PERCENT;\n            }\n            setMaxHeight(maxHeight); // Update maxHeight based on the current viewport height\n        };\n\n        window.addEventListener(\"resize\", handleResize);\n        return () => {\n            window.removeEventListener(\"resize\", handleResize);\n        };\n    }, []);\n\n    return (\n        <ListGroup\n            style={{\n                maxHeight: `${maxHeight}px`,\n                overflowY: \"auto\",\n                border: \"1px solid #808080\",\n                marginBottom: \"8px\",\n            }}\n        >\n            {models.map((model) => (\n                <ListGroup.Item\n                    key={model.name}\n                    active={selectedModel === model.name}\n                    onClick={() => onSelectModel(model)}\n                    style={{\n                        cursor: \"pointer\",\n                    }}\n                >\n                    {model.name}\n                </ListGroup.Item>\n            ))}\n        </ListGroup>\n    );\n};\n","import { useState, useEffect } from \"react\";\n\nexport class SimpleCache {\n    private storage: Storage;\n\n    constructor() {\n        this.storage = window.localStorage;\n    }\n\n    setItem(key: string, value: any, ttl = 60 * 60) {\n        const item: {\n            value: any;\n            expiry: number;\n        } = {\n            value,\n            expiry: Date.now() + ttl * 1000,\n        };\n        this.storage.setItem(key, JSON.stringify(item));\n    }\n\n    getItem(key: string): any {\n        try {\n            const itemStr = this.storage.getItem(key);\n            if (!itemStr) {\n                return null;\n            }\n    \n            const item: {\n                value: any;\n                expiry: number;\n            } = JSON.parse(itemStr);\n            if (Date.now() > item.expiry) {\n                this.storage.removeItem(key);\n                return null;\n            }\n            return item.value;\n        } catch (error) {\n            console.error(error);\n            return null;\n        }\n    }\n\n    removeItem(key: string) {\n        this.storage.removeItem(key);\n    }\n\n    clear() {\n        this.storage.clear();\n    }\n}\n\nconst cache = new SimpleCache();\n\nexport function useCache<T>(key: string, initialValue: T): [T, React.Dispatch<React.SetStateAction<T>>] {\n  const [value, setValue] = useState<T>(() => {\n    const cachedValue = cache.getItem(key);\n    return cachedValue !== null ? cachedValue : initialValue;\n  });\n\n  useEffect(() => {\n    cache.setItem(key, value);\n  }, [key, value]);\n\n  return [value, setValue];\n}\n","import React, { useEffect, useState } from \"react\";\nimport { Button, Modal, Form, ListGroup, Row, Col } from \"react-bootstrap\";\nimport axios from \"axios\";\nimport { AIBrushApi, StableDiffusionModel } from \"../client\";\nimport { ModelList } from \"./ModelList\";\nimport { useCache } from \"../lib/localcache\";\nimport { recentModels } from \"../lib/recentList\";\n\nconst httpclient = axios.create();\n\ninterface ModelSelectorProps {\n    api: AIBrushApi;\n    initialSelectedModel: string;\n    onSelectModel: (model: string) => void;\n    onCancel: () => void;\n    inpainting: boolean;\n}\n\n\n\nconst ModelSelector: React.FC<ModelSelectorProps> = ({\n    api,\n    initialSelectedModel,\n    onSelectModel,\n    onCancel,\n    inpainting,\n}) => {\n    const [models, setModels] = useCache<StableDiffusionModel[]>(\"models\", []);\n    const [selectedModel, setSelectedModel] =\n        useState<StableDiffusionModel | null>(null);\n    const [searchTerm, setSearchTerm] = useState(\"\");\n\n    const filteredModels = models.filter((model) =>\n        model.inpainting === inpainting && model.name.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    const handleSelect = () => {\n        console.log(\"Selected model:\", selectedModel);\n        if (selectedModel) {\n            onSelectModel(selectedModel.name);\n        }\n    };\n\n    const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {\n        setSearchTerm(e.target.value);\n    };\n\n    const handleModelClick = (model: StableDiffusionModel) => {\n        setSelectedModel(model);\n    };\n\n    useEffect(() => {\n        const setSortedModels = (\n            selectedModel: StableDiffusionModel,\n            models: StableDiffusionModel[]\n        ) => {\n            recentModels.addItem(selectedModel.name);\n\n            const recentModelNames = recentModels.getItems();\n            // map from model name to index\n            const recentModelIndices: { [key: string]: number } = {};\n            recentModelNames.forEach((name, index) => {\n                recentModelIndices[name] = index;\n            });\n            // sort models by recentness\n            const sortedModels = models.sort((a, b) => {\n                const aIndex = recentModelIndices[a.name];\n                const bIndex = recentModelIndices[b.name];\n                if (aIndex === undefined && bIndex === undefined) {\n                    return 0;\n                } else if (aIndex === undefined) {\n                    return 1;\n                } else if (bIndex === undefined) {\n                    return -1;\n                } else {\n                    return aIndex - bIndex;\n                }\n            });\n\n            setModels(sortedModels);\n        };\n\n        if (!models || models.length === 0) {\n            api.getModels().then((res) => {\n                console.log(res);\n                const selectedModel =\n                    res.data[initialSelectedModel] ||\n                    Object.values(res.data)[0];\n                console.log(\"Selected model:\", selectedModel);\n                setSelectedModel(selectedModel);\n                setSortedModels(selectedModel, Object.values(res.data));\n            });\n        } else {\n            const selectedModel =\n                models.find((model) => model.name === initialSelectedModel) ||\n                models[0];\n            setSelectedModel(selectedModel);\n            setSortedModels(selectedModel, models);\n        }\n    }, [api, models]);\n\n    useEffect(() => {\n        if (initialSelectedModel) {\n            recentModels.addItem(initialSelectedModel);\n        }\n    }, [initialSelectedModel]);\n\n    return (\n        <>\n            <Modal show={true} onHide={onCancel} size=\"xl\">\n                <Modal.Header closeButton>\n                    <Modal.Title>Select Model</Modal.Title>\n                </Modal.Header>\n                <Modal.Body>\n                    <Form.Control\n                        type=\"text\"\n                        placeholder=\"Search\"\n                        value={searchTerm}\n                        onChange={handleSearch}\n                    />\n                    <Row className=\"mt-3\">\n                        <Col sm={4}>\n                            <ModelList\n                                models={filteredModels}\n                                onSelectModel={handleModelClick}\n                                selectedModel={selectedModel?.name || \"\"}\n                            />\n                        </Col>\n                        <Col sm={8}>\n                            {selectedModel && (\n                                <>\n                                    <h5>{selectedModel.name}</h5>\n                                    <p>{selectedModel.description}</p>\n                                    {selectedModel.showcases &&\n                                        selectedModel.showcases.length > 0 && (\n                                            <img\n                                                src={selectedModel.showcases[0]}\n                                                alt=\"Showcase\"\n                                                style={{\n                                                    width: \"70%\",\n                                                }}\n                                            />\n                                        )}\n                                </>\n                            )}\n                        </Col>\n                    </Row>\n                </Modal.Body>\n                <Modal.Footer>\n                    <Button variant=\"secondary\" onClick={onCancel}>\n                        Cancel\n                    </Button>\n                    <Button\n                        variant=\"primary\"\n                        onClick={handleSelect}\n                        disabled={!selectedModel}\n                    >\n                        Select\n                    </Button>\n                </Modal.Footer>\n            </Modal>\n        </>\n    );\n};\n\nexport default ModelSelector;\n","import { OverlayTrigger, Tooltip } from \"react-bootstrap\";\n\ninterface Props {\n    onClick: () => void;\n}\n\nexport const ResetToDefaultIcon = ({ onClick }: Props) => {\n    return (\n        <OverlayTrigger\n            placement=\"top\"\n            overlay={<Tooltip id=\"reset-tooltip\">Reset to Default</Tooltip>}\n        >\n            <i className=\"fa fa-sync\" style={{\n                cursor: \"pointer\",\n            }} onClick={onClick}></i>\n        </OverlayTrigger>\n    );\n};\n","import React, { FC, useEffect, useState } from 'react';\nimport moment from \"moment\";\n\n// implement an error notification component\n// error message and timestamp are passed in as props\n// but close button can make the error message disappear\n\n// show error when the timestamp or message changes with useEffect hook\n// hide error when the close button is clicked\n\ninterface Props {\n    message: string | null;\n    timestamp: number;\n}\n\ninterface AlertProps {\n    message: string;\n    timestamp: number;\n    alertType: 'success' | 'info' | 'warning' | 'danger';\n}\n\nconst Alert: FC<AlertProps> = ({ message, timestamp, alertType }) => {\n    const [show, setShow] = useState(!!message);\n\n    useEffect(() => {\n        setShow(!!message);\n        // set a timeout of 10 seconds to hide the message if it is currently showing\n        if (message) {\n            const timeout = setTimeout(() => {\n                setShow(false);\n            }, 10000);\n            return () => {\n                clearTimeout(timeout);\n            };\n        }\n    }, [message, timestamp]);\n\n    if (!show) {\n        return null;\n    }\n\n    return (\n        <div className={`alert alert-${alertType} ${show ? 'show' : 'hide'}`}>\n            <button\n                type=\"button\"\n                className=\"close\"\n                onClick={() => setShow(false)}\n            >\n                &times;\n            </button>\n            {message}\n        </div>\n    );\n};\n\nexport const ErrorNotification: FC<Props> = ({ message, timestamp }) => {\n    return (\n        <Alert message={message || ''} timestamp={timestamp} alertType=\"danger\" />\n    );\n};\n\nexport const SuccessNotification: FC<Props> = ({ message, timestamp }) => {\n    return (\n        <Alert message={message || ''} timestamp={timestamp} alertType=\"success\" />\n    );\n};\n","import React, { FC, useState, useEffect } from \"react\";\nimport { ChromePicker } from \"react-color\";\n\n// class ButtonExample extends React.Component {\n//   state = {\n//     displayColorPicker: false,\n//   };\n\n//   handleClick = () => {\n//     this.setState({ displayColorPicker: !this.state.displayColorPicker })\n//   };\n\n//   handleClose = () => {\n//     this.setState({ displayColorPicker: false })\n//   };\n\n//   render() {\n//     const popover = {\n//       position: 'absolute',\n//       zIndex: '2',\n//     }\n//     const cover = {\n//       position: 'fixed',\n//       top: '0px',\n//       right: '0px',\n//       bottom: '0px',\n//       left: '0px',\n//     }\n//     return (\n//       <div>\n//         <button onClick={ this.handleClick }>Pick Color</button>\n//         { this.state.displayColorPicker ? <div style={ popover }>\n//           <div style={ cover } onClick={ this.handleClose }/>\n//           <ChromePicker />\n//         </div> : null }\n//       </div>\n//     )\n//   }\n// }\n\ninterface Props {\n    color: string;\n    onColorSelected: (color: string) => void;\n}\n\nexport const ColorPicker: FC<Props> = ({ color, onColorSelected }) => {\n    const [displayColorPicker, setDisplayColorPicker] = useState(false);\n    const [tmpColor, setTmpColor] = useState(color);\n\n    const handleClick = () => {\n        setDisplayColorPicker(!displayColorPicker);\n        if (displayColorPicker) {\n            onColorSelected(tmpColor);\n        }\n    };\n\n    const handleClose = () => {\n        setDisplayColorPicker(false);\n        if (displayColorPicker) {\n            onColorSelected(tmpColor);\n        }\n    };\n\n    const popover: React.CSSProperties = {\n        position: \"absolute\",\n        zIndex: 2,\n    };\n    const cover: React.CSSProperties = {\n        position: \"fixed\",\n        top: \"0px\",\n        right: \"0px\",\n        bottom: \"0px\",\n        left: \"0px\",\n    };\n\n    return (\n        <>\n            <button className=\"color-picker\" onClick={handleClick}>\n                <i className=\"fas fa-plus\" />\n            </button>\n            {displayColorPicker ? (\n                <div style={popover}>\n                    <div style={cover} onClick={handleClose} />\n                    <ChromePicker\n                        color={tmpColor}\n                        onChange={(color) => setTmpColor(color.hex)}\n                        onChangeComplete={(color) => setTmpColor(color.hex)}\n                    />\n                </div>\n            ) : null}\n        </>\n    );\n};\n","import React, { FC, useEffect, useState } from \"react\";\nimport { ChromePicker } from \"react-color\";\n\nimport { Renderer } from \"./renderer\";\nimport { BaseTool, Tool } from \"./tool\";\nimport { ZoomHelper } from \"./zoomHelper\";\nimport { PaletteButton } from \"./PaletteButton\";\nimport { ColorPicker } from \"./ColorPicker\";\n\nexport const defaultColors = [\n    \"#FFFFFF\",\n    \"#5A2C02\",\n    \"#386EB6\",\n    \"#6B31A1\",\n    \"#CB2C26\",\n    \"#000000\",\n    \"#888888\",\n    \"#50B050\",\n    \"#FBDB37\",\n    \"#E88D2D\",\n];\n\nexport class PencilTool extends BaseTool implements Tool {\n    private brushSize = 10;\n\n    private panning = false;\n    private isDrawing = false;\n    private lastX = 0;\n    private lastY = 0;\n    private colorPicking = false;\n    private lastPickedColor = \"#000000\";\n    private _dirty = false;\n\n    set dirty(dirty: boolean) {\n        this._dirty = dirty;\n        if (this.dirtyListener) {\n            this.dirtyListener(dirty);\n        }\n    }\n\n    get dirty() {\n        return this._dirty;\n    }\n\n    private dirtyListener?: (dirty: boolean) => void;\n    private colorPickedListener?: (color: string) => void;\n\n    constructor(\n        renderer: Renderer,\n        private layer: \"base\" | \"mask\",\n        private brushColor = defaultColors[0],\n        name = \"pencil\"\n    ) {\n        super(renderer, name);\n    }\n\n    private sync() {\n        if (this.colorPicking) {\n            this.renderer.setCursor({\n                x: this.lastX,\n                y: this.lastY,\n                radius: this.renderer.getWidth() / 20,\n                color: this.lastPickedColor,\n                type: \"colorpicker\",\n            });\n        } else {\n            this.renderer.setCursor({\n                x: this.lastX,\n                y: this.lastY,\n                radius: this.brushSize / 2,\n                color: this.brushColor,\n                type: \"circle-fill\",\n            });\n        }\n    }\n\n    updateArgs(args: any) {\n        super.updateArgs(args);\n        this.brushSize = args.brushSize || 10;\n        this.brushColor = args.brushColor || defaultColors[0];\n        this.sync();\n    }\n\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.colorPicking) {\n            return;\n        }\n        if (event.button === 0) {\n            let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n                event.nativeEvent.offsetX,\n                event.nativeEvent.offsetY\n            );\n            this.renderer.drawPoint(\n                x,\n                y,\n                this.brushSize,\n                this.brushColor,\n                this.layer\n            );\n            this.isDrawing = true;\n            this.lastX = x;\n            this.lastY = y;\n            this.dirty = true;\n        } else if (event.button === 1) {\n            this.panning = true;\n        }\n        this.sync();\n    }\n\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void {\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        if (this.colorPicking) {\n            this.lastPickedColor = this.renderer.getPixel(x, y);\n        } else if (this.panning) {\n            this.zoomHelper.onPan(event);\n        } else {\n            if (this.isDrawing) {\n                this.renderer.drawLine(\n                    this.lastX,\n                    this.lastY,\n                    x,\n                    y,\n                    this.brushSize,\n                    this.brushColor,\n                    this.layer\n                );\n                this.dirty = true;\n            }\n        }\n        this.lastX = x;\n        this.lastY = y;\n        this.sync();\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void {\n        if (event.button === 0) {\n            this.isDrawing = false;\n            if (this.colorPicking) {\n                this.colorPicking = false;\n                this.brushColor = this.lastPickedColor;\n                if (this.colorPickedListener) {\n                    this.colorPickedListener(this.lastPickedColor);\n                }\n            }\n        } else if (event.button === 1) {\n            this.panning = false;\n        }\n        this.sync();\n    }\n\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n        this.sync();\n    }\n\n    cancel() {\n        // kind of a hack, clears the selection layer\n        this.renderer.setEditImage(null);\n        this.dirty = false;\n    }\n\n    confirm() {\n        this.renderer.commitSelection();\n        const encodedImage = this.renderer.getEncodedImage(null);\n        if (encodedImage && this.saveListener) {\n            this.saveListener(encodedImage);\n        }\n        this.dirty = false;\n    }\n\n    onSaveImage(listener: (encodedImage: string) => void): void {\n        this.saveListener = listener;\n    }\n\n    onDirty(listener: (dirty: boolean) => void): void {\n        this.dirtyListener = listener;\n    }\n\n    destroy(): boolean {\n        if (this.dirty) {\n            this.renderer.commitSelection();\n        }\n        return true;\n    }\n\n    beginColorpicker(): void {\n        this.colorPicking = true;\n        this.sync();\n    }\n\n    onColorPicked(listener: (color: string) => void): void {\n        this.colorPickedListener = listener;\n    }\n}\n\ninterface ControlsProps {\n    renderer: Renderer;\n    tool: PencilTool;\n    colors: string[];\n}\n\nconst MAX_PALETTE_SIZE = 30;\n\nfunction addToPalette(palette: string[], color: string): string[] {\n    if (palette.indexOf(color) === -1) {\n        // insert at the beginning\n        palette = [color, ...palette];\n    }\n    if (palette.length > MAX_PALETTE_SIZE) {\n        palette = palette.slice(0, MAX_PALETTE_SIZE);\n    }\n    return palette;\n}\n\nexport const Controls: FC<ControlsProps> = ({ renderer, tool, colors }) => {\n    const [brushSize, setBrushSize] = useState(10);\n    const [brushColor, setBrushColor] = useState(colors[0]);\n    const [palette, setPalette] = useState(colors);\n    const [dirty, setDirty] = useState(false);\n\n    tool.onDirty(setDirty);\n\n    useEffect(() => {\n        tool.updateArgs({\n            brushSize,\n            brushColor,\n            palette,\n        });\n    }, [brushSize, brushColor, palette]);\n\n    const onColorSelected = (color: string) => {\n        setBrushColor(color);\n        setPalette(addToPalette(palette, color));\n    };\n\n    tool.onColorPicked(onColorSelected);\n\n    return (\n        <div style={{ marginTop: \"16px\" }}>\n            <div className=\"form-group\">\n                <label style={{ width: \"100%\" }}>\n                    Brush size\n                    <small\n                        className=\"form-text text-muted\"\n                        style={{ float: \"right\" }}\n                    >\n                        {brushSize}px\n                    </small>\n                </label>\n                <input\n                    type=\"range\"\n                    className=\"form-control-range\"\n                    min=\"1\"\n                    max=\"100\"\n                    value={brushSize}\n                    onChange={(e) => setBrushSize(parseInt(e.target.value))}\n                />\n            </div>\n            <div\n                style={{\n                    display: \"flex\",\n                    flexDirection: \"row\",\n                    flexWrap: \"wrap\",\n                }}\n            >\n                {palette.map((color, i) => (\n                    <PaletteButton\n                        key={i}\n                        selectedColor={brushColor}\n                        color={color}\n                        onClick={(color) => setBrushColor(color)}\n                    />\n                ))}\n                {/* <div\n                    className=\"color-picker\"\n                    style={{ textAlign: \"center\", backgroundColor: \"#ccc\" }}\n                >\n                    <i className=\"fas fa-eye-dropper\" />\n                </div> */}\n                <button\n                    className=\"color-picker\"\n                    onClick={() => tool.beginColorpicker()}\n                >\n                    <i className=\"fas fa-eye-dropper\" />\n                </button>\n                <ColorPicker\n                    color={brushColor}\n                    onColorSelected={(color) => onColorSelected(color)}\n                />\n            </div>\n            <div\n                className=\"form-group\"\n                style={{\n                    marginTop: \"16px\",\n                    visibility: dirty ? \"visible\" : \"hidden\",\n                }}\n            >\n                <button\n                    className=\"btn btn-secondary\"\n                    onClick={() => tool.cancel()}\n                >\n                    Revert\n                </button>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => tool.confirm()}\n                    style={{ marginLeft: \"8px\" }}\n                >\n                    Save\n                </button>\n            </div>\n        </div>\n    );\n};\n","import React, { useState, useEffect } from \"react\";\nimport { Renderer } from \"./renderer\";\nimport { Cursor, Rect } from \"./models\";\nimport { Tool, BaseTool } from \"./tool\";\nimport { AspectRatioSelector } from \"../../components/AspectRatioSelector\";\nimport { getUpscaleLevel } from \"../../lib/upscale\";\nimport {\n    DEFAULT_ASPECT_RATIO,\n    aspectRatios,\n    getClosestAspectRatio,\n} from \"../../lib/aspecRatios\";\nimport { ZoomHelper } from \"./zoomHelper\";\nimport { runInThisContext } from \"vm\";\n\nexport class SelectionTool extends BaseTool implements Tool {\n    private selectionOverlay: Rect | undefined;\n    private selectionOverlayPreview: Rect | undefined;\n    private outpaint?: boolean;\n\n    // private selectionWidth: number = 512;\n    // private selectionHeight: number = 512;\n\n    private panning = false;\n\n    // TODO: size modifier to make the selection overlay smaller\n\n    constructor(renderer: Renderer) {\n        super(renderer, \"select\");\n    }\n\n    updateArgs(args: any) {\n        args = {\n            ...this.getArgs(),\n            ...args,\n        }\n        super.updateArgs(args);\n        this.selectionOverlay = args.selectionOverlay || {\n            x: 0,\n            y: 0,\n            width: 512,\n            height: 512,\n        };\n        this.outpaint = args.outpaint;\n        if (!this.outpaint) {\n            this.selectionOverlay = this.clamp(this.selectionOverlay!);\n        }\n        this.sync();\n    }\n\n    private clamp(rect: Rect): Rect {\n        const imageWidth = this.renderer.getWidth();\n        const imageHeight = this.renderer.getHeight();\n        let x = rect.x;\n        let y = rect.y;\n        let width = rect.width;\n        let height = rect.height;\n        // clamp to the canvas\n        x = Math.max(0, Math.min(x, imageWidth - this.selectionOverlay!.width));\n        y = Math.max(0, Math.min(y, imageHeight - rect.height));\n        x = Math.min(x, imageWidth - rect.width);\n        y = Math.min(y, imageHeight - rect.height);\n        width = Math.min(width, imageWidth);\n        height = Math.min(height, imageHeight);\n        return {\n            x: x,\n            y: y,\n            width: width,\n            height: height,\n        };\n    }\n\n    private sync(): void {\n        this.renderer.setSelectionOverlay(this.selectionOverlay);\n        this.renderer.setSelectionOverlayPreview(this.selectionOverlayPreview);\n    }\n\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (event.type == \"touch\") {\n            this.onMouseMove(event);\n        } else if (event.button === 0) {\n            this.selectionOverlay = this.selectionOverlayPreview;\n            this.selectionOverlayPreview = undefined;\n            this.sync();\n            this.updateArgs({\n                selectionOverlay: this.selectionOverlay,\n            });\n        } else if (event.button === 1) {\n            this.panning = true;\n        }\n    }\n\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        const imageWidth = this.renderer.getWidth();\n        const imageHeight = this.renderer.getHeight();\n        if (this.panning) {\n            this.zoomHelper.onPan(event);\n        } else {\n            let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n                event.nativeEvent.offsetX,\n                event.nativeEvent.offsetY\n            );\n\n            // round to the nearest 16 pixels\n            x = Math.round(x / 16) * 16;\n            y = Math.round(y / 16) * 16;\n            // offset by -256 to center the rect\n            x -= 256;\n            y -= 256;\n\n            this.selectionOverlayPreview = {\n                x: x,\n                y: y,\n                width: this.selectionOverlay!.width,\n                height: this.selectionOverlay!.height,\n            };\n\n            if (!this.outpaint) {\n                this.selectionOverlayPreview = this.clamp(this.selectionOverlayPreview);\n            }\n\n            \n            this.sync();\n        }\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (event.button === 0 && event.type == \"touch\") {\n            this.selectionOverlay = this.selectionOverlayPreview;\n            this.selectionOverlayPreview = undefined;\n            this.sync();\n            this.updateArgs({\n                selectionOverlay: this.selectionOverlay,\n            });\n        }\n        this.panning = false;\n    }\n\n    onMouseLeave(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        this.selectionOverlayPreview = undefined;\n        this.panning = false;\n        this.sync();\n    }\n\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n    }\n\n    destroy() {\n        // this.renderer.setSelectionOverlay(undefined);\n        this.renderer.setSelectionOverlayPreview(undefined);\n        return true;\n    }\n}\n\ninterface ControlsProps {\n    renderer: Renderer;\n    tool: Tool;\n    /** Lock aspect ratio for smaller images */\n    lockAspectRatio?: boolean;\n    outpaint?: boolean;\n}\n\nexport const Controls: React.FC<ControlsProps> = ({\n    renderer,\n    tool,\n    lockAspectRatio,\n    outpaint,\n}) => {\n    const upscaleLevel = getUpscaleLevel(\n        renderer.getWidth(),\n        renderer.getHeight()\n    );\n    const [aspectRatio, setAspectRatio] = useState(DEFAULT_ASPECT_RATIO);\n    const [size, setSize] = useState(1);\n\n    useEffect(() => {\n        const upscaleLevel = getUpscaleLevel(\n            renderer.getWidth(),\n            renderer.getHeight()\n        );\n        // lock aspect ratio to image\n        if (upscaleLevel === 0 && lockAspectRatio) {\n            const aspectRatio = getClosestAspectRatio(\n                renderer.getWidth(),\n                renderer.getHeight()\n            );\n            setAspectRatio(aspectRatio.id);\n            tool.updateArgs({\n                selectionOverlay: {\n                    x: 0,\n                    y: 0,\n                    width: aspectRatio.width,\n                    height: aspectRatio.height,\n                },\n                outpaint,\n            });\n        } else {\n            const args = tool.getArgs();\n            if (args.selectionOverlay) {\n                // restore args\n                const aspectRatio = getClosestAspectRatio(\n                    args.selectionOverlay.width,\n                    args.selectionOverlay.height\n                );\n                setAspectRatio(aspectRatio.id);\n                setSize(args.selectionOverlay.width / aspectRatio.width);\n                tool.updateArgs(args);\n            } else {\n                // set default args\n                args.selectionOverlay = {\n                    x: 0,\n                    y: 0,\n                    width: aspectRatios[aspectRatio].width,\n                    height: aspectRatios[aspectRatio].height,\n                };\n                args.outpaint = outpaint;\n                tool.updateArgs(args);\n            }\n        }\n    }, [tool]);\n\n    function onChange(aspectRatioId: number, size: number) {\n        const args = tool.getArgs();\n        const aspectRatio = aspectRatios[aspectRatioId];\n        if (args.selectionOverlay) {\n            const xDiff =\n                args.selectionOverlay.width - aspectRatio.width * size;\n            const yDiff =\n                args.selectionOverlay.height - aspectRatio.height * size;\n            args.selectionOverlay.width = Math.round(aspectRatio.width * size);\n            args.selectionOverlay.height = Math.round(\n                aspectRatio.height * size\n            );\n            args.selectionOverlay.x += xDiff / 2;\n            args.selectionOverlay.y += yDiff / 2;\n            if (!outpaint) {\n                // clamp to canvas\n                args.selectionOverlay.x = Math.round(\n                    Math.max(\n                        0,\n                        Math.min(\n                            args.selectionOverlay.x,\n                            renderer.getWidth() - args.selectionOverlay.width\n                        )\n                    )\n                );\n                args.selectionOverlay.y = Math.round(\n                    Math.max(\n                        0,\n                        Math.min(\n                            args.selectionOverlay.y,\n                            renderer.getHeight() - args.selectionOverlay.height\n                        )\n                    )\n                );\n            }\n        }\n        tool.updateArgs({\n            selectionOverlay: args.selectionOverlay,\n        });\n    }\n\n    return (\n        <>\n            {upscaleLevel > 0 && (\n                <AspectRatioSelector\n                    aspectRatio={aspectRatio}\n                    onChange={(aspectRatioId) => {\n                        onChange(aspectRatioId, size);\n                        setAspectRatio(aspectRatioId);\n                    }}\n                />\n            )}\n            <div className=\"form-group\">\n                <label htmlFor=\"size\" style={{ width: \"100%\" }}>\n                    Size\n                    <small\n                        className=\"form-text text-muted\"\n                        style={{ float: \"right\" }}\n                    >\n                        {Math.round(size * 100)}%\n                    </small>\n                </label>\n                {/* range from 0.1 to 1 */}\n                <input\n                    type=\"range\"\n                    className=\"form-control-range\"\n                    id=\"size\"\n                    min=\"1\"\n                    max=\"2\"\n                    step=\"0.1\"\n                    value={size}\n                    onChange={(event) => {\n                        onChange(aspectRatio, parseFloat(event.target.value));\n                        setSize(parseFloat(event.target.value));\n                    }}\n                />\n            </div>\n        </>\n    );\n};\n","import { aspectRatios } from \"./aspecRatios\";\n\nexport function getUpscaleLevel(width: number, height: number): number {\n    for (let i = 0; i < aspectRatios.length; i++) {\n        const aspectRatio = aspectRatios[i];\n        if (width * height <= aspectRatio.width * aspectRatio.height) {\n            return 0;\n        }\n        // if (width === aspectRatio.width && height === aspectRatio.height) {\n        //     return upscaleLevel;\n        // }\n    }\n    width /= 2;\n    height /= 2;\n    for (let i = 0; i < aspectRatios.length; i++) {\n        const aspectRatio = aspectRatios[i];\n        if (width * height <= aspectRatio.width * aspectRatio.height) {\n            return 1;\n        }\n        // if (width === aspectRatio.width && height === aspectRatio.height) {\n        //     return upscaleLevel;\n        // }\n    }\n    return 2;\n}\n"],"sourceRoot":""}