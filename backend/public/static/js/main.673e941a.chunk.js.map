{"version":3,"sources":["pages/image-editor/enhance-tool.tsx","lib/aspecRatios.ts","pages/image-editor/smudge-tool.tsx","pages/image-editor/inpaint-tool.tsx","pages/image-editor/PaletteButton.tsx","pages/image-editor/ColorPicker.tsx","pages/image-editor/pencil-tool.tsx","pages/image-editor/ImageEditor.tsx","pages/image-editor/renderer.ts","client/api.ts","client/base.ts","client/common.ts","pages/image-editor/import-export.tsx","pages/image-editor/zoomHelper.tsx","pages/image-editor/tool.ts","pages/Login.tsx","components/TokenRefresher.tsx","components/Healthchecker.tsx","pages/WorkerConfig.tsx","pages/admin/WorkerList.tsx","pages/admin/Admin.tsx","components/ImageThumbnail.tsx","pages/DeletedImages.tsx","components/ImagePopup.tsx","components/PendingImagesThumbnail.tsx","components/PendingImages.tsx","pages/Homepage.tsx","pages/admin/Orders.tsx","pages/DiscordLogin.tsx","App.tsx","config.ts","reportWebVitals.ts","index.tsx","components/ImagePrompt.tsx","lib/upscale.ts","lib/apisocket.ts","lib/imageutil.ts","pages/image-editor/selection-tool.tsx","components/BusyModal.tsx","lib/sleep.ts","components/AspectRatioSelector.tsx"],"names":["eraserWidthModifier","EnhanceTool","renderer","selectionTool","prompt","count","variationStrength","_dirty","_state","stateHandler","selectionControlsListener","imageData","selectedImageDataIndex","selectedImageData","panning","erasing","progressListener","errorListener","dirtyListener","SelectionTool","selectSupported","state","selectionArgs","getArgs","selectionOverlay","x","y","width","getWidth","height","getHeight","updateArgs","this","dirty","listener","handler","error","destroy","setCursor","undefined","outpaint","getUpscaleLevel","event","zoomHelper","translateMouseToCanvasCoordinates","nativeEvent","offsetX","offsetY","button","ImageData","data","slice","erasePoint","onMouseDown","getSelectionOverlay","baseWidth","Math","min","eraserRadius","floor","relX","relY","startX","max","startY","endX","endY","i","j","index","distance","sqrt","pow","alphaPct","alpha","setEditImage","featherWidth","color","radius","type","onPan","updateCursor","onMouseMove","onMouseUp","onMouseLeave","onWheel","args","api","imageId","baseImage","baseImageData","Promise","resolve","reject","getImageData","responseType","then","resp","base64ImageData","Buffer","from","toString","src","imageElement","Image","onload","canvas","document","createElement","ctx","getContext","drawImage","featherEdges","remove","Error","apisocket","image","a","notifyError","encodedImage","getEncodedImage","console","input","defaultArgs","label","encoded_image","parent","id","phrases","negative_phrases","stable_diffusion_strength","closestAspectRatio","getClosestAspectRatio","temporary","createImage","newImages","images","length","completed","lastUpdate","moment","onMessage","msg","img","JSON","parse","NOTIFICATION_IMAGE_UPDATED","status","ImageStatusEnum","Completed","loadImageData","startTime","lastCheck","completeCount","sleep","diff","pendingIds","filter","Pending","Processing","map","log","batchGetImages","ids","updatedImagesResult","updatedImages","byId","reduce","acc","updated","isAfter","sort","b","score","push","direction","saveListener","commitSelection","BaseTool","EnhanceControls","tool","useState","setCount","setDirty","setVariationStrength","setPrompt","setState","progress","setProgress","setError","onChangeState","onProgress","onError","onDirty","style","marginTop","className","role","aria-valuenow","aria-valuemin","aria-valuemax","round","marginBottom","marginLeft","data-dismiss","aria-label","onClick","aria-hidden","lockAspectRatio","htmlFor","value","onChange","e","target","step","parseInt","parseFloat","marginRight","cancel","confirm","erase","submit","when","message","DEFAULT_ASPECT_RATIO","aspectRatios","displayName","aspectRatio","tests","aRatio","bRatio","abs","compareSize","upscale","SmudgeTool","brushSize","brushOpacity","lastX","lastY","smudging","sync","smudgeLine","copyEditImageFromBaseImage","SmudgeControls","setBrushSize","setBrushOpacity","useEffect","float","visibility","InpaintTool","imageWidth","imageHeight","selectionWidth","render","alphaMask","applyAlphaMask","snapshot","undo","clearRedoStack","expandToOverlay","encodedMask","getEncodedMask","maskData","encoded_mask","model","window","InpaintControls","setoutpaint","checked","PaletteButton","selectedColor","backgroundColor","ColorPicker","onColorSelected","displayColorPicker","setDisplayColorPicker","tmpColor","setTmpColor","position","zIndex","top","right","bottom","left","hex","onChangeComplete","defaultColors","PencilTool","brushColor","palette","isDrawing","colorPicking","lastPickedColor","colorPickedListener","drawPoint","getPixel","drawLine","Controls","setBrushColor","setPalette","indexOf","addToPalette","onColorPicked","display","flexDirection","flexWrap","beginColorpicker","anonymousClient","axios","create","defaults","headers","common","ImageEditor","showSelectionControls","setShowSelectionControls","tools","name","iconClass","constructor","r","renderControls","t","onShowSelectionControls","setImage","setRenderer","setTool","canUndo","setCanUndo","canRedo","setCanRedo","busyMessage","setBusyMessage","useParams","history","useHistory","canvasRef","useRef","onSelectTool","toolconfig","newTool","onSaveImage","saveNewImage","CreateImageInputStatusEnum","nsfw","newImage","replace","renderTool","buttonClass","isSelected","charAt","toUpperCase","preventDefault","getImage","getImageDownloadUrls","download_urls","get","image_url","binaryImageData","current","createRenderer","setBaseImage","loadImage","onSnapshot","addEventListener","removeEventListener","fontSize","textAlign","cursor","paddingBottom","disabled","redo","verticalAlign","touchAction","userSelect","ref","onTouchStart","onTouchMove","onTouchEnd","select","transform","resetView","show","title","Renderer","undoStack","redoStack","currentSnapshot","backgroundLayer","baseImageLayer","editLayer","selectionOverlayPreview","hasSelection","zoom","snapshotListener","allowRedo","pop","clearRect","putImageData","notifySnapshotListener","shift","context","setTransform","drawOverlay","pattern","createPattern","createCheckeredPattern","fillStyle","fillRect","color1","color2","updateSelectionOverlay","initializeBackgroundLayer","setSelectionOverlay","maxWidth","updateZoomAndOffset","lineWidth","strokeStyle","strokeRect","beginPath","arc","PI","stroke","globalAlpha","fill","moveTo","lineTo","result","toDataURL","split","selection","imageDataToEncodedImage","erasure","mask","convertErasureToMask","brushx","brushy","absx","leftEdge","rightEdge","topEdge","bottomEdge","absy","contains","x1","y1","x2","y2","lineCap","unitVector","totalRed","totalGreen","totalBlue","averageRed","averageGreen","averageBlue","pixel","g","rgbToHex","minX","minY","newCanvas","AddMetricItemTypeEnum","CreateImageInputHeightEnum","CreateImageInputWidthEnum","CreateServiceAccountInputTypeEnum","HealthcheckStatusEnum","ImageWidthEnum","ImageHeightEnum","ImageUncropOffsetXEnum","ImageUncropOffsetYEnum","UpdateImageInputStatusEnum","UpsertWorkerInputStatusEnum","WorkerStatusEnum","BASE_PATH","BaseAPI","configuration","basePath","globalAxios","RequiredError","field","DUMMY_BASE_URL","assertParamExists","functionName","paramName","paramValue","setSearchParams","url","searchParams","URLSearchParams","search","objects","object","key","Array","isArray","delete","item","append","set","serializeDataIfNeeded","requestOptions","nonString","isJsonMime","stringify","toPathString","pathname","hash","createRequestFunction","axiosArgs","axiosRequestArgs","options","request","AIBrushApiFp","localVarAxiosParamCreator","addMetrics","addMetricsInput","localVarUrlObj","URL","baseOptions","localVarRequestOptions","method","localVarQueryParameter","localVarHeaderParameter","query","headersFromBaseOptions","batchGetImagesInput","createImageInput","createInviteCode","createOrder","createOrderInput","createServiceAccount","createServiceAccountInput","createWorker","upsertWorkerInput","deleteImage","localVarPath","encodeURIComponent","String","deleteWorker","workerId","discordLogin","generateWorkerLoginCode","getAssetsUrl","getFeatures","getImageUploadUrls","getMaskData","getNpyData","getOrders","getThumbnailData","getVideoData","getWorker","getWorkerConfig","getWorkers","healthcheck","isAdmin","listImages","limit","login","loginInput","loginAsWorker","workerLoginCode","processImage","processImageInput","refresh","refreshLoginInput","updateImage","updateImageInput","updateVideoData","body","updateWorker","updateWorkerConfig","upsertWorkerConfigInput","uploadImageData","verify","verifyLoginInput","AIBrushApiAxiosParamCreator","localVarAxiosArgs","AIBrushApi","ImportExportControls","backupImage","setBackupImage","files","byteString","atob","buffer","ArrayBuffer","intArray","Uint8Array","charCodeAt","blob","Blob","saveAs","onExport","ZoomHelper","startTouches","startZoom","startOffsetX","startOffsetY","originalZoom","getZoom","getOffsetX","getOffsetY","canvasPoint","deltaY","xDiff","yDiff","movementX","movementY","rect","getBoundingClientRect","touches","canvasRect","getCanvas","startTouch1","startTouch2","touch1","touch2","startDistance","clientX","clientY","startCenterX","startCenterY","centerX","centerY","startCanvasPoint","xDiff2","yDiff2","mouseX","mouseY","touchHandle","_pinchZooming","localStorage","getItem","setItem","clearTimeout","touch","identifier","pageX","pageY","screenX","screenY","setTimeout","process","Login","props","email","setEmail","emailSubmitted","setEmailSubmitted","code","setCode","err","setErr","location","inviteCode","qs","substring","onLogin","match","client","invite_code","onVerify","fontWeight","href","placeholder","aria-describedby","trim","host","protocol","redirectUri","discordLink","TokenRefresher","onCredentialsRefreshed","credentials","interval","setInterval","refreshToken","loginResult","clearInterval","Healthchecker","healthCheck","setHealthCheck","catch","WorkerConfigPage","Private","setType","setIsAdmin","download","creds","is_admin","WorkerList","workers","setWorkers","workerConfigs","setWorkerConfigs","workerConfigPromises","worker","all","configsByWorkerId","config","worker_id","onDeleteWorker","w","onGenerateCode","login_code","onCreateWorker","display_name","onRenameWorker","num_gpus","gpu_configs","gpu_num","Modal","onHide","Header","closeButton","Title","Body","Admin","links","setLinks","onGenerateLink","link","to","ImageThumbnail","assetsUrl","bulkDelete","updated_at","retry","setRetry","backgroundImage","readOnly","DeletedImages","setImages","loadImages","add","valueOf","deleted_at","onDeleteImage","onRestoreImage","goBack","borderBottom","paddingTop","ImagePopup","onClose","onDelete","onFork","onEdit","onUpscale","onNSFW","join","negative_score","showNSFW","setShowNSFW","onerror","upscaleLevel","size","maxHeight","alt","displayStatus","icon","statusBadge","Saved","toFixed","PendingImagesThumbnail","pendingCount","processingCount","hover","setHover","onMouseEnter","backgroundSize","margin","background","lineHeight","PendingImages","onCancel","imageIcon","pendingDiv","Footer","Homepage","apiSocket","creating","setCreating","selectedImage","setSelectedImage","parentImage","setParentImage","showPendingImages","setShowPendingImages","hasMore","setHasMore","setSearch","searchDebounce","setSearchDebounce","bulkDeleteSelecting","setBulkDeleteSelecting","bulkDeleting","setBulkDeleting","bulkDeleteIds","setBulkDeleteIds","handle","find","onSubmit","scrollTo","onEditNewImage","imageInput","imagesToAdd","sortImages","pollImages","latestCursor","findIndex","deletedIds","updatedImage","timerHandle","uniqueIds","Set","payload","NOTIFICATION_IMAGE_DELETED","isPendingOrProcessing","aScore","bScore","onLoadMore","minUpdatedAt","forEach","onThumbnailClicked","onConfirmBulkDelete","promises","Object","keys","completedOrSavedImages","pendingOrProcessingImages","pendingImages","processingImages","ImagePrompt","Dropdown","Toggle","variant","Menu","Item","dataLength","next","loader","res","BusyModal","Orders","orders","setOrders","gpuCount","setGpuCount","hours","setHours","onCreateOrder","gpu_count","scope","order","created_by","created_at","ends_at","is_active","amount_paid_cents","borderTop","Button","DiscordLogin","accessToken","apiUrl","httpClient","ApiSocket","updateHttpClient","App","setCredentials","setAssetsUrl","features","setFeatures","init","assets_url","storedCredentials","updateToken","connect","path","exact","removeItem","alert","privacy_uri","terms_uri","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById","iterations","encoded_npy","enable_video","enable_zoom","zoom_frequency","zoom_scale","zoom_shift_x","zoom_shift_y","glid_3_xl_clip_guidance","glid_3_xl_clip_guidance_scale","glid_3_xl_skip_iterations","negativePrompt","setNegativePrompt","setAspectRatio","parentId","setParentId","advancedView","setAdvancedView","setEncodedImage","defaultAspectRatio","aspectRatioDetails","setAspectRatioDetails","originalWidth","setOriginalWidth","originalHeight","setOriginalHeight","resetState","handleSubmit","bestMatch","onImageSelected","file","HTMLCanvasElement","base64","textDecoration","aspectRatioId","minHeight","messageListener","close","includes","WebSocket","onopen","send","onmessage","evt","onclose","featherLeftEdge","featherRightEdge","featherTopEdge","featherBottomEdge","pixelIndex","existingAlpha","alphaIndex","clamp","setSelectionOverlayPreview","setSize","children","backdrop","keyboard","ms","AspectRatioSelector","alignItems","border"],"mappings":"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","file":"static/js/main.673e941a.chunk.js","sourcesContent":["import React, { FC, useState, useEffect, useRef } from \"react\";\nimport { Prompt } from \"react-router\";\nimport { loadImageAsync } from \"../../lib/loadImage\";\n\nimport { sleep } from \"../../lib/sleep\";\nimport { defaultArgs } from \"../../components/ImagePrompt\";\nimport { Tool, BaseTool } from \"./tool\";\nimport { Renderer } from \"./renderer\";\nimport { Cursor, Rect } from \"./models\";\nimport {\n    AIBrushApi,\n    CreateImageInput,\n    Image as APIImage,\n    ImageList,\n    ImageStatusEnum,\n} from \"../../client\";\nimport { ZoomHelper } from \"./zoomHelper\";\nimport { getClosestAspectRatio } from \"../../lib/aspecRatios\";\nimport { featherEdges, fixRedShift } from \"../../lib/imageutil\";\nimport { SelectionTool, Controls as SelectionControls } from \"./selection-tool\";\nimport { getUpscaleLevel } from \"../../lib/upscale\";\nimport { ApiSocket, NOTIFICATION_IMAGE_UPDATED } from \"../../lib/apisocket\";\nimport moment from \"moment\";\n\ntype EnhanceToolState = \"select\" | \"default\" | \"busy\" | \"confirm\" | \"erase\";\n\n// eraser width modifier adds a solid core with a feather edge\n// equal to the what is used on enhanced selections\nconst eraserWidthModifier = 1.3;\n\ninterface ImageWithData extends APIImage {\n    data?: ImageData;\n}\n\nexport class EnhanceTool extends BaseTool implements Tool {\n    readonly selectionTool: SelectionTool;\n    private prompt: string = \"\";\n    private count: number = 4;\n    private variationStrength: number = 0.35;\n    private _dirty = false;\n\n    private _state: EnhanceToolState = \"default\";\n    private stateHandler: (state: EnhanceToolState) => void = () => {};\n    private selectionControlsListener: (show: boolean) => void = () => {};\n\n    private imageData: Array<ImageData> = [];\n    private selectedImageDataIndex: number = -1;\n    private selectedImageData: ImageData | null = null;\n    private panning = false;\n    private erasing = false;\n    private progressListener?: (progress: number) => void;\n    private errorListener?: (error: string | null) => void;\n    private dirtyListener?: (dirty: boolean) => void;\n\n    set dirty(dirty: boolean) {\n        this._dirty = dirty;\n        if (this.dirtyListener) {\n            this.dirtyListener(dirty);\n        }\n    }\n\n    get dirty() {\n        return this._dirty;\n    }\n\n    onDirty(listener: (dirty: boolean) => void): void {\n        this.dirtyListener = listener;\n    }\n\n    onError(handler: (error: string | null) => void) {\n        this.errorListener = handler;\n    }\n\n    private notifyError(error: string | null) {\n        if (this.errorListener) {\n            this.errorListener(error);\n        }\n    }\n\n    get state(): EnhanceToolState {\n        return this._state;\n    }\n\n    set state(state: EnhanceToolState) {\n        if (state !== this._state) {\n            if (this._state == \"select\") {\n                this.selectionTool.destroy();\n            }\n            if (this._state === \"erase\") {\n                this.renderer.setCursor(undefined);\n            }\n            this._state = state;\n            this.stateHandler(state);\n            if (state == \"confirm\") {\n                this.selectionControlsListener(true);\n            } else {\n                this.selectionControlsListener(false);\n                if (state == \"select\") {\n                    this.selectionTool.updateArgs({\n                        ...this.selectionTool.getArgs(),\n                        outpaint: false,\n                    });\n                }\n            }\n        }\n    }\n\n    selectSupported(): boolean {\n        return !(\n            getUpscaleLevel(\n                this.renderer.getWidth(),\n                this.renderer.getHeight()\n            ) === 0 && this.renderer.getWidth()\n        );\n    }\n\n    constructor(renderer: Renderer) {\n        super(renderer, \"enhance\");\n        this.selectionTool = new SelectionTool(renderer);\n        if (this.selectSupported()) {\n            this.state = \"select\";\n        } else {\n            this.state = \"default\";\n        }\n        let selectionArgs = this.selectionTool.getArgs();\n        if (!this.selectSupported()) {\n            selectionArgs = {\n                ...selectionArgs,\n                selectionOverlay: {\n                    x: 0,\n                    y: 0,\n                    width: this.renderer.getWidth(),\n                    height: this.renderer.getHeight(),\n                },\n            };\n        }\n        this.selectionTool.updateArgs(selectionArgs);\n    }\n\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseDown(event);\n            return;\n        }\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        if (event.button === 1) {\n            this.panning = true;\n            return;\n        }\n        if (this.state == \"erase\" && this.selectedImageData) {\n            this.erasing = true;\n            // clone selected ImageData\n            this.selectedImageData = new ImageData(\n                this.selectedImageData.data.slice(),\n                this.selectedImageData.width,\n                this.selectedImageData.height\n            );\n\n            this.erasePoint(x, y);\n        }\n    }\n\n    // TODO: on erase cancel and on erase confirm\n    // either restore the image data from the array\n    // or overwrite the array with the new image data\n\n    private erasePoint(x: number, y: number) {\n        const selectionOverlay = this.renderer.getSelectionOverlay()!;\n        const baseWidth = Math.min(\n            selectionOverlay.width,\n            selectionOverlay.height\n        );\n        const eraserRadius = Math.floor((baseWidth / 8) * eraserWidthModifier);\n\n        const relX = x - selectionOverlay.x;\n        const relY = y - selectionOverlay.y;\n        const imageData = this.selectedImageData!;\n\n        const startX = Math.max(0, relX - eraserRadius);\n        const startY = Math.max(0, relY - eraserRadius);\n        const endX = Math.min(imageData.width, relX + eraserRadius);\n        const endY = Math.min(imageData.height, relY + eraserRadius);\n\n        // relX=64.28541697636388, relY=64.24464312259761, startX=0.28541697636387653, startY=0.24464312259760845, endX=128.28541697636388, endY=128.2446431225976\n\n        for (let i = startX; i < endX; i++) {\n            for (let j = startY; j < endY; j++) {\n                const index = (j * imageData.width + i) * 4;\n                const distance = Math.sqrt(\n                    Math.pow(i - relX, 2) + Math.pow(j - relY, 2)\n                );\n                if (distance < eraserRadius) {\n                    // set alpha to a linear gradient from the center,\n                    // 100% in the middle and 0% at the edge\n                    const alphaPct =\n                        (distance / eraserRadius) * eraserWidthModifier -\n                        (eraserWidthModifier - 1);\n\n                    const alpha = Math.min(\n                        Math.floor(alphaPct * 255),\n                        imageData.data[index + 3]\n                    );\n                    imageData.data[index + 3] = alpha;\n                }\n            }\n        }\n        this.renderer.setEditImage(imageData);\n    }\n\n    private updateCursor(x: number, y: number) {\n        if (this.state == \"erase\" && this.selectedImageData) {\n            const selectionOverlay = this.renderer.getSelectionOverlay()!;\n            const baseWidth = Math.min(\n                selectionOverlay.width,\n                selectionOverlay.height\n            );\n            const featherWidth = Math.floor(baseWidth / 8);\n            this.renderer.setCursor({\n                color: \"white\",\n                radius: featherWidth * eraserWidthModifier,\n                type: \"circle\",\n                x,\n                y,\n            });\n        } else if (this.state == \"confirm\") {\n            this.renderer.setCursor({\n                color: \"white\",\n                radius: 10,\n                type: \"crosshairs\",\n                x,\n                y,\n            });\n        } else {\n            this.renderer.setCursor(undefined);\n        }\n    }\n\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseMove(event);\n            return;\n        }\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        if (this.panning) {\n            this.zoomHelper.onPan(event);\n        }\n\n        this.updateCursor(x, y);\n        if (this.erasing) {\n            this.erasePoint(x, y);\n        }\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseUp(event);\n        }\n        this.panning = false;\n        this.erasing = false;\n    }\n\n    onMouseLeave(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseLeave(event);\n        }\n        this.panning = false;\n        this.erasing = false;\n    }\n\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.offsetX,\n            event.offsetY\n        );\n        this.updateCursor(x, y);\n    }\n\n    updateArgs(args: any) {\n        this.prompt = args.prompt || \"\";\n        this.count = args.count || 4;\n        this.variationStrength = args.variationStrength || 0.75;\n    }\n\n    onChangeState(handler: (state: EnhanceToolState) => void) {\n        this.stateHandler = handler;\n    }\n\n    onShowSelectionControls(listener: (show: boolean) => void): void {\n        this.selectionControlsListener = listener;\n    }\n\n    onProgress(listener: (progress: number) => void): void {\n        this.progressListener = listener;\n    }\n\n    private loadImageData(\n        api: AIBrushApi,\n        imageId: string,\n        baseImage: APIImage,\n        baseImageData: ImageData,\n        selectionOverlay: Rect\n    ): Promise<ImageData> {\n        return new Promise((resolve, reject) => {\n            api.getImageData(imageId, {\n                responseType: \"arraybuffer\",\n            }).then((resp) => {\n                const binaryImageData = Buffer.from(resp.data, \"binary\");\n                const base64ImageData = binaryImageData.toString(\"base64\");\n                const src = `data:image/png;base64,${base64ImageData}`;\n                const imageElement = new Image();\n                imageElement.src = src;\n                imageElement.onload = () => {\n                    const canvas = document.createElement(\"canvas\");\n                    canvas.width = selectionOverlay.width;\n                    canvas.height = selectionOverlay.height;\n                    const ctx = canvas.getContext(\"2d\");\n                    if (!ctx) {\n                        reject(new Error(\"Failed to get canvas context\"));\n                        return;\n                    }\n                    ctx.drawImage(\n                        imageElement,\n                        0,\n                        0,\n                        selectionOverlay.width,\n                        selectionOverlay.height\n                    );\n                    const imageData = ctx.getImageData(\n                        0,\n                        0,\n                        selectionOverlay.width,\n                        selectionOverlay.height\n                    );\n                    featherEdges(\n                        selectionOverlay,\n                        baseImage.width!,\n                        baseImage.height!,\n                        imageData\n                    );\n                    resolve(imageData);\n                    // remove canvas\n                    canvas.remove();\n                };\n            });\n        });\n    }\n\n    cancel() {\n        if (this.state == \"erase\") {\n            this.state = \"confirm\";\n            this.selectedImageData =\n                this.imageData[this.selectedImageDataIndex];\n            this.renderer.setEditImage(this.selectedImageData);\n        } else {\n            if (this.selectSupported()) {\n                this.state = \"select\";\n            } else {\n                this.state = \"default\";\n            }\n            this.imageData = [];\n            this.renderer.setEditImage(null);\n            this.dirty = false;\n        }\n    }\n\n    erase() {\n        this.state = \"erase\";\n    }\n\n    async submit(api: AIBrushApi, apisocket: ApiSocket, image: APIImage) {\n        this.dirty = true;\n        this.notifyError(null);\n        const selectionOverlay = this.renderer.getSelectionOverlay();\n        const encodedImage = this.renderer.getEncodedImage(selectionOverlay!);\n        if (!encodedImage) {\n            console.error(\"No selection\");\n            return;\n        }\n        const baseImageData = this.renderer.getImageData(selectionOverlay!)!;\n        const input: CreateImageInput = defaultArgs();\n        input.label = \"\";\n        input.encoded_image = encodedImage;\n        input.parent = image.id;\n        input.phrases = [this.prompt || image.phrases[0]];\n        input.negative_phrases = image.negative_phrases;\n        input.stable_diffusion_strength = this.variationStrength;\n        input.count = this.count;\n\n        const closestAspectRatio = getClosestAspectRatio(\n            selectionOverlay!.width,\n            selectionOverlay!.height\n        );\n        input.width = closestAspectRatio.width;\n        input.height = closestAspectRatio.height;\n        input.temporary = true;\n\n        this.state = \"busy\";\n        let resp: ImageList | null = null;\n        try {\n            resp = (await api.createImage(input)).data;\n        } catch (err) {\n            console.error(\"Error creating images\", err);\n            this.notifyError(\"Failed to create image\");\n            this.state = \"default\";\n            return;\n        }\n        let newImages: Array<ImageWithData> | undefined = resp.images;\n        if (!newImages || newImages.length === 0) {\n            this.state = \"default\";\n            throw new Error(\"No images returned\");\n        }\n        let completed = false;\n\n        let lastUpdate = moment();\n\n        apisocket.onMessage(async (msg: string) => {\n            const img = JSON.parse(msg) as any;\n            if (\n                img.type === NOTIFICATION_IMAGE_UPDATED &&\n                img.status === ImageStatusEnum.Completed\n            ) {\n                lastUpdate = moment();\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (newImages![i].id === img.id) {\n                        const imageData = await this.loadImageData(\n                            api,\n                            newImages![i].id,\n                            image,\n                            baseImageData,\n                            selectionOverlay!\n                        );\n                        newImages![i].data = imageData;\n                        newImages![i].status = ImageStatusEnum.Completed;\n                    }\n                }\n            } else if (img.status == ImageStatusEnum.Error) {\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (newImages![i].id === img.id) {\n                        newImages![i].status = ImageStatusEnum.Error;\n                    }\n                }\n            }\n        });\n        try {\n            let startTime = moment();\n            let lastCheck = moment();\n            \n            while (!completed) {\n                let completeCount = 0;\n                await sleep(1000);\n                // poll for completion\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (\n                        newImages![i].status === ImageStatusEnum.Completed ||\n                        newImages![i].status === ImageStatusEnum.Error\n                    ) {\n                        completeCount++;\n                        continue;\n                    }\n                }\n                if (this.progressListener) {\n                    this.progressListener(completeCount / newImages!.length);\n                }\n                if (completeCount === newImages!.length) {\n                    completed = true;\n                }\n\n                // fallback if sockets don't catch one\n                if (moment().diff(lastCheck, \"seconds\") > 10) {\n                    // get list of ids that aren't completed and batch get them.\n                    const pendingIds = newImages\n                        .filter((img) => img.status === ImageStatusEnum.Pending || img.status === ImageStatusEnum.Processing)\n                        .map((img) => img.id);\n                    console.log(\"Checking pending images\", pendingIds);\n                    const updatedImagesResult = await api.batchGetImages({\n                        ids: pendingIds,\n                    });\n                    const updatedImages = updatedImagesResult.data.images;\n                    const byId = updatedImages!.reduce((acc, img) => {\n                        acc[img.id] = img;\n                        return acc;\n                    }, {} as Record<string, APIImage>);\n                    for (let i = 0; i < newImages!.length; i++) {\n                        if (newImages![i].status === ImageStatusEnum.Pending || newImages![i].status === ImageStatusEnum.Processing) {\n                            const updated = byId[newImages![i].id];\n                            if (updated) {\n                                newImages![i].status = updated.status;\n                                if (\n                                    updated.status === ImageStatusEnum.Completed\n                                ) {\n                                    lastUpdate = moment();\n                                    const imageData = await this.loadImageData(\n                                        api,\n                                        newImages![i].id,\n                                        image,\n                                        baseImageData,\n                                        selectionOverlay!\n                                    );\n                                    newImages![i].data = imageData;\n                                }\n                            }\n                        }\n                    }\n                    lastCheck = moment();\n                }\n                // timeout of 2 minutes\n                if ((lastUpdate.isAfter(startTime) && moment().diff(lastUpdate, \"seconds\") > 30) || moment().diff(startTime, \"minutes\") > 2) {\n                    completed = true;\n                }\n            }\n        } finally {\n            apisocket.onMessage(undefined);\n        }\n\n        // sort images by score descending\n        newImages!.sort((a, b) => {\n            return b.score - a.score;\n        });\n        newImages = newImages!.filter((img) => {\n            return img.status === ImageStatusEnum.Completed;\n        });\n\n        this.imageData = [];\n        for (let i = 0; i < newImages!.length; i++) {\n            if (newImages![i].data) {\n                this.imageData.push(newImages![i].data as ImageData);\n            }\n        }\n        if (this.imageData.length === 0) {\n            this.state = \"default\";\n            this.notifyError(\"No images returned\");\n            return;\n        }\n        this.renderer.setEditImage(this.imageData[0]);\n        this.selectedImageDataIndex = 0;\n        this.selectedImageData = this.imageData[0];\n        this.state = \"confirm\";\n    }\n\n    select(direction: \"left\" | \"right\") {\n        if (direction == \"left\") {\n            this.selectedImageDataIndex--;\n            if (this.selectedImageDataIndex < -1) {\n                this.selectedImageDataIndex = this.imageData.length - 1;\n            }\n        }\n        if (direction == \"right\") {\n            this.selectedImageDataIndex++;\n            if (this.selectedImageDataIndex >= this.imageData.length) {\n                this.selectedImageDataIndex = -1;\n            }\n        }\n        if (this.selectedImageDataIndex === -1) {\n            this.selectedImageData = null;\n        } else {\n            this.selectedImageData =\n                this.imageData[this.selectedImageDataIndex];\n        }\n        this.renderer.setEditImage(this.selectedImageData);\n    }\n\n    onSaveImage(listener: (encodedImage: string) => void): void {\n        this.saveListener = listener;\n    }\n\n    confirm() {\n        this.renderer.commitSelection();\n        this.state = \"default\";\n        this.imageData = [];\n        const encodedImage = this.renderer.getEncodedImage(null);\n        if (encodedImage && this.saveListener) {\n            this.saveListener(encodedImage);\n        }\n        this.dirty = false;\n    }\n\n    destroy(): boolean {\n        this.renderer.setCursor(undefined);\n        return true;\n    }\n}\n\ninterface ControlsProps {\n    api: AIBrushApi;\n    apisocket: ApiSocket;\n    image: APIImage;\n    renderer: Renderer;\n    tool: EnhanceTool;\n}\n\nexport const EnhanceControls: FC<ControlsProps> = ({\n    api,\n    apisocket,\n    image,\n    renderer,\n    tool,\n}) => {\n    const [count, setCount] = useState(4);\n    const [dirty, setDirty] = useState(false);\n    const [variationStrength, setVariationStrength] = useState(0.35);\n    const [prompt, setPrompt] = useState(image.phrases[0]);\n    const [state, setState] = useState<EnhanceToolState>(tool.state);\n    const [progress, setProgress] = useState(0);\n    const [error, setError] = useState<string | null>(null);\n\n    tool.onChangeState(setState);\n    tool.onProgress(setProgress);\n    tool.onError(setError);\n    tool.onDirty(setDirty);\n\n    if (state == \"busy\") {\n        return (\n            <div style={{ marginTop: \"16px\" }}>\n                <i className=\"fa fa-spinner fa-spin\"></i>&nbsp; Enhancing...\n                <br />\n                {/* bootstrap progress bar */}\n                <div\n                    className=\"progress\"\n                    style={{ height: \"20px\", marginTop: \"16px\" }}\n                >\n                    <div\n                        className=\"progress-bar\"\n                        role=\"progressbar\"\n                        style={{ width: `${progress * 100}%` }}\n                        aria-valuenow={progress * 100}\n                        aria-valuemin={0}\n                        aria-valuemax={100}\n                    >\n                        {Math.round(progress * 100)}%\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div\n            style={{\n                marginTop: \"16px\",\n                marginBottom: \"8px\",\n                marginLeft: \"16px\",\n            }}\n        >\n            {error && (\n                <div className=\"alert alert-danger\" role=\"alert\">\n                    {/* dismiss button */}\n                    <button\n                        type=\"button\"\n                        className=\"close\"\n                        data-dismiss=\"alert\"\n                        aria-label=\"Close\"\n                        onClick={() => setError(null)}\n                    >\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                    {error}\n                </div>\n            )}\n            {state === \"select\" && (\n                <>\n                    <p>\n                        {/* info icon */}\n                        <i className=\"fa fa-info-circle\"></i>&nbsp; Move the\n                        selection rectangle to the area that you want to enhance\n                    </p>\n                    <SelectionControls\n                        renderer={renderer}\n                        tool={tool.selectionTool}\n                        lockAspectRatio={true}\n                    />\n                </>\n            )}\n            {state === \"default\" && (\n                <>\n                    <p>\n                        {/* info icon */}\n                        <i className=\"fa fa-info-circle\"></i>&nbsp; Confirm the\n                        parameters below and continue\n                    </p>\n                    {/* prompt */}\n                    <div className=\"form-group\">\n                        <label htmlFor=\"prompt\">Prompt</label>\n                        <input\n                            type=\"text\"\n                            className=\"form-control\"\n                            id=\"prompt\"\n                            value={prompt}\n                            onChange={(e) => {\n                                setPrompt(e.target.value);\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            Customize the text prompt here\n                        </small>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"count\">Count: {count}</label>\n                        <input\n                            type=\"range\"\n                            className=\"form-control-range\"\n                            id=\"count\"\n                            min=\"1\"\n                            max=\"10\"\n                            step=\"1\"\n                            value={count}\n                            onChange={(e) => {\n                                setCount(parseInt(e.target.value));\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            Number of enhancement options\n                        </small>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"variation-strength\">\n                            Variation Strength:{\" \"}\n                            {Math.round(variationStrength * 100)}%\n                        </label>\n                        <input\n                            type=\"range\"\n                            className=\"form-control-range\"\n                            id=\"variation-strength\"\n                            min=\"0\"\n                            max=\"1\"\n                            step=\"0.05\"\n                            value={variationStrength}\n                            onChange={(e) => {\n                                setVariationStrength(\n                                    parseFloat(e.target.value)\n                                );\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            How much variation to use\n                        </small>\n                    </div>\n                </>\n            )}\n            {state === \"erase\" && (\n                <p>\n                    {/* info icon */}\n                    <i className=\"fa fa-info-circle\"></i>&nbsp; Erase any\n                    undesired sections before saving\n                </p>\n            )}\n\n            <div className=\"form-group\">\n                {state === \"select\" && (\n                    <button\n                        type=\"button\"\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => {\n                            tool.state = \"default\";\n                        }}\n                        style={{ marginRight: \"8px\" }}\n                    >\n                        {/* magic icon */}\n                        <i className=\"fa fa-magic\"></i>&nbsp; Continue\n                    </button>\n                )}\n                {((state === \"default\" && tool.selectSupported()) ||\n                    state === \"confirm\" ||\n                    state === \"erase\") && (\n                    <button\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => {\n                            tool.cancel();\n                        }}\n                        style={{ marginRight: \"8px\" }}\n                    >\n                        {/* cancel icon */}\n                        <i className=\"fa fa-times\"></i>&nbsp; Revert\n                    </button>\n                )}\n                {(state === \"confirm\" || state === \"erase\") && (\n                    <button\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => tool.confirm()}\n                        style={{ marginRight: \"8px\" }}\n                    >\n                        <i className=\"fa fa-save\"></i>&nbsp; Save\n                    </button>\n                )}\n                {state === \"confirm\" && (\n                    <>\n                        <button\n                            className=\"btn btn-primary btn-sm\"\n                            onClick={() => tool.erase()}\n                            style={{ marginRight: \"8px\" }}\n                        >\n                            <i className=\"fa fa-eraser\"></i>&nbsp; Erase\n                        </button>\n                    </>\n                )}\n                {state === \"default\" && (\n                    <button\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => {\n                            tool.updateArgs({\n                                count,\n                                variationStrength,\n                                prompt,\n                            });\n                            tool.submit(api, apisocket, image);\n                        }}\n                        style={{ marginRight: \"8px\" }}\n                    >\n                        <i className=\"fa fa-magic\"></i>&nbsp; Enhance\n                    </button>\n                )}\n            </div>\n            <Prompt\n                when={dirty}\n                message=\"Are you sure you want to leave? Your changes will be lost.\"\n            />\n        </div>\n    );\n};\n","export interface AspectRatio {\n    displayName: string;\n    width: number;\n    height: number;\n    id: number;\n}\n\nexport const DEFAULT_ASPECT_RATIO = 5;\n\nexport const aspectRatios: AspectRatio[] = [\n    {\n        displayName: \"4:1\",\n        width: 1024,\n        height: 256,\n        id: 0,\n    },\n    {\n        displayName: \"3:1\",\n        width: 768,\n        height: 256,\n        id: 1,\n    },\n    {\n        displayName: \"2:1\",\n        width: 640,\n        height: 320,\n        id: 2,\n    },\n    {\n        displayName: \"3:2\",\n        width: 576,\n        height: 384,\n        id: 3,\n    },\n    {\n        displayName: \"5:4\",\n        width: 640,\n        height: 512,\n        id: 4,\n    },\n    {\n        displayName: \"1:1\",\n        width: 512,\n        height: 512,\n        id: 5,\n    },\n    {\n        displayName: \"4:5\",\n        width: 512,\n        height: 640,\n        id: 6,\n    },\n    {\n        displayName: \"2:3\",\n        width: 384,\n        height: 576,\n        id: 7,\n    },\n    {\n        displayName: \"1:2\",\n        width: 320,\n        height: 640,\n        id: 8,\n    },\n    {\n        displayName: \"1:3\",\n        width: 256,\n        height: 768,\n        id: 9,\n    },\n    {\n        displayName: \"1:4\",\n        width: 256,\n        height: 1024,\n        id: 10,\n    }\n];\n\nexport function getClosestAspectRatio(width: number, height: number): AspectRatio {\n    const aspectRatio = width / height;\n\n    const tests = [...aspectRatios];\n    tests.sort((a, b) => {\n        const aRatio = a.width / a.height;\n        const bRatio = b.width / b.height;\n        return (\n            Math.abs(aRatio - aspectRatio) -\n            Math.abs(bRatio - aspectRatio)\n        );\n    });\n    const bestMatch = tests[0];\n    return bestMatch;\n}\n\nexport function compareSize(a: AspectRatio, width: number, height: number): number {\n    const area1 = a.width * a.height;\n    const area2 = width * height;\n    return area1 - area2;\n}\n\nexport function upscale(aspectRatio: AspectRatio): AspectRatio {\n    return {\n        displayName: aspectRatio.displayName,\n        width: aspectRatio.width * 2,\n        height: aspectRatio.height * 2,\n        id: aspectRatio.id,\n    }\n}\n\nexport function downscale(aspectRatio: AspectRatio): AspectRatio {\n    return {\n        displayName: aspectRatio.displayName,\n        width: aspectRatio.width / 2,\n        height: aspectRatio.height / 2,\n        id: aspectRatio.id,\n    }\n}\n","import React, { FC, useState, useEffect } from \"react\";\nimport { Renderer } from \"./renderer\";\nimport { BaseTool, Tool } from \"./tool\";\nimport { ZoomHelper } from \"./zoomHelper\";\n\nexport class SmudgeTool extends BaseTool implements Tool {\n    private brushSize = 10;\n    private brushOpacity = 0.2;\n\n    private lastX = 0;\n    private lastY = 0;\n    private panning = false;\n    private smudging = false;\n    private _dirty = false;\n\n    set dirty(dirty: boolean) {\n        this._dirty = dirty;\n        if (this.dirtyListener) {\n            this.dirtyListener(dirty);\n        }\n    }\n\n    get dirty() {\n        return this._dirty;\n    }\n\n    private dirtyListener?: (dirty: boolean) => void;\n\n    constructor(renderer: Renderer) {\n        super(renderer, \"smudge\");\n    }\n\n    private sync() {\n        this.renderer.setCursor({\n            type: \"circle\",\n            color: \"white\",\n            radius: this.brushSize / 2,\n            x: this.lastX,\n            y: this.lastY,\n        });\n    }\n\n    updateArgs(args: any) {\n        super.updateArgs(args);\n        this.brushSize = args.brushSize || 10;\n        this.brushOpacity = args.brushOpacity || 0.2;\n        this.sync();\n    }\n\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void {\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n\n        if (this.panning) {\n            this.zoomHelper.onPan(event);\n        } else if (this.smudging) {\n            this.renderer.smudgeLine(\n                this.lastX,\n                this.lastY,\n                x,\n                y,\n                this.brushSize,\n                this.brushOpacity\n            );\n            this.dirty = true;\n        }\n\n        this.lastX = x;\n        this.lastY = y;\n        this.sync();\n    }\n\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n        this.sync();\n    }\n\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (event.button === 0) {\n            this.smudging = true;\n            if (!this.dirty) {\n                this.renderer.copyEditImageFromBaseImage();\n            }\n            this.dirty = true;\n            let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n                event.nativeEvent.offsetX,\n                event.nativeEvent.offsetY\n            );\n            this.lastX = x;\n            this.lastY = y;\n            this.sync();\n        } else if (event.button === 1) {\n            this.panning = true;\n        }\n        this.sync();\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        this.smudging = false;\n        this.panning = false;\n        this.sync();\n    }\n\n    onSaveImage(listener: (encodedImage: string) => void): void {\n        this.saveListener = listener;\n    }\n\n    onDirty(listener: (dirty: boolean) => void): void {\n        this.dirtyListener = listener;\n    }\n\n    cancel() {\n        // kind of a hack, clears the selection layer\n        this.renderer.setEditImage(null);\n        this.dirty = false;\n    }\n\n    confirm() {\n        this.renderer.commitSelection();\n        const encodedImage = this.renderer.getEncodedImage(null);\n        if (encodedImage && this.saveListener) {\n            this.saveListener(encodedImage);\n        }\n        this.dirty = false;\n    }\n\n    destroy(): boolean {\n        if (this.dirty) {\n            this.renderer.commitSelection();\n        }\n        return true;\n    }\n}\n\ninterface Props {\n    renderer: Renderer;\n    tool: SmudgeTool;\n}\n\nexport const SmudgeControls: FC<Props> = ({ renderer, tool }) => {\n    const [brushSize, setBrushSize] = useState(10);\n    const [brushOpacity, setBrushOpacity] = useState(0.2);\n    const [dirty, setDirty] = useState(false);\n\n    tool.onDirty(setDirty);\n\n    useEffect(() => {\n        tool.updateArgs({\n            brushSize,\n            brushOpacity,\n        });\n    }, [brushSize, brushOpacity]);\n\n    return (\n        <div style={{ marginTop: \"16px\" }}>\n            <div className=\"form-group\">\n                <label style={{ width: \"100%\" }}>\n                    Brush size\n                    <small\n                        className=\"form-text text-muted\"\n                        style={{ float: \"right\" }}\n                    >\n                        {brushSize}px\n                    </small>\n                </label>\n                <input\n                    type=\"range\"\n                    className=\"form-control-range\"\n                    min=\"1\"\n                    max=\"100\"\n                    value={brushSize}\n                    onChange={(e) => setBrushSize(parseInt(e.target.value))}\n                />\n            </div>\n            <div className=\"form-group\">\n                <label style={{ width: \"100%\" }}>\n                    Brush opacity\n                    <small\n                        className=\"form-text text-muted\"\n                        style={{ float: \"right\" }}\n                    >\n                        {Math.round(brushOpacity * 100)}%\n                    </small>\n                </label>\n                <input\n                    type=\"range\"\n                    className=\"form-control-range\"\n                    min=\"0\"\n                    max=\"1\"\n                    step=\"0.01\"\n                    value={brushOpacity}\n                    onChange={(e) =>\n                        setBrushOpacity(parseFloat(e.target.value))\n                    }\n                />\n            </div>\n            <div\n                className=\"form-group\"\n                style={{\n                    marginTop: \"16px\",\n                    visibility: dirty ? \"visible\" : \"hidden\",\n                }}\n            >\n                <button\n                    className=\"btn btn-secondary\"\n                    onClick={() => tool.cancel()}\n                >\n                    Revert\n                </button>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => tool.confirm()}\n                    style={{ marginLeft: \"8px\" }}\n                >\n                    Save\n                </button>\n            </div>\n        </div>\n    );\n};\n","import React, { FC, useState, useEffect, useRef } from \"react\";\nimport { Prompt } from \"react-router\";\n\nimport { sleep } from \"../../lib/sleep\";\nimport { defaultArgs } from \"../../components/ImagePrompt\";\nimport { Tool, BaseTool } from \"./tool\";\nimport { Renderer } from \"./renderer\";\nimport { SelectionTool } from \"./selection-tool\";\nimport { Cursor, Rect } from \"./models\";\nimport {\n    AIBrushApi,\n    CreateImageInput,\n    Image as APIImage,\n    ImageList,\n    ImageStatusEnum,\n} from \"../../client\";\nimport { ZoomHelper } from \"./zoomHelper\";\nimport { getClosestAspectRatio } from \"../../lib/aspecRatios\";\nimport { getUpscaleLevel } from \"../../lib/upscale\";\nimport { applyAlphaMask, featherEdges } from \"../../lib/imageutil\";\nimport { ApiSocket, NOTIFICATION_IMAGE_UPDATED } from \"../../lib/apisocket\";\nimport moment from \"moment\";\n\ntype InpaintToolState =\n    | \"select\"\n    | \"erase\"\n    | \"inpaint\"\n    | \"busy\"\n    | \"confirm\"\n    | undefined;\n\ninterface ImageWithData extends APIImage {\n    data?: ImageData;\n}\n\nexport class InpaintTool extends BaseTool implements Tool {\n    private selectionTool: SelectionTool;\n    private prompt: string = \"\";\n    private count: number = 4;\n    private variationStrength: number = 0.35;\n    private brushSize: number = 10;\n    private _dirty = false;\n\n    private _state: InpaintToolState;\n    private stateHandler: (state: InpaintToolState) => void = () => {};\n    private selectionControlsListener: (show: boolean) => void = () => {};\n\n    private imageData: Array<ImageData> = [];\n    private selectedImageDataIndex: number = -1;\n    private selectedImageData: ImageData | null = null;\n    private panning = false;\n    private erasing = false;\n    private progressListener?: (progress: number) => void;\n    private errorListener?: (error: string | null) => void;\n    private dirtyListener?: (dirty: boolean) => void;\n\n    set dirty(dirty: boolean) {\n        this._dirty = dirty;\n        if (this.dirtyListener) {\n            this.dirtyListener(dirty);\n        }\n    }\n\n    get dirty() {\n        return this._dirty;\n    }\n\n    onError(handler: (error: string | null) => void) {\n        this.errorListener = handler;\n    }\n\n    private notifyError(error: string | null) {\n        if (this.errorListener) {\n            this.errorListener(error);\n        }\n    }\n\n    get state(): InpaintToolState {\n        return this._state;\n    }\n\n    set state(state: InpaintToolState) {\n        if (state != this._state) {\n            if (this._state == \"select\") {\n                this.selectionTool.destroy();\n            }\n            if (this._state === \"erase\") {\n                this.renderer.setCursor(undefined);\n            }\n            this._state = state;\n            this.stateHandler(state);\n\n            if (state == \"confirm\") {\n                this.selectionControlsListener(true);\n            } else {\n                this.selectionControlsListener(false);\n                if (state == \"select\") {\n                    const imageWidth = this.renderer.getWidth();\n                    const imageHeight = this.renderer.getHeight();\n                    const selectionWidth = Math.min(\n                        imageWidth,\n                        imageHeight,\n                        512\n                    );\n                    this.selectionTool.updateArgs({\n                        selectionOverlay: {\n                            x: 0,\n                            y: 0,\n                            width: selectionWidth,\n                            height: selectionWidth,\n                        },\n                    });\n                }\n            }\n        }\n    }\n\n    selectSupported(): boolean {\n        // return !(\n        //     this.renderer.getWidth() == this.renderer.getHeight() &&\n        //     getUpscaleLevel(\n        //         this.renderer.getWidth(),\n        //         this.renderer.getHeight()\n        //     ) === 0\n        // );\n        return true;\n    }\n\n    constructor(renderer: Renderer) {\n        super(renderer, \"inpaint\");\n        this.selectionTool = new SelectionTool(renderer);\n        if (this.selectSupported()) {\n            this.state = \"select\";\n            this.selectionTool.updateArgs({\n                outpaint: this.getArgs().outpaint,\n            });\n        } else {\n            this.state = \"erase\";\n        }\n    }\n\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseDown(event);\n            return;\n        }\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        if (event.button === 1) {\n            this.panning = true;\n            return;\n        }\n        if (this.state == \"erase\") {\n            this.erasing = true;\n            this.erasePoint(x, y);\n        }\n    }\n\n    private erasePoint(x: number, y: number) {\n        if (!this.dirty) {\n            this.dirty = true;\n        }\n        this.renderer.erasePoint(x, y, this.brushSize);\n        this.renderer.render();\n    }\n\n    private updateCursor(x: number, y: number) {\n        if (this.state == \"erase\") {\n            this.renderer.setCursor({\n                color: \"white\",\n                radius: this.brushSize / 2,\n                type: \"circle\",\n                x,\n                y,\n            });\n        } else if (this.state == \"confirm\") {\n            this.renderer.setCursor({\n                color: \"white\",\n                radius: 10,\n                type: \"crosshairs\",\n                x,\n                y,\n            });\n        } else {\n            this.renderer.setCursor(undefined);\n        }\n    }\n\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseMove(event);\n            return;\n        }\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        if (this.panning) {\n            this.zoomHelper.onPan(event);\n        }\n\n        this.updateCursor(x, y);\n        if (this.erasing) {\n            this.erasePoint(x, y);\n        }\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseUp(event);\n        }\n        this.panning = false;\n        this.erasing = false;\n    }\n\n    onMouseLeave(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void {\n        if (this.state == \"select\") {\n            this.selectionTool.onMouseLeave(event);\n        }\n        this.panning = false;\n        this.erasing = false;\n    }\n\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.offsetX,\n            event.offsetY\n        );\n        this.updateCursor(x, y);\n    }\n\n    updateArgs(args: any) {\n        args = {\n            ...this.getArgs(),\n            ...args,\n        };\n        super.updateArgs(args);\n        this.prompt = args.prompt || \"\";\n        this.count = args.count || 4;\n        this.variationStrength = args.variationStrength || 0.75;\n        this.brushSize = args.brushSize || 10;\n\n        this.updateCursor(\n            this.renderer.getWidth() / 2,\n            this.renderer.getHeight() / 2\n        );\n        this.selectionTool.updateArgs({\n            outpaint: args.outpaint,\n        });\n    }\n\n    onChangeState(handler: (state: InpaintToolState) => void) {\n        this.stateHandler = handler;\n    }\n\n    onShowSelectionControls(listener: (show: boolean) => void): void {\n        this.selectionControlsListener = listener;\n    }\n\n    onProgress(listener: (progress: number) => void): void {\n        this.progressListener = listener;\n    }\n\n    private loadImageData(\n        api: AIBrushApi,\n        imageId: string,\n        alphaMask: ImageData,\n        baseImage: APIImage,\n        selectionOverlay: Rect\n    ): Promise<ImageData> {\n        return new Promise((resolve, reject) => {\n            api.getImageData(imageId, {\n                responseType: \"arraybuffer\",\n            }).then((resp) => {\n                const binaryImageData = Buffer.from(resp.data, \"binary\");\n                const base64ImageData = binaryImageData.toString(\"base64\");\n                const src = `data:image/png;base64,${base64ImageData}`;\n                const imageElement = new Image();\n                imageElement.src = src;\n                imageElement.onload = () => {\n                    const canvas = document.createElement(\"canvas\");\n                    canvas.width = selectionOverlay.width;\n                    canvas.height = selectionOverlay.height;\n                    const ctx = canvas.getContext(\"2d\");\n                    if (!ctx) {\n                        reject(new Error(\"Failed to get canvas context\"));\n                        return;\n                    }\n                    ctx.drawImage(\n                        imageElement,\n                        0,\n                        0,\n                        selectionOverlay.width,\n                        selectionOverlay.height\n                    );\n                    const imageData = ctx.getImageData(\n                        0,\n                        0,\n                        selectionOverlay.width,\n                        selectionOverlay.height\n                    );\n\n                    applyAlphaMask(imageData, alphaMask);\n\n                    featherEdges(\n                        selectionOverlay,\n                        this.renderer.getWidth(),\n                        this.renderer.getHeight(),\n                        imageData,\n                        10\n                    );\n\n                    resolve(imageData);\n                    // remove canvas\n                    canvas.remove();\n                };\n            });\n        });\n    }\n\n    cancel() {\n        if (this.selectSupported()) {\n            this.state = \"select\";\n        } else {\n            this.state = \"erase\";\n        }\n        this.renderer.snapshot();\n        this.renderer.undo();\n        this.renderer.clearRedoStack();\n        this.imageData = [];\n        this.renderer.setEditImage(null);\n        this.dirty = false;\n    }\n\n    async submit(api: AIBrushApi, apisocket: ApiSocket, image: APIImage) {\n        this.notifyError(null);\n        let selectionOverlay = this.renderer.getSelectionOverlay();\n        if (!selectionOverlay) {\n            console.error(\"No selection\");\n            return;\n        }\n\n        if (this.getArgs().outpaint) {\n            // check if selection overlay is out of renderer bounds (width, height)\n            if (\n                selectionOverlay.x < 0 ||\n                selectionOverlay.y < 0 ||\n                selectionOverlay.x + selectionOverlay.width >\n                    this.renderer.getWidth() ||\n                selectionOverlay.y + selectionOverlay.height >\n                    this.renderer.getHeight()\n            ) {\n                this.renderer.expandToOverlay();\n                selectionOverlay = this.renderer.getSelectionOverlay()!;\n            }\n        }\n\n        // get the erased area, then undo the erase to get the original image\n        const encodedMask = this.renderer.getEncodedMask(selectionOverlay);\n        const maskData = this.renderer.getImageData(selectionOverlay);\n        // hack to restore the image\n        this.renderer.snapshot();\n        this.renderer.undo();\n        this.renderer.clearRedoStack();\n\n        const encodedImage = this.renderer.getEncodedImage(selectionOverlay);\n\n        const input: CreateImageInput = defaultArgs();\n        input.label = \"\";\n        input.encoded_image = encodedImage;\n        input.encoded_mask = encodedMask;\n        input.parent = image.id;\n        input.phrases = [this.prompt || image.phrases[0]];\n        input.negative_phrases = image.negative_phrases;\n        input.stable_diffusion_strength = this.variationStrength;\n        input.count = this.count;\n        input.model = \"stable_diffusion_inpainting\";\n\n        const closestAspectRatio = getClosestAspectRatio(\n            selectionOverlay!.width,\n            selectionOverlay!.height\n        );\n        input.width = closestAspectRatio.width;\n        input.height = closestAspectRatio.height;\n        input.temporary = true;\n\n        this.state = \"busy\";\n        let resp: ImageList | null = null;\n        try {\n            resp = (await api.createImage(input)).data;\n        } catch (err) {\n            console.error(\"Error creating images\", err);\n            this.notifyError(\"Failed to create image\");\n            this.state = \"select\";\n            return;\n        }\n        let newImages: Array<ImageWithData> | undefined = resp.images;\n        if (!newImages || newImages.length === 0) {\n            this.state = \"select\";\n            throw new Error(\"No images returned\");\n        }\n        let completed = false;\n        let lastUpdate = moment();\n\n        apisocket.onMessage(async (msg: string) => {\n            console.log(\"inpaint onMessage\", msg);\n            const img = JSON.parse(msg) as any;\n            if (\n                img.type === NOTIFICATION_IMAGE_UPDATED &&\n                img.status === ImageStatusEnum.Completed\n            ) {\n                lastUpdate = moment();\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (newImages![i].id === img.id) {\n                        const imageData = await this.loadImageData(\n                            api,\n                            newImages![i].id,\n                            maskData!,\n                            image,\n                            selectionOverlay!\n                        );\n                        newImages![i].data = imageData;\n                        newImages![i].status = ImageStatusEnum.Completed;\n                    }\n                }\n            } else if (img.status === ImageStatusEnum.Error) {\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (newImages![i].id === img.id) {\n                        newImages![i].status = ImageStatusEnum.Error;\n                    }\n                }\n            }\n        });\n        try {\n            let startTime = moment();\n            let lastCheck = moment();\n            while (!completed) {\n                let completeCount = 0;\n                await sleep(100);\n                // poll for completion\n                for (let i = 0; i < newImages!.length; i++) {\n                    if (\n                        newImages![i].status === ImageStatusEnum.Completed ||\n                        newImages![i].status === ImageStatusEnum.Error\n                    ) {\n                        completeCount++;\n                        continue;\n                    }\n                }\n                if (this.progressListener) {\n                    this.progressListener(completeCount / newImages!.length);\n                }\n                if (completeCount === newImages!.length) {\n                    completed = true;\n                    continue;\n                }\n\n                // fallback if sockets don't catch one\n                if (moment().diff(lastCheck, \"seconds\") > 10) {\n                    // get list of ids that aren't completed and batch get them.\n                    const pendingIds = newImages\n                        .filter((img) => img.status === ImageStatusEnum.Pending || img.status === ImageStatusEnum.Processing)\n                        .map((img) => img.id);\n                    console.log(\"Checking pending images\", pendingIds);\n                    const updatedImagesResult = await api.batchGetImages({\n                        ids: pendingIds,\n                    });\n                    const updatedImages = updatedImagesResult.data.images;\n                    const byId = updatedImages!.reduce((acc, img) => {\n                        acc[img.id] = img;\n                        return acc;\n                    }, {} as Record<string, APIImage>);\n                    for (let i = 0; i < newImages!.length; i++) {\n                        if (newImages![i].status === ImageStatusEnum.Pending || newImages![i].status === ImageStatusEnum.Processing) {\n                            const updated = byId[newImages![i].id];\n                            if (updated) {\n                                newImages![i].status = updated.status;\n                                if (\n                                    updated.status === ImageStatusEnum.Completed\n                                ) {\n                                    lastUpdate = moment();\n                                    const imageData = await this.loadImageData(\n                                        api,\n                                        newImages![i].id,\n                                        maskData!,\n                                        image,\n                                        selectionOverlay!\n                                    );\n                                    newImages![i].data = imageData;\n                                }\n                            }\n                        }\n                    }\n                    lastCheck = moment();\n                }\n                // timeout of 2 minutes\n                if ((lastUpdate.isAfter(startTime) && moment().diff(lastUpdate, \"seconds\") > 30) ||  moment().diff(startTime, \"minutes\") > 2) {\n                    completed = true;\n                }\n            }\n        } finally {\n            apisocket.onMessage(undefined);\n        }\n\n        // sort images by score descending\n        newImages!.sort((a, b) => {\n            return b.score - a.score;\n        });\n        newImages = newImages!.filter((img) => {\n            return img.status === ImageStatusEnum.Completed;\n        });\n\n        this.imageData = [];\n        for (let i = 0; i < newImages!.length; i++) {\n            if (newImages![i].data) {\n                this.imageData.push(newImages![i].data as ImageData);\n            }\n        }\n        if (this.imageData.length === 0) {\n            this.state = \"select\";\n            this.notifyError(\"No images returned\");\n            return;\n        }\n        this.renderer.setEditImage(this.imageData[0]);\n        this.selectedImageDataIndex = 0;\n        this.selectedImageData = this.imageData[0];\n        this.state = \"confirm\";\n    }\n\n    onDirty(listener: (dirty: boolean) => void): void {\n        this.dirtyListener = listener;\n    }\n\n    select(direction: \"left\" | \"right\") {\n        if (direction == \"left\") {\n            this.selectedImageDataIndex--;\n            if (this.selectedImageDataIndex < -1) {\n                this.selectedImageDataIndex = this.imageData.length - 1;\n            }\n        }\n        if (direction == \"right\") {\n            this.selectedImageDataIndex++;\n            if (this.selectedImageDataIndex >= this.imageData.length) {\n                this.selectedImageDataIndex = -1;\n            }\n        }\n        if (this.selectedImageDataIndex === -1) {\n            this.selectedImageData = null;\n        } else {\n            this.selectedImageData =\n                this.imageData[this.selectedImageDataIndex];\n        }\n        this.renderer.setEditImage(this.selectedImageData);\n    }\n\n    onSaveImage(listener: (encodedImage: string) => void): void {\n        this.saveListener = listener;\n    }\n\n    confirm() {\n        this.renderer.commitSelection();\n        if (this.selectSupported()) {\n            this.state = \"select\";\n        } else {\n            this.state = \"erase\";\n        }\n\n        this.imageData = [];\n        const encodedImage = this.renderer.getEncodedImage(null);\n        if (encodedImage && this.saveListener) {\n            this.saveListener(encodedImage);\n        }\n        this.dirty = false;\n    }\n\n    destroy(): boolean {\n        if (this.dirty) {\n            if (!window.confirm(\"Discard changes?\")) {\n                return false;\n            }\n        }\n        this.renderer.setCursor(undefined);\n        this.renderer.setEditImage(null);\n        return true;\n    }\n}\n\ninterface ControlsProps {\n    api: AIBrushApi;\n    apisocket: ApiSocket;\n    image: APIImage;\n    renderer: Renderer;\n    tool: InpaintTool;\n}\n\nexport const InpaintControls: FC<ControlsProps> = ({\n    api,\n    apisocket,\n    image,\n    renderer,\n    tool,\n}) => {\n    const [count, setCount] = useState(4);\n    const [prompt, setPrompt] = useState(image.phrases[0]);\n    const [state, setState] = useState<InpaintToolState>(tool.state);\n    const [progress, setProgress] = useState(0);\n    const [error, setError] = useState<string | null>(null);\n    const [brushSize, setBrushSize] = useState(10);\n    const [dirty, setDirty] = useState(false);\n    const [outpaint, setoutpaint] = useState<boolean | undefined>(\n        tool.getArgs().outpaint\n    );\n\n    useEffect(() => {\n        tool.updateArgs({\n            brushSize,\n        });\n    }, [brushSize]);\n\n    tool.onChangeState(setState);\n    tool.onProgress(setProgress);\n    tool.onError(setError);\n    tool.onDirty(setDirty);\n\n    if (state == \"busy\") {\n        return (\n            <div style={{ marginTop: \"16px\" }}>\n                <i className=\"fa fa-spinner fa-spin\"></i>&nbsp; Inpainting...\n                <br />\n                {/* bootstrap progress bar */}\n                <div\n                    className=\"progress\"\n                    style={{ height: \"20px\", marginTop: \"16px\" }}\n                >\n                    <div\n                        className=\"progress-bar\"\n                        role=\"progressbar\"\n                        style={{ width: `${progress * 100}%` }}\n                        aria-valuenow={progress * 100}\n                        aria-valuemin={0}\n                        aria-valuemax={100}\n                    >\n                        {Math.round(progress * 100)}%\n                    </div>\n                </div>\n            </div>\n        );\n    }\n    return (\n        <div\n            style={{\n                marginTop: \"16px\",\n                marginBottom: \"8px\",\n                marginLeft: \"16px\",\n            }}\n        >\n            {error && (\n                <div className=\"alert alert-danger\" role=\"alert\">\n                    {/* dismiss button */}\n                    <button\n                        type=\"button\"\n                        className=\"close\"\n                        data-dismiss=\"alert\"\n                        aria-label=\"Close\"\n                        onClick={() => setError(null)}\n                    >\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                    {error}\n                </div>\n            )}\n            {state === \"select\" && (\n                <>\n                    <p>\n                        {/* info icon */}\n                        <i className=\"fa fa-info-circle\"></i>&nbsp; Move the\n                        selection rectangle to the area that you want to\n                        inpaint. For outpainting, try zooming out.\n                    </p>\n                    <div className=\"form-group\">\n                        {/* allow outpaint checkbox */}\n                        <div className=\"form-check\">\n                            <input\n                                className=\"form-check-input\"\n                                type=\"checkbox\"\n                                id=\"allowoutpaint\"\n                                checked={!!outpaint}\n                                onChange={(e) => {\n                                    setoutpaint(e.target.checked);\n                                    tool.updateArgs({\n                                        outpaint: e.target.checked,\n                                    });\n                                }}\n                            />\n                            <label\n                                className=\"form-check-label\"\n                                htmlFor=\"allowoutpaint\"\n                            >\n                                Allow outpainting\n                            </label>\n                        </div>\n                    </div>\n                </>\n            )}\n\n            {state === \"erase\" && (\n                <>\n                    <p>\n                        {/* info icon */}\n                        <i className=\"fa fa-info-circle\"></i>&nbsp; Erase the\n                        area that you want to inpaint.\n                    </p>\n                    <div className=\"form-group\">\n                        <label style={{ width: \"100%\" }}>\n                            Brush size\n                            <small\n                                className=\"form-text text-muted\"\n                                style={{ float: \"right\" }}\n                            >\n                                {brushSize}px\n                            </small>\n                        </label>\n                        <input\n                            type=\"range\"\n                            className=\"form-control-range\"\n                            min=\"1\"\n                            max=\"100\"\n                            value={brushSize}\n                            onChange={(e) =>\n                                setBrushSize(parseInt(e.target.value))\n                            }\n                        />\n                    </div>\n                </>\n            )}\n\n            {state === \"inpaint\" && (\n                <>\n                    <p>\n                        {/* info icon */}\n                        <i className=\"fa fa-info-circle\"></i>&nbsp; Confirm the\n                        parameters below and continue\n                    </p>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"prompt\">Prompt</label>\n                        <input\n                            type=\"text\"\n                            className=\"form-control\"\n                            id=\"prompt\"\n                            value={prompt}\n                            onChange={(e) => {\n                                setPrompt(e.target.value);\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            Customize the text prompt here\n                        </small>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"count\">Count: {count}</label>\n                        <input\n                            type=\"range\"\n                            className=\"form-control-range\"\n                            id=\"count\"\n                            min=\"1\"\n                            max=\"10\"\n                            step=\"1\"\n                            value={count}\n                            onChange={(e) => {\n                                setCount(parseInt(e.target.value));\n                            }}\n                        />\n                        <small className=\"form-text text-muted\">\n                            Number of inpaint options\n                        </small>\n                    </div>\n                </>\n            )}\n\n            {state === \"confirm\" && (\n                <>\n                    <p>\n                        Use the <i className=\"fa fa-arrow-left\"></i> and{\" \"}\n                        <i className=\"fa fa-arrow-right\"></i> buttons to\n                        navigate between the inpaint options\n                    </p>\n                </>\n            )}\n\n            <div className=\"form-group\">\n                {(dirty ||\n                    state === \"confirm\" ||\n                    (state == \"erase\" && tool.selectSupported()) ||\n                    state == \"inpaint\") && (\n                    <button\n                        style={{ marginRight: \"8px\" }}\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => {\n                            tool.cancel();\n                        }}\n                    >\n                        {/* cancel icon */}\n                        <i className=\"fa fa-times\"></i>&nbsp; Revert\n                    </button>\n                )}\n\n                {state === \"confirm\" && (\n                    <>\n                        <button\n                            className=\"btn btn-primary btn-sm\"\n                            onClick={() => tool.confirm()}\n                            style={{ marginRight: \"8px\" }}\n                        >\n                            {/* save icon */}\n                            <i className=\"fa fa-save\"></i>&nbsp; Save\n                        </button>\n                    </>\n                )}\n                {state == \"select\" && (\n                    <button\n                        style={{ marginRight: \"8px\" }}\n                        type=\"button\"\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => (tool.state = \"erase\")}\n                    >\n                        <i className=\"fa fa-eraser\"></i>&nbsp; Continue\n                    </button>\n                )}\n                {state == \"erase\" && (\n                    <button\n                        style={{ marginRight: \"8px\" }}\n                        type=\"button\"\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => (tool.state = \"inpaint\")}\n                    >\n                        <i className=\"fa fa-paint-brush\"></i>&nbsp; Continue\n                    </button>\n                )}\n                {state === \"inpaint\" && (\n                    <button\n                        style={{ marginRight: \"8px\" }}\n                        className=\"btn btn-primary btn-sm\"\n                        onClick={() => {\n                            tool.updateArgs({\n                                count,\n                                prompt,\n                            });\n                            tool.submit(api, apisocket, image);\n                        }}\n                    >\n                        {/* paint icon */}\n                        <i className=\"fa fa-paint-brush\"></i>&nbsp; Inpaint\n                    </button>\n                )}\n            </div>\n            <Prompt\n                when={dirty}\n                message=\"Are you sure you want to leave? Your changes will be lost.\"\n            />\n        </div>\n    );\n};\n","import React, { FC, useState, useEffect } from \"react\";\n\ninterface Props {\n    selectedColor: string;\n    color: string;\n    onClick: (color: string) => void;\n}\n\nexport const PaletteButton: FC<Props> = ({ selectedColor, color, onClick }) => {\n    let className = \"palette-button\";\n    if (selectedColor === color) {\n        className += \" selected\";\n    } else if (color == \"#000000\") {\n        className += \" black\";\n    }\n    return (\n        <div\n            className={className}\n            style={{ backgroundColor: color }}\n            onClick={() => onClick(color)}\n        ></div>\n    );\n};\n","import React, { FC, useState, useEffect } from \"react\";\nimport { ChromePicker } from \"react-color\";\n\n// class ButtonExample extends React.Component {\n//   state = {\n//     displayColorPicker: false,\n//   };\n\n//   handleClick = () => {\n//     this.setState({ displayColorPicker: !this.state.displayColorPicker })\n//   };\n\n//   handleClose = () => {\n//     this.setState({ displayColorPicker: false })\n//   };\n\n//   render() {\n//     const popover = {\n//       position: 'absolute',\n//       zIndex: '2',\n//     }\n//     const cover = {\n//       position: 'fixed',\n//       top: '0px',\n//       right: '0px',\n//       bottom: '0px',\n//       left: '0px',\n//     }\n//     return (\n//       <div>\n//         <button onClick={ this.handleClick }>Pick Color</button>\n//         { this.state.displayColorPicker ? <div style={ popover }>\n//           <div style={ cover } onClick={ this.handleClose }/>\n//           <ChromePicker />\n//         </div> : null }\n//       </div>\n//     )\n//   }\n// }\n\ninterface Props {\n    color: string;\n    onColorSelected: (color: string) => void;\n}\n\nexport const ColorPicker: FC<Props> = ({ color, onColorSelected }) => {\n    const [displayColorPicker, setDisplayColorPicker] = useState(false);\n    const [tmpColor, setTmpColor] = useState(color);\n\n    const handleClick = () => {\n        setDisplayColorPicker(!displayColorPicker);\n        if (displayColorPicker) {\n            onColorSelected(tmpColor);\n        }\n    };\n\n    const handleClose = () => {\n        setDisplayColorPicker(false);\n        if (displayColorPicker) {\n            onColorSelected(tmpColor);\n        }\n    };\n\n    const popover: React.CSSProperties = {\n        position: \"absolute\",\n        zIndex: 2,\n    };\n    const cover: React.CSSProperties = {\n        position: \"fixed\",\n        top: \"0px\",\n        right: \"0px\",\n        bottom: \"0px\",\n        left: \"0px\",\n    };\n\n    return (\n        <>\n            <button className=\"color-picker\" onClick={handleClick}>\n                <i className=\"fas fa-plus\" />\n            </button>\n            {displayColorPicker ? (\n                <div style={popover}>\n                    <div style={cover} onClick={handleClose} />\n                    <ChromePicker\n                        color={tmpColor}\n                        onChange={(color) => setTmpColor(color.hex)}\n                        onChangeComplete={(color) => setTmpColor(color.hex)}\n                    />\n                </div>\n            ) : null}\n        </>\n    );\n};\n","import React, { FC, useEffect, useState } from \"react\";\nimport { ChromePicker } from \"react-color\";\n\nimport { Renderer } from \"./renderer\";\nimport { BaseTool, Tool } from \"./tool\";\nimport { ZoomHelper } from \"./zoomHelper\";\nimport { PaletteButton } from \"./PaletteButton\";\nimport { ColorPicker } from \"./ColorPicker\";\n\nconst defaultColors = [\n    \"#FFFFFF\",\n    \"#5A2C02\",\n    \"#386EB6\",\n    \"#6B31A1\",\n    \"#CB2C26\",\n    \"#000000\",\n    \"#888888\",\n    \"#50B050\",\n    \"#FBDB37\",\n    \"#E88D2D\",\n];\n\nexport class PencilTool extends BaseTool implements Tool {\n    private brushSize = 10;\n    private brushColor = defaultColors[0];\n    private palette: string[] = [...defaultColors];\n\n    private panning = false;\n    private isDrawing = false;\n    private lastX = 0;\n    private lastY = 0;\n    private colorPicking = false;\n    private lastPickedColor = \"#000000\";\n    private _dirty = false;\n\n    set dirty(dirty: boolean) {\n        this._dirty = dirty;\n        if (this.dirtyListener) {\n            this.dirtyListener(dirty);\n        }\n    }\n\n    get dirty() {\n        return this._dirty;\n    }\n\n\n    private dirtyListener?: (dirty: boolean) => void;\n    private colorPickedListener?: (color: string) => void;\n\n    constructor(renderer: Renderer) {\n        super(renderer, \"pencil\");\n    }\n\n    private sync() {\n        if (this.colorPicking) {\n            this.renderer.setCursor({\n                x: this.lastX,\n                y: this.lastY,\n                radius: this.renderer.getWidth() / 20,\n                color: this.lastPickedColor,\n                type: \"colorpicker\",\n            })\n        } else {\n            this.renderer.setCursor({\n                x: this.lastX,\n                y: this.lastY,\n                radius: this.brushSize / 2,\n                color: this.brushColor,\n                type: \"circle-fill\",\n            });\n        }\n        \n    }\n\n    updateArgs(args: any) {\n        super.updateArgs(args);\n        this.brushSize = args.brushSize || 10;\n        this.brushColor = args.brushColor || defaultColors[0];\n        this.palette = args.palette || [...defaultColors];\n        this.sync();\n    }\n\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (this.colorPicking) {\n            return;\n        }\n        if (event.button === 0) {\n            let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n                event.nativeEvent.offsetX,\n                event.nativeEvent.offsetY\n            );\n            this.renderer.drawPoint(x, y, this.brushSize, this.brushColor);\n            this.isDrawing = true;\n            this.lastX = x;\n            this.lastY = y;\n            this.dirty = true;\n        } else if (event.button === 1) {\n            this.panning = true;\n        }\n        this.sync();\n    }\n\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void {\n        let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n            event.nativeEvent.offsetX,\n            event.nativeEvent.offsetY\n        );\n        if (this.colorPicking) {\n            this.lastPickedColor = this.renderer.getPixel(x, y);\n        } else if (this.panning) {\n            this.zoomHelper.onPan(event);\n        } else {\n            if (this.isDrawing) {\n                this.renderer.drawLine(\n                    this.lastX,\n                    this.lastY,\n                    x,\n                    y,\n                    this.brushSize,\n                    this.brushColor\n                );\n                this.dirty = true;\n            }\n        }\n        this.lastX = x;\n        this.lastY = y;\n        this.sync();\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void {\n        if (event.button === 0) {\n            this.isDrawing = false;\n            if (this.colorPicking) {\n                this.colorPicking = false;\n                this.brushColor = this.lastPickedColor;\n                if (this.colorPickedListener) {\n                    this.colorPickedListener(this.lastPickedColor);\n                }\n            }\n        } else if (event.button === 1) {\n            this.panning = false;\n        }\n        this.sync();\n    }\n\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n        this.sync();\n    }\n\n    cancel() {\n        // kind of a hack, clears the selection layer\n        this.renderer.setEditImage(null);\n        this.dirty = false;\n    }\n\n    confirm() {\n        this.renderer.commitSelection();\n        const encodedImage = this.renderer.getEncodedImage(null);\n        if (encodedImage && this.saveListener) {\n            this.saveListener(encodedImage);\n        }\n        this.dirty = false;\n    }\n\n    onSaveImage(listener: (encodedImage: string) => void): void {\n        this.saveListener = listener;\n    }\n\n    onDirty(listener: (dirty: boolean) => void): void {\n        this.dirtyListener = listener;\n    }\n\n    destroy(): boolean {\n        if (this.dirty) {\n            this.renderer.commitSelection();\n        }\n        return true;\n    }\n\n    beginColorpicker(): void {\n        this.colorPicking = true;\n        this.sync();\n    }\n\n    onColorPicked(listener: (color: string) => void): void {\n        this.colorPickedListener = listener;\n    }\n}\n\ninterface ControlsProps {\n    renderer: Renderer;\n    tool: PencilTool;\n}\n\nconst MAX_PALETTE_SIZE = 30;\n\nfunction addToPalette(palette: string[], color: string): string[] {\n    if (palette.indexOf(color) === -1) {\n        // insert at the beginning\n        palette = [color, ...palette];\n    }\n    if (palette.length > MAX_PALETTE_SIZE) {\n        palette = palette.slice(0, MAX_PALETTE_SIZE);\n    }\n    return palette;\n}\n\nexport const Controls: FC<ControlsProps> = ({ renderer, tool }) => {\n    const [brushSize, setBrushSize] = useState(10);\n    const [brushColor, setBrushColor] = useState(defaultColors[0]);\n    const [palette, setPalette] = useState(defaultColors);\n    const [dirty, setDirty] = useState(false);\n\n    tool.onDirty(setDirty);\n\n    useEffect(() => {\n        tool.updateArgs({\n            brushSize,\n            brushColor,\n            palette,\n        });\n    }, [brushSize, brushColor, palette]);\n\n    const onColorSelected = (color: string) => {\n        setBrushColor(color);\n        setPalette(addToPalette(palette, color));\n    };\n\n    tool.onColorPicked(onColorSelected);\n\n    return (\n        <div style={{ marginTop: \"16px\" }}>\n            <div className=\"form-group\">\n                <label style={{width: \"100%\"}}>\n                    Brush size\n                    <small className=\"form-text text-muted\" style={{float: \"right\"}}>\n                        {brushSize}px\n                    </small>\n                </label>\n                <input\n                    type=\"range\"\n                    className=\"form-control-range\"\n                    min=\"1\"\n                    max=\"100\"\n                    value={brushSize}\n                    onChange={(e) => setBrushSize(parseInt(e.target.value))}\n                />\n            </div>\n            <div\n                style={{\n                    display: \"flex\",\n                    flexDirection: \"row\",\n                    flexWrap: \"wrap\",\n                }}\n            >\n                {palette.map((color, i) => (\n                    <PaletteButton\n                        key={i}\n                        selectedColor={brushColor}\n                        color={color}\n                        onClick={(color) => setBrushColor(color)}\n                    />\n                ))}\n                {/* <div\n                    className=\"color-picker\"\n                    style={{ textAlign: \"center\", backgroundColor: \"#ccc\" }}\n                >\n                    <i className=\"fas fa-eye-dropper\" />\n                </div> */}\n                <button\n                    className=\"color-picker\"\n                    onClick={() => tool.beginColorpicker()}\n                >\n                    <i className=\"fas fa-eye-dropper\" />\n                </button>\n                <ColorPicker\n                    color={brushColor}\n                    onColorSelected={(color) => onColorSelected(color)}\n                />\n            </div>\n            <div className=\"form-group\" style={{\n                marginTop: \"16px\",\n                visibility: dirty ? \"visible\" : \"hidden\",\n            }}>\n                <button\n                    className=\"btn btn-secondary\"\n                    onClick={() => tool.cancel()}\n                >\n                    Revert\n                </button>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => tool.confirm()}\n                    style={{ marginLeft: \"8px\" }}\n                >\n                    Save\n                </button>\n            </div>\n        </div>\n    );\n};\n\n// TODO list:\n// reset to initial colors\n// color picker\n// eyedropper\n// color history\n\n// zoom/pan\n// actual drawing\n// undo/redo\n// save\n// revert\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport axios, { AxiosInstance } from \"axios\";\n\nimport {\n    AIBrushApi,\n    CreateImageInputStatusEnum,\n    Image as APIImage,\n} from \"../../client\";\nimport { getUpscaleLevel } from \"../../lib/upscale\";\nimport \"./ImageEditor.css\";\nimport { createRenderer, Renderer } from \"./renderer\";\nimport { Tool, BaseTool } from \"./tool\";\nimport { SelectionTool, Controls as SelectionControls } from \"./selection-tool\";\nimport { EnhanceTool, EnhanceControls } from \"./enhance-tool\";\nimport { PencilTool, Controls as PencilControls } from \"./pencil-tool\";\nimport { SmudgeTool, SmudgeControls } from \"./smudge-tool\";\nimport { ImportExportControls } from \"./import-export\";\nimport { InpaintControls, InpaintTool } from \"./inpaint-tool\";\nimport { defaultArgs } from \"../../components/ImagePrompt\";\nimport { ApiSocket } from \"../../lib/apisocket\";\nimport { createEncodedThumbnail } from \"../../lib/imageutil\";\nimport { BusyModal } from \"../../components/BusyModal\";\n\ninterface CanPreventDefault {\n    preventDefault: () => void;\n}\n\ninterface Props {\n    api: AIBrushApi;\n    apisocket: ApiSocket;\n    assetsUrl: string;\n}\n\ninterface ToolConfig {\n    name: string;\n    iconClass: string;\n    constructor: (r: Renderer) => Tool;\n    renderControls: (t: Tool, renderer: Renderer) => JSX.Element;\n    defaultArgs: any;\n}\n\nexport const anonymousClient = axios.create();\ndelete anonymousClient.defaults.headers.common[\"Authorization\"];\n\nexport const ImageEditor: React.FC<Props> = ({ api, apisocket }) => {\n    const [showSelectionControls, setShowSelectionControls] = useState(false);\n    const tools: Array<ToolConfig> = [\n        {\n            name: \"inpaint\",\n            iconClass: \"fas fa-paint-brush\",\n            constructor: (r: Renderer) => new InpaintTool(r),\n            defaultArgs: {},\n            renderControls: (t: Tool, renderer: Renderer) => {\n                t.onShowSelectionControls(setShowSelectionControls);\n                return (\n                    <InpaintControls\n                        tool={t as InpaintTool}\n                        renderer={renderer}\n                        api={api}\n                        apisocket={apisocket}\n                        image={image!}\n                    />\n                );\n            },\n        },\n        {\n            name: \"enhance\",\n            iconClass: \"fas fa-magic\",\n            constructor: (r: Renderer) => new EnhanceTool(r),\n            defaultArgs: {\n                variationStrength: 0.75,\n            },\n            renderControls: (t: Tool, renderer: Renderer) => {\n                t.onShowSelectionControls(setShowSelectionControls);\n                return (\n                    <EnhanceControls\n                        tool={t as EnhanceTool}\n                        renderer={renderer}\n                        api={api}\n                        apisocket={apisocket}\n                        image={image!}\n                    />\n                );\n            },\n        },\n        {\n            name: \"pencil\",\n            iconClass: \"fas fa-pencil-alt\",\n            constructor: (r: Renderer) => new PencilTool(r),\n            defaultArgs: {},\n            renderControls: (t: Tool, renderer: Renderer) => {\n                return (\n                    <PencilControls\n                        tool={t as PencilTool}\n                        renderer={renderer}\n                    />\n                );\n            },\n        },\n        {\n            name: \"smudge\",\n            // finger icon\n            iconClass: \"fas fa-hand-pointer\",\n            constructor: (r: Renderer) => new SmudgeTool(r),\n            defaultArgs: {},\n            renderControls: (t: Tool, renderer: Renderer) => {\n                return (\n                    <SmudgeControls\n                        tool={t as SmudgeTool}\n                        renderer={renderer}\n                    />\n                );\n            },\n        },\n        {\n            name: \"import-export\",\n            iconClass: \"fas fa-file-import\",\n            constructor: (r: Renderer) => new BaseTool(r, \"import-export\"),\n            defaultArgs: {},\n            renderControls: (t: Tool, renderer: Renderer) => {\n                return (\n                    <ImportExportControls\n                        renderer={renderer}\n                        tool={t as BaseTool}\n                        api={api}\n                    />\n                );\n            },\n        },\n    ];\n\n    const [image, setImage] = useState<APIImage | null>(null);\n    const [renderer, setRenderer] = useState<Renderer | null>(null);\n    const [tool, setTool] = useState<Tool | null>(null);\n    const [canUndo, setCanUndo] = useState(false);\n    const [canRedo, setCanRedo] = useState(false);\n    const [busyMessage, setBusyMessage] = useState<string | null>(null);\n\n    const { id } = useParams<{ id: string }>();\n    const history = useHistory();\n\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n\n    const onSelectTool = (toolconfig: ToolConfig) => {\n        if (renderer) {\n            if (tool) {\n                if (!tool.destroy()) {\n                    return;\n                }\n            }\n            const newTool = toolconfig.constructor(renderer);\n            setTool(newTool);\n            newTool.onSaveImage((encodedImage) => {\n                console.log(\"Saving image...\");\n                saveNewImage(encodedImage);\n            });\n        }\n    };\n\n    const saveNewImage = async (encodedImage: string) => {\n        if (!image || !encodedImage) {\n            throw new Error(\"Cannot save new image without existing image\");\n        }\n        setBusyMessage(\"Saving image...\");\n        const args = defaultArgs();\n        args.phrases = image.phrases;\n        args.negative_phrases = image.negative_phrases;\n        args.count = 1;\n        args.parent = image.id;\n        args.stable_diffusion_strength = image.stable_diffusion_strength;\n        args.status = CreateImageInputStatusEnum.Completed;\n        args.width = renderer!.getWidth() as any;\n        args.height = renderer!.getHeight() as any;\n        args.nsfw = image.nsfw;\n        args.encoded_image = encodedImage;\n        const newImage = (await api.createImage(args)).data!.images![0];\n        setImage(newImage);\n        // history.push(`/image-editor/${newImage.id}`);\n        history.replace(`/image-editor/${newImage.id}`);\n        setBusyMessage(null);\n    };\n\n    useEffect(() => {\n        if (image) {\n            return;\n        }\n\n        async function loadImage() {\n            const image = (await api.getImage(id)).data;\n            setImage(image);\n            const download_urls = await api.getImageDownloadUrls(id);\n            // Loading up data as binary, base64 encoding into image url\n            // bypasses browser security nonsense about cross-domain images\n            const resp = await anonymousClient.get(\n                download_urls.data.image_url!,\n                {\n                    responseType: \"arraybuffer\",\n                }\n            );\n            const binaryImageData = Buffer.from(resp.data, \"binary\");\n            const base64ImageData = binaryImageData.toString(\"base64\");\n            const src = `data:image/png;base64,${base64ImageData}`;\n            const imageElement = new Image();\n            imageElement.src = src;\n            imageElement.onload = () => {\n                if (!canvasRef.current) {\n                    console.error(\"Failed to get canvas\");\n                    return;\n                }\n                const renderer = createRenderer(canvasRef.current);\n                renderer.setBaseImage(imageElement);\n                setRenderer(renderer);\n            };\n        }\n        loadImage();\n    }, [image, id]);\n\n    useEffect(() => {\n        if (renderer) {\n            onSelectTool(tools[0]);\n            renderer.onSnapshot(() => {\n                setCanUndo(renderer.canUndo());\n                setCanRedo(renderer.canRedo());\n            });\n        }\n    }, [renderer]);\n\n    useEffect(() => {\n        if (canvasRef.current) {\n            const listener = (e: WheelEvent) => {\n                if (tool) {\n                    e.preventDefault();\n                    tool.onWheel(e);\n                }\n            };\n            canvasRef.current.addEventListener(\"wheel\", listener);\n            return () => {\n                canvasRef.current?.removeEventListener(\"wheel\", listener);\n            };\n        }\n    }, [tool, canvasRef.current]);\n\n    function renderTool(t: ToolConfig) {\n        let buttonClass = `btn btn-secondary light-button image-editor-tool-button`;\n        const isSelected = tool && tool.name == t.name;\n        if (isSelected) {\n            buttonClass = `btn btn-primary image-editor-tool-button`;\n        }\n        return (\n            <div className=\"form-group\" key={t.name}>\n                <button className={buttonClass} onClick={() => onSelectTool(t)}>\n                    <i className={t.iconClass}></i>\n                </button>\n                {/* capitalize tool name */}\n                <label>\n                    {t.name.charAt(0).toUpperCase() + t.name.slice(1)}\n                </label>\n                {isSelected && t.renderControls(tool!, renderer!)}\n            </div>\n        );\n    }\n\n    function preventDefault(e: CanPreventDefault): boolean {\n        e.preventDefault();\n        return true;\n    }\n\n    return (\n        <>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <h1 style={{ fontSize: \"40px\", textAlign: \"left\" }}>\n                        <i\n                            style={{ cursor: \"pointer\" }}\n                            onClick={() => history.push(`/images/${id}`)}\n                            className=\"fas fa-chevron-left\"\n                        ></i>\n                        &nbsp; AI Edit\n                    </h1>\n                </div>\n            </div>\n            <div className=\"row\" style={{ marginTop: \"32px\", paddingBottom: \"120px\" }}>\n                <div className=\"col-lg-3\">\n                    {renderer && (\n                        <>\n                            {tools.map((tool) => renderTool(tool))}\n                            {(canRedo || canUndo) && (\n                                <div className=\"form-group\">\n                                    <div className=\"btn-group\">\n                                        <button\n                                            className=\"btn btn-primary image-popup-button\"\n                                            disabled={!renderer || !canUndo}\n                                            onClick={() =>\n                                                renderer && renderer.undo()\n                                            }\n                                        >\n                                            {/* undo */}\n                                            <i className=\"fas fa-undo\"></i>\n                                        </button>\n                                        <button\n                                            className=\"btn btn-primary image-popup-button\"\n                                            disabled={!renderer || !canRedo}\n                                            onClick={() =>\n                                                renderer && renderer.redo()\n                                            }\n                                        >\n                                            <i className=\"fas fa-redo\"></i>\n                                        </button>\n                                    </div>\n                                </div>\n                            )}\n                        </>\n                    )}\n                </div>\n                <div className=\"col-lg-9\">\n                    <div style={{ verticalAlign: \"middle\" }}>\n                        <div>\n                            <canvas\n                                style={{\n                                    cursor: \"none\",\n                                    touchAction: \"none\",\n                                    userSelect: \"none\",\n                                }}\n                                ref={canvasRef}\n                                className=\"image-editor-canvas\"\n                                onMouseDown={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onMouseDown(e)\n                                }\n                                onMouseMove={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onMouseMove(e)\n                                }\n                                onMouseUp={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onMouseUp(e)\n                                }\n                                onMouseLeave={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    tool.onMouseLeave(e)\n                                }\n                                onTouchStart={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    // (() => {\n\n                                    //     const rect = canvasRef.current!.getBoundingClientRect();\n                                    //     const touch = e.touches[0];\n                                    //     if (touch) {\n                                    //         tool.onMouseDown({\n                                    //             type: \"touch\",\n                                    //             button: 0,\n                                    //             nativeEvent: {\n                                    //                 offsetX: touch.clientX - rect.left,\n                                    //                 offsetY: touch.clientY - rect.top,\n                                    //             }\n                                    //         } as any);\n                                    //     }\n                                    // })()\n                                    tool.onTouchStart(e)\n                                }\n                                onTouchMove={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    // (() => {\n                                    //     const rect = canvasRef.current!.getBoundingClientRect();\n                                    //     const touch = e.touches[0];\n                                    //     if (touch) {\n                                    //         tool.onMouseMove({\n                                    //             nativeEvent: {\n                                    //                 offsetX: touch.clientX - rect.left,\n                                    //                 offsetY: touch.clientY - rect.top,\n                                    //             }\n                                    //         } as any);\n                                    //     }\n                                    // })()\n                                    tool.onTouchMove(e)\n                                }\n                                onTouchEnd={(e) =>\n                                    preventDefault(e) &&\n                                    tool &&\n                                    // tool.onMouseUp({\n                                    //     button: 0\n                                    // } as any)\n                                    tool.onTouchEnd(e)\n                                }\n                            ></canvas>\n                            {showSelectionControls && (\n                                <>\n                                    <button\n                                        className=\"btn btn-secondary canvas-select-left\"\n                                        onClick={() => tool!.select(\"left\")}\n                                    >\n                                        <i className=\"fas fa-chevron-left\"></i>\n                                    </button>\n                                    <button\n                                        className=\"btn btn-secondary canvas-select-right\"\n                                        onClick={() => tool!.select(\"right\")}\n                                    >\n                                        <i className=\"fas fa-chevron-right\"></i>\n                                    </button>\n                                </>\n                            )}\n                        </div>\n                    </div>\n                    <div className=\"row\">\n                        <button\n                            className=\"btn btn-primary\"\n                            // center horizontally\n                            style={{\n                                position: \"absolute\",\n                                left: \"50%\",\n                                transform: \"translate(-50%, 0)\",\n                            }}\n                            onClick={() => {\n                                if (renderer) {\n                                    renderer.resetView();\n                                }\n                            }}\n                        >\n                            {/* reset zoom */}\n                            <i className=\"fas fa-search-plus\"></i>&nbsp; Reset\n                            View\n                        </button>\n                        {/* redo */}\n                    </div>\n                    {/* vertically center button within the div */}\n                </div>\n            </div>\n            {busyMessage && <BusyModal show={true} title=\"Please Wait\">{busyMessage}</BusyModal>}\n        </>\n    );\n};\n","import { Cursor, Rect } from \"./models\";\n\nconst maxSnapshots = 10;\n\nexport class Renderer {\n    private undoStack: ImageData[] = [];\n    private redoStack: ImageData[] = [];\n    private currentSnapshot: ImageData | undefined;\n\n    private backgroundLayer: HTMLCanvasElement;\n    private baseImageLayer: HTMLCanvasElement;\n    private editLayer: HTMLCanvasElement;\n    // private overlayLayer: HTMLCanvasElement;\n\n    private selectionOverlay: Rect | undefined;\n    private selectionOverlayPreview: Rect | undefined;\n    private hasSelection: boolean = false;\n    private cursor: Cursor | undefined;\n\n    private zoom: number;\n    private offsetX: number;\n    private offsetY: number;\n    private width = 0;\n    private height = 0;\n\n    private snapshotListener: (() => void) | null = null;\n\n    constructor(private readonly canvas: HTMLCanvasElement) {\n        canvas.width = 512;\n        canvas.height = 512;\n        // invisible canvas elements\n        this.backgroundLayer = document.createElement(\"canvas\");\n        this.backgroundLayer.width = 512;\n        this.backgroundLayer.height = 512;\n        this.baseImageLayer = document.createElement(\"canvas\");\n        this.editLayer = document.createElement(\"canvas\");\n        // this.overlayLayer = document.createElement(\"canvas\");\n\n        this.zoom = 1;\n        this.offsetX = 0;\n        this.offsetY = 0;\n    }\n\n    undo(allowRedo: boolean = true) {\n        if (this.undoStack.length > 0 && this.currentSnapshot) {\n            const imageData = this.undoStack.pop()!;\n            if (allowRedo) {\n                this.redoStack.push(this.currentSnapshot);\n            }\n            this.currentSnapshot = imageData;\n            // set as base image\n            const ctx = this.baseImageLayer.getContext(\"2d\");\n            if (ctx) {\n                ctx.clearRect(\n                    0,\n                    0,\n                    this.baseImageLayer.width,\n                    this.baseImageLayer.height\n                );\n                ctx.putImageData(imageData, 0, 0);\n                this.render();\n            }\n            this.notifySnapshotListener();\n        }\n    }\n\n    redo() {\n        if (this.redoStack.length > 0 && this.currentSnapshot) {\n            this.undoStack.push(this.currentSnapshot);\n            const imageData = this.redoStack.pop()!;\n            this.currentSnapshot = imageData;\n\n            // set as base image\n            const ctx = this.baseImageLayer.getContext(\"2d\");\n            if (ctx) {\n                ctx.putImageData(imageData, 0, 0);\n                this.render();\n            }\n            this.notifySnapshotListener();\n        }\n    }\n\n    clearRedoStack() {\n        this.redoStack = [];\n        this.notifySnapshotListener();\n    }\n\n    canUndo(): boolean {\n        return !this.hasSelection && this.undoStack.length > 0;\n    }\n\n    canRedo(): boolean {\n        return !this.hasSelection && this.redoStack.length > 0;\n    }\n\n    onSnapshot(listener: () => void) {\n        this.snapshotListener = listener;\n    }\n\n    snapshot() {\n        const ctx = this.baseImageLayer.getContext(\"2d\");\n        if (ctx) {\n            const snapshot = ctx.getImageData(\n                0,\n                0,\n                this.baseImageLayer.width,\n                this.baseImageLayer.height\n            );\n            if (this.currentSnapshot) {\n                this.undoStack.push(this.currentSnapshot);\n                this.currentSnapshot = snapshot;\n                if (this.redoStack.length > 0) {\n                    this.redoStack = [];\n                }\n                if (this.undoStack.length > maxSnapshots) {\n                    this.undoStack.shift();\n                }\n            } else {\n                this.currentSnapshot = snapshot;\n            }\n\n            this.notifySnapshotListener();\n        }\n    }\n\n    private notifySnapshotListener() {\n        if (this.snapshotListener) {\n            this.snapshotListener();\n        }\n    }\n\n    render() {\n        const context = this.canvas.getContext(\"2d\");\n        if (context) {\n            context.clearRect(0, 0, this.width, this.height);\n            context.drawImage(this.backgroundLayer, 0, 0);\n            // apply zoom and offset\n            context.setTransform(\n                this.zoom,\n                0,\n                0,\n                this.zoom,\n                this.offsetX * this.zoom,\n                this.offsetY * this.zoom\n            );\n            // context.drawImage(this.backgroundLayer, 0, 0);\n            context.drawImage(this.baseImageLayer, 0, 0);\n            context.drawImage(this.editLayer, 0, 0);\n            // context.drawImage(this.overlayLayer, 0, 0);\n            this.drawOverlay(context, this.width, this.height);\n            context.setTransform(1, 0, 0, 1, 0, 0);\n        }\n    }\n\n    getCanvas(): HTMLCanvasElement {\n        return this.canvas;\n    }\n\n    private initializeBackgroundLayer() {\n        // checkered background\n        // #DEDEDE\n        // #FFFFFF\n        // 10x10 pixel squares\n        const ctx = this.backgroundLayer.getContext(\"2d\");\n        if (ctx) {\n            const pattern = ctx.createPattern(\n                this.createCheckeredPattern(20, 20, \"#808080\", \"#AAAAAA\"),\n                \"repeat\"\n            );\n            if (pattern) {\n                ctx.fillStyle = pattern;\n                ctx.fillRect(\n                    0,\n                    0,\n                    this.backgroundLayer.width,\n                    this.backgroundLayer.height\n                );\n            }\n        }\n    }\n\n    private createCheckeredPattern(\n        width: number,\n        height: number,\n        color1: string,\n        color2: string\n    ): HTMLCanvasElement {\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = width;\n        canvas.height = height;\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx) {\n            ctx.fillStyle = color1;\n            ctx.fillRect(0, 0, width, height);\n            ctx.fillStyle = color2;\n            ctx.fillRect(0, 0, width / 2, height / 2);\n            ctx.fillRect(width / 2, height / 2, width / 2, height / 2);\n        }\n        return canvas;\n    }\n\n    setBaseImage(\n        image: HTMLImageElement | HTMLCanvasElement,\n        updateSelectionOverlay = true\n    ) {\n        const context = this.baseImageLayer.getContext(\"2d\");\n        if (context) {\n            // set size of all layers\n            // TODO: adapt for an always-square canvas\n            this.initializeBackgroundLayer();\n\n            this.baseImageLayer.width = image.width;\n            this.baseImageLayer.height = image.height;\n            this.editLayer.width = image.width;\n            this.editLayer.height = image.height;\n            // set image size\n            this.width = image.width;\n            this.height = image.height;\n            // this.canvas.width = image.width;\n            // this.canvas.height = image.height;\n            context.drawImage(image, 0, 0);\n\n            if (updateSelectionOverlay) {\n                // set 512x512 selection overlay at the center of the image\n                this.setSelectionOverlay({\n                    x: (image.width - 512) / 2,\n                    y: (image.height - 512) / 2,\n                    width: 512,\n                    height: 512,\n                });\n            }\n            this.resetView();\n            // this.render(); // already called by updateZoomAndOffset\n            this.snapshot();\n        }\n    }\n\n    resetView() {\n        // determine zoom based on image difference from canvas size\n        const maxWidth = Math.max(this.width, this.height);\n        const zoom = this.canvas.width / maxWidth;\n\n        let offsetX = 0;\n        let offsetY = 0;\n\n        if (this.width > this.height) {\n            offsetY = (this.width - this.height) / 2;\n        } else if (this.height > this.width) {\n            offsetX = (this.height - this.width) / 2;\n        }\n\n        this.updateZoomAndOffset(zoom, offsetX, offsetY);\n    }\n\n    setEditImage(imageData: ImageData | null) {\n        this.hasSelection = !!imageData;\n        const context = this.editLayer.getContext(\"2d\");\n        if (context && this.selectionOverlay) {\n            context.clearRect(\n                0,\n                0,\n                this.editLayer.width,\n                this.editLayer.height\n            );\n            if (imageData) {\n                context.putImageData(\n                    imageData,\n                    this.selectionOverlay.x,\n                    this.selectionOverlay.y\n                );\n            }\n            // edit image makes the selection rect and preview disappear\n            // so redraw the overlay\n            this.hasSelection = !!imageData;\n            this.render();\n        }\n        this.notifySnapshotListener();\n    }\n\n    private drawOverlay(\n        context: CanvasRenderingContext2D,\n        width: number,\n        height: number\n    ) {\n        const lineWidth = Math.max(this.width / 512, this.height / 512);\n        if (context) {\n            context.strokeStyle = \"white\";\n            context.lineWidth = lineWidth;\n            context.strokeRect(0, 0, width, height);\n\n            if (!this.hasSelection && this.selectionOverlay) {\n                context.strokeStyle = \"white\";\n                context.lineWidth = lineWidth;\n                context.strokeRect(\n                    this.selectionOverlay.x,\n                    this.selectionOverlay.y,\n                    this.selectionOverlay.width,\n                    this.selectionOverlay.height\n                );\n            }\n            if (!this.hasSelection && this.selectionOverlayPreview) {\n                context.strokeStyle = \"cyan\";\n                context.lineWidth = lineWidth;\n                context.strokeRect(\n                    this.selectionOverlayPreview.x,\n                    this.selectionOverlayPreview.y,\n                    this.selectionOverlayPreview.width,\n                    this.selectionOverlayPreview.height\n                );\n            }\n            if (this.cursor) {\n                if (this.cursor.type === \"circle\") {\n                    context.lineWidth = lineWidth;\n                    context.strokeStyle = this.cursor.color;\n                    // context.globalAlpha = 0.5;\n                    context.beginPath();\n                    context.arc(\n                        this.cursor.x,\n                        this.cursor.y,\n                        this.cursor.radius,\n                        0,\n                        2 * Math.PI\n                    );\n                    context.stroke();\n                } else if (this.cursor.type === \"circle-fill\") {\n                    context.fillStyle = this.cursor.color;\n                    context.strokeStyle = this.cursor.color;\n                    // context.lineWidth = lineWidth;\n                    // context.globalAlpha = 0.5;\n                    context.beginPath();\n                    context.arc(\n                        this.cursor.x,\n                        this.cursor.y,\n                        this.cursor.radius,\n                        0,\n                        2 * Math.PI\n                    );\n                    context.stroke();\n                    // set alpha to 0.5 and fill\n                    context.globalAlpha = 0.5;\n                    context.beginPath();\n                    context.arc(\n                        this.cursor.x,\n                        this.cursor.y,\n                        this.cursor.radius,\n                        0,\n                        2 * Math.PI\n                    );\n                    context.fill();\n                    context.globalAlpha = 1;\n                } else if (this.cursor.type == \"crosshairs\") {\n                    // draw crosshairs based on cursor radius\n                    context.strokeStyle = this.cursor.color;\n                    context.lineWidth = lineWidth;\n                    context.beginPath();\n                    context.moveTo(\n                        this.cursor.x - this.cursor.radius,\n                        this.cursor.y\n                    );\n                    context.lineTo(\n                        this.cursor.x + this.cursor.radius,\n                        this.cursor.y\n                    );\n                    context.moveTo(\n                        this.cursor.x,\n                        this.cursor.y - this.cursor.radius\n                    );\n                    context.lineTo(\n                        this.cursor.x,\n                        this.cursor.y + this.cursor.radius\n                    );\n                    context.stroke();\n                } else if (this.cursor.type === \"colorpicker\") {\n                    // TODO: add croshairs\n                    context.lineWidth = this.cursor.radius * 0.75;\n                    context.strokeStyle = this.cursor.color;\n                    // context.globalAlpha = 0.5;\n                    context.beginPath();\n                    context.arc(\n                        this.cursor.x,\n                        this.cursor.y,\n                        this.cursor.radius,\n                        0,\n                        2 * Math.PI\n                    );\n                    context.stroke();\n\n                    // draw crosshairs (black)\n                    context.lineWidth = lineWidth;\n                    context.strokeStyle = \"black\";\n                    context.beginPath();\n                    context.moveTo(\n                        this.cursor.x - this.cursor.radius,\n                        this.cursor.y\n                    );\n                    context.lineTo(\n                        this.cursor.x + this.cursor.radius,\n                        this.cursor.y\n                    );\n                    context.moveTo(\n                        this.cursor.x,\n                        this.cursor.y - this.cursor.radius\n                    );\n                    context.lineTo(\n                        this.cursor.x,\n                        this.cursor.y + this.cursor.radius\n                    );\n                    context.stroke();\n                }\n            }\n        }\n    }\n\n    setSelectionOverlay(selectionOverlay: Rect | undefined) {\n        this.selectionOverlay = selectionOverlay;\n        this.render();\n    }\n\n    setSelectionOverlayPreview(selectionOverlayPreview: Rect | undefined) {\n        this.selectionOverlayPreview = selectionOverlayPreview;\n        this.render();\n    }\n\n    setCursor(cursor: Cursor | undefined) {\n        this.cursor = cursor;\n        this.render();\n    }\n\n    getSelectionOverlay(): Rect | undefined {\n        return this.selectionOverlay;\n    }\n\n    getZoom(): number {\n        return this.zoom;\n    }\n\n    getOffsetX(): number {\n        return this.offsetX;\n    }\n\n    getOffsetY(): number {\n        return this.offsetY;\n    }\n\n    updateZoomAndOffset(zoom: number, offsetX: number, offsetY: number) {\n        // console.log(`zoom: ${zoom}, offset: ${offsetX}, ${offsetY}`)\n        this.zoom = zoom;\n        this.offsetX = offsetX;\n        this.offsetY = offsetY;\n        this.render();\n    }\n\n    getWidth(): number {\n        return this.width;\n    }\n\n    getHeight(): number {\n        return this.height;\n    }\n\n    private imageDataToEncodedImage(imageData: ImageData): string | undefined {\n        // create a canvas and draw the image data on it\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = imageData.width;\n        canvas.height = imageData.height;\n        const context = canvas.getContext(\"2d\");\n        if (context) {\n            context.putImageData(imageData, 0, 0);\n            // return the data url of the canvas\n            const result = canvas.toDataURL(\"image/png\");\n            // cleanup the canvas\n            canvas.remove();\n            // extract base64 data from data url\n            return result.split(\",\")[1];\n        }\n    }\n\n    getEncodedImage(selection: Rect | null): string | undefined {\n        const imageData = this.getImageData(selection);\n        if (imageData) {\n            return this.imageDataToEncodedImage(imageData);\n        }\n    }\n\n    private convertErasureToMask(erasure: ImageData): ImageData {\n        // for each pixel, if alpha < 255, set to white, otherwise set to black\n        const mask = erasure;\n        for (let i = 0; i < erasure.data.length; i += 4) {\n            if (erasure.data[i + 3] < 255) {\n                mask.data[i] = 255;\n                mask.data[i + 1] = 255;\n                mask.data[i + 2] = 255;\n                mask.data[i + 3] = 255;\n            } else {\n                mask.data[i] = 0;\n                mask.data[i + 1] = 0;\n                mask.data[i + 2] = 0;\n                mask.data[i + 3] = 255;\n            }\n        }\n        return mask;\n    }\n\n    getEncodedMask(selection: Rect | null): string | undefined {\n        const imageData = this.getImageData(selection)!;\n        const mask = this.convertErasureToMask(imageData);\n        return this.imageDataToEncodedImage(mask);\n    }\n\n    getImageData(selection: Rect | null): ImageData | undefined {\n        if (!selection) {\n            selection = {\n                x: 0,\n                y: 0,\n                width: this.width,\n                height: this.height,\n            };\n        }\n        // get image data of the selection\n        let context = this.baseImageLayer.getContext(\"2d\");\n        if (context) {\n            const imageData = context.getImageData(\n                selection.x,\n                selection.y,\n                selection.width,\n                selection.height\n            );\n            return imageData;\n        }\n    }\n\n    commitSelection() {\n        // draw the selection overlay on the base image layer\n        const context = this.baseImageLayer.getContext(\"2d\");\n        if (context) {\n            context.drawImage(this.editLayer, 0, 0);\n            this.setEditImage(null);\n            this.snapshot();\n        }\n    }\n\n    drawPoint(x: number, y: number, brushSize: number, color: string): void {\n        // draw on selection layer\n        const context = this.editLayer.getContext(\"2d\");\n        if (context) {\n            context.fillStyle = color;\n            context.beginPath();\n            context.arc(x, y, brushSize / 2, 0, 2 * Math.PI);\n            context.fill();\n        }\n        this.render();\n    }\n\n    erasePoint(brushx: number, brushy: number, brushSize: number): void {\n        if (!this.selectionOverlay) {\n            throw new Error(\"No selection overlay\");\n        }\n        // get image data centered on x, y with brushSize width and height\n        const context = this.baseImageLayer.getContext(\"2d\");\n        if (context) {\n            const imageData = context.getImageData(\n                brushx - brushSize / 2,\n                brushy - brushSize / 2,\n                brushSize,\n                brushSize\n            );\n            // set alpha to 0 in a circle centered on x, y with radius brushSize / 2\n            for (let i = 0; i < imageData.data.length; i += 4) {\n                const x = (i / 4) % brushSize;\n                const y = Math.floor(i / 4 / brushSize);\n\n                const absx = x - brushSize / 2 + brushx;\n                // three pixel barrier on each edge UNLESS the selection overlay borders that edge\n                let leftEdge = this.selectionOverlay.x;\n                if (leftEdge > 0) {\n                    leftEdge += 10;\n                }\n                let rightEdge =\n                    this.selectionOverlay.x + this.selectionOverlay.width;\n                if (rightEdge < this.width) {\n                    rightEdge -= 10;\n                }\n                let topEdge = this.selectionOverlay.y;\n                if (topEdge > 0) {\n                    topEdge += 10;\n                }\n                let bottomEdge =\n                    this.selectionOverlay.y + this.selectionOverlay.height;\n                if (bottomEdge < this.canvas.height) {\n                    bottomEdge -= 10;\n                }\n\n                const containsx = absx > leftEdge && absx < rightEdge;\n                const absy = y - brushSize / 2 + brushy;\n                const containsy = absy > topEdge && absy < bottomEdge;\n                const contains = containsx && containsy;\n\n                // check if x, y is within the selection overlay\n                if (this.selectionOverlay && !contains) {\n                    continue;\n                }\n\n                const distance = Math.sqrt(\n                    Math.pow(x - brushSize / 2, 2) +\n                        Math.pow(y - brushSize / 2, 2)\n                );\n                if (distance < brushSize / 2) {\n                    imageData.data[i + 3] = 0;\n                }\n            }\n            // draw the image data on the selection layer\n            context.putImageData(\n                imageData,\n                brushx - brushSize / 2,\n                brushy - brushSize / 2\n            );\n        }\n    }\n\n    drawLine(\n        x1: number,\n        y1: number,\n        x2: number,\n        y2: number,\n        brushSize: number,\n        color: string\n    ): void {\n        // draw on selection layer\n        const context = this.editLayer.getContext(\"2d\");\n        if (context) {\n            context.strokeStyle = color;\n            context.lineWidth = brushSize;\n            context.lineCap = \"round\";\n            context.beginPath();\n            context.moveTo(x1, y1);\n            context.lineTo(x2, y2);\n            context.stroke();\n        }\n        this.render();\n    }\n\n    smudgeLine(\n        x1: number,\n        y1: number,\n        x2: number,\n        y2: number,\n        brushSize: number,\n        brushOpacity: number\n    ): void {\n        const unitVector = {\n            x: x2 - x1,\n            y: y2 - y1,\n        };\n        const length = Math.sqrt(\n            unitVector.x * unitVector.x + unitVector.y * unitVector.y\n        );\n        unitVector.x /= length;\n        unitVector.y /= length;\n\n        // for each point on the line, get image data (brushSize x brushSize) from edit layer\n        // average pixel values that are within the brush circle.\n        // update the image data with the averaged pixel values in the\n        // brush circle, then put the image data back on the edit layer\n        // at the point on the line\n\n        const context = this.editLayer.getContext(\"2d\");\n        if (context) {\n            for (let i = 0; i < length; i++) {\n                const x = x1 + i * unitVector.x;\n                const y = y1 + i * unitVector.y;\n\n                const imageData = context.getImageData(\n                    x - brushSize / 2,\n                    y - brushSize / 2,\n                    brushSize,\n                    brushSize\n                );\n\n                let totalRed = 0;\n                let totalGreen = 0;\n                let totalBlue = 0;\n                let count = 0.0;\n\n                // average pixel values\n                for (let y = 0; y < imageData.height; y++) {\n                    for (let x = 0; x < imageData.width; x++) {\n                        const index = (y * imageData.width + x) * 4;\n                        const distance = Math.sqrt(\n                            (x - brushSize / 2) * (x - brushSize / 2) +\n                                (y - brushSize / 2) * (y - brushSize / 2)\n                        );\n                        if (distance <= brushSize / 2) {\n                            // get the pixel value from the image data\n                            const r = imageData.data[index];\n                            const g = imageData.data[index + 1];\n                            const b = imageData.data[index + 2];\n\n                            totalRed += r;\n                            totalGreen += g;\n                            totalBlue += b;\n                            count++;\n                        }\n                    }\n                }\n\n                // update the image data with the averaged pixel values\n                // these need to be weighted by the brush opacity\n                const averageRed = totalRed / count;\n                const averageGreen = totalGreen / count;\n                const averageBlue = totalBlue / count;\n                for (let y = 0; y < imageData.height; y++) {\n                    for (let x = 0; x < imageData.width; x++) {\n                        const index = (y * imageData.width + x) * 4;\n                        const distance = Math.sqrt(\n                            (x - brushSize / 2) * (x - brushSize / 2) +\n                                (y - brushSize / 2) * (y - brushSize / 2)\n                        );\n                        if (distance <= brushSize / 2) {\n                            imageData.data[index] =\n                                averageRed * brushOpacity +\n                                imageData.data[index] * (1 - brushOpacity);\n                            imageData.data[index + 1] =\n                                averageGreen * brushOpacity +\n                                imageData.data[index + 1] * (1 - brushOpacity);\n                            imageData.data[index + 2] =\n                                averageBlue * brushOpacity +\n                                imageData.data[index + 2] * (1 - brushOpacity);\n                        }\n                    }\n                }\n\n                // put the image data back on the edit layer\n                context.putImageData(\n                    imageData,\n                    x - brushSize / 2,\n                    y - brushSize / 2\n                );\n            }\n        }\n        this.render();\n    }\n\n    getPixel(x: number, y: number): string {\n        const context = this.baseImageLayer.getContext(\"2d\");\n        // get pixel as hex string\n        if (context) {\n            const pixel = context.getImageData(x, y, 1, 1).data;\n            return (\n                \"#\" +\n                (\"000000\" + rgbToHex(pixel[0], pixel[1], pixel[2])).slice(-6)\n            );\n        }\n        return \"#000000\";\n    }\n\n    copyEditImageFromBaseImage(): void {\n        // copy the base image to the edit layer\n        const context = this.editLayer.getContext(\"2d\");\n        if (context) {\n            context.drawImage(this.baseImageLayer, 0, 0);\n        }\n        this.render();\n        this.hasSelection = true;\n        this.notifySnapshotListener();\n    }\n\n    expandToOverlay() {\n        if (!this.selectionOverlay) {\n            throw new Error(\"No selection overlay\");\n        }\n        const minX = Math.min(0, this.selectionOverlay.x);\n        const minY = Math.min(0, this.selectionOverlay.y);\n        const maxX = Math.max(\n            this.selectionOverlay.x + this.selectionOverlay.width,\n            this.baseImageLayer.width\n        );\n        const maxY = Math.max(\n            this.selectionOverlay.y + this.selectionOverlay.height,\n            this.baseImageLayer.height\n        );\n        const width = maxX - minX;\n        const height = maxY - minY;\n\n        // create a new canvas with the expanded size\n        const newCanvas = document.createElement(\"canvas\");\n        newCanvas.width = width;\n        newCanvas.height = height;\n        // draw the base image on the new canvas.\n        // if overlay.x is negative, image.x is overlay.x * -1\n        // if overlay.x is 0 or positive, image.x is 0\n        // if overlay.y is negative, image.y is overlay.y * -1\n        // if overlay.y is 0 or positive, image.y is 0\n        const context = newCanvas.getContext(\"2d\");\n        if (context) {\n            context.drawImage(\n                this.baseImageLayer,\n                Math.max(0, this.selectionOverlay.x * -1),\n                Math.max(0, this.selectionOverlay.y * -1)\n            );\n        }\n        if (this.selectionOverlay.x < 0) {\n            this.selectionOverlay.x = 0;\n        }\n        if (this.selectionOverlay.y < 0) {\n            this.selectionOverlay.y = 0;\n        }\n        console.log(`new Canvas size: ${width} x ${height}`);\n        this.setBaseImage(newCanvas, false);\n    }\n}\n\nfunction rgbToHex(r: number, g: number, b: number) {\n    if (r > 255 || g > 255 || b > 255) throw \"Invalid color component\";\n    return ((r << 16) | (g << 8) | b).toString(16);\n}\n\nexport function createRenderer(canvas: HTMLCanvasElement): Renderer {\n    return new Renderer(canvas);\n}\n","/* tslint:disable */\n/* eslint-disable */\n/**\n * AIBrush API\n * Orchestration backend for AI Brush\n *\n * The version of the OpenAPI document: 1.0.0\n * Contact: admin@aibrush.art\n *\n * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).\n * https://openapi-generator.tech\n * Do not edit the class manually.\n */\n\n\nimport { Configuration } from './configuration';\nimport globalAxios, { AxiosPromise, AxiosInstance } from 'axios';\n// Some imports not used depending on template conditions\n// @ts-ignore\nimport { DUMMY_BASE_URL, assertParamExists, setApiKeyToObject, setBasicAuthToObject, setBearerAuthToObject, setOAuthToObject, setSearchParams, serializeDataIfNeeded, toPathString, createRequestFunction } from './common';\n// @ts-ignore\nimport { BASE_PATH, COLLECTION_FORMATS, RequestArgs, BaseAPI, RequiredError } from './base';\n\n/**\n * \n * @export\n * @interface AddMetricItem\n */\nexport interface AddMetricItem {\n    /**\n     * \n     * @type {string}\n     * @memberof AddMetricItem\n     */\n    name: string;\n    /**\n     * \n     * @type {number}\n     * @memberof AddMetricItem\n     */\n    value: number;\n    /**\n     * \n     * @type {string}\n     * @memberof AddMetricItem\n     */\n    type: AddMetricItemTypeEnum;\n    /**\n     * \n     * @type {Array<MetricAttribute>}\n     * @memberof AddMetricItem\n     */\n    attributes: Array<MetricAttribute>;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum AddMetricItemTypeEnum {\n    Gauge = 'gauge',\n    Count = 'count'\n}\n\n/**\n * \n * @export\n * @interface AddMetricsInput\n */\nexport interface AddMetricsInput {\n    /**\n     * \n     * @type {Array<AddMetricItem>}\n     * @memberof AddMetricsInput\n     */\n    metrics: Array<AddMetricItem>;\n}\n/**\n * \n * @export\n * @interface AssetsUrl\n */\nexport interface AssetsUrl {\n    /**\n     * \n     * @type {string}\n     * @memberof AssetsUrl\n     */\n    assets_url: string;\n}\n/**\n * \n * @export\n * @interface BatchGetImagesInput\n */\nexport interface BatchGetImagesInput {\n    /**\n     * \n     * @type {Array<string>}\n     * @memberof BatchGetImagesInput\n     */\n    ids: Array<string>;\n}\n/**\n * \n * @export\n * @interface CreateImageInput\n */\nexport interface CreateImageInput {\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    status?: CreateImageInputStatusEnum;\n    /**\n     * \n     * @type {Array<string>}\n     * @memberof CreateImageInput\n     */\n    phrases?: Array<string>;\n    /**\n     * \n     * @type {Array<string>}\n     * @memberof CreateImageInput\n     */\n    negative_phrases?: Array<string>;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    label?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    iterations?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    parent?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    encoded_image?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    encoded_mask?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    encoded_npy?: string;\n    /**\n     * \n     * @type {boolean}\n     * @memberof CreateImageInput\n     */\n    enable_video?: boolean;\n    /**\n     * \n     * @type {boolean}\n     * @memberof CreateImageInput\n     */\n    enable_zoom?: boolean;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    zoom_frequency?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    zoom_scale?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    zoom_shift_x?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    zoom_shift_y?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof CreateImageInput\n     */\n    model?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    glid_3_xl_skip_iterations?: number;\n    /**\n     * \n     * @type {boolean}\n     * @memberof CreateImageInput\n     */\n    glid_3_xl_clip_guidance?: boolean;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    glid_3_xl_clip_guidance_scale?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    height?: CreateImageInputHeightEnum;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    width?: CreateImageInputWidthEnum;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    uncrop_offset_x?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    uncrop_offset_y?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    stable_diffusion_strength?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateImageInput\n     */\n    count?: number;\n    /**\n     * \n     * @type {boolean}\n     * @memberof CreateImageInput\n     */\n    nsfw?: boolean;\n    /**\n     * \n     * @type {boolean}\n     * @memberof CreateImageInput\n     */\n    temporary?: boolean;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum CreateImageInputStatusEnum {\n    Pending = 'pending',\n    Processing = 'processing',\n    Completed = 'completed',\n    Saved = 'saved',\n    Error = 'error'\n}\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum CreateImageInputHeightEnum {\n    NUMBER_128 = 128,\n    NUMBER_256 = 256,\n    NUMBER_384 = 384,\n    NUMBER_512 = 512,\n    NUMBER_640 = 640,\n    NUMBER_768 = 768,\n    NUMBER_896 = 896,\n    NUMBER_1024 = 1024\n}\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum CreateImageInputWidthEnum {\n    NUMBER_128 = 128,\n    NUMBER_256 = 256,\n    NUMBER_384 = 384,\n    NUMBER_512 = 512,\n    NUMBER_640 = 640,\n    NUMBER_768 = 768,\n    NUMBER_896 = 896,\n    NUMBER_1024 = 1024\n}\n\n/**\n * \n * @export\n * @interface CreateOrderInput\n */\nexport interface CreateOrderInput {\n    /**\n     * \n     * @type {number}\n     * @memberof CreateOrderInput\n     */\n    gpu_count: number;\n    /**\n     * \n     * @type {number}\n     * @memberof CreateOrderInput\n     */\n    hours: number;\n}\n/**\n * \n * @export\n * @interface CreateServiceAccountInput\n */\nexport interface CreateServiceAccountInput {\n    /**\n     * \n     * @type {string}\n     * @memberof CreateServiceAccountInput\n     */\n    type?: CreateServiceAccountInputTypeEnum;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum CreateServiceAccountInputTypeEnum {\n    Public = 'public',\n    Private = 'private'\n}\n\n/**\n * \n * @export\n * @interface DiscordLogin\n */\nexport interface DiscordLogin {\n    /**\n     * \n     * @type {string}\n     * @memberof DiscordLogin\n     */\n    code: string;\n}\n/**\n * \n * @export\n * @interface FeatureList\n */\nexport interface FeatureList {\n    /**\n     * \n     * @type {string}\n     * @memberof FeatureList\n     */\n    terms_uri?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof FeatureList\n     */\n    privacy_uri?: string;\n}\n/**\n * \n * @export\n * @interface Healthcheck\n */\nexport interface Healthcheck {\n    /**\n     * \n     * @type {string}\n     * @memberof Healthcheck\n     */\n    status?: HealthcheckStatusEnum;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum HealthcheckStatusEnum {\n    Ok = 'ok'\n}\n\n/**\n * \n * @export\n * @interface Image\n */\nexport interface Image {\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    id: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    created_at: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    created_by: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    updated_at: number;\n    /**\n     * \n     * @type {Array<string>}\n     * @memberof Image\n     */\n    phrases: Array<string>;\n    /**\n     * \n     * @type {Array<string>}\n     * @memberof Image\n     */\n    negative_phrases: Array<string>;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    label: string;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    parent: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    iterations: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    current_iterations: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    score: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    negative_score: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    status: ImageStatusEnum;\n    /**\n     * \n     * @type {boolean}\n     * @memberof Image\n     */\n    enable_video: boolean;\n    /**\n     * \n     * @type {boolean}\n     * @memberof Image\n     */\n    enable_zoom?: boolean;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    zoom_frequency?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    zoom_scale?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    zoom_shift_x?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    zoom_shift_y?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    model: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    glid_3_xl_skip_iterations?: number;\n    /**\n     * \n     * @type {boolean}\n     * @memberof Image\n     */\n    glid_3_xl_clip_guidance?: boolean;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    glid_3_xl_clip_guidance_scale?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    width: ImageWidthEnum;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    height: ImageHeightEnum;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    uncrop_offset_x?: ImageUncropOffsetXEnum;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    uncrop_offset_y?: ImageUncropOffsetYEnum;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    stable_diffusion_strength: number;\n    /**\n     * \n     * @type {boolean}\n     * @memberof Image\n     */\n    nsfw: boolean;\n    /**\n     * \n     * @type {boolean}\n     * @memberof Image\n     */\n    temporary: boolean;\n    /**\n     * \n     * @type {number}\n     * @memberof Image\n     */\n    deleted_at?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Image\n     */\n    worker_id?: string;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum ImageStatusEnum {\n    Pending = 'pending',\n    Processing = 'processing',\n    Completed = 'completed',\n    Saved = 'saved',\n    Error = 'error'\n}\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum ImageWidthEnum {\n    NUMBER_128 = 128,\n    NUMBER_256 = 256,\n    NUMBER_384 = 384,\n    NUMBER_512 = 512,\n    NUMBER_640 = 640,\n    NUMBER_768 = 768,\n    NUMBER_896 = 896,\n    NUMBER_1024 = 1024\n}\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum ImageHeightEnum {\n    NUMBER_128 = 128,\n    NUMBER_256 = 256,\n    NUMBER_384 = 384,\n    NUMBER_512 = 512,\n    NUMBER_640 = 640,\n    NUMBER_768 = 768,\n    NUMBER_896 = 896,\n    NUMBER_1024 = 1024\n}\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum ImageUncropOffsetXEnum {\n    NUMBER_MINUS_896 = -896,\n    NUMBER_MINUS_768 = -768,\n    NUMBER_MINUS_640 = -640,\n    NUMBER_MINUS_512 = -512,\n    NUMBER_MINUS_384 = -384,\n    NUMBER_MINUS_256 = -256,\n    NUMBER_MINUS_128 = -128,\n    NUMBER_0 = 0,\n    NUMBER_128 = 128,\n    NUMBER_256 = 256,\n    NUMBER_384 = 384,\n    NUMBER_512 = 512,\n    NUMBER_640 = 640,\n    NUMBER_768 = 768,\n    NUMBER_896 = 896\n}\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum ImageUncropOffsetYEnum {\n    NUMBER_MINUS_896 = -896,\n    NUMBER_MINUS_768 = -768,\n    NUMBER_MINUS_640 = -640,\n    NUMBER_MINUS_512 = -512,\n    NUMBER_MINUS_384 = -384,\n    NUMBER_MINUS_256 = -256,\n    NUMBER_MINUS_128 = -128,\n    NUMBER_0 = 0,\n    NUMBER_128 = 128,\n    NUMBER_256 = 256,\n    NUMBER_384 = 384,\n    NUMBER_512 = 512,\n    NUMBER_640 = 640,\n    NUMBER_768 = 768,\n    NUMBER_896 = 896\n}\n\n/**\n * \n * @export\n * @interface ImageList\n */\nexport interface ImageList {\n    /**\n     * \n     * @type {Array<Image>}\n     * @memberof ImageList\n     */\n    images?: Array<Image>;\n}\n/**\n * \n * @export\n * @interface ImageUrls\n */\nexport interface ImageUrls {\n    /**\n     * \n     * @type {string}\n     * @memberof ImageUrls\n     */\n    image_url?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof ImageUrls\n     */\n    mask_url?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof ImageUrls\n     */\n    thumbnail_url?: string;\n}\n/**\n * \n * @export\n * @interface InviteCode\n */\nexport interface InviteCode {\n    /**\n     * \n     * @type {string}\n     * @memberof InviteCode\n     */\n    id?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof InviteCode\n     */\n    created_at?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof InviteCode\n     */\n    created_by?: string;\n}\n/**\n * \n * @export\n * @interface IsAdminResponse\n */\nexport interface IsAdminResponse {\n    /**\n     * \n     * @type {boolean}\n     * @memberof IsAdminResponse\n     */\n    is_admin?: boolean;\n}\n/**\n * \n * @export\n * @interface LoginInput\n */\nexport interface LoginInput {\n    /**\n     * \n     * @type {string}\n     * @memberof LoginInput\n     */\n    email?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof LoginInput\n     */\n    invite_code?: string;\n}\n/**\n * \n * @export\n * @interface LoginResult\n */\nexport interface LoginResult {\n    /**\n     * \n     * @type {string}\n     * @memberof LoginResult\n     */\n    accessToken?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof LoginResult\n     */\n    refreshToken?: string;\n}\n/**\n * \n * @export\n * @interface MetricAttribute\n */\nexport interface MetricAttribute {\n    /**\n     * \n     * @type {string}\n     * @memberof MetricAttribute\n     */\n    name?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof MetricAttribute\n     */\n    value?: string;\n}\n/**\n * \n * @export\n * @interface Order\n */\nexport interface Order {\n    /**\n     * \n     * @type {string}\n     * @memberof Order\n     */\n    id: string;\n    /**\n     * \n     * @type {string}\n     * @memberof Order\n     */\n    created_by: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Order\n     */\n    created_at: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Order\n     */\n    ends_at: number;\n    /**\n     * \n     * @type {boolean}\n     * @memberof Order\n     */\n    is_active: boolean;\n    /**\n     * \n     * @type {number}\n     * @memberof Order\n     */\n    gpu_count: number;\n    /**\n     * \n     * @type {number}\n     * @memberof Order\n     */\n    amount_paid_cents: number;\n}\n/**\n * \n * @export\n * @interface OrderList\n */\nexport interface OrderList {\n    /**\n     * \n     * @type {Array<Order>}\n     * @memberof OrderList\n     */\n    orders: Array<Order>;\n}\n/**\n * \n * @export\n * @interface ProcessImageInput\n */\nexport interface ProcessImageInput {\n    /**\n     * \n     * @type {string}\n     * @memberof ProcessImageInput\n     */\n    model?: string;\n    /**\n     * \n     * @type {boolean}\n     * @memberof ProcessImageInput\n     */\n    peek?: boolean;\n}\n/**\n * \n * @export\n * @interface RefreshLoginInput\n */\nexport interface RefreshLoginInput {\n    /**\n     * \n     * @type {string}\n     * @memberof RefreshLoginInput\n     */\n    refreshToken?: string;\n}\n/**\n * \n * @export\n * @interface UpdateImageInput\n */\nexport interface UpdateImageInput {\n    /**\n     * \n     * @type {string}\n     * @memberof UpdateImageInput\n     */\n    label?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof UpdateImageInput\n     */\n    current_iterations?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof UpdateImageInput\n     */\n    status?: UpdateImageInputStatusEnum;\n    /**\n     * \n     * @type {string}\n     * @memberof UpdateImageInput\n     */\n    encoded_image?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof UpdateImageInput\n     */\n    encoded_npy?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof UpdateImageInput\n     */\n    score?: number;\n    /**\n     * \n     * @type {number}\n     * @memberof UpdateImageInput\n     */\n    negative_score?: number;\n    /**\n     * \n     * @type {boolean}\n     * @memberof UpdateImageInput\n     */\n    nsfw?: boolean;\n    /**\n     * \n     * @type {number}\n     * @memberof UpdateImageInput\n     */\n    deleted_at?: number | null;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum UpdateImageInputStatusEnum {\n    Pending = 'pending',\n    Processing = 'processing',\n    Completed = 'completed',\n    Saved = 'saved',\n    Error = 'error'\n}\n\n/**\n * \n * @export\n * @interface UpsertWorkerConfigInput\n */\nexport interface UpsertWorkerConfigInput {\n    /**\n     * \n     * @type {Array<WorkerGpuConfig>}\n     * @memberof UpsertWorkerConfigInput\n     */\n    gpu_configs?: Array<WorkerGpuConfig>;\n}\n/**\n * \n * @export\n * @interface UpsertWorkerInput\n */\nexport interface UpsertWorkerInput {\n    /**\n     * \n     * @type {string}\n     * @memberof UpsertWorkerInput\n     */\n    display_name?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof UpsertWorkerInput\n     */\n    status?: UpsertWorkerInputStatusEnum;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum UpsertWorkerInputStatusEnum {\n    Idle = 'idle',\n    Active = 'active'\n}\n\n/**\n * \n * @export\n * @interface User\n */\nexport interface User {\n    /**\n     * \n     * @type {string}\n     * @memberof User\n     */\n    id?: string;\n    /**\n     * \n     * @type {boolean}\n     * @memberof User\n     */\n    active?: boolean;\n}\n/**\n * \n * @export\n * @interface VerifyLoginInput\n */\nexport interface VerifyLoginInput {\n    /**\n     * \n     * @type {string}\n     * @memberof VerifyLoginInput\n     */\n    email?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof VerifyLoginInput\n     */\n    code?: string;\n}\n/**\n * \n * @export\n * @interface Worker\n */\nexport interface Worker {\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    id: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Worker\n     */\n    created_at: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    display_name: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Worker\n     */\n    last_ping?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    status?: WorkerStatusEnum;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    login_code?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    engine?: string;\n    /**\n     * \n     * @type {number}\n     * @memberof Worker\n     */\n    num_gpus?: number;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    cloud_instance_id?: string;\n    /**\n     * \n     * @type {string}\n     * @memberof Worker\n     */\n    gpu_type?: string;\n}\n\n/**\n    * @export\n    * @enum {string}\n    */\nexport enum WorkerStatusEnum {\n    Idle = 'idle',\n    Active = 'active'\n}\n\n/**\n * \n * @export\n * @interface WorkerConfig\n */\nexport interface WorkerConfig {\n    /**\n     * \n     * @type {string}\n     * @memberof WorkerConfig\n     */\n    worker_id: string;\n    /**\n     * \n     * @type {Array<WorkerGpuConfig>}\n     * @memberof WorkerConfig\n     */\n    gpu_configs?: Array<WorkerGpuConfig>;\n}\n/**\n * \n * @export\n * @interface WorkerGpuConfig\n */\nexport interface WorkerGpuConfig {\n    /**\n     * \n     * @type {number}\n     * @memberof WorkerGpuConfig\n     */\n    gpu_num: number;\n    /**\n     * \n     * @type {string}\n     * @memberof WorkerGpuConfig\n     */\n    model: string;\n}\n/**\n * \n * @export\n * @interface WorkerList\n */\nexport interface WorkerList {\n    /**\n     * \n     * @type {Array<Worker>}\n     * @memberof WorkerList\n     */\n    workers?: Array<Worker>;\n}\n/**\n * \n * @export\n * @interface WorkerLoginCode\n */\nexport interface WorkerLoginCode {\n    /**\n     * \n     * @type {string}\n     * @memberof WorkerLoginCode\n     */\n    login_code: string;\n}\n\n/**\n * AIBrushApi - axios parameter creator\n * @export\n */\nexport const AIBrushApiAxiosParamCreator = function (configuration?: Configuration) {\n    return {\n        /**\n         * Add Metrics\n         * @param {AddMetricsInput} [addMetricsInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        addMetrics: async (addMetricsInput?: AddMetricsInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/metrics`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(addMetricsInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get a list of saved images by id\n         * @param {BatchGetImagesInput} [batchGetImagesInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        batchGetImages: async (batchGetImagesInput?: BatchGetImagesInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/batch-get-images`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(batchGetImagesInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Create a new image\n         * @param {CreateImageInput} [createImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createImage: async (createImageInput?: CreateImageInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/images`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(createImageInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Create a new invite code\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createInviteCode: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/invite-codes`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Create a new order\n         * @param {CreateOrderInput} [createOrderInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createOrder: async (createOrderInput?: CreateOrderInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/orders`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(createOrderInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Create a service account\n         * @param {CreateServiceAccountInput} [createServiceAccountInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createServiceAccount: async (createServiceAccountInput?: CreateServiceAccountInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/auth/service-accounts`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(createServiceAccountInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Create a new worker\n         * @param {UpsertWorkerInput} [upsertWorkerInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createWorker: async (upsertWorkerInput?: UpsertWorkerInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/workers`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(upsertWorkerInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Delete a saved image\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        deleteImage: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('deleteImage', 'id', id)\n            const localVarPath = `/api/images/{id}`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'DELETE', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Delete a worker\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        deleteWorker: async (workerId: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'workerId' is not null or undefined\n            assertParamExists('deleteWorker', 'workerId', workerId)\n            const localVarPath = `/api/workers/{worker_id}`\n                .replace(`{${\"worker_id\"}}`, encodeURIComponent(String(workerId)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'DELETE', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Log in with Discord\n         * @param {DiscordLogin} [discordLogin] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        discordLogin: async (discordLogin?: DiscordLogin, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/discord-login`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(discordLogin, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Generate a login code for a worker\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        generateWorkerLoginCode: async (workerId: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'workerId' is not null or undefined\n            assertParamExists('generateWorkerLoginCode', 'workerId', workerId)\n            const localVarPath = `/api/workers/{worker_id}/login-code`\n                .replace(`{${\"worker_id\"}}`, encodeURIComponent(String(workerId)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the assets url\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getAssetsUrl: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/assets-url`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the features\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getFeatures: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/features`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get a saved image by id\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImage: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getImage', 'id', id)\n            const localVarPath = `/api/images/{id}`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the binary image data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageData: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getImageData', 'id', id)\n            const localVarPath = `/api/images/{id}.image.png`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get download urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageDownloadUrls: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getImageDownloadUrls', 'id', id)\n            const localVarPath = `/api/images/{id}/download-urls`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get upload urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageUploadUrls: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getImageUploadUrls', 'id', id)\n            const localVarPath = `/api/images/{id}/upload-urls`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the binary mask data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getMaskData: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getMaskData', 'id', id)\n            const localVarPath = `/api/images/{id}.mask.png`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the binary image data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getNpyData: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getNpyData', 'id', id)\n            const localVarPath = `/api/images/{id}.npy`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the list of orders\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getOrders: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/orders`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the binary thumbnail data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getThumbnailData: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getThumbnailData', 'id', id)\n            const localVarPath = `/api/images/{id}.thumbnail.png`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the binary video data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getVideoData: async (id: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('getVideoData', 'id', id)\n            const localVarPath = `/api/images/{id}.mp4`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get a worker\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getWorker: async (workerId: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'workerId' is not null or undefined\n            assertParamExists('getWorker', 'workerId', workerId)\n            const localVarPath = `/api/workers/{worker_id}`\n                .replace(`{${\"worker_id\"}}`, encodeURIComponent(String(workerId)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get a worker config\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getWorkerConfig: async (workerId: string, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'workerId' is not null or undefined\n            assertParamExists('getWorkerConfig', 'workerId', workerId)\n            const localVarPath = `/api/workers/{worker_id}/config`\n                .replace(`{${\"worker_id\"}}`, encodeURIComponent(String(workerId)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the list of workers\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getWorkers: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/workers`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Healthcheck\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        healthcheck: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/healthcheck`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Check if the user is admin\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        isAdmin: async (options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/is-admin`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get a list of saved images\n         * @param {number} [cursor] \n         * @param {string} [filter] \n         * @param {number} [limit] \n         * @param {'asc' | 'desc'} [direction] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        listImages: async (cursor?: number, filter?: string, limit?: number, direction?: 'asc' | 'desc', options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/images`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'GET', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n            if (cursor !== undefined) {\n                localVarQueryParameter['cursor'] = cursor;\n            }\n\n            if (filter !== undefined) {\n                localVarQueryParameter['filter'] = filter;\n            }\n\n            if (limit !== undefined) {\n                localVarQueryParameter['limit'] = limit;\n            }\n\n            if (direction !== undefined) {\n                localVarQueryParameter['direction'] = direction;\n            }\n\n\n    \n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Login by email\n         * @param {LoginInput} [loginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        login: async (loginInput?: LoginInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/auth/login`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(loginInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Log in as a worker\n         * @param {WorkerLoginCode} [workerLoginCode] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        loginAsWorker: async (workerLoginCode?: WorkerLoginCode, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/worker-login`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(workerLoginCode, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Get the next pending image and set its status to processing.\n         * @param {ProcessImageInput} [processImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        processImage: async (processImageInput?: ProcessImageInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/process-image`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'PUT', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(processImageInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Refresh Login code\n         * @param {RefreshLoginInput} [refreshLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        refresh: async (refreshLoginInput?: RefreshLoginInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/auth/refresh`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(refreshLoginInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Update a saved image\n         * @param {string} id \n         * @param {UpdateImageInput} [updateImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateImage: async (id: string, updateImageInput?: UpdateImageInput, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('updateImage', 'id', id)\n            const localVarPath = `/api/images/{id}`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'PATCH', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(updateImageInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Update the video data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateVideoData: async (id: string, body?: any, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('updateVideoData', 'id', id)\n            const localVarPath = `/api/images/{id}.mp4`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'PUT', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'video/mp4';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(body, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Update a worker\n         * @param {string} workerId \n         * @param {UpsertWorkerInput} [upsertWorkerInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateWorker: async (workerId: string, upsertWorkerInput?: UpsertWorkerInput, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'workerId' is not null or undefined\n            assertParamExists('updateWorker', 'workerId', workerId)\n            const localVarPath = `/api/workers/{worker_id}`\n                .replace(`{${\"worker_id\"}}`, encodeURIComponent(String(workerId)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'PUT', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(upsertWorkerInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Update a worker config\n         * @param {string} workerId \n         * @param {UpsertWorkerConfigInput} [upsertWorkerConfigInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateWorkerConfig: async (workerId: string, upsertWorkerConfigInput?: UpsertWorkerConfigInput, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'workerId' is not null or undefined\n            assertParamExists('updateWorkerConfig', 'workerId', workerId)\n            const localVarPath = `/api/workers/{worker_id}/config`\n                .replace(`{${\"worker_id\"}}`, encodeURIComponent(String(workerId)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'PUT', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(upsertWorkerConfigInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Upload the binary image data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        uploadImageData: async (id: string, body?: any, options: any = {}): Promise<RequestArgs> => {\n            // verify required parameter 'id' is not null or undefined\n            assertParamExists('uploadImageData', 'id', id)\n            const localVarPath = `/api/images/{id}.image.png`\n                .replace(`{${\"id\"}}`, encodeURIComponent(String(id)));\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'PUT', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'image/png';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(body, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n        /**\n         * Verify Login code\n         * @param {VerifyLoginInput} [verifyLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        verify: async (verifyLoginInput?: VerifyLoginInput, options: any = {}): Promise<RequestArgs> => {\n            const localVarPath = `/api/auth/verify`;\n            // use dummy base URL string because the URL constructor only accepts absolute URLs.\n            const localVarUrlObj = new URL(localVarPath, DUMMY_BASE_URL);\n            let baseOptions;\n            if (configuration) {\n                baseOptions = configuration.baseOptions;\n            }\n\n            const localVarRequestOptions = { method: 'POST', ...baseOptions, ...options};\n            const localVarHeaderParameter = {} as any;\n            const localVarQueryParameter = {} as any;\n\n\n    \n            localVarHeaderParameter['Content-Type'] = 'application/json';\n\n            setSearchParams(localVarUrlObj, localVarQueryParameter, options.query);\n            let headersFromBaseOptions = baseOptions && baseOptions.headers ? baseOptions.headers : {};\n            localVarRequestOptions.headers = {...localVarHeaderParameter, ...headersFromBaseOptions, ...options.headers};\n            localVarRequestOptions.data = serializeDataIfNeeded(verifyLoginInput, localVarRequestOptions, configuration)\n\n            return {\n                url: toPathString(localVarUrlObj),\n                options: localVarRequestOptions,\n            };\n        },\n    }\n};\n\n/**\n * AIBrushApi - functional programming interface\n * @export\n */\nexport const AIBrushApiFp = function(configuration?: Configuration) {\n    const localVarAxiosParamCreator = AIBrushApiAxiosParamCreator(configuration)\n    return {\n        /**\n         * Add Metrics\n         * @param {AddMetricsInput} [addMetricsInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async addMetrics(addMetricsInput?: AddMetricsInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.addMetrics(addMetricsInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get a list of saved images by id\n         * @param {BatchGetImagesInput} [batchGetImagesInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async batchGetImages(batchGetImagesInput?: BatchGetImagesInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<ImageList>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.batchGetImages(batchGetImagesInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Create a new image\n         * @param {CreateImageInput} [createImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async createImage(createImageInput?: CreateImageInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<ImageList>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.createImage(createImageInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Create a new invite code\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async createInviteCode(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<InviteCode>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.createInviteCode(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Create a new order\n         * @param {CreateOrderInput} [createOrderInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async createOrder(createOrderInput?: CreateOrderInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Order>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.createOrder(createOrderInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Create a service account\n         * @param {CreateServiceAccountInput} [createServiceAccountInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async createServiceAccount(createServiceAccountInput?: CreateServiceAccountInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<LoginResult>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.createServiceAccount(createServiceAccountInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Create a new worker\n         * @param {UpsertWorkerInput} [upsertWorkerInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async createWorker(upsertWorkerInput?: UpsertWorkerInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Worker>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.createWorker(upsertWorkerInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Delete a saved image\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async deleteImage(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.deleteImage(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Delete a worker\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async deleteWorker(workerId: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.deleteWorker(workerId, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Log in with Discord\n         * @param {DiscordLogin} [discordLogin] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async discordLogin(discordLogin?: DiscordLogin, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<LoginResult>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.discordLogin(discordLogin, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Generate a login code for a worker\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async generateWorkerLoginCode(workerId: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<WorkerLoginCode>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.generateWorkerLoginCode(workerId, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the assets url\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getAssetsUrl(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<AssetsUrl>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getAssetsUrl(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the features\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getFeatures(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<FeatureList>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getFeatures(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get a saved image by id\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getImage(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Image>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getImage(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the binary image data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getImageData(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<any>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getImageData(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get download urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getImageDownloadUrls(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<ImageUrls>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getImageDownloadUrls(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get upload urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getImageUploadUrls(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<ImageUrls>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getImageUploadUrls(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the binary mask data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getMaskData(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<any>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getMaskData(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the binary image data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getNpyData(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<any>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getNpyData(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the list of orders\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getOrders(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<OrderList>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getOrders(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the binary thumbnail data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getThumbnailData(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<any>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getThumbnailData(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the binary video data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getVideoData(id: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<any>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getVideoData(id, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get a worker\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getWorker(workerId: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Worker>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getWorker(workerId, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get a worker config\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getWorkerConfig(workerId: string, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<WorkerConfig>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getWorkerConfig(workerId, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the list of workers\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async getWorkers(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<WorkerList>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.getWorkers(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Healthcheck\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async healthcheck(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Healthcheck>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.healthcheck(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Check if the user is admin\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async isAdmin(options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<IsAdminResponse>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.isAdmin(options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get a list of saved images\n         * @param {number} [cursor] \n         * @param {string} [filter] \n         * @param {number} [limit] \n         * @param {'asc' | 'desc'} [direction] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async listImages(cursor?: number, filter?: string, limit?: number, direction?: 'asc' | 'desc', options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<ImageList>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.listImages(cursor, filter, limit, direction, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Login by email\n         * @param {LoginInput} [loginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async login(loginInput?: LoginInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.login(loginInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Log in as a worker\n         * @param {WorkerLoginCode} [workerLoginCode] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async loginAsWorker(workerLoginCode?: WorkerLoginCode, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<LoginResult>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.loginAsWorker(workerLoginCode, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Get the next pending image and set its status to processing.\n         * @param {ProcessImageInput} [processImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async processImage(processImageInput?: ProcessImageInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Image>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.processImage(processImageInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Refresh Login code\n         * @param {RefreshLoginInput} [refreshLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async refresh(refreshLoginInput?: RefreshLoginInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<LoginResult>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.refresh(refreshLoginInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Update a saved image\n         * @param {string} id \n         * @param {UpdateImageInput} [updateImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async updateImage(id: string, updateImageInput?: UpdateImageInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Image>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.updateImage(id, updateImageInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Update the video data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async updateVideoData(id: string, body?: any, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.updateVideoData(id, body, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Update a worker\n         * @param {string} workerId \n         * @param {UpsertWorkerInput} [upsertWorkerInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async updateWorker(workerId: string, upsertWorkerInput?: UpsertWorkerInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<Worker>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.updateWorker(workerId, upsertWorkerInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Update a worker config\n         * @param {string} workerId \n         * @param {UpsertWorkerConfigInput} [upsertWorkerConfigInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async updateWorkerConfig(workerId: string, upsertWorkerConfigInput?: UpsertWorkerConfigInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<WorkerConfig>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.updateWorkerConfig(workerId, upsertWorkerConfigInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Upload the binary image data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async uploadImageData(id: string, body?: any, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<void>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.uploadImageData(id, body, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n        /**\n         * Verify Login code\n         * @param {VerifyLoginInput} [verifyLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        async verify(verifyLoginInput?: VerifyLoginInput, options?: any): Promise<(axios?: AxiosInstance, basePath?: string) => AxiosPromise<LoginResult>> {\n            const localVarAxiosArgs = await localVarAxiosParamCreator.verify(verifyLoginInput, options);\n            return createRequestFunction(localVarAxiosArgs, globalAxios, BASE_PATH, configuration);\n        },\n    }\n};\n\n/**\n * AIBrushApi - factory interface\n * @export\n */\nexport const AIBrushApiFactory = function (configuration?: Configuration, basePath?: string, axios?: AxiosInstance) {\n    const localVarFp = AIBrushApiFp(configuration)\n    return {\n        /**\n         * Add Metrics\n         * @param {AddMetricsInput} [addMetricsInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        addMetrics(addMetricsInput?: AddMetricsInput, options?: any): AxiosPromise<void> {\n            return localVarFp.addMetrics(addMetricsInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get a list of saved images by id\n         * @param {BatchGetImagesInput} [batchGetImagesInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        batchGetImages(batchGetImagesInput?: BatchGetImagesInput, options?: any): AxiosPromise<ImageList> {\n            return localVarFp.batchGetImages(batchGetImagesInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Create a new image\n         * @param {CreateImageInput} [createImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createImage(createImageInput?: CreateImageInput, options?: any): AxiosPromise<ImageList> {\n            return localVarFp.createImage(createImageInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Create a new invite code\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createInviteCode(options?: any): AxiosPromise<InviteCode> {\n            return localVarFp.createInviteCode(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Create a new order\n         * @param {CreateOrderInput} [createOrderInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createOrder(createOrderInput?: CreateOrderInput, options?: any): AxiosPromise<Order> {\n            return localVarFp.createOrder(createOrderInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Create a service account\n         * @param {CreateServiceAccountInput} [createServiceAccountInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createServiceAccount(createServiceAccountInput?: CreateServiceAccountInput, options?: any): AxiosPromise<LoginResult> {\n            return localVarFp.createServiceAccount(createServiceAccountInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Create a new worker\n         * @param {UpsertWorkerInput} [upsertWorkerInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        createWorker(upsertWorkerInput?: UpsertWorkerInput, options?: any): AxiosPromise<Worker> {\n            return localVarFp.createWorker(upsertWorkerInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Delete a saved image\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        deleteImage(id: string, options?: any): AxiosPromise<void> {\n            return localVarFp.deleteImage(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Delete a worker\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        deleteWorker(workerId: string, options?: any): AxiosPromise<void> {\n            return localVarFp.deleteWorker(workerId, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Log in with Discord\n         * @param {DiscordLogin} [discordLogin] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        discordLogin(discordLogin?: DiscordLogin, options?: any): AxiosPromise<LoginResult> {\n            return localVarFp.discordLogin(discordLogin, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Generate a login code for a worker\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        generateWorkerLoginCode(workerId: string, options?: any): AxiosPromise<WorkerLoginCode> {\n            return localVarFp.generateWorkerLoginCode(workerId, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the assets url\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getAssetsUrl(options?: any): AxiosPromise<AssetsUrl> {\n            return localVarFp.getAssetsUrl(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the features\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getFeatures(options?: any): AxiosPromise<FeatureList> {\n            return localVarFp.getFeatures(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get a saved image by id\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImage(id: string, options?: any): AxiosPromise<Image> {\n            return localVarFp.getImage(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the binary image data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageData(id: string, options?: any): AxiosPromise<any> {\n            return localVarFp.getImageData(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get download urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageDownloadUrls(id: string, options?: any): AxiosPromise<ImageUrls> {\n            return localVarFp.getImageDownloadUrls(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get upload urls for image assets\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getImageUploadUrls(id: string, options?: any): AxiosPromise<ImageUrls> {\n            return localVarFp.getImageUploadUrls(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the binary mask data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getMaskData(id: string, options?: any): AxiosPromise<any> {\n            return localVarFp.getMaskData(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the binary image data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getNpyData(id: string, options?: any): AxiosPromise<any> {\n            return localVarFp.getNpyData(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the list of orders\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getOrders(options?: any): AxiosPromise<OrderList> {\n            return localVarFp.getOrders(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the binary thumbnail data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getThumbnailData(id: string, options?: any): AxiosPromise<any> {\n            return localVarFp.getThumbnailData(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the binary video data\n         * @param {string} id \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getVideoData(id: string, options?: any): AxiosPromise<any> {\n            return localVarFp.getVideoData(id, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get a worker\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getWorker(workerId: string, options?: any): AxiosPromise<Worker> {\n            return localVarFp.getWorker(workerId, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get a worker config\n         * @param {string} workerId \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getWorkerConfig(workerId: string, options?: any): AxiosPromise<WorkerConfig> {\n            return localVarFp.getWorkerConfig(workerId, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the list of workers\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        getWorkers(options?: any): AxiosPromise<WorkerList> {\n            return localVarFp.getWorkers(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Healthcheck\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        healthcheck(options?: any): AxiosPromise<Healthcheck> {\n            return localVarFp.healthcheck(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Check if the user is admin\n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        isAdmin(options?: any): AxiosPromise<IsAdminResponse> {\n            return localVarFp.isAdmin(options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get a list of saved images\n         * @param {number} [cursor] \n         * @param {string} [filter] \n         * @param {number} [limit] \n         * @param {'asc' | 'desc'} [direction] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        listImages(cursor?: number, filter?: string, limit?: number, direction?: 'asc' | 'desc', options?: any): AxiosPromise<ImageList> {\n            return localVarFp.listImages(cursor, filter, limit, direction, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Login by email\n         * @param {LoginInput} [loginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        login(loginInput?: LoginInput, options?: any): AxiosPromise<void> {\n            return localVarFp.login(loginInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Log in as a worker\n         * @param {WorkerLoginCode} [workerLoginCode] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        loginAsWorker(workerLoginCode?: WorkerLoginCode, options?: any): AxiosPromise<LoginResult> {\n            return localVarFp.loginAsWorker(workerLoginCode, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Get the next pending image and set its status to processing.\n         * @param {ProcessImageInput} [processImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        processImage(processImageInput?: ProcessImageInput, options?: any): AxiosPromise<Image> {\n            return localVarFp.processImage(processImageInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Refresh Login code\n         * @param {RefreshLoginInput} [refreshLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        refresh(refreshLoginInput?: RefreshLoginInput, options?: any): AxiosPromise<LoginResult> {\n            return localVarFp.refresh(refreshLoginInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Update a saved image\n         * @param {string} id \n         * @param {UpdateImageInput} [updateImageInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateImage(id: string, updateImageInput?: UpdateImageInput, options?: any): AxiosPromise<Image> {\n            return localVarFp.updateImage(id, updateImageInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Update the video data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateVideoData(id: string, body?: any, options?: any): AxiosPromise<void> {\n            return localVarFp.updateVideoData(id, body, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Update a worker\n         * @param {string} workerId \n         * @param {UpsertWorkerInput} [upsertWorkerInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateWorker(workerId: string, upsertWorkerInput?: UpsertWorkerInput, options?: any): AxiosPromise<Worker> {\n            return localVarFp.updateWorker(workerId, upsertWorkerInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Update a worker config\n         * @param {string} workerId \n         * @param {UpsertWorkerConfigInput} [upsertWorkerConfigInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        updateWorkerConfig(workerId: string, upsertWorkerConfigInput?: UpsertWorkerConfigInput, options?: any): AxiosPromise<WorkerConfig> {\n            return localVarFp.updateWorkerConfig(workerId, upsertWorkerConfigInput, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Upload the binary image data\n         * @param {string} id \n         * @param {any} [body] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        uploadImageData(id: string, body?: any, options?: any): AxiosPromise<void> {\n            return localVarFp.uploadImageData(id, body, options).then((request) => request(axios, basePath));\n        },\n        /**\n         * Verify Login code\n         * @param {VerifyLoginInput} [verifyLoginInput] \n         * @param {*} [options] Override http request option.\n         * @throws {RequiredError}\n         */\n        verify(verifyLoginInput?: VerifyLoginInput, options?: any): AxiosPromise<LoginResult> {\n            return localVarFp.verify(verifyLoginInput, options).then((request) => request(axios, basePath));\n        },\n    };\n};\n\n/**\n * AIBrushApi - object-oriented interface\n * @export\n * @class AIBrushApi\n * @extends {BaseAPI}\n */\nexport class AIBrushApi extends BaseAPI {\n    /**\n     * Add Metrics\n     * @param {AddMetricsInput} [addMetricsInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public addMetrics(addMetricsInput?: AddMetricsInput, options?: any) {\n        return AIBrushApiFp(this.configuration).addMetrics(addMetricsInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get a list of saved images by id\n     * @param {BatchGetImagesInput} [batchGetImagesInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public batchGetImages(batchGetImagesInput?: BatchGetImagesInput, options?: any) {\n        return AIBrushApiFp(this.configuration).batchGetImages(batchGetImagesInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Create a new image\n     * @param {CreateImageInput} [createImageInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public createImage(createImageInput?: CreateImageInput, options?: any) {\n        return AIBrushApiFp(this.configuration).createImage(createImageInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Create a new invite code\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public createInviteCode(options?: any) {\n        return AIBrushApiFp(this.configuration).createInviteCode(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Create a new order\n     * @param {CreateOrderInput} [createOrderInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public createOrder(createOrderInput?: CreateOrderInput, options?: any) {\n        return AIBrushApiFp(this.configuration).createOrder(createOrderInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Create a service account\n     * @param {CreateServiceAccountInput} [createServiceAccountInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public createServiceAccount(createServiceAccountInput?: CreateServiceAccountInput, options?: any) {\n        return AIBrushApiFp(this.configuration).createServiceAccount(createServiceAccountInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Create a new worker\n     * @param {UpsertWorkerInput} [upsertWorkerInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public createWorker(upsertWorkerInput?: UpsertWorkerInput, options?: any) {\n        return AIBrushApiFp(this.configuration).createWorker(upsertWorkerInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Delete a saved image\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public deleteImage(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).deleteImage(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Delete a worker\n     * @param {string} workerId \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public deleteWorker(workerId: string, options?: any) {\n        return AIBrushApiFp(this.configuration).deleteWorker(workerId, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Log in with Discord\n     * @param {DiscordLogin} [discordLogin] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public discordLogin(discordLogin?: DiscordLogin, options?: any) {\n        return AIBrushApiFp(this.configuration).discordLogin(discordLogin, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Generate a login code for a worker\n     * @param {string} workerId \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public generateWorkerLoginCode(workerId: string, options?: any) {\n        return AIBrushApiFp(this.configuration).generateWorkerLoginCode(workerId, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the assets url\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getAssetsUrl(options?: any) {\n        return AIBrushApiFp(this.configuration).getAssetsUrl(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the features\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getFeatures(options?: any) {\n        return AIBrushApiFp(this.configuration).getFeatures(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get a saved image by id\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getImage(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getImage(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the binary image data\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getImageData(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getImageData(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get download urls for image assets\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getImageDownloadUrls(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getImageDownloadUrls(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get upload urls for image assets\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getImageUploadUrls(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getImageUploadUrls(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the binary mask data\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getMaskData(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getMaskData(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the binary image data\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getNpyData(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getNpyData(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the list of orders\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getOrders(options?: any) {\n        return AIBrushApiFp(this.configuration).getOrders(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the binary thumbnail data\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getThumbnailData(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getThumbnailData(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the binary video data\n     * @param {string} id \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getVideoData(id: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getVideoData(id, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get a worker\n     * @param {string} workerId \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getWorker(workerId: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getWorker(workerId, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get a worker config\n     * @param {string} workerId \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getWorkerConfig(workerId: string, options?: any) {\n        return AIBrushApiFp(this.configuration).getWorkerConfig(workerId, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the list of workers\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public getWorkers(options?: any) {\n        return AIBrushApiFp(this.configuration).getWorkers(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Healthcheck\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public healthcheck(options?: any) {\n        return AIBrushApiFp(this.configuration).healthcheck(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Check if the user is admin\n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public isAdmin(options?: any) {\n        return AIBrushApiFp(this.configuration).isAdmin(options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get a list of saved images\n     * @param {number} [cursor] \n     * @param {string} [filter] \n     * @param {number} [limit] \n     * @param {'asc' | 'desc'} [direction] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public listImages(cursor?: number, filter?: string, limit?: number, direction?: 'asc' | 'desc', options?: any) {\n        return AIBrushApiFp(this.configuration).listImages(cursor, filter, limit, direction, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Login by email\n     * @param {LoginInput} [loginInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public login(loginInput?: LoginInput, options?: any) {\n        return AIBrushApiFp(this.configuration).login(loginInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Log in as a worker\n     * @param {WorkerLoginCode} [workerLoginCode] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public loginAsWorker(workerLoginCode?: WorkerLoginCode, options?: any) {\n        return AIBrushApiFp(this.configuration).loginAsWorker(workerLoginCode, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Get the next pending image and set its status to processing.\n     * @param {ProcessImageInput} [processImageInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public processImage(processImageInput?: ProcessImageInput, options?: any) {\n        return AIBrushApiFp(this.configuration).processImage(processImageInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Refresh Login code\n     * @param {RefreshLoginInput} [refreshLoginInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public refresh(refreshLoginInput?: RefreshLoginInput, options?: any) {\n        return AIBrushApiFp(this.configuration).refresh(refreshLoginInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Update a saved image\n     * @param {string} id \n     * @param {UpdateImageInput} [updateImageInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public updateImage(id: string, updateImageInput?: UpdateImageInput, options?: any) {\n        return AIBrushApiFp(this.configuration).updateImage(id, updateImageInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Update the video data\n     * @param {string} id \n     * @param {any} [body] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public updateVideoData(id: string, body?: any, options?: any) {\n        return AIBrushApiFp(this.configuration).updateVideoData(id, body, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Update a worker\n     * @param {string} workerId \n     * @param {UpsertWorkerInput} [upsertWorkerInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public updateWorker(workerId: string, upsertWorkerInput?: UpsertWorkerInput, options?: any) {\n        return AIBrushApiFp(this.configuration).updateWorker(workerId, upsertWorkerInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Update a worker config\n     * @param {string} workerId \n     * @param {UpsertWorkerConfigInput} [upsertWorkerConfigInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public updateWorkerConfig(workerId: string, upsertWorkerConfigInput?: UpsertWorkerConfigInput, options?: any) {\n        return AIBrushApiFp(this.configuration).updateWorkerConfig(workerId, upsertWorkerConfigInput, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Upload the binary image data\n     * @param {string} id \n     * @param {any} [body] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public uploadImageData(id: string, body?: any, options?: any) {\n        return AIBrushApiFp(this.configuration).uploadImageData(id, body, options).then((request) => request(this.axios, this.basePath));\n    }\n\n    /**\n     * Verify Login code\n     * @param {VerifyLoginInput} [verifyLoginInput] \n     * @param {*} [options] Override http request option.\n     * @throws {RequiredError}\n     * @memberof AIBrushApi\n     */\n    public verify(verifyLoginInput?: VerifyLoginInput, options?: any) {\n        return AIBrushApiFp(this.configuration).verify(verifyLoginInput, options).then((request) => request(this.axios, this.basePath));\n    }\n}\n\n\n","/* tslint:disable */\n/* eslint-disable */\n/**\n * AIBrush API\n * Orchestration backend for AI Brush\n *\n * The version of the OpenAPI document: 1.0.0\n * Contact: admin@aibrush.art\n *\n * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).\n * https://openapi-generator.tech\n * Do not edit the class manually.\n */\n\n\nimport { Configuration } from \"./configuration\";\n// Some imports not used depending on template conditions\n// @ts-ignore\nimport globalAxios, { AxiosPromise, AxiosInstance } from 'axios';\n\nexport const BASE_PATH = \"https://www.aibrush.art\".replace(/\\/+$/, \"\");\n\n/**\n *\n * @export\n */\nexport const COLLECTION_FORMATS = {\n    csv: \",\",\n    ssv: \" \",\n    tsv: \"\\t\",\n    pipes: \"|\",\n};\n\n/**\n *\n * @export\n * @interface RequestArgs\n */\nexport interface RequestArgs {\n    url: string;\n    options: any;\n}\n\n/**\n *\n * @export\n * @class BaseAPI\n */\nexport class BaseAPI {\n    protected configuration: Configuration | undefined;\n\n    constructor(configuration?: Configuration, protected basePath: string = BASE_PATH, protected axios: AxiosInstance = globalAxios) {\n        if (configuration) {\n            this.configuration = configuration;\n            this.basePath = configuration.basePath || this.basePath;\n        }\n    }\n};\n\n/**\n *\n * @export\n * @class RequiredError\n * @extends {Error}\n */\nexport class RequiredError extends Error {\n    name: \"RequiredError\" = \"RequiredError\";\n    constructor(public field: string, msg?: string) {\n        super(msg);\n    }\n}\n","/* tslint:disable */\n/* eslint-disable */\n/**\n * AIBrush API\n * Orchestration backend for AI Brush\n *\n * The version of the OpenAPI document: 1.0.0\n * Contact: admin@aibrush.art\n *\n * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).\n * https://openapi-generator.tech\n * Do not edit the class manually.\n */\n\n\nimport { Configuration } from \"./configuration\";\nimport { RequiredError,RequestArgs } from \"./base\";\nimport { AxiosInstance } from 'axios';\n\n/**\n *\n * @export\n */\nexport const DUMMY_BASE_URL = 'https://example.com'\n\n/**\n *\n * @throws {RequiredError}\n * @export\n */\nexport const assertParamExists = function (functionName: string, paramName: string, paramValue: unknown) {\n    if (paramValue === null || paramValue === undefined) {\n        throw new RequiredError(paramName, `Required parameter ${paramName} was null or undefined when calling ${functionName}.`);\n    }\n}\n\n/**\n *\n * @export\n */\nexport const setApiKeyToObject = async function (object: any, keyParamName: string, configuration?: Configuration) {\n    if (configuration && configuration.apiKey) {\n        const localVarApiKeyValue = typeof configuration.apiKey === 'function'\n            ? await configuration.apiKey(keyParamName)\n            : await configuration.apiKey;\n        object[keyParamName] = localVarApiKeyValue;\n    }\n}\n\n/**\n *\n * @export\n */\nexport const setBasicAuthToObject = function (object: any, configuration?: Configuration) {\n    if (configuration && (configuration.username || configuration.password)) {\n        object[\"auth\"] = { username: configuration.username, password: configuration.password };\n    }\n}\n\n/**\n *\n * @export\n */\nexport const setBearerAuthToObject = async function (object: any, configuration?: Configuration) {\n    if (configuration && configuration.accessToken) {\n        const accessToken = typeof configuration.accessToken === 'function'\n            ? await configuration.accessToken()\n            : await configuration.accessToken;\n        object[\"Authorization\"] = \"Bearer \" + accessToken;\n    }\n}\n\n/**\n *\n * @export\n */\nexport const setOAuthToObject = async function (object: any, name: string, scopes: string[], configuration?: Configuration) {\n    if (configuration && configuration.accessToken) {\n        const localVarAccessTokenValue = typeof configuration.accessToken === 'function'\n            ? await configuration.accessToken(name, scopes)\n            : await configuration.accessToken;\n        object[\"Authorization\"] = \"Bearer \" + localVarAccessTokenValue;\n    }\n}\n\n/**\n *\n * @export\n */\nexport const setSearchParams = function (url: URL, ...objects: any[]) {\n    const searchParams = new URLSearchParams(url.search);\n    for (const object of objects) {\n        for (const key in object) {\n            if (Array.isArray(object[key])) {\n                searchParams.delete(key);\n                for (const item of object[key]) {\n                    searchParams.append(key, item);\n                }\n            } else {\n                searchParams.set(key, object[key]);\n            }\n        }\n    }\n    url.search = searchParams.toString();\n}\n\n/**\n *\n * @export\n */\nexport const serializeDataIfNeeded = function (value: any, requestOptions: any, configuration?: Configuration) {\n    const nonString = typeof value !== 'string';\n    const needsSerialization = nonString && configuration && configuration.isJsonMime\n        ? configuration.isJsonMime(requestOptions.headers['Content-Type'])\n        : nonString;\n    return needsSerialization\n        ? JSON.stringify(value !== undefined ? value : {})\n        : (value || \"\");\n}\n\n/**\n *\n * @export\n */\nexport const toPathString = function (url: URL) {\n    return url.pathname + url.search + url.hash\n}\n\n/**\n *\n * @export\n */\nexport const createRequestFunction = function (axiosArgs: RequestArgs, globalAxios: AxiosInstance, BASE_PATH: string, configuration?: Configuration) {\n    return (axios: AxiosInstance = globalAxios, basePath: string = BASE_PATH) => {\n        const axiosRequestArgs = {...axiosArgs.options, url: (configuration?.basePath || basePath) + axiosArgs.url};\n        return axios.request(axiosRequestArgs);\n    };\n}\n","import React, { FC, useState, useEffect } from \"react\";\nimport loadImage from \"blueimp-load-image\";\nimport saveAs from \"file-saver\";\n\nimport { AIBrushApi } from \"../../client\";\nimport { Renderer } from \"./renderer\";\nimport { BaseTool, Tool } from \"./tool\";\n\ninterface Props {\n    renderer: Renderer;\n    tool: BaseTool;\n    api: AIBrushApi;\n}\n\nexport const ImportExportControls: FC<Props> = ({ renderer, tool }) => {\n\n    const [backupImage, setBackupImage] = useState<string | undefined>();\n\n    const onImageSelected = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const files = event.target.files;\n        if (files && files.length > 0) {\n            loadImage(\n                files[0],\n                (img) => {\n                    const backupImage = renderer.getEncodedImage(null);\n                    setBackupImage(backupImage);\n                    renderer.setBaseImage(img as HTMLImageElement);\n                },\n                { canvas: false }\n            );\n        }\n    };\n\n    const onExport = () => {\n        const encodedImage = renderer.getEncodedImage(null);\n        if (encodedImage) {\n            // base64 decode\n            const byteString = atob(encodedImage);\n            // save as file\n            const buffer = new ArrayBuffer(byteString.length);\n            const intArray = new Uint8Array(buffer);\n            for (let i = 0; i < byteString.length; i++) {\n                intArray[i] = byteString.charCodeAt(i);\n            }\n            const blob = new Blob([intArray], { type: \"image/png\" });\n            saveAs(blob, \"image.png\");\n        }\n    };\n\n    if (backupImage) {\n        return (\n            <div className=\"form-group\" style={{marginTop: \"16px\"}}>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => {\n                        setBackupImage(undefined);\n                        const img = new Image();\n                        // set src as data uri\n                        const src = \"data:image/png;base64,\" + backupImage;\n                        img.src = src;\n                        img.onload = () => {\n                            renderer.setBaseImage(img);\n                        };\n                    }}\n                >\n                    {/* cancel icon */}\n                    <i className=\"fas fa-times\"></i>&nbsp;\n                    Revert\n                </button>\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => {\n                        setBackupImage(undefined);\n                        if (tool.saveListener) {\n                            tool.saveListener(backupImage);\n                        }\n                    }}\n                    style={{marginLeft: \"8px\"}}\n                >\n                    {/* save icon */}\n                    <i className=\"fas fa-save\"></i>&nbsp;\n                    Save\n                </button>\n            </div>\n        );\n    }\n\n    // Show buttons for import and export and \"save a copy\"\n    return (\n        <>\n            <div className=\"form-group\" style={{marginTop: \"16px\"}}>\n                <label\n                    id=\"loadimage-wrapper\"\n                    className={`btn btn-primary `}\n                    style={{ display: \"inline\" }}\n                >\n                    {/* upload image */}\n                    <i className=\"fas fa-upload\"></i>&nbsp; Import Image\n                    <input\n                        id=\"loadimage\"\n                        type=\"file\"\n                        style={{ display: \"none\" }}\n                        onChange={onImageSelected}\n                    />\n                </label>\n            </div>\n            <div className=\"form-group\">\n                <button\n                    className=\"btn btn-primary\"\n                    onClick={() => {\n                        onExport();\n                    }}\n                    style={{ marginLeft: \"8px\"}}\n                >\n                    <i className=\"fas fa-download\"></i>&nbsp; Export Image\n                </button>\n            </div>\n        </>\n    );\n};\n","import { Renderer } from \"./renderer\";\n\nexport class ZoomHelper {\n\n    private startTouches: React.TouchList | null;\n    private startZoom = 1;\n    private startOffsetX = 0;\n    private startOffsetY = 0;\n\n    constructor(private renderer: Renderer) {\n        this.startTouches = null;\n    }\n\n    onWheel(event: WheelEvent) {\n        const originalZoom = this.renderer.getZoom();\n        let zoom = this.renderer.getZoom();\n        let offsetX = this.renderer.getOffsetX();\n        let offsetY = this.renderer.getOffsetY();\n\n        let canvasPoint = this.translateMouseToCanvasCoordinates(\n            event.offsetX,\n            event.offsetY\n        );\n        // console.log(\"x: \" + x + \", y: \" + y);\n        \n        if (event.deltaY < 0) {\n            zoom += 0.1 * zoom;\n        } else {\n            zoom -= 0.1 * zoom;\n        }\n        zoom = Math.max(0.1, Math.min(zoom, 8.0));\n\n        let xDiff = canvasPoint.x - -offsetX;\n        let yDiff = canvasPoint.y - -offsetY;\n\n        // offsetX = canvasPoint.x - xDiff * (zoom / originalZoom);\n        // offsetY = canvasPoint.y - yDiff * (zoom / originalZoom);\n        offsetX -= xDiff * (zoom / originalZoom) - xDiff;\n        offsetY -= yDiff * (zoom / originalZoom) - yDiff;\n\n        this.renderer.updateZoomAndOffset(zoom, offsetX, offsetY);\n    }\n\n    onPan(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        let movementX = event.movementX;\n        let movementY = event.movementY;\n        // translate offset to canvas coordinates\n        let rect = (\n            event.target as HTMLCanvasElement\n        ).getBoundingClientRect();\n        movementX = (movementX / rect.width) * this.renderer.getWidth();\n        movementY = (movementY / rect.height) * this.renderer.getHeight();\n\n        let zoom = this.renderer.getZoom();\n        let offsetX = this.renderer.getOffsetX();\n        let offsetY = this.renderer.getOffsetY();\n\n        offsetX += movementX / zoom;\n        offsetY += movementY / zoom;\n\n        this.renderer.updateZoomAndOffset(zoom, offsetX, offsetY);\n    }\n\n    onTouchStart(event: React.TouchEvent<HTMLCanvasElement>) {\n        if (event.touches.length === 2) {\n            this.startTouches = event.touches;\n            this.startZoom = this.renderer.getZoom();\n            this.startOffsetX = this.renderer.getOffsetX();\n            this.startOffsetY = this.renderer.getOffsetY();\n        }\n    }\n\n    onTouchMove(event: React.TouchEvent<HTMLCanvasElement>) {\n        if (this.startTouches) {\n            const canvasRect = this.renderer.getCanvas().getBoundingClientRect();\n            const startTouch1 = this.startTouches[0];\n            const startTouch2 = this.startTouches[1];\n            const touch1 = event.touches[0];\n            const touch2 = event.touches[1];\n\n            const startDistance = Math.sqrt(\n                Math.pow(startTouch1.clientX - startTouch2.clientX, 2) +\n                Math.pow(startTouch1.clientY - startTouch2.clientY, 2)\n            );\n            const distance = Math.sqrt(\n                Math.pow(touch1.clientX - touch2.clientX, 2) +\n                Math.pow(touch1.clientY - touch2.clientY, 2)\n            );\n            const zoom = this.startZoom * (distance / startDistance);\n\n            const startCenterX = (startTouch1.clientX + startTouch2.clientX) / 2;\n            const startCenterY = (startTouch1.clientY + startTouch2.clientY) / 2;\n            const centerX = (touch1.clientX + touch2.clientX) / 2;\n            const centerY = (touch1.clientY + touch2.clientY) / 2;\n\n            const startCanvasPoint = this.translateMouseToCanvasCoordinates(\n                startCenterX - canvasRect.left,\n                startCenterY - canvasRect.top\n            );\n            const canvasPoint = this.translateMouseToCanvasCoordinates(\n                centerX - canvasRect.left,\n                centerY - canvasRect.top\n            );\n\n            let offsetX = this.startOffsetX;\n            let offsetY = this.startOffsetY;\n\n            let xDiff = canvasPoint.x - startCanvasPoint.x;\n            let yDiff = canvasPoint.y - startCanvasPoint.y;\n\n            let xDiff2 = canvasPoint.x - -this.renderer.getOffsetX();\n            let yDiff2 = canvasPoint.y - -this.renderer.getOffsetY();\n\n            offsetX -= xDiff2 * (zoom / this.startZoom) - xDiff2 - (xDiff * (distance / startDistance));\n            offsetY -= yDiff2 * (zoom / this.startZoom) - yDiff2 - (yDiff * (distance / startDistance));\n\n            this.renderer.updateZoomAndOffset(zoom, offsetX, offsetY);\n        }\n    }\n\n    onTouchEnd(event: React.TouchEvent<HTMLCanvasElement>) {\n        this.startTouches = null;\n    }\n\n\n    translateMouseToCanvasCoordinates(mouseX: number, mouseY: number, zoom?: number, offsetX?: number, offsetY?: number) {\n        let x = mouseX;\n        let y = mouseY;\n        // adjust for zoom\n        zoom = zoom || this.renderer.getZoom();\n        offsetX = offsetX || this.renderer.getOffsetX();\n        offsetY = offsetY || this.renderer.getOffsetY();\n        x = x / zoom;\n        y = y / zoom;\n\n        // translate offset to canvas coordinates\n        let rect = this.renderer.getCanvas().getBoundingClientRect();\n\n        // x = (x / rect.width) * this.renderer.getWidth();\n        // y = (y / rect.height) * this.renderer.getHeight();\n\n        x = (x / rect.width) * 512;\n        y = (y / rect.height) * 512;\n\n        x = Math.round(x - offsetX);\n        y = Math.round(y - offsetY);\n\n        return { x: x, y: y };\n    }\n\n    translateCanvasToMouseCoordinates(x: number, y: number, zoom?: number, offsetX?: number, offsetY?: number) {\n        zoom = zoom || this.renderer.getZoom();\n        offsetX = offsetX || this.renderer.getOffsetX();\n        offsetY = offsetY || this.renderer.getOffsetY();\n        x = x + offsetX;\n        y = y + offsetY;\n        x = x * zoom;\n        y = y * zoom;\n\n        // translate offset to canvas coordinates\n        let rect = this.renderer.getCanvas().getBoundingClientRect();\n        x = Math.round((x / this.renderer.getWidth()) * rect.width);\n        y = Math.round((y / this.renderer.getHeight()) * rect.height);\n\n        return { x: x, y: y };\n    }\n}","import React from \"react\";\nimport { Renderer } from \"./renderer\";\nimport { ZoomHelper } from \"./zoomHelper\";\n\nexport interface Tool {\n    name: string;\n    getArgs(): any;\n    updateArgs(args: any): void;\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void;\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void;\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void;\n    onMouseLeave(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>): void;\n\n    onTouchStart(event: React.TouchEvent<HTMLCanvasElement>): void;\n    onTouchMove(event: React.TouchEvent<HTMLCanvasElement>): void;\n    onTouchEnd(event: React.TouchEvent<HTMLCanvasElement>): void;\n\n    onKeyDown(event: KeyboardEvent): void;\n    onKeyUp(event: KeyboardEvent): void;\n    onWheel(event: WheelEvent): void;\n    destroy(): boolean;\n    onShowSelectionControls(listener: (show: boolean) => void): void;\n    select(direction: \"left\" | \"right\"): void;\n    onSaveImage(listener: (encodedImage: string) => void): void;\n}\n\nexport class BaseTool implements Tool {\n    saveListener?: (encodedImage: string) => void = () => {};\n\n    private touchHandle: number | undefined;\n\n    readonly zoomHelper: ZoomHelper;\n\n    private _pinchZooming = false;\n\n    constructor(readonly renderer: Renderer, readonly name: string) {\n        this.zoomHelper = new ZoomHelper(renderer);\n    }\n\n    getArgs(): any {\n        return JSON.parse(\n            localStorage.getItem(`tool_args_${this.name}`) || \"{}\"\n        );\n    }\n    updateArgs(args: any) {\n        localStorage.setItem(`tool_args_${this.name}`, JSON.stringify(args));\n    }\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {}\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {}\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {}\n    onMouseLeave(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {}\n\n    onTouchStart(event: React.TouchEvent<HTMLCanvasElement>) {\n        if (this.touchHandle) {\n            window.clearTimeout(this.touchHandle);\n        }\n        const touches: React.Touch[] = [];\n        // make a deep copy so that the values live past the delay\n        for (let i = 0; i < event.touches.length; i++) {\n            const touch = event.touches[i];\n            touches.push({\n                identifier: touch.identifier,\n                clientX: touch.clientX,\n                clientY: touch.clientY,\n                pageX: touch.pageX,\n                pageY: touch.pageY,\n                screenX: touch.screenX,\n                screenY: touch.screenY,\n                target: null,\n            } as any);\n        }\n        event = {\n            touches,\n        } as any;\n        this.touchHandle = window.setTimeout(() => {\n            this.touchHandle = undefined;\n            if (event.touches.length === 2) {\n                this._pinchZooming = true;\n                this.zoomHelper.onTouchStart(event);\n            } else {\n                const rect = this.renderer.getCanvas().getBoundingClientRect();\n                const touch = event.touches[0];\n                if (touch) {\n                    this.onMouseDown({\n                        type: \"touch\",\n                        button: 0,\n                        nativeEvent: {\n                            offsetX: touch.clientX - rect.left,\n                            offsetY: touch.clientY - rect.top,\n                        },\n                    } as any);\n                }\n            }\n        }, 200);\n    }\n    onTouchMove(event: React.TouchEvent<HTMLCanvasElement>) {\n        if (event.touches.length === 2) {\n            this.zoomHelper.onTouchMove(event);\n        } else {\n            const rect = this.renderer.getCanvas().getBoundingClientRect();\n            const touch = event.touches[0];\n            if (touch) {\n                this.onMouseMove({\n                    type: \"touch\",\n                    button: 0,\n                    nativeEvent: {\n                        offsetX: touch.clientX - rect.left,\n                        offsetY: touch.clientY - rect.top,\n                    },\n                } as any);\n            }\n        }\n    }\n    onTouchEnd(event: React.TouchEvent<HTMLCanvasElement>) {\n        if (this._pinchZooming) {\n            this._pinchZooming = false;\n            this.zoomHelper.onTouchEnd(event);\n        } else {\n            this.onMouseUp({\n                button: 0,\n                type: \"touch\",\n            } as any);\n        }\n    }\n\n    onKeyDown(event: KeyboardEvent) {}\n    onKeyUp(event: KeyboardEvent) {}\n    onWheel(event: WheelEvent) {}\n    destroy(): boolean {\n        return true;\n    }\n    onShowSelectionControls(listener: (show: boolean) => void) {}\n    select(direction: \"left\" | \"right\") {}\n    onSaveImage(listener: (encodedImage: string) => void) {\n        this.saveListener = listener;\n    }\n}\n","// Login react component with hooks\nimport React, { useState, FC } from \"react\";\nimport * as axios from \"axios\";\nimport qs from \"qs\";\nimport { AIBrushApi, LoginResult } from \"../client/api\";\n\nconsole.log(process.env)\nconst DISCORD_CLIENT_ID = \"1043951225944678490\";\n\ninterface LoginProps {\n    client: AIBrushApi;\n    onLogin: (loginResult: LoginResult) => void;\n}\n\nexport const Login: FC<LoginProps> = (props) => {\n    // login form accepts email only\n    const [email, setEmail] = useState(\"\");\n    const [emailSubmitted, setEmailSubmitted] = useState(false);\n    const [code, setCode] = useState(\"\");\n    const [err, setErr] = useState(\"\");\n\n    // check query string for invite_code\n    const query = window.location.search;\n    const queryParams = qs.parse(query.substring(1));\n    const inviteCode = queryParams[\"invite_code\"];\n\n    const onLogin = async () => {\n        // clear error\n        setErr(\"\");\n        // validate valid email\n        if (!email.match(/^[^@]+@[^@]+\\.[^@]+$/)) {\n            setErr(\"Invalid email address\");\n            return;\n        }\n\n        try {\n            await props.client.login({\n                email: email,\n                invite_code: inviteCode as string,\n            });\n            setEmailSubmitted(true);\n        } catch (err) {\n            console.error(err);\n            setErr(\"Could not login\");\n        }\n    };\n\n    const discordLink = () => {\n        // localhost url:\n        // https://discord.com/api/oauth2/authorize?client_id=1043951225944678490&redirect_uri=http%3A%2F%2Flocalhost%3A3001%2Fdiscord-login&response_type=code&scope=identify%20email\n        // prod url:\n        // https://discord.com/api/oauth2/authorize?client_id=1043951225944678490&redirect_uri=https%3A%2F%2Fwww.aibrush.art%2Fdiscord-login&response_type=code&scope=identify%20email\n        const host = window.location.host;\n        const protocol = window.location.protocol;\n        const redirectUri = `${protocol}//${host}/discord-login`;\n        const url = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${redirectUri}&response_type=code&scope=identify%20email`;\n        return url;\n    };\n\n    const onVerify = async () => {\n        // clear error\n        setErr(\"\");\n        // attempt to verify code\n        try {\n            const result = await props.client.verify({\n                email,\n                code,\n            });\n            props.onLogin(result.data);\n        } catch (err) {\n            console.error(err);\n            setErr(\"Failed to verify code\");\n        }\n    };\n\n    // bootstrap login form\n    return (\n        <>\n            <div\n                className=\"row\"\n                style={{\n                    height: \"100vh\",\n                    marginLeft: \"0px\",\n                    marginRight: \"0px\",\n                }}\n            >\n                <div className=\"col-md-6 login-splash\">\n                    {/* <div className=\"center-cropped\" style={{backgroundImage: \"url(/images/scifi-dreamland.png)\"}}></div> */}\n                    <img\n                        className=\"center-cropped\"\n                        src=\"/images/scifi-dreamland.png\"\n                    />\n                </div>\n                <div className=\"col-md-6\">\n                    <div\n                        style={{\n                            fontWeight: 500,\n                            fontSize: \"48px\",\n                            marginTop: \"200px\",\n                        }}\n                    >\n                        AiBrush\n                    </div>\n\n                    <div\n                        style={{\n                            marginLeft: \"10%\",\n                            marginRight: \"10%\",\n                            marginTop: \"88px\",\n                            marginBottom: \"24px\",\n                        }}\n                    >\n                        Login With Email\n                    </div>\n                    {/* Display error if one is set */}\n                    {/* Use <p class=\"text-danger\" */}\n                    {err && <p className=\"text-danger\">{err}</p>}\n                    {err && (\n                        <p className=\"text-info\">\n                            If you don't have an account yet, request one by\n                            sending an email to{\" \"}\n                            <a href=\"mailto:admin@aibrush.art\">\n                                admin@aibrush.art\n                            </a>\n                        </p>\n                    )}\n                    <div\n                        style={{\n                            marginLeft: \"10%\",\n                            marginRight: \"10%\",\n                            marginTop: \"24px\",\n                            textAlign: \"left\",\n                        }}\n                    >\n                        {/* If email submitted, show verify code form*/}\n                        {emailSubmitted && (\n                            <>\n                                <div className=\"form-group\">\n                                    <label htmlFor=\"verifyCode\">\n                                        Verify Code\n                                    </label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"form-control\"\n                                        id=\"verifyCode\"\n                                        placeholder=\"Verification Code\"\n                                        value={code}\n                                        onChange={(e) =>\n                                            setCode(e.target.value)\n                                        }\n                                    />\n                                </div>\n                                {/* Cancel verification and go back to email */}\n                                <button\n                                    className=\"btn btn-secondary\"\n                                    onClick={() => setEmailSubmitted(false)}\n                                >\n                                    Cancel\n                                </button>\n                                &nbsp;\n                                {/* Verify code */}\n                                <button\n                                    type=\"button\"\n                                    className=\"btn btn-primary\"\n                                    onClick={(e) => {\n                                        e.preventDefault();\n                                        onVerify();\n                                    }}\n                                >\n                                    Verify\n                                </button>\n                            </>\n                        )}\n                        {/* Else, show login form */}\n                        {!emailSubmitted && (\n                            <>\n                                <div className=\"form-group\">\n                                    <label htmlFor=\"email\">Email address</label>\n                                    <input\n                                        type=\"email\"\n                                        className=\"form-control\"\n                                        id=\"email\"\n                                        aria-describedby=\"emailHelp\"\n                                        placeholder=\"Enter email\"\n                                        value={email}\n                                        onChange={(e) =>\n                                            setEmail(e.target.value.trim())\n                                        }\n                                    />\n                                </div>\n                                <button\n                                    type=\"button\"\n                                    className=\"btn btn-primary\"\n                                    style={{ float: \"right\" }}\n                                    onClick={(e) => {\n                                        e.preventDefault();\n                                        onLogin();\n                                    }}\n                                >\n                                    Login\n                                </button>\n                            </>\n                        )}\n                    </div>\n                    <div\n                        style={{\n                            marginLeft: \"10%\",\n                            marginRight: \"10%\",\n                            marginTop: \"88px\",\n                            marginBottom: \"24px\",\n                        }}\n                    >\n                        <hr/>\n                        OR\n                    </div>\n                    <div\n                        style={{\n                            marginLeft: \"10%\",\n                            marginRight: \"10%\",\n                            marginTop: \"24px\",\n                        }}\n                    >\n                        <a href={discordLink()} className=\"btn btn-primary\">\n                            <i className=\"fab fa-discord\"></i> Login With Discord\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </>\n    );\n};\n","// Given a set of credentials, this component will refresh them\n// every 5 minutes and invoke the onCredentialsRefreshed callback\n\nimport React, { useEffect, FC } from \"react\"\nimport { LoginResult, AIBrushApi } from \"../client/api\";\n\ninterface TokenRefresherProps {\n    onCredentialsRefreshed: (loginResult: LoginResult) => void;\n    api: AIBrushApi;\n    credentials: LoginResult;\n}\n\nexport const TokenRefresher : FC<TokenRefresherProps> = ({ onCredentialsRefreshed, api, credentials }) => {\n    useEffect(() => {\n        const interval = setInterval(() => {\n            if (credentials && credentials.refreshToken) {\n                api.refresh({refreshToken: credentials.refreshToken}).then(loginResult => {\n                    onCredentialsRefreshed(loginResult.data);\n                });\n            }\n\n        }, 5 * 60 * 1000);\n        return () => {\n            clearInterval(interval);\n        };\n    }, [credentials, api, onCredentialsRefreshed]);\n    return <div></div>;\n}","import React, { FC, useEffect, useState } from 'react';\nimport { AIBrushApi } from \"../client/api\";\n\ninterface HealthcheckerProps {\n    api: AIBrushApi;\n}\n\nexport const Healthchecker: FC<HealthcheckerProps> = ({ api }) => {\n    // automatically check health every 5 seconds\n    const [healthCheck, setHealthCheck] = useState(true);\n    \n    useEffect(() => {\n        const interval = setInterval(() => {\n            api.healthcheck().then(() => setHealthCheck(true)).catch(() => setHealthCheck(false));\n        }, 5000);\n\n        return () => clearInterval(interval);\n    }, [api]);\n\n    // only display bootstrap danger alert if healthcheck failed\n    // \"service is unavailable\"\n    return (\n        <div className=\"alert alert-danger\" role=\"alert\" style={{ display: healthCheck ? 'none' : 'block' }}>\n            <strong>Service is unavailable</strong>\n        </div>\n    );\n}\n\n","import React, { FC, useEffect, useState } from \"react\";\nimport { saveAs } from \"file-saver\";\n\nimport { AIBrushApi, CreateServiceAccountInputTypeEnum } from \"../client/api\";\n\ninterface Props {\n    api: AIBrushApi;\n}\n\nexport const WorkerConfigPage: FC<Props> = ({ api }) => {\n\n    const [type, setType] = useState<CreateServiceAccountInputTypeEnum>(CreateServiceAccountInputTypeEnum.Private);\n    const [isAdmin, setIsAdmin] = useState<boolean>(false);\n\n    // show some information about what a worker is and does\n    // * a worker processes requests to create images with AIBrush\n    const info = (): JSX.Element => {\n        return (\n            <>\n                <div className=\"row\">\n                    <div className=\"col-12\">\n                        <h2>Worker Config</h2>\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col-12\">\n                        <p>\n                            This page allows you to download a worker config file needed to access the AIBrush api.\n                            This file can be used to run a worker on a local or cloud machine, or a Colab notebook.\n                            Images worker requires an NVidia GPU with at least 12GB of VRAM, but at least 16GB is recommended.\n                            Suggestions worker requires an NVidia GPU with at least 16GB of VRAM.\n\n                            See the <a href=\"https://github.com/wolfgangmeyers/aibrush-2/tree/main/worker#readme\" target=\"_blank\">worker readme</a> for details on how to set up a worker process.\n                        </p>\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col-lg-6 offset-lg-3\">\n                        <hr/>\n                        <p>\n                            Here is a link to a Google Colab notebook that can be used as a worker node:\n                        </p>\n                        {/* Link to google colab notebook at https://colab.research.google.com/drive/1cW3vVjdeI19o7a9miMu47J5EDyHfZT20#scrollTo=Ed1iT6_JK0Mo */}\n                        <a className=\"btn btn-primary top-button\" href=\"https://colab.research.google.com/drive/1cW3vVjdeI19o7a9miMu47J5EDyHfZT20#scrollTo=Ed1iT6_JK0Mo\" target=\"_blank\">\n                            {/* font awesome google colab icon */}\n                            <i className=\"fab fa-google\"></i>&nbsp;\n                            Google Colab Notebook\n                        </a>\n                    </div>\n                </div>\n            </>\n        )\n    }\n\n    const download = async () => {\n        const creds = await api.createServiceAccount({\n            type: type\n        })\n        const blob = new Blob([JSON.stringify(creds.data)], { type: \"application/json\" });\n        saveAs(blob, \"credentials.json\");\n    }\n\n    // public / private dropdown\n    // download button\n    const form = (): JSX.Element => {\n        return (\n            <div className=\"row\">\n                {/* lg-6 with lg-3 offset */}\n                <div className=\"col-lg-6 offset-lg-3\">\n                    <form>\n                        {isAdmin && <div className=\"form-group\">\n                            <label htmlFor=\"type\">Type</label>\n                            <select className=\"form-control\" id=\"type\" value={type} onChange={(e) => setType(e.target.value as CreateServiceAccountInputTypeEnum)}>\n                                <option value=\"public\">Public</option>\n                                <option value=\"private\">Private</option>\n                            </select>\n                        </div>}\n                        <button type=\"submit\" className=\"btn btn-primary\" onClick={() => download()}>Download</button>\n                    </form>\n                </div>\n\n            </div>\n        )\n    }\n\n    useEffect(() => {\n        api.isAdmin().then(isAdmin => setIsAdmin(!!isAdmin.data.is_admin));\n    }, [])\n\n    return (\n        <>\n            {info()}\n            {form()}\n        </>\n    )\n}","import React, { FC, useEffect, useState } from \"react\";\nimport { Modal } from \"react-bootstrap\";\nimport { AIBrushApi, Worker, WorkerConfig } from \"../../client\";\n\ninterface Props {\n    api: AIBrushApi;\n}\n\nexport const WorkerList: FC<Props> = ({ api }) => {\n    const [workers, setWorkers] = useState<Worker[]>([]);\n    const [workerConfigs, setWorkerConfigs] = useState<WorkerConfig[]>([]);\n    const [code, setCode] = useState<string>(\"\");\n\n    function refresh() {\n        api.getWorkers().then((resp) => {\n            const workers = resp.data.workers || [];\n            setWorkers(workers);\n            const workerConfigPromises = workers.map((worker) => {\n                return api.getWorkerConfig(worker.id);\n            });\n            Promise.all(workerConfigPromises).then((workerConfigs) => {\n                setWorkerConfigs(workerConfigs.map((resp) => resp.data));\n            });\n        });\n    }\n\n    useEffect(() => {\n        refresh();\n    }, [api]);\n\n    const configsByWorkerId = workerConfigs.reduce((acc, config) => {\n        acc[config.worker_id] = config;\n        return acc;\n    }, {} as Record<string, WorkerConfig>);\n\n    const onDeleteWorker = async (worker: Worker) => {\n        await api.deleteWorker(worker.id);\n        setWorkers(workers.filter((w) => w.id !== worker.id));\n    };\n\n    const onGenerateCode = async (worker: Worker) => {\n        const resp = await api.generateWorkerLoginCode(worker.id);\n        setCode(resp.data.login_code);\n    };\n\n    const onCreateWorker = async () => {\n        const displayName = window.prompt(`Worker ${workers.length + 1}`);\n        if (displayName) {\n            const worker = await api.createWorker({\n                display_name: displayName,\n            });\n            setWorkers([...workers, worker.data]);\n        }\n    };\n\n    const onRenameWorker = async (worker: Worker) => {\n        const displayName = window.prompt(\n            worker.display_name,\n            `Worker ${workers.length + 1}`\n        );\n        if (displayName) {\n            await api.updateWorker(worker.id, {\n                display_name: displayName,\n            });\n            setWorkers(\n                workers.map((w) =>\n                    w.id === worker.id ? { ...w, display_name: displayName } : w\n                )\n            );\n        }\n    };\n\n    // for each worker, render a row\n    // show id, display name, and status. actions = delete, generate code\n\n    return (\n        <>\n            <h1>Workers</h1>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <button\n                        className=\"btn btn-primary\"\n                        onClick={onCreateWorker}\n                    >\n                        Create Worker\n                    </button>\n                    &nbsp;\n                    {/* refresh button */}\n                    <button className=\"btn btn-primary\" onClick={refresh}>\n                        Refresh\n                    </button>\n                </div>\n            </div>\n            <div className=\"row\" style={{ marginTop: \"16px\" }}>\n                <div className=\"col-12\">\n                    {workers.length > 0 && (\n                        <table className=\"table\">\n                            <thead>\n                                <tr>\n                                    <th>ID</th>\n                                    <th>Display Name</th>\n                                    <th>GPU Count</th>\n                                    <th>GPU Configurations</th>\n                                    <th>Actions</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                {workers.map((worker) => (\n                                    <tr key={worker.id}>\n                                        <td>{worker.id}</td>\n                                        <td>{worker.display_name}</td>\n                                        <td>{worker.num_gpus || 1}</td>\n                                        <td>\n                                            {configsByWorkerId[worker.id] &&\n                                                configsByWorkerId[worker.id]\n                                                    .gpu_configs &&\n                                                configsByWorkerId[\n                                                    worker.id\n                                                ].gpu_configs!.map((config) => (\n                                                    <div\n                                                        key={`${worker.id}_${config.gpu_num}`}\n                                                    >\n                                                        GPU {config.gpu_num}:{\" \"}\n                                                        {config.model}\n                                                    </div>\n                                                ))}\n                                        </td>\n                                        <td>\n                                            <button\n                                                className=\"btn btn-danger btn-sm\"\n                                                onClick={() =>\n                                                    onDeleteWorker(worker)\n                                                }\n                                            >\n                                                Delete\n                                            </button>\n                                            &nbsp;\n                                            <button\n                                                className=\"btn btn-primary btn-sm\"\n                                                onClick={() =>\n                                                    onGenerateCode(worker)\n                                                }\n                                            >\n                                                Generate Code\n                                            </button>\n                                            &nbsp;\n                                            <button\n                                                className=\"btn btn-primary btn-sm\"\n                                                onClick={() =>\n                                                    onRenameWorker(worker)\n                                                }\n                                            >\n                                                Rename\n                                            </button>\n                                        </td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                        </table>\n                    )}\n                </div>\n            </div>\n            {code && (\n                <Modal show={!!code} onHide={() => setCode(\"\")}>\n                    <Modal.Header closeButton>\n                        <Modal.Title>Worker Login Code</Modal.Title>\n                    </Modal.Header>\n                    <Modal.Body>\n                        <p>\n                            Give this code to the worker to login to the\n                            application.\n                        </p>\n                        <p>\n                            <strong>{code}</strong>\n                        </p>\n                    </Modal.Body>\n                </Modal>\n            )}\n        </>\n    );\n};\n","import React, { FC, useState, useEffect, useRef } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { AIBrushApi } from \"../../client/api\";\nimport { WorkerList } from \"./WorkerList\";\n\ninterface Props {\n    api: AIBrushApi;\n}\n\nexport const Admin: FC<Props> = ({ api }) => {\n    const [links, setLinks] = useState<string[]>([]);\n\n    const onGenerateLink = async () => {\n        const inviteCode = await api.createInviteCode();\n        setLinks([...links, `/?invite_code=${inviteCode.data.id}`]);\n    };\n\n    return (\n        <>\n            {/* Header: Create new image */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <h1>Admin features</h1>\n                </div>\n            </div>\n            {/* 50px vertical spacer */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <div className=\"spacer\" />\n                </div>\n            </div>\n            {links.length > 0 && (\n                <div className=\"row\">\n                    <div className=\"col-12\">\n                        <p>Right click to copy invite links</p>\n                    </div>\n                </div>\n            )}\n            <div className=\"row\">\n                <div className=\"offset-lg-3 col-lg-6 col-sm-12\">\n                    {/* show a list of hyperlinks */}\n                    <div className=\"btn-group-vertical\">\n                        {links.map((link, i) => (\n                            <a key={i} href={link} className=\"btn btn-primary\">\n                                <i className=\"fas fa-link\" />\n                                &nbsp; Invite Link\n                            </a>\n                        ))}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <div className=\"spacer\" />\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    {/* button to generate links */}\n                    <button\n                        className=\"btn btn-primary\"\n                        onClick={onGenerateLink}\n                    >\n                        Generate Link\n                    </button>\n                </div>\n            </div>\n            <hr />\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <Link className=\"btn btn-primary\" to=\"/orders\">\n                        Orders\n                    </Link>\n                </div>\n            </div>\n            <hr />\n            <WorkerList api={api} />\n        </>\n    );\n};\n","import React, { FC, useEffect, useState } from \"react\";\nimport moment from \"moment\";\nimport { Image, ImageStatusEnum } from \"../client/api\";\n\ninterface Props {\n    assetsUrl: string;\n    image: Image;\n    bulkDelete?: boolean;\n    onClick?: (image: Image) => void;\n}\n\nexport const ImageThumbnail: FC<Props> = ({ assetsUrl, image, bulkDelete, onClick }) => {\n    const src = `${assetsUrl}/${image.id}.thumbnail.png?updated_at=${image.updated_at}`;\n    const [retry, setRetry] = useState(\"\");\n\n    useEffect(() => {\n        // This is to help deal with eventual consistency from S3.\n        // if image.updated_at (unix timestamp in milliseconds) is less than a minute ago, try to reload the image\n        if (moment().diff(moment(image.updated_at), \"minutes\") < 1) {\n            setRetry(\"\");\n            const t = setTimeout(() => {\n                setRetry(\"&retry\")\n            }, 3000);\n            return () => clearTimeout(t);\n        }\n    }, [image.id, image.updated_at])\n\n    let label = image.label;\n    if (image.label === \"\") {\n        label = image.phrases[0];\n    }\n    \n    let className = \"image-thumbnail\";\n    if (bulkDelete) {\n        className += \" bulk-delete\";\n    }\n\n    return (\n        <div\n            className={className}\n            style={{\n                backgroundImage: `url(${src}${retry}), url(/images/default.png)`,\n                filter: image.nsfw ? \"blur(8px)\" : undefined,\n            }}\n            onClick={() => onClick && onClick(image)}\n        >\n            {!bulkDelete && <div className=\"image-thumbnail-label\">\n                {label}\n            </div>}\n\n            {bulkDelete && <div className=\"image-thumbnail-label\">\n                <input type=\"checkbox\" style={{\n                    width: \"20px\",\n                    height: \"20px\",\n                    marginLeft: \"16px\",\n                    marginTop: \"16px\",\n                }} checked readOnly />\n            </div>}\n\n            {image.status === ImageStatusEnum.Pending && <div className=\"image-thumbnail-pending\">\n                <i style={{marginTop: \"20px\"}} className=\"fa fa-hourglass-half\"></i>\n            </div>}\n            {\n                image.status === ImageStatusEnum.Processing && <div className=\"image-thumbnail-pending\">\n                    <i style={{marginTop: \"20px\"}} className=\"fa fa-cog fa-spin\"></i>\n                </div>\n            }\n        </div>\n    );\n};\n","import React, { FC, useEffect, useState } from \"react\";\nimport { AIBrushApi, Image } from \"../client\";\nimport moment from \"moment\";\nimport { ImageThumbnail } from \"../components/ImageThumbnail\";\nimport { useHistory } from \"react-router-dom\";\n\ninterface Props {\n    api: AIBrushApi;\n    assetsUrl: string;\n}\n\nexport const DeletedImages: FC<Props> = ({ api, assetsUrl }) => {\n    const [images, setImages] = useState<Image[]>([]);\n\n    const history = useHistory();\n\n    const loadImages = async () => {\n        const cursor = moment().add(-24, \"hours\").valueOf();\n        // TODO: special api call for deleted images?\n        const resp = await api.listImages(cursor, \"\", 100, \"asc\");\n        setImages(\n            (resp.data.images?.filter((image) => !!image.deleted_at) || []).sort(\n                (a, b) => {\n                    if (a.deleted_at && b.deleted_at) {\n                        return b.deleted_at - a.deleted_at;\n                    }\n                    return 0;\n                }\n            )\n        );\n    };\n\n    const onDeleteImage = async (image: Image) => {\n        setImages(images.filter((i) => i.id !== image.id));\n        await api.deleteImage(image.id);\n    };\n\n    const onRestoreImage = async (image: Image) => {\n        setImages(images.filter((i) => i.id !== image.id));\n        await api.updateImage(image.id, { deleted_at: null });\n    };\n\n    useEffect(() => {\n        loadImages();\n    }, [api]);\n\n    return (\n        <div>\n            {/* table made of divs */}\n            {/* imagethumbnail, phrases, action */}\n            <div>\n                {/* <div style={{ marginBottom: \"8px\" }}>\n                    <div style={{ display: \"inline-block\", width: \"200px\" }}>\n                        Image\n                    </div>\n                    <div style={{ display: \"inline-block\", width: \"200px\" }}>\n                        Action\n                    </div>\n                </div> */}\n                <div className=\"row\">\n                    <div className=\"col-12\">\n                        <h1 style={{ fontSize: \"40px\", textAlign: \"left\" }}>\n                            <i\n                                style={{ cursor: \"pointer\" }}\n                                onClick={() => history.goBack()}\n                                className=\"fas fa-chevron-left\"\n                            ></i>\n                            &nbsp; Deleted Images\n                        </h1>\n                    </div>\n                </div>\n                <div className=\"row\" style={{marginTop: \"32px\"}}>\n                    <div className=\"col-sm-2 offset-sm-2\">Image</div>\n                    <div className=\"col-sm-8\">Action</div>\n                </div>\n                {images.map((image) => (\n                    <div\n                        className=\"row\"\n                        style={{\n                            marginTop: \"16px\",\n                            borderBottom: \"1px solid #303030\",\n                        }}\n                    >\n                        <div className=\"col-sm-2 offset-sm-2\">\n                            <ImageThumbnail\n                                assetsUrl={assetsUrl}\n                                image={image}\n                            />\n                        </div>\n                        <div\n                            className=\"col-sm-8\"\n                            style={{\n                                paddingTop: \"64px\",\n                                paddingBottom: \"64px\",\n                            }}\n                        >\n                            <button\n                                className=\"btn btn-danger btn-sm image-popup-delete-button\"\n                                onClick={() => onDeleteImage(image)}\n                                style={{\n                                    marginRight: \"8px\",\n                                }}\n                            >\n                                <i className=\"fa fa-trash\"></i>&nbsp;Delete\n                            </button>\n                            <button\n                                className=\"btn btn-primary btn-sm image-popup-restore-button\"\n                                onClick={() => onRestoreImage(image)}\n                            >\n                                <i className=\"fa fa-undo\"></i>&nbsp;Restore\n                            </button>\n                        </div>\n                    </div>\n                ))}\n            </div>\n        </div>\n    );\n};\n","import React, { FC, useEffect, useRef, useState } from \"react\";\nimport { Modal } from \"react-bootstrap\";\nimport { CreateImageInput, Image, ImageStatusEnum } from \"../client/api\";\nimport { getUpscaleLevel } from \"../lib/upscale\";\n\ninterface ImagePopupProps {\n    assetsUrl: string;\n    image: Image;\n    onClose: () => void;\n    onDelete?: (image: Image) => void;\n    onFork?: (image: Image) => void;\n    onEdit?: (image: Image) => void;\n    onUpscale?: (image: Image) => void;\n    onNSFW?: (image: Image, nsfw: boolean) => void;\n}\n\nexport const ImagePopup: FC<ImagePopupProps> = ({\n    assetsUrl,\n    image,\n    onClose,\n    onDelete,\n    onFork,\n    onEdit,\n    onUpscale,\n    onNSFW,\n}) => {\n    const img = useRef<HTMLImageElement>(null);\n    const src = `${assetsUrl}/${image.id}.image.png?updated_at=${image.updated_at}`;\n    let score = image.score;\n    if (\n        image.negative_phrases.join(\"\").trim() !== \"\" &&\n        image.negative_score != 0\n    ) {\n        score -= image.negative_score;\n    }\n    const [showNSFW, setShowNSFW] = useState(false);\n\n    const statusBadge = (status: string) => {\n        const displayStatus = status.charAt(0).toUpperCase() + status.slice(1);\n        let icon = \"fa fa-question-circle\";\n        switch (status) {\n            case ImageStatusEnum.Pending:\n                icon = \"fas fa-hourglass-half\";\n                break;\n            case ImageStatusEnum.Processing:\n                icon = \"fas fa-cog fa-spin\";\n                break;\n            case ImageStatusEnum.Completed:\n                icon = \"fas fa-check\";\n                break;\n            case ImageStatusEnum.Error:\n                icon = \"fas fa-exclamation-circle\";\n                break;\n        }\n        return (\n            <>\n                <span style={{ fontSize: \"24px\" }}>\n                    <i\n                        className={`${icon} status-badge status-badge-${status}`}\n                        style={{\n                            fontSize: \"10px\",\n                            position: \"relative\",\n                            top: \"-1px\",\n                        }}\n                    ></i>\n                    &nbsp;{displayStatus}\n                </span>\n            </>\n        );\n    };\n\n    useEffect(() => {\n        if (!img.current) {\n            return;\n        }\n        img.current.onerror = () => {\n            if (!img.current) {\n                return;\n            }\n            img.current.src = \"/images/default.png\";\n        };\n    }, [img]);\n\n    let title = image.label;\n    if (!title) {\n        title = image.phrases[0];\n    }\n\n    const upscaleLevel = getUpscaleLevel(image.width!, image.height!);\n\n    // if open, show modal with image\n    return (\n        <Modal show={true} onHide={onClose} size=\"xl\">\n            <Modal.Header closeButton>\n                <Modal.Title>{title}</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <img\n                    ref={img}\n                    style={{\n                        maxWidth: \"100%\",\n                        maxHeight: \"1024px\",\n                        display: \"block\",\n                        marginLeft: \"auto\",\n                        marginRight: \"auto\",\n                        filter: image.nsfw && !showNSFW ? \"blur(30px)\" : \"\",\n                    }}\n                    id={`image-popup-${image.id}`}\n                    src={src}\n                    alt={image.label}\n                />\n                {/* List these fields: status, iterations, phrases */}\n                <div className=\"row\">\n                    <div className=\"col-lg-12\"></div>\n                </div>\n                {/* controls */}\n                <div className=\"row\">\n                    <div className=\"col-lg-12\">\n                        <div\n                            className=\"image-popup-controls\"\n                            style={{ marginTop: \"40px\" }}\n                        >\n                            {statusBadge(image.status)}\n                            <div style={{ float: \"right\" }}>\n                                {onFork &&\n                                    (image.status === ImageStatusEnum.Saved ||\n                                        image.status ===\n                                            ImageStatusEnum.Completed) && (\n                                        <button\n                                            className=\"btn btn-secondary btn-sm image-popup-button\"\n                                            onClick={() => onFork(image)}\n                                            style={{ marginRight: \"5px\" }}\n                                        >\n                                            <i className=\"fas fa-code-branch\"></i>\n                                            &nbsp;VARIATIONS\n                                        </button>\n                                    )}\n                                {onDelete && (\n                                    <button\n                                        className=\"btn btn-danger btn-sm image-popup-delete-button\"\n                                        onClick={() =>\n                                            onDelete && onDelete(image)\n                                        }\n                                        style={{ marginRight: \"5px\" }}\n                                    >\n                                        <i className=\"fas fa-trash-alt\"></i>\n                                        &nbsp;DELETE\n                                    </button>\n                                )}\n                                {onEdit && (\n                                    <button\n                                        className=\"btn btn-primary btn-sm image-popup-button edit-button\"\n                                        onClick={() => onEdit && onEdit(image)}\n                                        style={{ marginRight: \"5px\" }}\n                                    >\n                                        <i className=\"fas fa-edit\"></i>\n                                        &nbsp;EDIT\n                                    </button>\n                                )}\n                                {onUpscale && upscaleLevel < 2 && (\n                                    <button\n                                        className=\"btn btn-primary btn-sm image-popup-button\"\n                                        onClick={() =>\n                                            onUpscale && onUpscale(image)\n                                        }\n                                        style={{ marginRight: \"5px\" }}\n                                    >\n                                        <i className=\"fas fa-search-plus\"></i>\n                                        &nbsp;UPSCALE\n                                    </button>\n                                )}\n                                {image.nsfw && (\n                                    <button\n                                        className=\"btn btn-primary btn-sm image-popup-button\"\n                                        onClick={() => setShowNSFW(!showNSFW)}\n                                        style={{ marginRight: \"5px\" }}\n                                    >\n                                        <i className=\"fas fa-eye\"></i>\n                                        &nbsp;{showNSFW ? \"HIDE\" : \"SHOW\"}\n                                    </button>\n                                )}\n                            </div>\n                        </div>\n                        <div\n                            className=\"image-popup-controls\"\n                            style={{ marginTop: \"28px\", marginBottom: \"85px\" }}\n                        >\n                            <div>\n                                Similarity to prompt: {(score * 200).toFixed(2)}\n                                %\n                            </div>\n                            <div>\n                                Image dimensions: {image.width} x {image.height}\n                            </div>\n                            {image.nsfw && (\n                                <>\n                                    <div>\n                                        {/* alert warning icon */}\n                                        <i\n                                            className=\"fas fa-exclamation-triangle\"\n                                            style={{\n                                                color: \"orange\",\n                                                fontSize: \"18px\",\n                                                position: \"relative\",\n                                                top: \"2px\",\n                                            }}\n                                        ></i>\n                                        &nbsp;May contain NSFW content\n                                    </div>\n                                    {onNSFW && (\n                                        <a\n                                            href=\"javascript:void(0)\"\n                                            onClick={() =>\n                                                onNSFW(image, false)\n                                            }\n                                        >\n                                            Mark as Safe for Work\n                                        </a>\n                                    )}\n                                </>\n                            )}\n                            {!image.nsfw && (\n                                <>\n                                    <div>\n                                        {/* green check icon */}\n                                        <i\n                                            className=\"fas fa-check\"\n                                            style={{\n                                                color: \"green\",\n                                                fontSize: \"18px\",\n                                                position: \"relative\",\n                                                top: \"2px\",\n                                            }}\n                                        ></i>\n                                        &nbsp;Safe for Work\n                                    </div>\n                                    {onNSFW && (\n                                        <a\n                                            href=\"javascript:void(0)\"\n                                            onClick={() =>\n                                                onNSFW(image, true)\n                                            }\n                                        >\n                                            Mark as Not Safe for Work\n                                        </a>\n                                    )}\n                                </>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            </Modal.Body>\n        </Modal>\n    );\n};\n","import React, { FC, useEffect, useState } from \"react\";\nimport moment from \"moment\";\nimport { Image, ImageStatusEnum } from \"../client/api\";\n\ninterface Props {\n    pendingCount: number;\n    processingCount: number;\n    onClick?: () => void;\n}\n\nexport const PendingImagesThumbnail: FC<Props> = ({\n    pendingCount,\n    processingCount,\n    onClick,\n}) => {\n    const [hover, setHover] = useState(false);\n\n    // on mouse in/out, set hover state\n    const onMouseEnter = () => setHover(true);\n    const onMouseLeave = () => setHover(false);\n    let icon = (\n        <i style={{ marginTop: \"20px\" }} className=\"fa fa-hourglass-half\"></i>\n    );\n\n    if (processingCount > 0) {\n        icon = (\n            <i style={{ marginTop: \"20px\" }} className=\"fa fa-cog fa-spin\"></i>\n        );\n    }\n\n    return (\n        <div\n            onMouseEnter={onMouseEnter}\n            onMouseLeave={onMouseLeave}\n            style={{\n                backgroundImage: `url(/images/default.png)`,\n                backgroundSize: \"contain\",\n                width: \"128px\",\n                height: \"128px\",\n                margin: \"8px\",\n                float: \"left\",\n                cursor: \"pointer\",\n            }}\n            onClick={onClick}\n        >\n            {hover && (\n                <div\n                    style={{\n                        background: \"rgba(255, 255, 255, 0.5)\",\n                        color: \"black\",\n                        width: \"100%\",\n                        height: \"100%\",\n                        lineHeight: \"1\",\n                        fontSize: \"20px\",\n                    }}\n                >\n                    <br/>\n                    {pendingCount > 0 && (\n                        <div style={{ marginBottom: \"24px\" }}>\n                            {pendingCount} pending\n                        </div>\n                    )}\n                    {processingCount > 0 && (\n                        <div>{processingCount} processing</div>\n                    )}\n                </div>\n            )}\n            {!hover && (\n                <div\n                    style={{\n                        background: \"rgba(255, 255, 255, 0.3)\",\n                        color: \"#555\",\n                        width: \"100%\",\n                        height: \"100%\",\n                        fontSize: \"80px\",\n                    }}\n                >\n                    {icon}\n                </div>\n            )}\n        </div>\n    );\n};\n","import React, {FC, useEffect, useState} from \"react\";\nimport { Modal } from \"react-bootstrap\";\nimport { Image } from \"../client/api\";\n\ninterface Props {\n    images: Image[];\n    onDeleteImage: (image: Image) => void;\n    onCancel: () => void;\n    show: boolean;\n}\n\nexport const PendingImages: FC<Props> = ({\n    images,\n    onDeleteImage,\n    onCancel,\n    show,\n}) => {\n\n    function imageIcon(image: Image) {\n        if (image.status === \"pending\") {\n            return <i className=\"fa fa-hourglass-half\"></i>;\n        } else if (image.status === \"processing\") {\n            return <i className=\"fa fa-cog fa-spin\"></i>;\n        }\n    }\n\n    const truncate = (phrases: string) => {\n        if (phrases.length > 35) {\n            return phrases.substring(0, 35) + \"...\";\n        }\n        return phrases;\n    }\n\n    // refactor from table to div layout\n    const pendingDiv = (\n        <div>\n            <div style={{marginBottom: \"8px\"}}>\n                <div style={{display: \"inline-block\", width: \"100px\"}}>\n                    Status\n                </div>\n                <div style={{display: \"inline-block\", width: \"250px\"}}>\n                    Phrases\n                </div>\n                <div style={{display: \"inline-block\", width: \"100px\"}}>\n                    Action\n                </div>\n            </div>\n            {images.map((image) => (\n                <div key={image.id} style={{marginBottom: \"8px\"}}>\n                    <div style={{display: \"inline-block\", width: \"100px\"}}>\n                        {imageIcon(image)}&nbsp;{image.status}\n                    </div>\n                    <div style={{display: \"inline-block\", width: \"250px\"}}>\n                        {/* if more than 30 chars, truncate with ellipsis*/}\n                        {truncate(image.phrases.join(\", \"))}\n                    </div>\n                    <div style={{display: \"inline-block\", width: \"100px\"}}>\n                        <button\n                            className=\"btn btn-danger btn-sm image-popup-delete-button\"\n                            onClick={() => onDeleteImage(image)}\n                        >\n                            <i className=\"fa fa-trash\"></i>&nbsp;Delete\n                        </button>\n                    </div>\n                </div>\n            ))}\n        </div>\n    );\n\n    return (\n        <Modal show={show} onHide={onCancel}>\n            <Modal.Header closeButton>\n                <Modal.Title>Pending Images</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                {pendingDiv}\n            </Modal.Body>\n            <Modal.Footer>\n                <button className=\"btn btn-secondary\" onClick={onCancel}>\n                    Close\n                </button>\n            </Modal.Footer>\n        </Modal>\n    );\n};","// V2 page\nimport React, { FC, useState, useEffect } from \"react\";\nimport Dropdown from \"react-bootstrap/Dropdown\";\nimport { useParams, useHistory, Link } from \"react-router-dom\";\nimport moment from \"moment\";\nimport ScrollToTop from \"react-scroll-to-top\";\nimport { AIBrushApi } from \"../client\";\nimport { CreateImageInput, Image, ImageStatusEnum } from \"../client/api\";\nimport { ImageThumbnail } from \"../components/ImageThumbnail\";\nimport { ImagePrompt, defaultArgs } from \"../components/ImagePrompt\";\n\nimport InfiniteScroll from \"react-infinite-scroll-component\";\nimport { ImagePopup } from \"../components/ImagePopup\";\nimport { BusyModal } from \"../components/BusyModal\";\nimport { PendingImagesThumbnail } from \"../components/PendingImagesThumbnail\";\nimport { PendingImages } from \"../components/PendingImages\";\nimport { ApiSocket, NOTIFICATION_IMAGE_DELETED, NOTIFICATION_IMAGE_UPDATED } from \"../lib/apisocket\";\n\ninterface Props {\n    api: AIBrushApi;\n    apiSocket: ApiSocket;\n    assetsUrl: string;\n}\n\nexport const Homepage: FC<Props> = ({ api, apiSocket, assetsUrl }) => {\n    const [creating, setCreating] = useState(false);\n    const [selectedImage, setSelectedImage] = useState<Image | null>(null);\n    const [parentImage, setParentImage] = useState<Image | null>(null);\n\n    const [showPendingImages, setShowPendingImages] = useState(false);\n\n    const [images, setImages] = useState<Array<Image>>([]);\n    const [err, setErr] = useState<string | null>(null);\n    const [hasMore, setHasMore] = useState<boolean>(true);\n    const [search, setSearch] = useState<string>(\"\");\n    const [searchDebounce, setSearchDebounce] = useState<string>(\"\");\n\n    const [bulkDeleteSelecting, setBulkDeleteSelecting] = useState(false);\n    const [bulkDeleting, setBulkDeleting] = useState(false);\n    const [bulkDeleteIds, setBulkDeleteIds] = useState<{\n        [key: string]: boolean;\n    }>({});\n\n    const { id } = useParams<{ id?: string }>();\n    const history = useHistory();\n\n    useEffect(() => {\n        let handle = setTimeout(() => {\n            setSearch(searchDebounce);\n        }, 500);\n        return () => {\n            clearTimeout(handle);\n        };\n    }, [searchDebounce]);\n\n    useEffect(() => {\n        if (id) {\n            // check if the image is already loaded\n            const image = images.find((image) => image.id === id);\n            if (image) {\n                setSelectedImage(image);\n            }\n            // refresh\n            api.getImage(id).then((image) => {\n                setSelectedImage(image.data);\n            });\n        } else {\n            setSelectedImage(null);\n        }\n    }, [id]);\n\n    const onSubmit = async (input: CreateImageInput) => {\n        setCreating(true);\n        setParentImage(null);\n        setErr(null);\n        window.scrollTo(0, 0);\n        try {\n            await api.createImage(input);\n        } catch (e: any) {\n            console.error(e);\n            setErr(\"Error creating image\");\n        } finally {\n            setCreating(false);\n        }\n    };\n\n    const onEditNewImage = async (input: CreateImageInput) => {\n        setCreating(true);\n        setParentImage(null);\n        setErr(null);\n        window.scrollTo(0, 0);\n        try {\n            const newImages = await api.createImage(input);\n            if (newImages.data.images) {\n                const image = newImages.data.images![0];\n                history.push(`/image-editor/${image.id}`);\n            }\n        } catch (e: any) {\n            console.error(e);\n            setErr(\"Error creating image\");\n        } finally {\n            setCreating(false);\n        }\n    };\n\n    const onNSFW = (image: Image, nsfw: boolean) => {\n        api.updateImage(image.id, { nsfw }).then((res) => {\n            setImages((images) => {\n                return images.map((i) => {\n                    if (i.id === image.id) {\n                        return res.data;\n                    }\n                    return i;\n                });\n            });\n            setSelectedImage(res.data);\n        });\n    };\n\n    const onUpscale = async (image: Image) => {\n        setCreating(true);\n        setErr(null);\n        window.scrollTo(0, 0);\n        try {\n            const imageInput = defaultArgs();\n            imageInput.parent = image.id;\n            imageInput.label = image.label;\n            imageInput.phrases = image.phrases;\n            imageInput.negative_phrases = image.negative_phrases;\n            imageInput.width = image.width! * 2;\n            imageInput.height = image.height! * 2;\n            imageInput.model = \"swinir\";\n            imageInput.count = 1;\n\n            const newImages = await api.createImage(imageInput);\n            setImages((images) => {\n                // there is a race condition where poll images can fire before this callback\n                // so double-check to avoid duplicates\n                const imagesToAdd = (newImages.data.images || []).filter(\n                    (image) => {\n                        return !images.find((i) => i.id === image.id);\n                    }\n                );\n                return [...imagesToAdd, ...images].sort(sortImages);\n            });\n            history.push(\"/\");\n        } catch (e: any) {\n            console.error(e);\n            setErr(\"Error creating image\");\n        } finally {\n            setCreating(false);\n        }\n    };\n\n    useEffect(() => {\n        if (!api) {\n            return;\n        }\n        const loadImages = async () => {\n            console.log(\"Initial load images\");\n            // clear error\n            setErr(null);\n            setHasMore(true);\n            try {\n                const cursor = moment().add(1, \"minutes\").valueOf();\n                const resp = await api.listImages(cursor, search, 100, \"desc\");\n                if (resp.data.images) {\n                    console.log(\"Initial load images\", resp.data.images.length);\n                    setImages(\n                        resp.data.images\n                            .filter((image) => !image.deleted_at)\n                            .sort(sortImages)\n                    );\n                }\n                return 0;\n            } catch (err) {\n                setErr(\"Could not load images\");\n                console.error(err);\n            }\n        };\n        loadImages();\n    }, [api, search]);\n\n    useEffect(() => {\n        if (!api) {\n            return;\n        }\n\n        const pollImages = async (images: Array<Image>) => {\n            // clear error\n            setErr(null);\n            // set cursor to max updated_at from images\n            const cursor = images.reduce((max, image) => {\n                return Math.max(max, image.updated_at);\n            }, 0);\n\n            try {\n                const resp = await api.listImages(\n                    cursor + 1,\n                    search,\n                    100,\n                    \"asc\"\n                );\n                if (resp.data.images) {\n                    let latestCursor = cursor;\n                    for (let image of resp.data.images) {\n                        if (image.updated_at > latestCursor) {\n                            latestCursor = image.updated_at;\n                        }\n                    }\n\n                    // split resp.data.images into \"new\" and \"updated\" lists\n                    // image is \"new\" if it's not in images\n                    const newImages = resp.data.images.filter((image) => {\n                        return images.findIndex((i) => i.id === image.id) < 0;\n                    });\n                    const updatedImages = resp.data.images.filter((image) => {\n                        return images.findIndex((i) => i.id === image.id) >= 0;\n                    });\n                    setImages((images) => {\n                        const deletedIds: { [key: string]: boolean } = {};\n                        for (let image of newImages) {\n                            if (image.deleted_at) {\n                                deletedIds[image.id] = true;\n                                console.log(\n                                    `Deleting image ${image.id} from list`\n                                );\n                            }\n                        }\n                        for (let image of updatedImages) {\n                            if (image.deleted_at) {\n                                deletedIds[image.id] = true;\n                                console.log(\n                                    `Deleting image ${image.id} from list`\n                                );\n                            }\n                        }\n                        images = images.filter(\n                            (image) => !deletedIds[image.id]\n                        );\n                        return [\n                            ...images.map((image) => {\n                                const updatedImage = updatedImages.find(\n                                    (i) => i.id === image.id\n                                );\n                                if (updatedImage) {\n                                    return updatedImage;\n                                }\n                                return image;\n                            }),\n                            ...newImages.filter((image) => !image.deleted_at),\n                        ].sort(sortImages);\n                    });\n                }\n                return images;\n            } catch (err) {\n                setErr(\"Could not load images\");\n                console.error(err);\n            }\n        };\n\n        // polling is now a fallback for when the websocket connection fails\n        const timerHandle = setInterval(() => {\n            pollImages(images);\n        }, 60 * 1000);\n        return () => {\n            clearInterval(timerHandle);\n        };\n    }, [api, images, search]);\n\n    useEffect(() => {\n        // de-duplicate images by id\n        // first check if there are any duplicates\n        // I know, I should figure out where the duplicates are coming from,\n        // but I'm lazy.\n        const ids = images.map((image) => image.id);\n        const uniqueIds = new Set(ids);\n        if (ids.length !== uniqueIds.size) {\n            setImages((images) => {\n                // there are duplicates\n                const uniqueImages = images.filter((image, index) => {\n                    return ids.indexOf(image.id) === index;\n                });\n                return uniqueImages.sort(sortImages);\n            });\n        }\n    }, [images]);\n\n    useEffect(() => {\n        apiSocket.onMessage(async message => {\n            const payload = JSON.parse(message);\n            if (payload.type === NOTIFICATION_IMAGE_UPDATED || payload.type === NOTIFICATION_IMAGE_DELETED) {\n                const updatedImage = await api.getImage(payload.id);\n                if (updatedImage.data.temporary) {\n                    return;\n                }\n                setImages((images) => {\n                    const index = images.findIndex((image) => image.id === updatedImage.data.id);\n                    let updatedImages = images;\n                    if (index >= 0) {\n                        updatedImages = images.map((image) => {\n                            if (image.id === updatedImage.data.id) {\n                                return updatedImage.data;\n                            }\n                            return image;\n                        });\n                    } else {\n                        updatedImages = [...images, updatedImage.data];\n                    }\n                    return updatedImages.sort(sortImages);\n                });\n            }\n        });\n        return () => {\n            apiSocket.onMessage(undefined);\n        }\n    }, [apiSocket]);\n\n    const isPendingOrProcessing = (image: Image) => {\n        return (\n            image.status === ImageStatusEnum.Pending ||\n            image.status === ImageStatusEnum.Processing\n        );\n    };\n\n    const sortImages = (a: Image, b: Image) => {\n        // pending and processing images always come first\n        if (isPendingOrProcessing(a) && !isPendingOrProcessing(b)) {\n            return -1;\n        } else if (!isPendingOrProcessing(a) && isPendingOrProcessing(b)) {\n            return 1;\n        }\n        // if the parent is the same, sort by score descending\n        // otherwise, sort by updated_at\n        if (\n            a.parent === b.parent &&\n            a.phrases.join(\"|\") == b.phrases.join(\"|\") &&\n            a.status !== ImageStatusEnum.Pending &&\n            b.status !== ImageStatusEnum.Pending\n        ) {\n            // if the score is the same, sort by updated_at\n            let aScore = a.score;\n            let bScore = b.score;\n            // working around a bug where negative score was assigned\n            // for an empty negative prompt.\n            if (a.phrases.join(\"\").trim() !== \"\") {\n                aScore = aScore - a.negative_score;\n            }\n            if (b.phrases.join(\"\").trim() !== \"\") {\n                bScore = bScore - b.negative_score;\n            }\n            if (aScore == bScore) {\n                return b.updated_at - a.updated_at;\n            }\n            return bScore - aScore;\n        }\n\n        return b.updated_at - a.updated_at;\n    };\n\n    const onLoadMore = async () => {\n        // get the minimum updated_at from images\n        let minUpdatedAt = moment().valueOf();\n        images.forEach((image) => {\n            minUpdatedAt = Math.min(minUpdatedAt, image.updated_at);\n        });\n        // load images in descending order from updated_at\n        const resp = await api.listImages(\n            minUpdatedAt - 1,\n            search,\n            100,\n            \"desc\"\n        );\n        if (resp.data.images && resp.data.images.length > 0) {\n            // combine images with new images and sort by updated_at descending\n            setImages((images) =>\n                [...images, ...(resp.data.images || [])]\n                    .filter((image) => !image.deleted_at)\n                    .sort(sortImages)\n            );\n        } else {\n            setHasMore(false);\n        }\n    };\n\n    const onDelete = async (image: Image) => {\n        try {\n            await api.deleteImage(image.id);\n        } catch (e) {\n            console.error(e);\n            setErr(\"Error deleting image\");\n        }\n    };\n\n    const onFork = async (image: Image) => {\n        setParentImage(image);\n        // setSelectedImage(null);\n        history.push(\"/\");\n        window.scrollTo(0, 0);\n    };\n\n    const onEdit = async (image: Image) => {\n        history.push(`/image-editor/${image.id}`);\n    };\n\n    const onThumbnailClicked = (image: Image) => {\n        // setSelectedImage(image);\n        if (bulkDeleteSelecting) {\n            setBulkDeleteIds({\n                ...bulkDeleteIds,\n                [image.id]: !bulkDeleteIds[image.id],\n            });\n        } else {\n            history.push(`/images/${image.id}`);\n        }\n    };\n\n    const handleCancelFork = () => {\n        setParentImage(null);\n        window.scrollTo(0, 0);\n    };\n\n    const onConfirmBulkDelete = async () => {\n        try {\n            setBulkDeleting(true);\n            // await api.deleteImages(Object.keys(bulkDeleteIds));\n            const promises = Object.keys(bulkDeleteIds).map((id) => {\n                return api.deleteImage(id);\n            });\n            await Promise.all(promises);\n            setImages((images) => {\n                return images.filter((image) => !bulkDeleteIds[image.id]);\n            });\n            setBulkDeleteIds({});\n            setBulkDeleteSelecting(false);\n        } catch (e) {\n            console.error(e);\n            setErr(\"Error deleting images\");\n        } finally {\n            setBulkDeleting(false);\n        }\n    };\n\n    const completedOrSavedImages = images.filter((image) => {\n        return (\n            !image.deleted_at &&\n            (image.status === ImageStatusEnum.Completed ||\n                image.status === ImageStatusEnum.Saved)\n        );\n    });\n\n    const pendingOrProcessingImages = images.filter(\n        (image) =>\n            !image.deleted_at &&\n            (image.status === ImageStatusEnum.Pending ||\n                image.status === ImageStatusEnum.Processing)\n    );\n\n    const pendingImages = pendingOrProcessingImages.filter(\n        (image) => image.status === ImageStatusEnum.Pending\n    );\n\n    const processingImages = pendingOrProcessingImages.filter(\n        (image) => image.status === ImageStatusEnum.Processing\n    );\n\n    return (\n        <>\n            <h1 style={{ fontSize: \"40px\", textAlign: \"left\" }}>\n                Welcome to AiBrush\n            </h1>\n\n            <ImagePrompt\n                assetsUrl={assetsUrl}\n                creating={creating}\n                onSubmit={onSubmit}\n                onEdit={onEditNewImage}\n                parent={parentImage}\n                onCancel={() => handleCancelFork()}\n            />\n            <hr />\n\n            <div className=\"homepage-images\" style={{ marginTop: \"48px\", paddingBottom: \"48px\" }}>\n                <div style={{ textAlign: \"left\" }}>\n                    <div\n                        className=\"input-group\"\n                        style={{ marginBottom: \"16px\" }}\n                    >\n                        <input\n                            style={{}}\n                            value={searchDebounce}\n                            type=\"search\"\n                            className=\"form-control image-search\"\n                            placeholder=\"Search...\"\n                            onChange={(e) => setSearchDebounce(e.target.value)}\n                        />\n\n                        <div\n                            style={{\n                                float: \"right\",\n                            }}\n                        >\n                            {!bulkDeleteSelecting && (\n                                <Dropdown>\n                                    <Dropdown.Toggle variant=\"danger\">\n                                        <i className=\"fas fa-trash\"></i>\n                                    </Dropdown.Toggle>\n\n                                    <Dropdown.Menu>\n                                        <Dropdown.Item\n                                            onClick={() =>\n                                                setBulkDeleteSelecting(true)\n                                            }\n                                        >\n                                            Bulk Delete\n                                        </Dropdown.Item>\n                                        <Dropdown.Item\n                                            onClick={() =>\n                                                history.push(\"/deleted-images\")\n                                            }\n                                        >\n                                            View Deleted Images\n                                        </Dropdown.Item>\n                                    </Dropdown.Menu>\n                                </Dropdown>\n                            )}\n                            {bulkDeleteSelecting && (\n                                <>\n                                    <button\n                                        className=\"btn btn-primary image-popup-button\"\n                                        onClick={() => {\n                                            setBulkDeleteSelecting(false);\n                                            setBulkDeleteIds({});\n                                        }}\n                                    >\n                                        Cancel\n                                    </button>\n                                    <button\n                                        style={{ marginLeft: \"8px\" }}\n                                        className=\"btn image-popup-delete-button\"\n                                        onClick={() => {\n                                            onConfirmBulkDelete();\n                                        }}\n                                    >\n                                        Delete\n                                    </button>\n                                </>\n                            )}\n                        </div>\n                    </div>\n                </div>\n                <InfiniteScroll\n                    dataLength={images.length}\n                    next={onLoadMore}\n                    hasMore={hasMore}\n                    loader={<><hr/><h4>Loading...</h4></>}\n                >\n                    {pendingOrProcessingImages.length > 0 && (\n                        <PendingImagesThumbnail\n                            pendingCount={pendingImages.length}\n                            processingCount={processingImages.length}\n                            onClick={() => {\n                                setShowPendingImages(true);\n                            }}\n                        />\n                    )}\n                    {completedOrSavedImages.map((image) => (\n                        <ImageThumbnail\n                            key={image.id}\n                            image={image}\n                            assetsUrl={assetsUrl}\n                            onClick={onThumbnailClicked}\n                            bulkDelete={\n                                bulkDeleteSelecting && bulkDeleteIds[image.id]\n                            }\n                        />\n                    ))}\n                </InfiniteScroll>\n            </div>\n\n            {selectedImage && (\n                <ImagePopup\n                    assetsUrl={assetsUrl}\n                    image={selectedImage}\n                    onClose={() => history.push(\"/\")}\n                    onDelete={(image) => {\n                        onDelete(image);\n                        setImages(images.filter((i) => i.id !== image.id));\n                        history.push(\"/\");\n                    }}\n                    onFork={(image) => {\n                        onFork(image);\n                        history.push(\"/\");\n                    }}\n                    onEdit={(image) => {\n                        onEdit(image);\n                    }}\n                    onUpscale={(image) => {\n                        onUpscale(image);\n                    }}\n                    onNSFW={onNSFW}\n                />\n            )}\n            <ScrollToTop />\n            <BusyModal show={creating} title=\"Creating images\">\n                <p>Please wait while we create your image.</p>\n            </BusyModal>\n            <BusyModal show={bulkDeleting} title=\"Deleting images\">\n                <p>Please wait while we delete your images.</p>\n            </BusyModal>\n            <PendingImages\n                images={pendingOrProcessingImages}\n                onCancel={() => setShowPendingImages(false)}\n                show={showPendingImages}\n                onDeleteImage={(image) => {\n                    onDelete(image);\n                    setImages(images.filter((i) => i.id !== image.id));\n                }}\n            />\n        </>\n    );\n};\n","import React, { FC, useEffect, useState } from \"react\";\nimport { Modal, Button } from \"react-bootstrap\";\nimport { AIBrushApi, Order } from \"../../client\";\n\n// TODO: better place to put this?\nconst COST_PER_HOUR_PER_GPU = 1.35;\nconst IMAGES_PER_HOUR_PER_GPU = 14 * 60;\n\ninterface Props {\n    api: AIBrushApi;\n}\n\nexport const Orders: FC<Props> = ({ api }) => {\n    const [orders, setOrders] = useState<Order[]>([]);\n    const [gpuCount, setGpuCount] = useState(1);\n    const [hours, setHours] = useState(1);\n    const [creating, setCreating] = useState(false);\n\n    useEffect(() => {\n        api.getOrders().then((res) => {\n            setOrders(res.data.orders);\n        });\n    }, [api]);\n\n    const onCreateOrder = async () => {\n        setCreating(false);\n        await api.createOrder({\n            gpu_count: gpuCount,\n            hours,\n        });\n        setGpuCount(1);\n        setHours(1);\n    };\n\n    return (\n        <>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <h1>Orders</h1>\n                </div>\n            </div>\n            {/* 50px vertical spacer */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <div className=\"spacer\" />\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <button\n                        type=\"button\"\n                        className=\"btn btn-primary\"\n                        onClick={() => setCreating(true)}\n                    >\n                        Create Order\n                    </button>\n                </div>\n            </div>\n            {/* 50px vertical spacer */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <div className=\"spacer\" />\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    <table className=\"table\">\n                        <thead>\n                            <tr>\n                                <th scope=\"col\">ID</th>\n                                <th scope=\"col\">Created By</th>\n                                <th scope=\"col\">Created At</th>\n                                <th scope=\"col\">Ends At</th>\n                                <th scope=\"col\">Is Active</th>\n                                <th scope=\"col\">GPU Count</th>\n                                <th scope=\"col\">Amount Paid</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            {orders.map((order) => (\n                                <tr key={order.id}>\n                                    <th scope=\"row\">{order.id}</th>\n                                    <td>{order.created_by}</td>\n                                    <td>{order.created_at}</td>\n                                    <td>{order.ends_at}</td>\n                                    <td>{order.is_active ? \"Yes\" : \"No\"}</td>\n                                    <td>{order.gpu_count}</td>\n                                    <td>{order.amount_paid_cents}</td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n            <Modal show={creating} onHide={() => setCreating(false)}>\n                <Modal.Header closeButton>\n                    <Modal.Title>Create Order</Modal.Title>\n                </Modal.Header>\n                <Modal.Body>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"gpuCount\" style={{width: \"100%\"}}>\n                            GPU Count\n                            <span\n                                className=\"form-text text-muted\"\n                                style={{ float: \"right\" }}\n                            >\n                                {gpuCount} GPU{gpuCount === 1 ? \"\" : \"s\"}\n                            </span>\n                        </label>\n                        <input\n                            type=\"range\"\n                            min=\"1\"\n                            max=\"4\"\n                            className=\"form-control\"\n                            id=\"gpuCount\"\n                            value={gpuCount}\n                            onChange={(e) =>\n                                setGpuCount(parseInt(e.target.value))\n                            }\n                        />\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"hours\" style={{width: \"100%\"}}>\n                            Hours\n                            <span\n                                className=\"form-text text-muted\"\n                                style={{ float: \"right\" }}\n                            >\n                                {hours} Hour{hours === 1 ? \"\" : \"s\"}\n                            </span>\n                        </label>\n                        <input\n                            type=\"range\"\n                            min=\"1\"\n                            max=\"8\"\n                            className=\"form-control\"\n                            id=\"hours\"\n                            value={hours}\n                            onChange={(e) => setHours(parseInt(e.target.value))}\n                        />\n                    </div>\n                    {/* show calculated cost */}\n                    <div className=\"form-group\" style={{borderTop: \"1px solid #444\", paddingTop: \"24px\"}}>\n                        <label htmlFor=\"cost\" style={{width: \"100%\"}}>\n                            Cost\n                            <span\n                                className=\"form-text text-muted\"\n                                style={{ float: \"right\" }}\n                            >\n                                $\n                                {(\n                                    COST_PER_HOUR_PER_GPU * gpuCount * hours\n                                ).toFixed(2)}\n                            </span>\n                        </label>\n                    </div>\n                    {/* show calculated images */}\n                    <div className=\"form-group\">\n                        <label htmlFor=\"images\" style={{width: \"100%\"}}>\n                            Max Images per Hour (estimated)\n                            <span\n                                className=\"form-text text-muted\"\n                                style={{ float: \"right\" }}\n                            >\n                                {IMAGES_PER_HOUR_PER_GPU * gpuCount}\n                            </span>\n                        </label>\n                    </div>\n                </Modal.Body>\n                <Modal.Footer>\n                    <Button\n                        variant=\"secondary\"\n                        onClick={() => setCreating(false)}\n                    >\n                        Cancel\n                    </Button>\n                    <Button variant=\"primary\" onClick={onCreateOrder}>\n                        Create\n                    </Button>\n                </Modal.Footer>\n            </Modal>\n        </>\n    );\n};\n","import React, { useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { AIBrushApi, LoginResult } from \"../client\";\n\ninterface LoginProps {\n    client: AIBrushApi;\n    onLogin: (loginResult: LoginResult) => void;\n}\n\nexport const DiscordLogin: React.FC<LoginProps> = ({client, onLogin}) => {\n    const history = useHistory();\n    const code = new URLSearchParams(window.location.search).get(\"code\");\n    \n    useEffect(() => {\n        if (code) {\n            console.log(\"logging in with code\", code);\n            client.discordLogin({code}).then((result) => {\n                console.log(\"login result\", result);\n                if (result.data.accessToken) {\n                    onLogin(result.data);\n                }\n                \n                history.push(\"/\");\n            });\n        } else {\n            history.push(\"/\");\n        }\n    }, [])\n\n    return null;\n}","import React, { useState, useEffect } from \"react\";\nimport * as axios from \"axios\";\nimport { BrowserRouter, Switch, Route, Link } from \"react-router-dom\";\nimport \"./App.css\";\nimport \"./bootstrap.min.css\";\nimport { AIBrushApi, LoginResult, FeatureList } from \"./client/api\";\nimport { getConfig } from \"./config\";\nimport { Login } from \"./pages/Login\";\nimport { TokenRefresher } from \"./components/TokenRefresher\";\nimport { Healthchecker } from \"./components/Healthchecker\";\nimport { WorkerConfigPage } from \"./pages/WorkerConfig\";\nimport { Admin } from \"./pages/admin/Admin\";\nimport { ImageEditor } from \"./pages/image-editor/ImageEditor\";\nimport { DeletedImages } from \"./pages/DeletedImages\";\n\n// V2 UI\nimport { Homepage } from \"./pages/Homepage\";\nimport { Orders } from \"./pages/admin/Orders\";\nimport { ApiSocket } from \"./lib/apisocket\";\nimport { DiscordLogin } from \"./pages/DiscordLogin\";\n\nconst config = getConfig();\nconst httpClient = axios.default;\nconst client = new AIBrushApi(\n    undefined,\n    localStorage.getItem(\"apiUrl\") || config.apiUrl,\n    httpClient\n);\nconst apiSocket: ApiSocket = new ApiSocket();\n\nfunction updateHttpClient(loginResult: LoginResult) {\n    if (loginResult.accessToken) {\n        httpClient.defaults.headers.common[\n            \"Authorization\"\n        ] = `Bearer ${loginResult.accessToken}`;\n    }\n}\n\nfunction App() {\n    const [credentials, setCredentials] = useState<LoginResult | null>(null);\n    const [assetsUrl, setAssetsUrl] = useState<string>(\"/api/images\");\n    const [isAdmin, setIsAdmin] = useState<boolean>(false);\n    const [features, setFeatures] = useState<FeatureList | null>(null);\n\n    const onLogout = () => {\n        setCredentials(null);\n        localStorage.removeItem(\"credentials\");\n        httpClient.defaults.headers.common[\"Authorization\"] = undefined;\n    };\n\n    const init = async () => {\n        console.log(\"App.init\");\n        client\n            .getAssetsUrl()\n            .then((result) => setAssetsUrl(result.data.assets_url));\n        client.getFeatures().then((result) => setFeatures(result.data));\n        const storedCredentials = localStorage.getItem(\"credentials\");\n        if (storedCredentials) {\n            // attempt to refresh token\n            try {\n                const credentials = JSON.parse(\n                    storedCredentials\n                ) as LoginResult;\n                const result = await client.refresh({\n                    refreshToken: credentials.refreshToken,\n                });\n                setCredentials(result.data);\n\n                // save to storage\n                localStorage.setItem(\n                    \"credentials\",\n                    JSON.stringify(result.data)\n                );\n                updateHttpClient(result.data);\n                const isAdmin = await client.isAdmin();\n                setIsAdmin(!!isAdmin.data.is_admin);\n                apiSocket.updateToken(result.data.accessToken!);\n                apiSocket.connect();\n            } catch (e) {\n                console.log(e);\n            }\n        }\n    };\n\n    const onLogin = async (credentials: LoginResult) => {\n        localStorage.setItem(\"credentials\", JSON.stringify(credentials));\n        setCredentials(credentials);\n        updateHttpClient(credentials);\n        apiSocket.updateToken(credentials.accessToken!);\n        apiSocket.connect();\n    };\n\n    useEffect(() => {\n        init();\n    }, []);\n\n    return (\n        <div className=\"App\">\n            <TokenRefresher\n                api={client}\n                credentials={credentials as LoginResult}\n                onCredentialsRefreshed={onLogin}\n            />\n            <Healthchecker api={client} />\n\n            <BrowserRouter>\n                {/* if credentials are not set, show Login component */}\n                {!credentials && (\n                    <Switch>\n                        <Route path=\"/\" exact={true}>\n                            <Login client={client} onLogin={onLogin} />\n                        </Route>\n                        <Route path=\"/discord-login\">\n                            <DiscordLogin client={client} onLogin={onLogin} />\n                        </Route>\n                        {/* fallback route is login page */}\n                        <Route path=\"*\">\n                            <Login client={client} onLogin={onLogin} />\n                        </Route>\n                    </Switch>\n                )}\n                {credentials && (\n                    <div className=\"container\">\n                        <div className=\"row\">\n                            <div className=\"col-lg-12\">\n                                {/* if credentials are set, show a bootstrap logout button a the far top right corner div */}\n                                {credentials && (\n                                    <>\n                                        <button\n                                            className=\"btn btn-primary top-button\"\n                                            onClick={() => onLogout()}\n                                        >\n                                            {/* font awesome logout icon */}\n                                            <i className=\"fas fa-sign-out-alt\"></i>\n                                        </button>\n                                        {/* home button */}\n                                        <Link\n                                            className=\"btn btn-primary top-button\"\n                                            to=\"/\"\n                                        >\n                                            {/* font awesome home icon */}\n                                            <i className=\"fas fa-home\"></i>\n                                        </Link>\n                                        {/* Link to discord */}\n                                        <a\n                                            className=\"btn btn-primary top-button\"\n                                            href=\"https://discord.gg/VPYyAJBkhC\"\n                                            target=\"_blank\"\n                                        >\n                                            {/* font awesome discord icon */}\n                                            <i className=\"fab fa-discord\"></i>\n                                        </a>\n                                        <Link\n                                            className=\"btn top-button pulse\"\n                                            to=\"/\"\n                                            style={{\n                                                width: \"47px\"\n                                            }}\n                                            onClick={\n                                                () => alert(\"Coming soon!\")\n                                            }\n                                        >\n                                            {/* font awesome bolt icon */}\n                                            <i className=\"fas fa-bolt\"></i>\n                                        </Link>\n                                    </>\n                                )}\n                            </div>\n                        </div>\n\n                        {/* if credentials are set, show the rest of the app */}\n\n                        <Switch>\n                            <Route path=\"/\" exact={true}>\n                                {/* <MainMenu isAdmin={isAdmin} /> */}\n                                <Homepage\n                                    api={client}\n                                    apiSocket={apiSocket}\n                                    assetsUrl={assetsUrl}\n                                />\n                            </Route>\n                            <Route path=\"/images/:id\">\n                                <Homepage\n                                    api={client}\n                                    apiSocket={apiSocket}\n                                    assetsUrl={assetsUrl}\n                                />\n                            </Route>\n                            <Route path=\"/image-editor/:id\">\n                                <ImageEditor\n                                    api={client}\n                                    apisocket={apiSocket}\n                                    assetsUrl={assetsUrl}\n                                />\n                            </Route>\n                            <Route path=\"/worker-config\">\n                                <WorkerConfigPage api={client} />\n                            </Route>\n                            <Route path=\"/deleted-images\">\n                                <DeletedImages\n                                    api={client}\n                                    assetsUrl={assetsUrl}\n                                />\n                            </Route>\n                            {isAdmin && (\n                                <>\n                                    <Route path=\"/admin\">\n                                        <Admin api={client} />\n                                    </Route>\n                                    <Route path=\"/orders\">\n                                        <Orders api={client} />\n                                    </Route>\n                                </>\n                            )}\n                        </Switch>\n                        <div\n                            // style={{ marginTop: \"100px\", padding: \"50px\" }}\n\n                            // use position:fixed to make the footer stick to the bottom of the page\n                            style={{\n                                position: \"fixed\",\n                                bottom: \"0\",\n                                left: \"0\",\n                                width: \"100%\",\n                                height: \"50px\",\n                                paddingTop: \"16px\",\n                                backgroundColor: \"#000000\",\n                            }}\n                        >\n                                {/* show external popout pages to terms and privacy policy, if they are present in the features */}\n                                {features && features.privacy_uri && (\n                                    <a\n                                        href={features.privacy_uri}\n                                        target=\"_blank\"\n                                    >\n                                        Privacy Policy\n                                    </a>\n                                )}\n                                {features && features.terms_uri && (\n                                    <a\n                                        href={features.terms_uri}\n                                        target=\"_blank\"\n                                        style={{ marginLeft: \"20px\" }}\n                                    >\n                                        Terms of Service\n                                    </a>\n                                )}\n                                {/* link to mail to admin@aibrush.art */}\n                                <a\n                                    href=\"mailto:admin@aibrush.art\"\n                                    style={{ marginLeft: \"20px\" }}\n                                >\n                                    Contact\n                                </a>\n                        </div>\n                    </div>\n                )}\n            </BrowserRouter>\n        </div>\n    );\n}\n\nexport default App;\n","export interface Config {\n    apiUrl: string;\n}\n\nexport function getConfig(): Config {\n    // if (process.env.REACT_APP_ENV === \"prod\") {\n    //     return {\n    //         apiUrl: \"https://aibrush.ngrok.io\"\n    //     };\n    // } else if (process.env.REACT_APP_ENV === \"alt\") {\n    //     return {\n    //         apiUrl: \"\"\n    //     };\n    // } else {\n    //     return {\n    //         apiUrl: \"http://localhost:3000\"\n    //     };\n    // }\n    return {\n        apiUrl: \"\"\n    };\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import React, { FC, useEffect, useState } from \"react\";\nimport { CreateImageInput, CreateImageInputStatusEnum, Image } from \"../client\";\nimport {\n    aspectRatios, DEFAULT_ASPECT_RATIO, getClosestAspectRatio, upscale, compareSize, AspectRatio\n} from \"../lib/aspecRatios\";\nimport loadImage from \"blueimp-load-image\";\nimport { AspectRatioSelector } from \"./AspectRatioSelector\";\nimport { getUpscaleLevel } from \"../lib/upscale\";\n\ninterface Props {\n    parent: Image | null;\n    creating: boolean;\n    assetsUrl: string;\n    onSubmit: (input: CreateImageInput) => void;\n    // go straight to editor without variations\n    onEdit: (input: CreateImageInput) => void;\n    onCancel: () => void;\n}\n\nexport function defaultArgs(): CreateImageInput {\n    return {\n        phrases: [\"a painting of a happy corgi wearing sunglasses\"],\n        negative_phrases: [],\n        label: \"\",\n        iterations: 50,\n        encoded_image: \"\",\n        encoded_npy: \"\",\n        encoded_mask: \"\",\n        enable_video: false,\n        enable_zoom: false,\n        zoom_frequency: 10,\n        zoom_scale: 0.99,\n        zoom_shift_x: 0,\n        zoom_shift_y: 0,\n        model: \"stable_diffusion_text2im\",\n        glid_3_xl_clip_guidance: false,\n        glid_3_xl_clip_guidance_scale: 150,\n        glid_3_xl_skip_iterations: 0,\n        width: 512,\n        height: 512,\n        stable_diffusion_strength: 0.75,\n        count: 4,\n    };\n}\n\nexport const ImagePrompt: FC<Props> = ({\n    parent,\n    creating,\n    assetsUrl,\n    onSubmit,\n    onCancel,\n    onEdit,\n}) => {\n    const [prompt, setPrompt] = useState<string>(\"\");\n    const [negativePrompt, setNegativePrompt] = useState<string>(\"\");\n    const [count, setCount] = useState<number>(4);\n    const [variationStrength, setVariationStrength] = useState<number>(0.75);\n    const [aspectRatio, setAspectRatio] =\n        useState<number>(DEFAULT_ASPECT_RATIO);\n    const [parentId, setParentId] = useState<string | null>(null);\n    const [advancedView, setAdvancedView] = useState<boolean>(false);\n    const [encodedImage, setEncodedImage] = useState<string>(\"\");\n    const defaultAspectRatio = aspectRatios[DEFAULT_ASPECT_RATIO];\n    \n    const [aspectRatioDetails, setAspectRatioDetails] = useState<AspectRatio>(aspectRatios[DEFAULT_ASPECT_RATIO]);\n    let [originalWidth, setOriginalWidth] = useState<number>(defaultAspectRatio.width);\n    let [originalHeight, setOriginalHeight] = useState<number>(defaultAspectRatio.height);\n\n    // const aspectRatioDetails = aspectRatios[aspectRatio];\n\n    const resetState = () => {\n        setPrompt(\"\");\n        setNegativePrompt(\"\");\n        setCount(4);\n        setAdvancedView(false);\n        setParentId(null);\n        setVariationStrength(0.75);\n        setAspectRatio(DEFAULT_ASPECT_RATIO);\n        setAspectRatioDetails(aspectRatios[DEFAULT_ASPECT_RATIO]);\n        setEncodedImage(\"\");\n    };\n\n    const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n        e.preventDefault();\n        const args = defaultArgs();\n        args.phrases = [prompt || \"\"];\n        args.negative_phrases = [negativePrompt || \"\"];\n        args.count = count;\n        args.parent = parentId || undefined;\n        args.stable_diffusion_strength = variationStrength;\n        if (parent) {\n            const bestMatch = getClosestAspectRatio(parent.width!, parent.height!);\n            args.width = bestMatch.width;\n            args.height = bestMatch.height;\n            args.nsfw = parent.nsfw;\n        } else {\n            const bestMatch = getClosestAspectRatio(aspectRatioDetails.width, aspectRatioDetails.height);\n            args.width = bestMatch.width;\n            args.height = bestMatch.height;\n        }\n        if (encodedImage) {\n            args.encoded_image = encodedImage;\n        }\n\n        resetState();\n        onSubmit(args);\n    };\n\n    const handleEdit = () => {\n        if (!encodedImage) {\n            console.error(\"Cannot edit without existing image\")\n        }\n        const args = defaultArgs();\n        args.phrases = [prompt || \"\"];\n        args.negative_phrases = [negativePrompt || \"\"];\n        args.count = 1;\n        args.parent = parentId || undefined;\n        args.stable_diffusion_strength = variationStrength;\n        args.status = CreateImageInputStatusEnum.Completed;\n        args.width = originalWidth;\n        args.height = originalHeight;\n        if (parent) {\n            args.nsfw = parent.nsfw;\n        }\n        if (encodedImage) {\n            args.encoded_image = encodedImage;\n        }\n\n        resetState();\n        onEdit(args);\n    }\n\n    const handleCancel = () => {\n        resetState();\n        onCancel();\n    };\n\n    const onImageSelected = async (e: React.ChangeEvent<HTMLInputElement>) => {\n        const file = e.target.files && e.target.files[0];\n        if (!file) {\n            return;\n        }\n        loadImage(\n            file,\n            (img: Event | HTMLImageElement | HTMLCanvasElement) => {\n                if (!(img instanceof HTMLCanvasElement)) {\n                    return;\n                }\n                // try to match width and height to a supported aspect ratio\n                const width = img.width;\n                const height = img.height;\n                let bestMatch = getClosestAspectRatio(width, height);\n                while (compareSize(upscale(bestMatch), width, height) <= 0) {\n                    bestMatch = upscale(bestMatch);\n                    if (getUpscaleLevel(bestMatch.width, bestMatch.height) >= 2) {\n                        break;\n                    }\n                }\n                console.log(\"best match\", bestMatch);\n\n\n                const canvas = document.createElement(\"canvas\");\n                // canvas.width = bestMatch.width;\n                // canvas.height = bestMatch.height;\n                canvas.width = width;\n                canvas.height = height;\n                const ctx = canvas.getContext(\"2d\");\n                if (!ctx) {\n                    return;\n                }\n                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n\n                // convert image to base64\n                // const canvas = img as HTMLCanvasElement\n                const dataUrl = canvas.toDataURL(\"image/png\");\n                const base64 = dataUrl.split(\",\")[1];\n                setEncodedImage(base64);\n                // get the index of the best match\n                setAspectRatio(\n                    aspectRatios.findIndex(\n                        (a) => a.id === bestMatch.id\n                    )\n                );\n                setAspectRatioDetails(bestMatch);\n                setOriginalWidth(width);\n                setOriginalHeight(height);\n                // remove canvas\n                canvas.remove();\n            },\n            {\n                maxWidth: 4096,\n                maxHeight: 4096,\n                canvas: true,\n            }\n        );\n    };\n\n    useEffect(() => {\n        if (parent) {\n            setPrompt(parent.phrases.join(\", \"));\n            setNegativePrompt(parent.negative_phrases.join(\", \"));\n            setCount(4);\n            setParentId(parent.id);\n            setAdvancedView(true);\n            setVariationStrength(parent.stable_diffusion_strength);\n            setEncodedImage(\"\");\n        } else {\n            resetState();\n        }\n    }, [parent]);\n\n    return (\n        <form onSubmit={handleSubmit}>\n            <div className=\"homepage-prompt\">\n                <div className=\"input-group\">\n                    <input\n                        className=\"form-control\"\n                        placeholder=\"What would you like to create?\"\n                        value={prompt}\n                        onChange={(e) => setPrompt(e.target.value)}\n                    />\n\n                    <div className=\"input-group-append\">\n                        <button\n                            type=\"submit\"\n                            className=\"btn btn-secondary light-button\"\n                            style={{ marginLeft: \"8px\" }}\n                            disabled={!prompt || creating}\n                        >\n                            {/* paintbrush button */}\n                            {!creating && (\n                                <i className=\"fas fa-paint-brush\"></i>\n                            )}\n                            {/* spinner button */}\n                            {creating && (\n                                <i className=\"fas fa-spinner fa-spin\"></i>\n                            )}\n                        </button>\n                    </div>\n                </div>\n                <div\n                    style={{\n                        marginTop: \"24px\",\n                    }}\n                >\n                    <a\n                        href=\"javascript:void(0)\"\n                        onClick={() => setAdvancedView(!advancedView)}\n                        style={{\n                            color: \"white\",\n                            textDecoration: \"underline\",\n                        }}\n                    >\n                        Advanced\n                    </a>\n                    &nbsp;\n                    {advancedView ? (\n                        <i className=\"fas fa-chevron-up\"></i>\n                    ) : (\n                        <i className=\"fas fa-chevron-down\"></i>\n                    )}\n                </div>\n                {advancedView && (\n                    <div className=\"homepage-prompt-advanced\">\n                        {parent && !encodedImage && (\n                            <div className=\"form-group\">\n                                <label>Parent Image</label>\n                                {/* ${assetsUrl}/${image.id}.image.png?updated_at=${image.updated_at} */}\n                                <img\n                                    style={{\n                                        display: \"block\",\n                                        marginLeft: \"auto\",\n                                        marginRight: \"auto\",\n                                        maxWidth: \"100%\",\n                                    }}\n                                    src={`${assetsUrl}/${parentId}.image.png?updated_at=${parent.updated_at}`}\n                                />\n                            </div>\n                        )}\n                        {encodedImage && (\n                            <div className=\"form-group\">\n                                <label>Init Image</label>\n                                <img\n                                    style={{\n                                        display: \"block\",\n                                        marginLeft: \"auto\",\n                                        marginRight: \"auto\",\n                                        maxWidth: \"100%\",\n                                    }}\n                                    src={`data:image/png;base64,${encodedImage}`}\n                                />\n                            </div>\n                        )}\n                        {!parent && !encodedImage && (\n                            <AspectRatioSelector\n                                aspectRatio={aspectRatio}\n                                onChange={aspectRatioId => {\n                                    setAspectRatio(aspectRatioId);\n                                    setAspectRatioDetails(\n                                        aspectRatios[aspectRatioId]\n                                    );\n                                }}\n                            />\n                        )}\n                        <div className=\"form-group\">\n                            <div\n                                style={{\n                                    display: \"block\",\n                                    maxWidth: encodedImage ? \"350px\" : \"180px\",\n                                    marginTop: \"40px\",\n                                    marginRight: \"auto\",\n                                    marginLeft: \"auto\",\n                                }}\n                            >\n                                <label\n                                    id=\"loadimage-wrapper\"\n                                    className={`btn btn-primary `}\n                                    style={{ display: \"inline\" }}\n                                >\n                                    {/* upload image */}\n                                    <i className=\"fas fa-upload\"></i>&nbsp;\n                                    {encodedImage || parent\n                                        ? \"Replace Image\"\n                                        : \"Upload Image\"}\n                                    <input\n                                        id=\"loadimage\"\n                                        type=\"file\"\n                                        style={{ display: \"none\" }}\n                                        onChange={onImageSelected}\n                                    />\n                                </label>\n                                {encodedImage && (\n                                    <label\n                                        className=\"btn btn-secondary\"\n                                        onClick={() => setEncodedImage(\"\")}\n                                        style={{ display: \"inline\" }}\n                                    >\n                                        {/* remove image */}\n                                        <i className=\"fas fa-trash\"></i>&nbsp;\n                                        Remove Image\n                                    </label>\n                                )}\n                            </div>\n                        </div>\n                        <div className=\"form-group\">\n                            {/* negative prompt */}\n                            <label htmlFor=\"negativePrompt\">\n                                Negative Prompt\n                            </label>\n                            <input\n                                type=\"text\"\n                                className=\"form-control\"\n                                id=\"negativePrompt\"\n                                placeholder=\"What would you like to avoid?\"\n                                value={negativePrompt}\n                                onChange={(e) =>\n                                    setNegativePrompt(e.target.value)\n                                }\n                            />\n                            <span className=\"helptext\">\n                                Try descriptive words like \"blurry\" or\n                                \"distorted\"\n                            </span>\n                        </div>\n                        <div className=\"form-group\">\n                            <label htmlFor=\"count\">Count: {count}</label>\n                            {/* range slider from 1 to 20 */}\n                            <input\n                                type=\"range\"\n                                className=\"form-control-range\"\n                                id=\"count\"\n                                min=\"1\"\n                                max=\"20\"\n                                value={count}\n                                onChange={(e) =>\n                                    setCount(parseInt(e.target.value))\n                                }\n                            />\n                            <span className=\"helptext\">\n                                This is how many images you want to generate\n                            </span>\n                        </div>\n                        {(parentId || encodedImage) && (\n                            <div className=\"form-group\">\n                                {/* variation strength */}\n                                <label htmlFor=\"variationStrength\">\n                                    Variation Strength:&nbsp;\n                                    {(variationStrength * 100).toFixed(0)}%\n                                </label>\n                                <input\n                                    type=\"range\"\n                                    className=\"form-control-range\"\n                                    id=\"variationStrength\"\n                                    min=\"0.05\"\n                                    max=\"0.95\"\n                                    step=\"0.05\"\n                                    value={variationStrength}\n                                    onChange={(e) =>\n                                        setVariationStrength(\n                                            parseFloat(e.target.value)\n                                        )\n                                    }\n                                />\n                                <span className=\"helptext\">\n                                    This is how much variation you want to see\n                                    from the parent image\n                                </span>\n                            </div>\n                        )}\n                        {advancedView && (\n                            <div\n                                className=\"form-group\"\n                                style={{ minHeight: \"20px\" }}\n                            >\n                                <div className=\"float-right\">\n                                    {parent && (\n                                        <button\n                                            type=\"button\"\n                                            className=\"btn btn-secondary light-button\"\n                                            onClick={handleCancel}\n                                        >\n                                            <i className=\"fas fa-times\"></i>\n                                            &nbsp;CANCEL\n                                        </button>\n                                    )}\n                                    <button\n                                        type=\"submit\"\n                                        className=\"btn btn-primary\"\n                                        style={{ marginLeft: \"8px\" }}\n                                        disabled={!prompt || creating}\n                                    >\n                                        {/* paintbrush button */}\n                                        {!creating && (\n                                            <i className=\"fas fa-paint-brush\"></i>\n                                        )}\n                                        {/* spinner button */}\n                                        {creating && (\n                                            <i className=\"fas fa-spinner fa-spin\"></i>\n                                        )}\n                                        &nbsp;PAINT\n                                    </button>\n                                    {encodedImage && (\n                                        <button\n                                            type=\"button\"\n                                            className=\"btn btn-secondary light-button\"\n                                            onClick={handleEdit}\n                                            style={{ marginLeft: \"8px\" }}\n                                            disabled={!prompt || creating}\n                                        >\n                                            <i className=\"fas fa-edit\"></i>\n                                            &nbsp;EDIT\n                                        </button>\n                                    )}\n                                </div>\n                            </div>\n                        )}\n                    </div>\n                )}\n            </div>\n        </form>\n    );\n};\n","import { aspectRatios } from \"./aspecRatios\";\n\nexport function getUpscaleLevel(width: number, height: number): number {\n    for (let i = 0; i < aspectRatios.length; i++) {\n        const aspectRatio = aspectRatios[i];\n        if (width * height <= aspectRatio.width * aspectRatio.height) {\n            return 0;\n        }\n        // if (width === aspectRatio.width && height === aspectRatio.height) {\n        //     return upscaleLevel;\n        // }\n    }\n    width /= 2;\n    height /= 2;\n    for (let i = 0; i < aspectRatios.length; i++) {\n        const aspectRatio = aspectRatios[i];\n        if (width * height <= aspectRatio.width * aspectRatio.height) {\n            return 1;\n        }\n        // if (width === aspectRatio.width && height === aspectRatio.height) {\n        //     return upscaleLevel;\n        // }\n    }\n    return 2;\n}\n","\nexport const NOTIFICATION_IMAGE_UPDATED = \"image_updated\";\nexport const NOTIFICATION_IMAGE_DELETED = \"image_deleted\";\nexport const NOTIFICATION_PENDING_IMAGE = \"pending_image\";\n\nexport class ApiSocket {\n    private client?: WebSocket;\n    private accessToken?: string\n    private messageListener?: (message: string) => void;\n\n    updateToken(accessToken: string) {\n        this.accessToken = accessToken;\n    }\n\n    onMessage(listener?: (message: string) => void) {\n        this.messageListener = listener;\n    }\n\n    connect() {\n        if (!this.accessToken) {\n            throw new Error(\"unauthenticated\");\n        }\n        if (this.client) {\n            // will reconnect in one second automatically\n            // this is called every time the auth refreshes\n            this.client.close();\n            return;\n        }\n        let host = window.location.host;\n        let protocol = \"wss\";\n        if (host.includes(\"localhost\")) {\n          host = \"localhost:3000\";\n          protocol = \"ws\";\n        }\n        this.client = new WebSocket(`${protocol}://${host}`);\n        this.client.onerror = err => console.error(err);\n        this.client.onopen = () => {\n            console.log(\"websocket connected\");\n            this.client!.send(this.accessToken!);\n        }\n        this.client.onmessage = evt => {\n            console.log(\"server push\", evt.data);\n            if (this.messageListener) {\n                this.messageListener(evt.data as string);\n            }\n        }\n        this.client.onclose = () => {\n          console.log(\"websocket closed\");\n          this.client = undefined;\n          setTimeout(() => this.connect(), 1000);\n        }\n    }\n}\n","import { Rect } from \"../pages/image-editor/models\";\n\nexport function featherEdges(\n    selectionOverlay: Rect,\n    imageWidth: number,\n    imageHeight: number,\n    imageData: ImageData,\n    featherWidth?: number\n) {\n    const featherLeftEdge = selectionOverlay.x != 0;\n    const featherRightEdge =\n        selectionOverlay.x + selectionOverlay.width != imageWidth;\n    const featherTopEdge = selectionOverlay.y != 0;\n    const featherBottomEdge =\n        selectionOverlay.y + selectionOverlay.height != imageHeight;\n\n    const baseWidth = Math.min(selectionOverlay.width, selectionOverlay.height);\n    if (!featherWidth) {\n        featherWidth = Math.floor(baseWidth / 8);\n    }\n\n    if (featherTopEdge) {\n        for (let y = 0; y < featherWidth; y++) {\n            for (let x = 0; x < selectionOverlay.width; x++) {\n                const pixelIndex = (y * selectionOverlay.width + x) * 4;\n                const alpha = (y / featherWidth) * 255;\n                const existingAlpha = imageData.data[pixelIndex + 3];\n                imageData.data[pixelIndex + 3] = Math.min(alpha, existingAlpha);\n            }\n        }\n    }\n    if (featherBottomEdge) {\n        for (\n            let y = selectionOverlay.height - featherWidth;\n            y < selectionOverlay.height;\n            y++\n        ) {\n            for (let x = 0; x < selectionOverlay.width; x++) {\n                const pixelIndex = (y * selectionOverlay.width + x) * 4;\n                const alpha =\n                    ((selectionOverlay.height - y) / featherWidth) * 255;\n                const existingAlpha = imageData.data[pixelIndex + 3];\n                imageData.data[pixelIndex + 3] = Math.min(alpha, existingAlpha);\n            }\n        }\n    }\n    if (featherLeftEdge) {\n        for (let x = 0; x < featherWidth; x++) {\n            for (let y = 0; y < selectionOverlay.height; y++) {\n                const pixelIndex = (y * selectionOverlay.width + x) * 4;\n                const alpha = (x / featherWidth) * 255;\n                const existingAlpha = imageData.data[pixelIndex + 3];\n                imageData.data[pixelIndex + 3] = Math.min(alpha, existingAlpha);\n            }\n        }\n    }\n    if (featherRightEdge) {\n        for (\n            let x = selectionOverlay.width - featherWidth;\n            x < selectionOverlay.width;\n            x++\n        ) {\n            for (let y = 0; y < selectionOverlay.height; y++) {\n                const pixelIndex = (y * selectionOverlay.width + x) * 4;\n                const alpha =\n                    ((selectionOverlay.width - x) / featherWidth) * 255;\n                const existingAlpha = imageData.data[pixelIndex + 3];\n                imageData.data[pixelIndex + 3] = Math.min(alpha, existingAlpha);\n            }\n        }\n    }\n}\n\nexport function applyAlphaMask(imageData: ImageData, alphaMask: ImageData) {\n    if (\n        imageData.width != alphaMask.width ||\n        imageData.height != alphaMask.height\n    ) {\n        throw new Error(\"imageData and alphaMask are not the same size\");\n    }\n    const spread = 10;\n    for (let x = 0; x < imageData.width; x++) {\n        for (let y = 0; y < imageData.height; y++) {\n            // r, g, b, a\n            // if transparency within 10 pixels, set alpha to 1, otherwise to zero.\n            // binary alpha inversion with spread\n            let alpha = false;\n            for (\n                let x2 = Math.max(0, x - spread);\n                x2 < Math.min(imageData.width, x + spread);\n                x2++\n            ) {\n                for (\n                    let y2 = Math.max(0, y - spread);\n                    y2 < Math.min(imageData.height, y + spread);\n                    y2++\n                ) {\n                    const alphaValue =\n                        alphaMask.data[y2 * alphaMask.width * 4 + x2 * 4 + 3];\n                    if (alphaValue < 255) {\n                        alpha = true;\n                    }\n                }\n            }\n            const alphaIndex = y * imageData.width * 4 + x * 4 + 3;\n            if (alpha) {\n                imageData.data[alphaIndex] = 255;\n            } else {\n                imageData.data[alphaIndex] = 0;\n            }\n        }\n    }\n}\n\nfunction getAverageColor(imageData: ImageData) {\n    let red = 0;\n    let green = 0;\n    let blue = 0;\n    let count = 0;\n    for (let i = 0; i < imageData.data.length; i += 4) {\n        if (imageData.data[i + 3] > 0) {\n            red += imageData.data[i];\n            green += imageData.data[i + 1];\n            blue += imageData.data[i + 2];\n            count++;\n        }\n    }\n    return {\n        red: red / count,\n        green: green / count,\n        blue: blue / count,\n    };\n}\n\nexport function fixRedShift(baseImageData: ImageData, imageData: ImageData) {\n    // get the average red, green and blue values for the base image\n    const baseAverageColor = getAverageColor(baseImageData);\n    const averageColor = getAverageColor(imageData);\n\n    // we need to multiply pixels in imageData by an amount so that the average equals the base average\n    // do this for red, green and blue separately\n    const redMultiplier = baseAverageColor.red / averageColor.red;\n    const greenMultiplier = baseAverageColor.green / averageColor.green;\n    const blueMultiplier = baseAverageColor.blue / averageColor.blue;\n\n    for (let i = 0; i < imageData.data.length; i += 4) {\n        imageData.data[i] *= Math.floor(redMultiplier);\n        imageData.data[i + 1] *= Math.floor(greenMultiplier);\n        imageData.data[i + 2] *= Math.floor(blueMultiplier);\n    }\n}\n\nexport function createEncodedThumbnail(encodedImage: string): Promise<string> {\n    return new Promise((resolve, reject) => {\n        // use html5 canvas\n        // crop to square aspect ratio on 128x128 canvas\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = 128;\n        canvas.height = 128;\n\n        const image = new Image();\n        image.src = `data:image/png;base64,${encodedImage}`;\n        image.onload = () => {\n            const context = canvas.getContext(\"2d\");\n            if (!context) {\n                throw new Error(\"Could not create canvas context\");\n            }\n            const width = 128;\n            const height = 128;\n            canvas.width = width;\n            canvas.height = height;\n            context.drawImage(\n                image,\n                0,\n                0,\n                image.width,\n                image.height,\n                0,\n                0,\n                width,\n                height\n            );\n            // save to png\n            const imageUrl = canvas.toDataURL(\"image/png\");\n            const base64 = imageUrl.split(\",\")[1];\n            resolve(base64);\n        };\n    });\n}\n","import React, { useState, useEffect } from \"react\";\nimport { Renderer } from \"./renderer\";\nimport { Cursor, Rect } from \"./models\";\nimport { Tool, BaseTool } from \"./tool\";\nimport { AspectRatioSelector } from \"../../components/AspectRatioSelector\";\nimport { getUpscaleLevel } from \"../../lib/upscale\";\nimport {\n    DEFAULT_ASPECT_RATIO,\n    aspectRatios,\n    getClosestAspectRatio,\n} from \"../../lib/aspecRatios\";\nimport { ZoomHelper } from \"./zoomHelper\";\nimport { runInThisContext } from \"vm\";\n\nexport class SelectionTool extends BaseTool implements Tool {\n    private selectionOverlay: Rect | undefined;\n    private selectionOverlayPreview: Rect | undefined;\n    private outpaint?: boolean;\n\n    // private selectionWidth: number = 512;\n    // private selectionHeight: number = 512;\n\n    private panning = false;\n\n    // TODO: size modifier to make the selection overlay smaller\n\n    constructor(renderer: Renderer) {\n        super(renderer, \"select\");\n    }\n\n    updateArgs(args: any) {\n        args = {\n            ...this.getArgs(),\n            ...args,\n        }\n        super.updateArgs(args);\n        this.selectionOverlay = args.selectionOverlay || {\n            x: 0,\n            y: 0,\n            width: 512,\n            height: 512,\n        };\n        this.outpaint = args.outpaint;\n        if (!this.outpaint) {\n            this.selectionOverlay = this.clamp(this.selectionOverlay!);\n        }\n        this.sync();\n    }\n\n    private clamp(rect: Rect): Rect {\n        const imageWidth = this.renderer.getWidth();\n        const imageHeight = this.renderer.getHeight();\n        let x = rect.x;\n        let y = rect.y;\n        let width = rect.width;\n        let height = rect.height;\n        // clamp to the canvas\n        x = Math.max(0, Math.min(x, imageWidth - this.selectionOverlay!.width));\n        y = Math.max(0, Math.min(y, imageHeight - rect.height));\n        x = Math.min(x, imageWidth - rect.width);\n        y = Math.min(y, imageHeight - rect.height);\n        width = Math.min(width, imageWidth);\n        height = Math.min(height, imageHeight);\n        return {\n            x: x,\n            y: y,\n            width: width,\n            height: height,\n        };\n    }\n\n    private sync(): void {\n        this.renderer.setSelectionOverlay(this.selectionOverlay);\n        this.renderer.setSelectionOverlayPreview(this.selectionOverlayPreview);\n    }\n\n    onMouseDown(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (event.type == \"touch\") {\n            this.onMouseMove(event);\n        } else if (event.button === 0) {\n            this.selectionOverlay = this.selectionOverlayPreview;\n            this.selectionOverlayPreview = undefined;\n            this.sync();\n            this.updateArgs({\n                selectionOverlay: this.selectionOverlay,\n            });\n        } else if (event.button === 1) {\n            this.panning = true;\n        }\n    }\n\n    onMouseMove(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        const imageWidth = this.renderer.getWidth();\n        const imageHeight = this.renderer.getHeight();\n        if (this.panning) {\n            this.zoomHelper.onPan(event);\n        } else {\n            let { x, y } = this.zoomHelper.translateMouseToCanvasCoordinates(\n                event.nativeEvent.offsetX,\n                event.nativeEvent.offsetY\n            );\n\n            // round to the nearest 16 pixels\n            x = Math.round(x / 16) * 16;\n            y = Math.round(y / 16) * 16;\n            // offset by -256 to center the rect\n            x -= 256;\n            y -= 256;\n\n            this.selectionOverlayPreview = {\n                x: x,\n                y: y,\n                width: this.selectionOverlay!.width,\n                height: this.selectionOverlay!.height,\n            };\n\n            if (!this.outpaint) {\n                // // clamp to the canvas\n                // x = Math.max(\n                //     0,\n                //     Math.min(x, imageWidth - this.selectionOverlay!.width)\n                // );\n                // y = Math.max(\n                //     0,\n                //     Math.min(y, imageHeight - this.selectionOverlay!.height)\n                // );\n                // x = Math.min(x, imageWidth - this.selectionOverlay!.width);\n                // y = Math.min(y, imageHeight - this.selectionOverlay!.height);\n                this.selectionOverlayPreview = this.clamp(this.selectionOverlayPreview);\n            }\n\n            \n            this.sync();\n        }\n    }\n\n    onMouseUp(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        if (event.button === 0 && event.type == \"touch\") {\n            this.selectionOverlay = this.selectionOverlayPreview;\n            this.selectionOverlayPreview = undefined;\n            this.sync();\n            this.updateArgs({\n                selectionOverlay: this.selectionOverlay,\n            });\n        }\n        this.panning = false;\n    }\n\n    onMouseLeave(event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) {\n        this.selectionOverlayPreview = undefined;\n        this.panning = false;\n        this.sync();\n    }\n\n    onWheel(event: WheelEvent) {\n        this.zoomHelper.onWheel(event);\n    }\n\n    destroy() {\n        // this.renderer.setSelectionOverlay(undefined);\n        this.renderer.setSelectionOverlayPreview(undefined);\n        return true;\n    }\n}\n\ninterface ControlsProps {\n    renderer: Renderer;\n    tool: Tool;\n    /** Lock aspect ratio for smaller images */\n    lockAspectRatio?: boolean;\n    outpaint?: boolean;\n}\n\nexport const Controls: React.FC<ControlsProps> = ({\n    renderer,\n    tool,\n    lockAspectRatio,\n    outpaint,\n}) => {\n    const upscaleLevel = getUpscaleLevel(\n        renderer.getWidth(),\n        renderer.getHeight()\n    );\n    const [aspectRatio, setAspectRatio] = useState(DEFAULT_ASPECT_RATIO);\n    const [size, setSize] = useState(1);\n\n    useEffect(() => {\n        const upscaleLevel = getUpscaleLevel(\n            renderer.getWidth(),\n            renderer.getHeight()\n        );\n        // lock aspect ratio to image\n        if (upscaleLevel === 0 && lockAspectRatio) {\n            const aspectRatio = getClosestAspectRatio(\n                renderer.getWidth(),\n                renderer.getHeight()\n            );\n            setAspectRatio(aspectRatio.id);\n            tool.updateArgs({\n                selectionOverlay: {\n                    x: 0,\n                    y: 0,\n                    width: aspectRatio.width,\n                    height: aspectRatio.height,\n                },\n                outpaint,\n            });\n        } else {\n            const args = tool.getArgs();\n            if (args.selectionOverlay) {\n                // restore args\n                const aspectRatio = getClosestAspectRatio(\n                    args.selectionOverlay.width,\n                    args.selectionOverlay.height\n                );\n                setAspectRatio(aspectRatio.id);\n                setSize(args.selectionOverlay.width / aspectRatio.width);\n                tool.updateArgs(args);\n            } else {\n                // set default args\n                args.selectionOverlay = {\n                    x: 0,\n                    y: 0,\n                    width: aspectRatios[aspectRatio].width,\n                    height: aspectRatios[aspectRatio].height,\n                };\n                args.outpaint = outpaint;\n                tool.updateArgs(args);\n            }\n        }\n    }, [tool]);\n\n    function onChange(aspectRatioId: number, size: number) {\n        const args = tool.getArgs();\n        const aspectRatio = aspectRatios[aspectRatioId];\n        if (args.selectionOverlay) {\n            const xDiff =\n                args.selectionOverlay.width - aspectRatio.width * size;\n            const yDiff =\n                args.selectionOverlay.height - aspectRatio.height * size;\n            args.selectionOverlay.width = Math.round(aspectRatio.width * size);\n            args.selectionOverlay.height = Math.round(\n                aspectRatio.height * size\n            );\n            args.selectionOverlay.x += xDiff / 2;\n            args.selectionOverlay.y += yDiff / 2;\n            if (!outpaint) {\n                // clamp to canvas\n                args.selectionOverlay.x = Math.round(\n                    Math.max(\n                        0,\n                        Math.min(\n                            args.selectionOverlay.x,\n                            renderer.getWidth() - args.selectionOverlay.width\n                        )\n                    )\n                );\n                args.selectionOverlay.y = Math.round(\n                    Math.max(\n                        0,\n                        Math.min(\n                            args.selectionOverlay.y,\n                            renderer.getHeight() - args.selectionOverlay.height\n                        )\n                    )\n                );\n            }\n        }\n        tool.updateArgs({\n            selectionOverlay: args.selectionOverlay,\n        });\n    }\n\n    return (\n        <>\n            {upscaleLevel > 0 && (\n                <AspectRatioSelector\n                    aspectRatio={aspectRatio}\n                    onChange={(aspectRatioId) => {\n                        onChange(aspectRatioId, size);\n                        setAspectRatio(aspectRatioId);\n                    }}\n                />\n            )}\n            <div className=\"form-group\">\n                <label htmlFor=\"size\" style={{ width: \"100%\" }}>\n                    Size\n                    <small\n                        className=\"form-text text-muted\"\n                        style={{ float: \"right\" }}\n                    >\n                        {Math.round(size * 100)}%\n                    </small>\n                </label>\n                {/* range from 0.1 to 1 */}\n                <input\n                    type=\"range\"\n                    className=\"form-control-range\"\n                    id=\"size\"\n                    min=\"0.5\"\n                    max=\"1\"\n                    step=\"0.1\"\n                    value={size}\n                    onChange={(event) => {\n                        onChange(aspectRatio, parseFloat(event.target.value));\n                        setSize(parseFloat(event.target.value));\n                    }}\n                />\n            </div>\n        </>\n    );\n};\n","import React, { FC, useEffect, useRef, useState } from \"react\";\nimport { Modal } from \"react-bootstrap\";\nimport { propTypes } from \"react-bootstrap/esm/Image\";\n\ninterface Props {\n    show: boolean;\n    title?: string;\n}\n\n// Show modal with child contents\nexport const BusyModal: FC<Props> = ({ show, title, children }) => {\n    return (\n        <Modal show={show} backdrop=\"static\" keyboard={false}>\n            <Modal.Header closeButton>\n                <Modal.Title>{title || \"Processing\"}</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <div className=\"d-flex justify-content-center\">\n                    <div className=\"spinner-border\" role=\"status\">\n                        <span className=\"sr-only\">{children || \"Please Wait...\"}</span>\n                    </div>\n                </div>\n            </Modal.Body>\n        </Modal>\n    );\n}","export function sleep(ms: number): Promise<void> {\n    return new Promise(resolve => window.setTimeout(resolve, ms));\n}\n","import React, { FC, useEffect, useRef, useState } from \"react\";\n\nimport { aspectRatios, DEFAULT_ASPECT_RATIO, getClosestAspectRatio } from \"../lib/aspecRatios\";\n\ninterface Props {\n    aspectRatio: number;\n    onChange: (aspectRatio: number) => void;\n    disabled?: boolean;\n}\n\nexport const AspectRatioSelector: FC<Props> = ({ aspectRatio, onChange, disabled }) => {\n    const aspectRatioDetails = aspectRatios[aspectRatio];\n    return (\n        <div className=\"form-group\">\n            <div\n                style={{\n                    minHeight: \"140px\",\n                    display: \"flex\",\n                    alignItems: \"center\",\n                }}\n            >\n                {/* aspect ratio slider, goes from 0 -> aspectRatios.length - 1 */}\n                <div\n                    style={{\n                        width: aspectRatioDetails.width / 8,\n                        height: aspectRatioDetails.height / 8,\n                        // dotted line options: dotted, dashed, solid, double, groove, ridge, inset, outset, none, hidden\n                        border: \"1px dashed white\",\n                        margin: \"auto\",\n                    }}\n                ></div>\n            </div>\n            <label style={{width: \"100%\"}}>\n                Aspect Ratio\n                <small className=\"form-text text-muted\" style={{float: \"right\"}}>\n                    {aspectRatioDetails.displayName}\n                </small>\n            </label>\n            <input\n                type=\"range\"\n                disabled={disabled}\n                className=\"form-control-range\"\n                min={0}\n                max={aspectRatios.length - 1}\n                value={aspectRatio}\n                onChange={(e) => {\n                    onChange(parseInt(e.target.value));\n                }}\n            />\n        </div>\n    );\n};\n"],"sourceRoot":""}