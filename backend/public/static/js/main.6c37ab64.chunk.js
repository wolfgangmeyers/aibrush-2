(this["webpackJsonpaibrush-frontend"]=this["webpackJsonpaibrush-frontend"]||[]).push([[0],{100:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(3),r=n(0),s=n(1),i=function(e){var t=e.message,n=e.timestamp,i=e.alertType,c=Object(r.useState)(!!t),o=Object(a.a)(c,2),u=o[0],l=o[1];return Object(r.useEffect)((function(){if(l(!!t),t){var e=setTimeout((function(){l(!1)}),1e4);return function(){clearTimeout(e)}}}),[t,n]),u?Object(s.jsxs)("div",{className:"alert alert-".concat(i," ").concat(u?"show":"hide"),children:[Object(s.jsx)("button",{type:"button",className:"close",onClick:function(){return l(!1)},children:"\xd7"}),t]}):null},c=function(e){var t=e.message,n=e.timestamp;return Object(s.jsx)(i,{message:t||"",timestamp:n,alertType:"danger"})}},115:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n(0);var a=n(18),r=n(1),s=function(e){var t=e.aspectRatio,n=e.onChange,s=e.disabled,i=a.b[t];return Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsx)("div",{style:{minHeight:"140px",display:"flex",alignItems:"center"},children:Object(r.jsx)("div",{style:{width:i.width/8,height:i.height/8,border:"1px dashed white",margin:"auto"}})}),Object(r.jsxs)("label",{style:{width:"100%"},children:["Aspect Ratio",Object(r.jsx)("small",{className:"form-text text-muted",style:{float:"right"},children:i.displayName})]}),Object(r.jsx)("input",{type:"range",disabled:s,className:"form-control-range",min:0,max:a.b.length-1,value:t,onChange:function(e){n(parseInt(e.target.value))}})]})}},122:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(2),r=n.n(a),s=n(5),i=n(15),c=n(16),o=function(){function e(t){Object(i.a)(this,e),this.dbConfig=void 0,this.db=null,this.dbConfig=t}return Object(c.a)(e,[{key:"createDB",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=indexedDB.open(t.dbConfig.dbName);a.onupgradeneeded=function(){a.result.createObjectStore(t.dbConfig.storeName)},a.onsuccess=function(){e(a.result)},a.onerror=function(){n(a.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getDB",value:function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=4;break}return e.next=3,this.createDB();case 3:this.db=e.sent;case 4:return e.abrupt("return",this.db);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getItem",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n,a=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDB();case 2:return n=e.sent,e.abrupt("return",new Promise((function(e,r){var s=n.transaction(a.dbConfig.storeName).objectStore(a.dbConfig.storeName).get(t);s.onsuccess=function(){e(s.result)},s.onerror=function(){e(null)}})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setItem",value:function(){var e=Object(s.a)(r.a.mark((function e(t,n){var a,s=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDB();case 2:return a=e.sent,e.abrupt("return",new Promise((function(e,r){var i=a.transaction(s.dbConfig.storeName,"readwrite").objectStore(s.dbConfig.storeName).put(n,t);i.onsuccess=function(){e()},i.onerror=function(){e()}})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteItem",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n,a=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDB();case 2:return n=e.sent,e.abrupt("return",new Promise((function(e,r){var s=n.transaction(a.dbConfig.storeName,"readwrite").objectStore(a.dbConfig.storeName).delete(t);s.onsuccess=function(){e()},s.onerror=function(){e()}})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllItems",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDB();case 2:return t=e.sent,e.abrupt("return",new Promise((function(e,a){var r=t.transaction(n.dbConfig.storeName).objectStore(n.dbConfig.storeName).getAll();r.onsuccess=function(){e(r.result)},r.onerror=function(){e([])}})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}()},123:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(3),r=n(0),s=n(127),i=n(1),c=function(e){var t=e.selectedColor,n=e.color,c=e.onClick,o=e.onColorSelected,u=Object(r.useState)(!1),l=Object(a.a)(u,2),h=l[0],d=l[1],f=Object(r.useState)(n),m=Object(a.a)(f,2),p=m[0],g=m[1];Object(r.useEffect)((function(){g(n)}),[n]);var b="palette-button";return t===n?b+=" selected":"#000000"==n&&(b+=" black"),Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{className:b,style:{backgroundColor:n},onClick:function(){return c(n)},onDoubleClick:function(){return d(!h)}}),o&&h?Object(i.jsxs)("div",{style:{position:"absolute",zIndex:2},children:[Object(i.jsx)(s.a,{color:p,onChange:function(e){return g(e.hex)},onChangeComplete:function(e){return g(e.hex)}}),Object(i.jsx)("button",{className:"btn btn-primary",style:{marginRight:"8px",marginLeft:"16px"},onClick:function(){o(p),d(!1)},children:Object(i.jsx)("i",{className:"fas fa-check"})}),Object(i.jsx)("button",{className:"btn btn-primary",onClick:function(){return d(!1)},children:Object(i.jsx)("i",{className:"fas fa-times"})})]}):null]})}},128:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var a=n(3),r=n(0),s=n(21),i=n(26),c=n(222),o=n(1),u=function(e){var t=e.text,n=Object(r.useState)(!1),s=Object(a.a)(n,2),i=s[0],u=s[1];return Object(o.jsx)(c.CopyToClipboard,{text:t,onCopy:function(){u(!0),setTimeout((function(){return u(!1)}),5e3)},children:Object(o.jsx)("span",{style:{cursor:"pointer",marginLeft:"8px"},children:Object(o.jsx)("i",{className:"fas fa-".concat(i?"check":"copy"),style:{color:i?"green":void 0}})})})},l=function(e){var t=e.onSwipe,n=e.children,s=Object(r.useState)(null),i=Object(a.a)(s,2),c=i[0],u=i[1],l=Object(r.useState)(null),h=Object(a.a)(l,2),d=h[0],f=h[1];return Object(o.jsx)("div",{onTouchStart:function(e){f(null),u(e.targetTouches[0].clientX)},onTouchMove:function(e){return f(e.targetTouches[0].clientX)},onTouchEnd:function(){if(c&&d){var e=c-d,n=e>50;(n||e<-50)&&t(n?1:-1)}},children:n})},h=function(e){var t=e.image,n=e.censorNSFW,c=e.onClose,h=e.onDelete,d=e.onFork,f=e.onEdit,m=e.onNSFW,p=e.onSave,g=e.onSwipe,b=Object(r.useRef)(null),j="https://aibrush2-filestore.s3.amazonaws.com/".concat(t.id,".image.png?updated_at=").concat(t.updated_at);t.imageData&&(j=t.imageData);t.score;t.params.negative_prompt&&0!=t.negative_score&&t.negative_score;var v=Object(r.useState)(!1),x=Object(a.a)(v,2),O=x[0],y=x[1];Object(r.useEffect)((function(){b.current&&(b.current.onerror=function(){b.current&&(b.current.src="/images/default.png")})}),[b]);var w=t.label;w||(w=t.params.prompt),w.indexOf(",")>0&&(w=w.substring(0,w.indexOf(",")));var k="10px";window.innerWidth<992&&(k="-30px");var C=.6*window.innerHeight+"px";return Object(o.jsxs)(s.a,{show:!0,onHide:c,size:"xl",children:[Object(o.jsx)(s.a.Header,{closeButton:!0,children:Object(o.jsx)(s.a.Title,{children:w})}),Object(o.jsxs)(s.a.Body,{children:[Object(o.jsxs)("div",{style:{position:"relative"},children:[g&&Object(o.jsx)("button",{className:"btn btn-secondary btn-sm image-popup-left-button",style:{position:"absolute",left:k,top:"50%",transform:"translateY(-50%)",zIndex:1,padding:"5px 10px"},onClick:function(){return g(t,-1)},children:Object(o.jsx)("i",{className:"fas fa-chevron-left"})}),Object(o.jsx)(l,{onSwipe:function(e){return g&&g(t,e)},children:Object(o.jsx)("img",{ref:b,style:{maxWidth:"100%",maxHeight:C,display:"block",marginLeft:"auto",marginRight:"auto",filter:t.nsfw&&n&&!O?"blur(30px)":""},id:"image-popup-".concat(t.id),src:j,alt:t.label})}),Object(o.jsx)("button",{className:"btn btn-secondary btn-sm .image-popup-right-button",style:{position:"absolute",right:k,top:"50%",transform:"translateY(-50%)",zIndex:1,padding:"5px 10px"},onClick:function(){return g&&g(t,1)},children:Object(o.jsx)("i",{className:"fas fa-chevron-right"})})]}),Object(o.jsx)("div",{className:"row",children:Object(o.jsx)("div",{className:"col-lg-12"})}),Object(o.jsx)("div",{className:"row",children:Object(o.jsxs)("div",{className:"col-lg-12",children:[Object(o.jsxs)("div",{className:"image-popup-controls",style:{marginTop:"40px"},children:[function(e){var t=e.charAt(0).toUpperCase()+e.slice(1),n="fa fa-question-circle";switch(e){case i.a.Pending:n="fas fa-hourglass-half";break;case i.a.Processing:n="fas fa-cog fa-spin";break;case i.a.Completed:n="fas fa-check";break;case i.a.Saved:n="fas fa-save";break;case i.a.Error:n="fas fa-exclamation-circle"}return Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)("span",{style:{fontSize:"24px"},children:[Object(o.jsx)("i",{className:"".concat(n," status-badge status-badge-").concat(e),style:{fontSize:"10px",position:"relative",top:"-1px"}}),"\xa0",t]})})}(t.status),Object(o.jsxs)("div",{style:{float:"right"},children:[d&&(t.status===i.a.Saved||t.status===i.a.Completed)&&Object(o.jsxs)("button",{className:"btn btn-secondary btn-sm image-popup-button",onClick:function(){return d(t)},style:{marginRight:"5px"},children:[Object(o.jsx)("i",{className:"fas fa-code-branch"}),"\xa0VARIATIONS"]}),h&&Object(o.jsxs)("button",{className:"btn btn-danger btn-sm image-popup-delete-button",onClick:function(){return h&&h(t)},style:{marginRight:"5px"},children:[Object(o.jsx)("i",{className:"fas fa-trash-alt"}),"\xa0DELETE"]}),f&&Object(o.jsxs)("button",{className:"btn btn-primary btn-sm image-popup-button edit-button",onClick:function(){return f&&f(t)},style:{marginRight:"5px"},children:[Object(o.jsx)("i",{className:"fas fa-edit"}),"\xa0EDIT"]}),p&&Object(o.jsxs)("button",{className:"btn btn-primary btn-sm image-popup-button",onClick:function(){return p&&p(t)},style:{marginRight:"5px"},children:[Object(o.jsx)("i",{className:"fas fa-save"}),"\xa0SAVE"]}),t.nsfw&&n&&Object(o.jsxs)("button",{className:"btn btn-primary btn-sm image-popup-button",onClick:function(){return y(!O)},style:{marginRight:"5px"},children:[Object(o.jsx)("i",{className:"fas fa-eye"}),"\xa0",O?"HIDE":"SHOW"]})]})]}),Object(o.jsxs)("div",{className:"image-popup-controls",style:{marginTop:"28px",marginBottom:"85px"},children:[Object(o.jsxs)("div",{children:["Image dimensions: ",t.params.width," x"," ",t.params.height]}),Object(o.jsxs)("div",{children:["Model: ",t.model]}),t.nsfw&&Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)("div",{children:[Object(o.jsx)("i",{className:"fas fa-exclamation-triangle",style:{color:"orange",fontSize:"18px",position:"relative",top:"2px"}}),"\xa0May contain NSFW content"]}),m&&Object(o.jsx)("a",{href:"javascript:void(0)",onClick:function(){return m(t,!1)},children:"Mark as Safe for Work"})]}),t.params.seed&&Object(o.jsxs)("div",{children:["Seed: ",t.params.seed]}),!t.nsfw&&Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)("div",{children:[Object(o.jsx)("i",{className:"fas fa-check",style:{color:"green",fontSize:"18px",position:"relative",top:"2px"}}),"\xa0Safe for Work"]}),m&&Object(o.jsx)("a",{href:"javascript:void(0)",onClick:function(){return m(t,!0)},children:"Mark as Not Safe for Work"})]}),Object(o.jsxs)("div",{style:{marginTop:"8px"},children:["Prompt: ",t.params.prompt,Object(o.jsx)(u,{text:t.params.prompt})]}),Object(o.jsxs)("div",{style:{marginTop:"8px"},children:["Negative Prompt: ",t.params.negative_prompt,Object(o.jsx)(u,{text:t.params.negative_prompt})]})]})]})})]})]})}},161:function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return m}));var a=n(3),r=n(15),s=n(16),i=n(60),c=n(30),o=n(32),u=n(33),l=n(0),h=n(38),d=n(1),f=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e,"smudge")).brushSize=10,a.brushOpacity=.2,a.lastX=0,a.lastY=0,a.panning=!1,a.smudging=!1,a._dirty=!1,a.dirtyListener=void 0,a}return Object(s.a)(n,[{key:"dirty",get:function(){return this._dirty},set:function(e){this._dirty=e,this.dirtyListener&&this.dirtyListener(e)}},{key:"sync",value:function(){this.renderer.setCursor({type:"circle",color:"white",radius:this.brushSize/2,x:this.lastX,y:this.lastY})}},{key:"updateArgs",value:function(e){Object(i.a)(Object(c.a)(n.prototype),"updateArgs",this).call(this,e),this.brushSize=e.brushSize||10,this.brushOpacity=e.brushOpacity||.2,this.sync()}},{key:"onMouseMove",value:function(e){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.panning?this.zoomHelper.onPan(e):this.smudging&&(this.renderer.smudgeLine(this.lastX,this.lastY,n,a,this.brushSize,this.brushOpacity),this.dirty=!0),this.lastX=n,this.lastY=a,this.sync()}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e),this.sync()}},{key:"onMouseDown",value:function(e){if(0===e.button){this.smudging=!0,this.dirty||this.renderer.copyEditImageFromBaseImage(),this.dirty=!0;var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.lastX=n,this.lastY=a,this.sync()}else 1===e.button&&(this.panning=!0);this.sync()}},{key:"onMouseUp",value:function(e){this.smudging=!1,this.panning=!1,this.sync()}},{key:"onSaveImage",value:function(e){this.saveListener=e}},{key:"onDirty",value:function(e){this.dirtyListener=e}},{key:"cancel",value:function(){this.renderer.setEditImage(null),this.dirty=!1}},{key:"confirm",value:function(){this.renderer.commitSelection();var e=this.renderer.getEncodedImage(null);e&&this.saveListener&&this.saveListener(e),this.dirty=!1}},{key:"destroy",value:function(){return this.dirty&&this.renderer.commitSelection(),!0}}]),n}(h.a),m=function(e){e.renderer;var t=e.tool,n=Object(l.useState)(10),r=Object(a.a)(n,2),s=r[0],i=r[1],c=Object(l.useState)(.2),o=Object(a.a)(c,2),u=o[0],h=o[1],f=Object(l.useState)(!1),m=Object(a.a)(f,2),p=m[0],g=m[1];return t.onDirty(g),Object(l.useEffect)((function(){t.updateArgs({brushSize:s,brushOpacity:u})}),[s,u]),Object(d.jsxs)("div",{style:{marginTop:"16px"},children:[Object(d.jsxs)("div",{className:"form-group",children:[Object(d.jsxs)("label",{style:{width:"100%"},children:["Brush size",Object(d.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[s,"px"]})]}),Object(d.jsx)("input",{type:"range",className:"form-control-range",min:"1",max:"100",value:s,onChange:function(e){return i(parseInt(e.target.value))}})]}),Object(d.jsxs)("div",{className:"form-group",children:[Object(d.jsxs)("label",{style:{width:"100%"},children:["Brush opacity",Object(d.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[Math.round(100*u),"%"]})]}),Object(d.jsx)("input",{type:"range",className:"form-control-range",min:"0",max:"1",step:"0.01",value:u,onChange:function(e){return h(parseFloat(e.target.value))}})]}),Object(d.jsxs)("div",{className:"form-group",style:{marginTop:"16px",visibility:p?"visible":"hidden"},children:[Object(d.jsx)("button",{className:"btn btn-secondary",onClick:function(){return t.cancel()},children:"Revert"}),Object(d.jsx)("button",{className:"btn btn-primary",onClick:function(){return t.confirm()},style:{marginLeft:"8px"},children:"Save"})]})]})}},162:function(e,t,n){"use strict";n.d(t,"b",(function(){return A})),n.d(t,"a",(function(){return z}));var a=n(24),r=n(3),s=n(2),i=n.n(s),c=n(5),o=n(4),u=n(15),l=n(16),h=n(60),d=n(30),f=n(32),m=n(33),p=n(0),g=n(13),b=n.n(g),j=n(17),v=n(73),x=n(83),O=n(38),y=n(98),w=n(53),k=n(18),C=n(22),S=n(19),I=n.n(S),N=n(66),L=n(59),M=n(84),D=n(88),E=n(56),T=n(81),_=n(80),P=n(1),A=(b.a.create(),function(e){Object(f.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e,"inpaint")).selectionTool=void 0,a.prompt="",a.negativePrompt="",a.count=4,a.brushSize=10,a.loras=[],a._dirty=!1,a.worker=void 0,a.idCounter=0,a._state=void 0,a.stateHandler=function(){},a.selectionControlsListener=function(){},a.imageData=[],a.selectedImageDataIndex=-1,a.selectedImageData=null,a.panning=!1,a.erasing=!1,a.progressListener=void 0,a.errorListener=void 0,a.dirtyListener=void 0,a.selectionTool=new y.b(e),a.selectSupported()?(a.state="select",a.selectionTool.updateArgs({outpaint:a.getArgs().outpaint})):a.state="erase",a.worker=new C.a,a}return Object(l.a)(n,[{key:"dirty",get:function(){return this._dirty},set:function(e){this._dirty=e,this.dirtyListener&&this.dirtyListener(e)}},{key:"newId",value:function(){return"".concat(this.idCounter++)}},{key:"onError",value:function(e){this.errorListener=e}},{key:"notifyError",value:function(e){this.errorListener&&this.errorListener(e)}},{key:"state",get:function(){return this._state},set:function(e){if(e!=this._state)if("select"==this._state&&this.selectionTool.destroy(),"erase"===this._state&&this.renderer.setCursor(void 0),this._state=e,this.stateHandler(e),"confirm"==e)this.selectionControlsListener(!0);else if(this.selectionControlsListener(!1),"select"==e){var t=this.renderer.getWidth(),n=this.renderer.getHeight(),a=Math.min(t,n,512);this.selectionTool.updateArgs({selectionOverlay:{x:0,y:0,width:a,height:a}})}}},{key:"selectSupported",value:function(){return!0}},{key:"onMouseDown",value:function(e){if("select"!=this.state){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;1!==e.button?"erase"==this.state&&(this.erasing=!0,this.erasePoint(n,a)):this.panning=!0}else this.selectionTool.onMouseDown(e)}},{key:"erasePoint",value:function(e,t){this.dirty||(this.dirty=!0),this.renderer.erasePoint(e,t,this.brushSize),this.renderer.render()}},{key:"updateCursor",value:function(e,t){"erase"==this.state?this.renderer.setCursor({color:"white",radius:this.brushSize/2,type:"circle",x:e,y:t}):this.renderer.setCursor({color:"white",radius:10,type:"crosshairs",x:e,y:t})}},{key:"onMouseMove",value:function(e){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.updateCursor(n,a),"select"!=this.state?(this.panning&&this.zoomHelper.onPan(e),this.erasing&&this.erasePoint(n,a)):this.selectionTool.onMouseMove(e)}},{key:"onMouseUp",value:function(e){"select"==this.state&&this.selectionTool.onMouseUp(e),this.panning=!1,this.erasing=!1}},{key:"onMouseLeave",value:function(e){"select"==this.state&&this.selectionTool.onMouseLeave(e),this.panning=!1,this.erasing=!1}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e);var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.offsetX,e.offsetY),n=t.x,a=t.y;this.updateCursor(n,a)}},{key:"updateArgs",value:function(e){e=Object(o.a)(Object(o.a)({},this.getArgs()),e),Object(h.a)(Object(d.a)(n.prototype),"updateArgs",this).call(this,e),this.prompt=e.prompt||"",this.negativePrompt=e.negativePrompt||"",this.count=e.count||4,this.brushSize=e.brushSize||10,this.loras=e.loras||[],this.updateCursor(this.renderer.getWidth()/2,this.renderer.getHeight()/2),this.selectionTool.updateArgs({outpaint:e.outpaint})}},{key:"onChangeState",value:function(e){this.stateHandler=e}},{key:"onShowSelectionControls",value:function(e){this.selectionControlsListener=e}},{key:"onProgress",value:function(e){this.progressListener=e}},{key:"loadImageData",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,a){var r,s,c,o,u,l,h;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(C.g)(t);case 2:if(r=e.sent,(s=document.createElement("canvas")).width=a.width,s.height=a.height,c=s.getContext("2d")){e.next=9;break}throw new Error("Failed to get canvas context");case 9:return c.drawImage(r,0,0,a.width,a.height),o=c.getImageData(0,0,a.width,a.height),u=this.newId(),e.next=14,this.worker.processRequest({id:u,alphaMode:"alpha",alphaPixels:n.data,feather:!0,height:this.renderer.getHeight(),width:this.renderer.getWidth(),pixels:o.data,selectionOverlay:a,featherWidth:10});case 14:return l=e.sent,h=new ImageData(l.pixels,o.width,o.height),s.remove(),e.abrupt("return",h);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){this.selectSupported()?this.state="select":this.state="erase",this.renderer.snapshot(),this.renderer.undo(),this.renderer.clearRedoStack(),this.imageData=[],this.renderer.setEditImage(null),this.dirty=!1}},{key:"updateProgress",value:function(e){this.progressListener&&this.progressListener(e)}},{key:"submit",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,a){var r,s,o,u,l,h,d,f,m,p,g,b=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.notifyError(null),r=this.renderer.getSelectionOverlay()){e.next=5;break}return console.error("No selection"),e.abrupt("return");case 5:return this.getArgs().outpaint&&(r.x<0||r.y<0||r.x+r.width>this.renderer.getWidth()||r.y+r.height>this.renderer.getHeight())&&(this.renderer.expandToOverlay(),r=this.renderer.getSelectionOverlay()),this.state="uploading",this.updateProgress(0),s=this.renderer.getEncodedMask(r),o=this.renderer.getImageData(r),this.renderer.snapshot(),this.renderer.undo(),this.renderer.clearRedoStack(),u=this.renderer.getEncodedImage(r),(l=Object(x.b)()).label="",l.encoded_image=u,l.encoded_mask=s,l.parent=n.id,l.params.prompt=this.prompt||n.params.prompt,l.params.negative_prompt=this.negativePrompt||n.params.negative_prompt,l.params.denoising_strength=1,l.count=this.count,l.model=a,h=Object(k.c)(r.width,r.height),l.params.width=h.width,l.params.height=h.height,l.params.loras=this.loras,l.temporary=!0,e.prev=29,e.next=32,t.generateImages(l,(function(e){b.updateProgress(e.loaded/e.total)}));case 32:d=e.sent,e.next=41;break;case 35:return e.prev=35,e.t0=e.catch(29),console.error("Error creating images",e.t0),this.notifyError("Failed to create image"),this.state="select",e.abrupt("return");case 41:this.state="processing",this.updateProgress(0),f=[],m=!1,p=I()();case 46:if(m){e.next=64;break}return e.next=49,Object(v.a)(2e3);case 49:return e.next=51,t.checkGenerationJob(d);case 51:if(d=e.sent,this.updateProgress(d.progress),"completed"!==d.status){e.next=58;break}return m=!0,f=d.images.filter((function(e){return"completed"===e.status})),e.next=58,Promise.all(f.map(function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.loadImageData(t,o,r);case 2:n=e.sent,t.data=n;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 58:if(!(I()().diff(p,"minutes")>2)){e.next=62;break}return m=!0,e.next=62,t.client.deleteImageRequest(d.id);case 62:e.next=46;break;case 64:for(f.sort((function(e,t){return e.created_at-t.created_at})),f=f.filter((function(e){return e.status===w.a.Completed})),this.imageData=[],g=0;g<f.length;g++)f[g].data&&this.imageData.push(f[g].data);if(0!==this.imageData.length){e.next=72;break}return this.state="select",this.notifyError("No images returned"),e.abrupt("return");case 72:this.renderer.setEditImage(this.imageData[0]),this.selectedImageDataIndex=0,this.selectedImageData=this.imageData[0],this.state="confirm";case 76:case"end":return e.stop()}}),e,this,[[29,35]])})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"onDirty",value:function(e){this.dirtyListener=e}},{key:"select",value:function(e){"left"==e&&(this.selectedImageDataIndex--,this.selectedImageDataIndex<-1&&(this.selectedImageDataIndex=this.imageData.length-1)),"right"==e&&(this.selectedImageDataIndex++,this.selectedImageDataIndex>=this.imageData.length&&(this.selectedImageDataIndex=-1)),-1===this.selectedImageDataIndex?this.selectedImageData=null:this.selectedImageData=this.imageData[this.selectedImageDataIndex],this.renderer.setEditImage(this.selectedImageData)}},{key:"onSaveImage",value:function(e){this.saveListener=e}},{key:"confirm",value:function(){this.renderer.commitSelection(),this.imageData=[];var e=this.renderer.getEncodedImage(null);e&&this.saveListener&&this.saveListener(e,{phrases:[this.prompt],negative_phrases:[this.negativePrompt],selection_overlay:this.renderer.getSelectionOverlay()}),this.dirty=!1,this.selectSupported()?this.state="select":this.state="erase"}},{key:"destroy",value:function(){return!(this.dirty&&!window.confirm("Discard changes?"))&&(this.renderer.setCursor(void 0),this.renderer.setEditImage(null),this.worker.destroy(),!0)}}]),n}(O.a)),z=function(e){var t=e.generator,n=e.image,s=(e.renderer,e.tool),i=Object(p.useState)(4),c=Object(r.a)(i,2),o=c[0],u=c[1],l=Object(p.useState)(n.params.prompt||""),h=Object(r.a)(l,2),d=h[0],f=h[1],m=Object(p.useState)(n.params.negative_prompt||""),g=Object(r.a)(m,2),b=g[0],v=g[1],x=Object(p.useState)(s.state),O=Object(r.a)(x,2),y=O[0],w=O[1],k=Object(p.useState)(0),C=Object(r.a)(k,2),S=C[0],I=C[1],A=Object(p.useState)(null),z=Object(r.a)(A,2),F=z[0],R=z[1],H=Object(p.useState)(10),B=Object(r.a)(H,2),W=B[0],Y=B[1],X=Object(p.useState)(!1),U=Object(r.a)(X,2),K=U[0],J=U[1],q=Object(p.useState)(s.getArgs().outpaint),Z=Object(r.a)(q,2),G=Z[0],V=Z[1],$=Object(p.useState)("Deliberate Inpainting"),Q=Object(r.a)($,2),ee=Q[0],te=Q[1],ne=Object(p.useState)(!1),ae=Object(r.a)(ne,2),re=ae[0],se=ae[1],ie=Object(p.useState)(!1),ce=Object(r.a)(ie,2),oe=ce[0],ue=ce[1],le=Object(p.useState)([]),he=Object(r.a)(le,2),de=he[0],fe=he[1];Object(p.useEffect)((function(){s.updateArgs({brushSize:W})}),[W]),Object(p.useEffect)((function(){n.params.loras&&n.params.loras.length>0?Object(E.b)(n.params.loras).then((function(e){fe(e)})):fe([])}),[n]),s.onChangeState(w),s.onProgress(I),s.onError(R),s.onDirty(J);return"uploading"===y||"processing"===y?Object(P.jsxs)("div",{style:{marginTop:"16px"},children:[Object(P.jsx)("i",{className:"fa fa-spinner fa-spin"}),"\xa0"," ","uploading"===y?"Uploading...":"Inpainting...",Object(P.jsx)("br",{}),Object(P.jsx)(N.a,{progress:S})]}):Object(P.jsxs)("div",{style:{marginTop:"16px",marginBottom:"8px",marginLeft:"16px"},children:[F&&Object(P.jsxs)("div",{className:"alert alert-danger",role:"alert",children:[Object(P.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:function(){return R(null)},children:Object(P.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),F]}),"select"===y&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsxs)("p",{children:[Object(P.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Move the selection rectangle to the area that you want to inpaint. For outpainting, try zooming out."]}),Object(P.jsx)("div",{className:"form-group",children:Object(P.jsxs)("div",{className:"form-check",children:[Object(P.jsx)("input",{className:"form-check-input",type:"checkbox",id:"allowoutpaint",checked:!!G,onChange:function(e){V(e.target.checked),s.updateArgs({outpaint:e.target.checked})}}),Object(P.jsx)("label",{className:"form-check-label",htmlFor:"allowoutpaint",children:"Allow outpainting"})]})})]}),"erase"===y&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsxs)("p",{children:[Object(P.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Erase the area that you want to inpaint."]}),Object(P.jsxs)("div",{className:"form-group",children:[Object(P.jsxs)("label",{style:{width:"100%"},children:["Brush size",Object(P.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[W,"px"]})]}),Object(P.jsx)("input",{type:"range",className:"form-control-range",min:"1",max:"100",value:W,onChange:function(e){return Y(parseInt(e.target.value))}})]})]}),"inpaint"===y&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsxs)("p",{children:[Object(P.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Confirm the parameters below and continue"]}),Object(P.jsxs)("div",{className:"form-group",children:[Object(P.jsxs)("label",{htmlFor:"prompt",children:["Prompt\xa0",Object(P.jsx)(D.a,{onClick:function(){return f(n.params.prompt||"")}})]}),Object(P.jsx)("input",{type:"text",className:"form-control",id:"prompt",value:d,onChange:function(e){f(e.target.value)}}),Object(P.jsx)("small",{className:"form-text text-muted",children:"Customize the text prompt here"})]}),de.length>0&&Object(P.jsx)(T.a,{prompt:d,selectedLoras:de,onAddTrigger:function(e){var t=[d];d.length>0&&!d.endsWith(",")&&t.push(", "),t.push(e),f(t.join(""))}}),Object(P.jsxs)("div",{className:"form-group",children:[Object(P.jsxs)("label",{htmlFor:"negativeprompt",children:["Negative prompt\xa0",Object(P.jsx)(D.a,{onClick:function(){return v(n.params.negative_prompt||"")}})]}),Object(P.jsx)("input",{type:"text",className:"form-control",value:b,onChange:function(e){v(e.target.value)}}),Object(P.jsx)("small",{className:"form-text text-muted",children:"Customize the negative text prompt here"})]}),Object(P.jsxs)("div",{className:"form-group",children:[Object(P.jsxs)("label",{htmlFor:"count",children:["Count: ",o]}),Object(P.jsx)("input",{type:"range",className:"form-control-range",id:"count",min:"1",max:"10",step:"1",value:o,onChange:function(e){u(parseInt(e.target.value))}}),Object(P.jsx)("small",{className:"form-text text-muted",children:"Number of inpaint options"})]}),Object(P.jsxs)("div",{className:"form-group",children:[Object(P.jsx)("label",{htmlFor:"model",children:"Model"}),Object(P.jsx)("div",{children:Object(P.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",onClick:function(){return se(!0)},children:[ee,"\xa0",Object(P.jsx)("i",{className:"fas fa-caret-down"})]})}),Object(P.jsx)("small",{className:"form-text text-muted",children:"Select the inpaint model"})]}),Object(P.jsxs)("div",{className:"form-group",children:[Object(P.jsx)("label",{htmlFor:"loras",children:"Loras"}),Object(P.jsxs)("div",{children:[de.map((function(e){return Object(P.jsx)(_.a,{lora:e,onRemove:function(e){return function(e){var t=de.filter((function(t){return t.config.name!==e.config.name}));fe(t)}(e)}},e.lora.name)})),de.length<5&&Object(P.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",style:{marginLeft:"8px"},onClick:function(){return ue(!0)},children:[Object(P.jsx)("i",{className:"fas fa-plus"}),"\xa0Add Lora"]})]})]}),Object(P.jsx)("div",{className:"form-group",children:Object(P.jsx)(L.a,{imagesCost:o})})]}),"confirm"===y&&Object(P.jsx)(P.Fragment,{children:Object(P.jsxs)("p",{children:["Use the ",Object(P.jsx)("i",{className:"fa fa-arrow-left"})," and"," ",Object(P.jsx)("i",{className:"fa fa-arrow-right"})," buttons to navigate between the inpaint options"]})}),Object(P.jsxs)("div",{className:"form-group",children:[(K||"confirm"===y||"erase"==y&&s.selectSupported()||"inpaint"==y)&&Object(P.jsxs)("button",{style:{marginRight:"8px"},className:"btn btn-primary btn-sm",onClick:function(){s.cancel()},children:[Object(P.jsx)("i",{className:"fa fa-times"}),"\xa0 Revert"]}),"confirm"===y&&Object(P.jsx)(P.Fragment,{children:Object(P.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){return s.confirm()},style:{marginRight:"8px"},children:[Object(P.jsx)("i",{className:"fa fa-save"}),"\xa0 Save"]})}),"select"==y&&Object(P.jsxs)("button",{style:{marginRight:"8px"},type:"button",className:"btn btn-primary btn-sm",onClick:function(){return s.state="erase"},children:[Object(P.jsx)("i",{className:"fa fa-eraser"}),"\xa0 Continue"]}),"erase"==y&&Object(P.jsxs)("button",{style:{marginRight:"8px"},type:"button",className:"btn btn-primary btn-sm",onClick:function(){return s.state="inpaint"},children:[Object(P.jsx)("i",{className:"fa fa-paint-brush"}),"\xa0 Continue"]}),"inpaint"===y&&Object(P.jsxs)("button",{style:{marginRight:"8px"},className:"btn btn-primary btn-sm",onClick:function(){s.updateArgs({count:o,prompt:d,negativePrompt:b}),s.submit(t,n,ee)},children:[Object(P.jsx)("i",{className:"fa fa-paint-brush"}),"\xa0 Inpaint"]})]}),Object(P.jsx)(j.a,{when:K,message:"Are you sure you want to leave? Your changes will be lost."}),re&&Object(P.jsx)(M.a,{onCancel:function(){return se(!1)},onSelectModel:function(e){te(e),se(!1)},initialSelectedModel:ee,inpainting:!0}),oe&&Object(P.jsx)(E.a,{onCancel:function(){return ue(!1)},onConfirm:function(e){return function(e){fe([].concat(Object(a.a)(de),[e])),ue(!1)}(e)}})]})}},163:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return F}));var a=n(113),r=n(27),s=n(4),i=n(2),c=n.n(i),o=n(24),u=n(5),l=n(3),h=n(0),d=n(230),f=n(13),m=n.n(f),p=n(221),g=n.n(p),b=n(91),j=n(17),v=n(19),x=n.n(v),O=n(125),y=n.n(O),w=n(26),k=n(82),C=n(83),S=n(22),I=n(126),N=n(128),L=n(54),M=n(223),D=n(224),E=n(100),T=n(66),_=n(225),P=n(226),A=n(1),z=m.a.create();delete z.defaults.headers.common.Authorization;var F=function(t){var n=t.generator,i=t.imageClient,f=t.localImages,m=t.paymentStatus,p=Object(h.useState)(!1),v=Object(l.a)(p,2),O=v[0],F=v[1],R=Object(h.useState)(null),H=Object(l.a)(R,2),B=H[0],W=H[1],Y=Object(h.useState)(null),X=Object(l.a)(Y,2),U=X[0],K=X[1],J=Object(h.useState)(!1),q=Object(l.a)(J,2),Z=q[0],G=q[1],V=Object(h.useState)(!1),$=Object(l.a)(V,2),Q=$[0],ee=($[1],Object(h.useState)(0)),te=Object(l.a)(ee,2),ne=te[0],ae=te[1],re=Object(h.useState)(!1),se=Object(l.a)(re,2),ie=se[0],ce=se[1],oe=Object(h.useState)([]),ue=Object(l.a)(oe,2),le=ue[0],he=ue[1],de=Object(h.useState)([]),fe=Object(l.a)(de,2),me=fe[0],pe=fe[1],ge=Object(h.useState)(null),be=Object(l.a)(ge,2),je=be[0],ve=be[1],xe=Object(h.useState)(0),Oe=Object(l.a)(xe,2),ye=Oe[0],we=Oe[1],ke=Object(h.useState)(!0),Ce=Object(l.a)(ke,2),Se=Ce[0],Ie=Ce[1],Ne=Object(h.useState)(""),Le=Object(l.a)(Ne,2),Me=Le[0],De=Le[1],Ee=Object(h.useState)(""),Te=Object(l.a)(Ee,2),_e=Te[0],Pe=Te[1],Ae=Object(h.useState)(!1),ze=Object(l.a)(Ae,2),Fe=ze[0],Re=ze[1],He=Object(h.useState)(!1),Be=Object(l.a)(He,2),We=Be[0],Ye=Be[1],Xe=Object(h.useState)({}),Ue=Object(l.a)(Xe,2),Ke=Ue[0],Je=Ue[1],qe=Object(h.useState)(!0),Ze=Object(l.a)(qe,2),Ge=Ze[0],Ve=Ze[1],$e=Object(h.useState)(!1),Qe=Object(l.a)($e,2),et=Qe[0],tt=Qe[1],nt=Object(j.i)().id,at=Object(j.g)(),rt=Object(j.h)(),st=function(e){ve(e),we(x()().valueOf())};Object(h.useEffect)((function(){var e=setTimeout((function(){De(_e)}),500);return function(){clearTimeout(e)}}),[_e]),Object(h.useEffect)((function(){if(nt){var e=le.find((function(e){return e.id===nt}));e&&W(e),f.getImage(nt).then((function(e){W(e),e||at.replace("/")}))}else W(null)}),[nt]);var it=function(){var e=Object(u.a)(c.a.mark((function e(t){var a,r,s,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F(!0),K(null),ve(null),window.scrollTo(0,0),ae(0),e.prev=5,!t.encoded_image){e.next=10;break}return e.next=9,Object(S.b)(t.encoded_image);case 9:t.encoded_image=e.sent;case 10:return e.next=12,n.generateImages(t,(function(e){ae(e.loaded/e.total)}));case 12:a=e.sent,pe((function(e){return[].concat(Object(o.a)(e),[a])})),e.next=23;break;case 16:if(e.prev=16,e.t0=e.catch(5),console.error(e.t0),!(null===(r=e.t0.response)||void 0===r||null===(s=r.data)||void 0===s||null===(i=s.message)||void 0===i?void 0:i.includes("credits"))){e.next=22;break}return tt(!0),e.abrupt("return");case 22:st("Error creating images");case 23:return e.prev=23,F(!1),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[5,16,23,26]])})));return function(t){return e.apply(this,arguments)}}(),ct=function(){var e=Object(u.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F(!0),K(null),ve(null),window.scrollTo(0,0),e.prev=4,(n=t.encoded_image)||(n=Object(S.c)("#ffffff",t.params.width,t.params.height)),a={created_at:x()().valueOf(),updated_at:x()().valueOf(),created_by:"",params:{steps:20,width:t.params.width,height:t.params.height,prompt:t.params.prompt,negative_prompt:t.params.negative_prompt,denoising_strength:t.params.denoising_strength},label:"",id:d.a(),model:t.model,negative_score:0,nsfw:!!t.nsfw,parent:t.parent,score:0,status:w.a.Completed,temporary:!1,imageData:"data:image/png;base64,".concat(n)},e.next=10,f.saveImage(a);case 10:at.push("/image-editor/".concat(a.id)),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),console.error(e.t0),st("Error creating image");case 17:return e.prev=17,F(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,13,17,20]])})));return function(t){return e.apply(this,arguments)}}(),ot=function(){var e=Object(u.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(s.a)(Object(s.a)({},t),{},{nsfw:n}),e.next=3,f.saveImage(t);case 3:he((function(e){return e.map((function(e){return t.id===e.id?Object(s.a)(Object(s.a)({},e),{},{nsfw:n}):e}))})),W(t);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ut=function(){var e=Object(u.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Initial load images"),ve(null),Ie(!0),e.prev=3,n=x()().add(1,"minutes").valueOf(),e.next=7,f.listImages(n,"prev",100,t);case 7:return a=e.sent,he(a.sort(ht)),e.abrupt("return");case 12:e.prev=12,e.t0=e.catch(3),st("Could not load images"),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t){return e.apply(this,arguments)}}();Object(h.useEffect)((function(){ut(Me)}),[Me]),Object(h.useEffect)((function(){var e=!1,t=function(){var t=Object(u.a)(c.a.mark((function t(a){var s,i,u,l,h,d,m,p,g;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=2;break}return t.abrupt("return");case 2:return e=!0,t.prev=3,t.next=6,n.checkGenerationJobs(me);case 6:s=t.sent,i=[],u=[],l=Object(r.a)(s),t.prev=10,l.s();case 12:if((h=l.n()).done){t.next=41;break}if("pending"!==(d=h.value).status&&"processing"!=d.status){t.next=18;break}i.push(d),t.next=39;break;case 18:if("completed"!==d.status||!d.images){t.next=39;break}m=Object(r.a)(d.images),t.prev=20,m.s();case 22:if((p=m.n()).done){t.next=31;break}if((g=p.value).status!=w.a.Error){t.next=27;break}return st(g.error||"Some images failed to generate, please make sure your prompt doesn't violate our terms of service"),t.abrupt("continue",29);case 27:u.push(g),f.saveImage(g);case 29:t.next=22;break;case 31:t.next=36;break;case 33:t.prev=33,t.t0=t.catch(20),m.e(t.t0);case 36:return t.prev=36,m.f(),t.finish(36);case 39:t.next=12;break;case 41:t.next=46;break;case 43:t.prev=43,t.t1=t.catch(10),l.e(t.t1);case 46:return t.prev=46,l.f(),t.finish(46);case 49:u.length>0&&he((function(e){return[].concat(u,Object(o.a)(e))})),pe(i),t.next=57;break;case 53:t.prev=53,t.t2=t.catch(3),st("Could not load images"),console.error(t.t2);case 57:return t.prev=57,e=!1,t.finish(57);case 60:case"end":return t.stop()}}),t,null,[[3,53,57,60],[10,43,46,49],[20,33,36,39]])})));return function(e){return t.apply(this,arguments)}}(),a=setInterval((function(){t(le)}),2e3);return function(){clearInterval(a)}}),[n,me,le,Me]),Object(h.useEffect)((function(){(function(){var t=Object(u.a)(c.a.mark((function t(){var n,a,r,o,u,l,h;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=g.a.parse(rt.search,{ignoreQueryPrefix:!0})).parent){t.next=20;break}return G(!0),t.prev=3,t.next=6,i.loadImage(n.parent);case 6:if(!(a=t.sent)){t.next=17;break}return r="https://aibrush2-filestore.s3.amazonaws.com/".concat(a.id,".image.png"),t.next=11,z.get(r,{responseType:"arraybuffer"});case 11:o=t.sent,u=e.from(o.data,"binary"),l=u.toString("base64"),h="data:image/png;base64,".concat(l),K(Object(s.a)(Object(s.a)({},a),{},{imageData:h})),at.push("/");case 17:return t.prev=17,G(!1),t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[3,,17,20]])})));return function(){return t.apply(this,arguments)}})()()}),[rt.search]);var lt=function(e){return e.status===w.a.Pending||e.status===w.a.Processing},ht=function(e,t){return lt(e)&&!lt(t)?-1:!lt(e)&&lt(t)?1:t.updated_at-e.updated_at},dt=function(){var e=Object(u.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=x()().valueOf(),le.forEach((function(e){t=Math.min(t,e.updated_at)})),e.next=4,f.listImages(t-1,"prev",100,Me);case 4:(n=e.sent).length>0?he((function(e){var t=e.reduce((function(e,t){return e[t.id]=t,e}),{});return n=n.filter((function(e){return!t[e.id]})),[].concat(Object(o.a)(e),Object(o.a)(n)).filter((function(e){return!e.deleted_at})).sort(ht)})):Ie(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ft=function(){var e=Object(u.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=null,B&&((a=le.findIndex((function(e){return e.id===B.id})))>0?n=le[a-1]:0===a&&le.length>1&&(n=le[1])),e.next=5,f.deleteImage(t.id);case 5:he((function(e){return e.filter((function(e){return e.id!==t.id}))})),n?at.push("/images/".concat(n.id)):at.push("/"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),st("Error deleting image");case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),mt=function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.deleteImageRequest(t.id);case 2:pe((function(e){return e.filter((function(e){return e.id!==t.id}))}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pt=function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:K(t),at.push("/"),window.scrollTo(0,0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),gt=function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:at.push("/image-editor/".concat(t.id));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),bt=function(e){Fe?Je(Object(s.a)(Object(s.a)({},Ke),{},Object(a.a)({},e.id,!Ke[e.id]))):at.push("/images/".concat(e.id))},jt=function(){var e=Object(u.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Ye(!0),t=Object.keys(Ke).map((function(e){return f.deleteImage(e)})),e.next=5,Promise.all(t);case 5:he((function(e){return e.filter((function(e){return!Ke[e.id]}))})),Je({}),Re(!1),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0),st("Error deleting images");case 14:return e.prev=14,Ye(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(){return e.apply(this,arguments)}}(),vt=le.filter((function(e){return!e.deleted_at&&(e.status===w.a.Completed||e.status===w.a.Saved)})),xt=me.filter((function(e){return"pending"===e.status})),Ot=me.filter((function(e){return"processing"===e.status}));return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)("h1",{style:{fontSize:"40px",textAlign:"left"},children:"Welcome to AiBrush - Home"}),Object(A.jsx)(E.a,{message:je,timestamp:ye}),Object(A.jsx)(C.a,{creating:O,onSubmit:it,onEdit:ct,parent:U,onCancel:function(){return K(null),void window.scrollTo(0,0)}}),Object(A.jsx)("hr",{}),Object(A.jsxs)("div",{className:"homepage-images",style:{marginTop:"48px",paddingBottom:"48px"},children:[Object(A.jsx)("div",{style:{textAlign:"left"},children:Object(A.jsxs)("div",{className:"input-group",style:{marginBottom:"16px"},children:[Object(A.jsx)("input",{style:{},value:_e,type:"search",className:"form-control image-search",placeholder:"Search...",onChange:function(e){return Pe(e.target.value)}}),Object(A.jsxs)("div",{style:{float:"right"},children:[!Fe&&Object(A.jsxs)(A.Fragment,{children:[Object(A.jsxs)("button",{style:{display:"inline"},className:"btn btn-primary image-popup-button",onClick:function(){return Ve(!Ge)},children:[!Ge&&Object(A.jsx)("i",{className:"fas fa-eye"}),Ge&&Object(A.jsx)("i",{className:"fas fa-eye-slash"})]}),Object(A.jsxs)(b.a,{style:{display:"inline",marginLeft:"8px"},children:[Object(A.jsx)(b.a.Toggle,{variant:"danger",children:Object(A.jsx)("i",{className:"fas fa-trash"})}),Object(A.jsxs)(b.a.Menu,{children:[Object(A.jsx)(b.a.Item,{onClick:function(){return Re(!0)},children:"Bulk Delete"}),Object(A.jsx)(b.a.Item,{onClick:function(){return at.push("/local-deleted-images")},children:"View Deleted Images"})]})]})]}),Fe&&Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)("button",{className:"btn btn-primary image-popup-button",onClick:function(){Re(!1),Je({})},children:"Cancel"}),Object(A.jsx)("button",{style:{marginLeft:"8px"},className:"btn image-popup-delete-button",onClick:function(){jt()},children:"Delete"})]})]})]})}),Object(A.jsxs)(I.a,{dataLength:le.length,next:dt,hasMore:Se,loader:Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)("hr",{}),Object(A.jsx)("h4",{children:"Loading..."})]}),children:[me.length>0&&Object(A.jsx)(M.a,{pendingCount:xt.length,processingCount:Ot.length,onClick:function(){ce(!0)}}),vt.map((function(e){return Object(A.jsx)(k.a,{image:e,onClick:bt,bulkDelete:Fe&&Ke[e.id],censorNSFW:Ge},e.id)}))]})]}),B&&Object(A.jsx)(N.a,{image:B,onClose:function(){return at.push("/")},onDelete:function(e){ft(e),he(le.filter((function(t){return t.id!==e.id}))),at.push("/")},onFork:function(e){pt(e),at.push("/")},onEdit:function(e){gt(e)},onNSFW:ot,censorNSFW:Ge,onSwipe:function(e,t){var n=le.findIndex((function(t){return t.id===e.id}));if(-1!==n){var a=n+t;if(!(a<0||a>=le.length)){var r=le[a];bt(r)}}}}),Object(A.jsx)(y.a,{}),Object(A.jsxs)(L.a,{show:O,title:"Creating images",children:[Object(A.jsx)("p",{children:"Please wait while we create your image."}),Object(A.jsx)(T.a,{progress:ne})]}),Object(A.jsx)(L.a,{show:We,title:"Deleting images",children:Object(A.jsx)("p",{children:"Please wait while we delete your images."})}),Object(A.jsx)(L.a,{show:Z,title:"Loading parent image",children:Object(A.jsx)("p",{children:"Please wait while we load the parent image."})}),Object(A.jsx)(L.a,{show:Q,title:"Saving image",children:Object(A.jsx)(T.a,{progress:ne})}),Object(A.jsx)(D.a,{jobs:me,onCancel:function(){return ce(!1)},show:ie,onDeleteJob:function(e){mt(e)}}),Object(A.jsx)(_.a,{show:et,onHide:function(){return tt(!1)}}),Object(A.jsx)(P.a,{paymentStatus:m})]})}}).call(this,n(103).Buffer)},164:function(e,t,n){"use strict";n.d(t,"b",(function(){return H})),n.d(t,"a",(function(){return B}));var a=n(24),r=n(3),s=n(2),i=n.n(s),c=n(5),o=n(4),u=n(15),l=n(16),h=n(32),d=n(33),f=n(0),m=n(13),p=n.n(m),g=n(17),b=n(73),j=n(83),v=n(38),x=n(53),O=n(22),y=n(98),w=n(99),k=n(19),C=n.n(k),S=n(66),I=n(79),N=n(59),L=n(84),M=n(90),D=n(123),E=n(1),T=["#FFFFFF","#000000"],_=function(e){var t=e.tool,n=e.onConfirm,a=e.onRevert,s=Object(f.useState)(10),i=Object(r.a)(s,2),c=i[0],o=i[1],u=Object(f.useState)(T[0]),l=Object(r.a)(u,2),h=l[0],d=l[1];return Object(f.useEffect)((function(){t.updateArgs({brushSize:c,brushColor:h})}),[c,h]),Object(E.jsxs)("div",{style:{marginTop:"16px"},children:[Object(E.jsxs)("div",{className:"form-group",children:[Object(E.jsxs)("label",{style:{width:"100%"},children:["Brush size",Object(E.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[c,"px"]})]}),Object(E.jsx)("input",{type:"range",className:"form-control-range",min:"1",max:"100",value:c,onChange:function(e){return o(parseInt(e.target.value))}})]}),Object(E.jsx)("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:T.map((function(e,t){return Object(E.jsx)(D.a,{selectedColor:h,color:e,onClick:function(e){return d(e)}},t)}))}),Object(E.jsxs)("div",{className:"form-group",style:{marginTop:"16px"},children:[Object(E.jsx)("i",{className:"fa fa-info-circle"}),"\xa0Masking: areas that are painted white will be changed, areas that are painted black will be left unchanged."]}),Object(E.jsxs)("div",{className:"form-group",style:{marginTop:"16px"},children:[Object(E.jsx)("button",{className:"btn btn-secondary",onClick:function(){return t.renderer.invertMask()},children:"Invert"}),Object(E.jsx)("button",{className:"btn btn-secondary",onClick:a,style:{marginLeft:"8px"},children:"Cancel"}),Object(E.jsx)("button",{className:"btn btn-primary",onClick:n,style:{marginLeft:"8px"},children:"Save"})]})]})},P=n(88),A=n(56),z=n(81),F=n(80),R=(p.a.create(),1.3),H=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(u.a)(this,n),(a=t.call(this,e,"enhance")).selectionTool=void 0,a.pencilTool=void 0,a.prompt="",a.negativePrompt="",a.model="Epic Diffusion",a.count=4,a.variationStrength=.35,a.loras=[],a._dirty=!1,a.worker=void 0,a.idCounter=0,a._state="default",a.stateHandler=function(){},a.selectionControlsListener=function(){},a.maskHandler=function(){},a.imageData=[],a.selectedImageDataIndex=-1,a.selectedImageData=null,a.panning=!1,a.erasing=!1,a.progressListener=void 0,a.errorListener=void 0,a.dirtyListener=void 0,a.selectionTool=new y.b(e),a.pencilTool=new M.b(e,"mask","#FFFFFF","mask-editor"),a.selectSupported()?a.state="select":a.state="default";var r=a.selectionTool.getArgs();return a.selectSupported()||(r=Object(o.a)(Object(o.a)({},r),{},{selectionOverlay:{x:0,y:0,width:a.renderer.getWidth(),height:a.renderer.getHeight()}})),a.selectionTool.updateArgs(r),a.pencilTool.updateArgs(Object(o.a)(Object(o.a)({},a.pencilTool.getArgs()),{},{brushColor:"#FFFFFF"})),a.renderer.setCursor(void 0),a.worker=new O.a,a}return Object(l.a)(n,[{key:"dirty",get:function(){return this._dirty},set:function(e){this._dirty=e,this.dirtyListener&&this.dirtyListener(e)}},{key:"onDirty",value:function(e){this.dirtyListener=e}},{key:"onError",value:function(e){this.errorListener=e}},{key:"notifyError",value:function(e){this.errorListener&&this.errorListener(e)}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this.renderer.setCursor(void 0),"select"==this._state&&this.selectionTool.destroy(),this._state=e,this.stateHandler(e),"confirm"==e?this.selectionControlsListener(!0):(this.selectionControlsListener(!1),"select"==e&&this.selectionTool.updateArgs(Object(o.a)(Object(o.a)({},this.selectionTool.getArgs()),{},{outpaint:!1}))))}},{key:"selectSupported",value:function(){return!(0===Object(w.a)(this.renderer.getWidth(),this.renderer.getHeight())&&this.renderer.getWidth())}},{key:"onMouseDown",value:function(e){if("select"!=this.state)if("mask"!=this.state){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;1!==e.button?"erase"==this.state&&this.selectedImageData&&(this.erasing=!0,this.selectedImageData=new ImageData(this.selectedImageData.data.slice(),this.selectedImageData.width,this.selectedImageData.height),this.erasePoint(n,a)):this.panning=!0}else this.pencilTool.onMouseDown(e);else this.selectionTool.onMouseDown(e)}},{key:"erasePoint",value:function(e,t){for(var n=this.renderer.getSelectionOverlay(),a=Math.min(n.width,n.height),r=Math.floor(a/8*R),s=e-n.x,i=t-n.y,c=this.selectedImageData,o=Math.max(0,s-r),u=Math.max(0,i-r),l=Math.min(c.width,s+r),h=Math.min(c.height,i+r),d=o;d<l;d++)for(var f=u;f<h;f++){var m=4*(f*c.width+d),p=Math.sqrt(Math.pow(d-s,2)+Math.pow(f-i,2));if(p<r){var g=p/r*R-.30000000000000004,b=Math.min(Math.floor(255*g),c.data[m+3]);c.data[m+3]=b}}this.renderer.setEditImage(c)}},{key:"updateCursor",value:function(e,t){if("erase"==this.state&&this.selectedImageData){var n=this.renderer.getSelectionOverlay(),a=Math.min(n.width,n.height),r=Math.floor(a/8);this.renderer.setCursor({color:"white",radius:r*R,type:"circle",x:e,y:t})}else this.renderer.setCursor({color:"white",radius:10,type:"crosshairs",x:e,y:t})}},{key:"onMouseMove",value:function(e){if("select"!=this.state)if("mask"!=this.state){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.panning&&this.zoomHelper.onPan(e),this.updateCursor(n,a),this.erasing&&this.erasePoint(n,a)}else this.pencilTool.onMouseMove(e);else this.selectionTool.onMouseMove(e)}},{key:"onMouseUp",value:function(e){"select"==this.state&&this.selectionTool.onMouseUp(e),"mask"==this.state&&this.pencilTool.onMouseUp(e),this.panning=!1,this.erasing=!1}},{key:"onMouseLeave",value:function(e){"select"==this.state&&this.selectionTool.onMouseLeave(e),"mask"==this.state&&this.pencilTool.onMouseLeave(e),this.panning=!1,this.erasing=!1}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e);var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.offsetX,e.offsetY),n=t.x,a=t.y;this.updateCursor(n,a)}},{key:"updateArgs",value:function(e){e=Object(o.a)(Object(o.a)({},this.getArgs()),e),this.prompt=e.prompt||"",this.negativePrompt=e.negativePrompt||"",this.model=e.model||"Epic Diffusion",this.count=e.count||4,this.variationStrength=e.variationStrength||.75,this.loras=e.loras||[],console.log("updateArgs",e)}},{key:"onChangeState",value:function(e){this.stateHandler=e}},{key:"onChangeMask",value:function(e){this.maskHandler=e}},{key:"onShowSelectionControls",value:function(e){this.selectionControlsListener=e}},{key:"onProgress",value:function(e){this.progressListener=e}},{key:"newId",value:function(){return"".concat(this.idCounter++)}},{key:"loadImageData",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n,a){var r,s,c,o,u,l,h,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(O.g)(t);case 2:if(r=e.sent,(s=document.createElement("canvas")).width=a.width,s.height=a.height,c=s.getContext("2d")){e.next=9;break}throw new Error("Failed to get canvas context");case 9:return c.drawImage(r,0,0,a.width,a.height),o=c.getImageData(0,0,a.width,a.height),u=this.newId(),l={id:u,alphaMode:"none",feather:!0,height:this.renderer.getHeight(),width:this.renderer.getWidth(),pixels:o.data,selectionOverlay:a},n&&(l.alphaMode="mask",l.alphaPixels=n.data),e.next=16,this.worker.processRequest(l);case 16:return h=e.sent,d=new ImageData(h.pixels,o.width,o.height),s.remove(),e.abrupt("return",d);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){"erase"==this.state?(this.state="confirm",this.selectedImageData=this.imageData[this.selectedImageDataIndex],this.renderer.setEditImage(this.selectedImageData)):(this.selectSupported()?this.state="select":this.state="default",this.imageData=[],this.renderer.setEditImage(null),this.dirty=!1)}},{key:"erase",value:function(){this.state="erase"}},{key:"mask",value:function(){this.renderer.isMasked()&&this.renderer.deleteMask(),this.renderer.createMask(),this.state="mask",this.maskHandler(!0)}},{key:"deleteMask",value:function(){this.renderer.deleteMask(),"mask"==this.state&&(this.state="default"),this.maskHandler(!1)}},{key:"updateProgress",value:function(e){this.progressListener&&this.progressListener(e)}},{key:"submit",value:function(){var e=Object(c.a)(i.a.mark((function e(t,n){var a,r,s,o,u,l,h,d,f,m,p=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dirty=!0,this.notifyError(null),a=this.renderer.getSelectionOverlay(),r=this.renderer.getEncodedImage(a)){e.next=7;break}return console.error("No selection"),e.abrupt("return");case 7:return e.next=9,Object(O.b)(r);case 9:return r=e.sent,this.renderer.isMasked()&&(s=this.renderer.getEncodedMask(a,"mask"),o=this.renderer.getImageData(a,"mask")),(u=Object(j.b)()).encoded_image=r,s&&(u.encoded_mask=s),u.label="",u.parent=n.id,u.params.prompt=this.prompt||n.params.prompt,u.params.negative_prompt=this.negativePrompt||n.params.negative_prompt,u.params.denoising_strength=this.variationStrength,u.count=this.count,u.model=this.model,u.nsfw=n.nsfw,u.params.width=a.width,u.params.height=a.height,u.params.width=64*Math.ceil(u.params.width/64),u.params.height=64*Math.ceil(u.params.height/64),u.params.loras=this.loras,u.temporary=!0,this.state="uploading",e.prev=29,e.next=32,t.generateImages(u,(function(e){p.updateProgress(e.loaded/e.total)}));case 32:l=e.sent,e.next=41;break;case 35:return e.prev=35,e.t0=e.catch(29),console.error("Error creating images",e.t0),this.notifyError("Failed to create image"),this.state="default",e.abrupt("return");case 41:this.state="processing",this.updateProgress(0),h=!1,d=C()(),f=[];case 46:if(h){e.next=64;break}return e.next=49,Object(b.a)(2e3);case 49:return e.next=51,t.checkGenerationJob(l);case 51:if(l=e.sent,this.updateProgress(l.progress),"completed"!==l.status){e.next=58;break}return h=!0,f=l.images.filter((function(e){return"completed"===e.status})),e.next=58,Promise.all(f.map(function(){var e=Object(c.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.loadImageData(t,o,a);case 2:n=e.sent,t.data=n;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 58:if(!(C()().diff(d,"minutes")>2)){e.next=62;break}return h=!0,e.next=62,t.client.deleteImageRequest(l.id);case 62:e.next=46;break;case 64:for(f.sort((function(e,t){return e.created_at-t.created_at})),f=f.filter((function(e){return e.status===x.a.Completed})),this.imageData=[],m=0;m<f.length;m++)f[m].data&&this.imageData.push(f[m].data);if(0!==this.imageData.length){e.next=72;break}return this.state="default",this.notifyError("No images returned"),e.abrupt("return");case 72:this.renderer.setEditImage(this.imageData[0]),this.selectedImageDataIndex=0,this.selectedImageData=this.imageData[0],this.state="confirm",this.deleteMask();case 77:case"end":return e.stop()}}),e,this,[[29,35]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"select",value:function(e){"left"==e&&(this.selectedImageDataIndex--,this.selectedImageDataIndex<-1&&(this.selectedImageDataIndex=this.imageData.length-1)),"right"==e&&(this.selectedImageDataIndex++,this.selectedImageDataIndex>=this.imageData.length&&(this.selectedImageDataIndex=-1)),-1===this.selectedImageDataIndex?this.selectedImageData=null:this.selectedImageData=this.imageData[this.selectedImageDataIndex],this.renderer.setEditImage(this.selectedImageData)}},{key:"onSaveImage",value:function(e){this.saveListener=e}},{key:"confirm",value:function(){this.renderer.commitSelection(),this.selectSupported()?this.state="select":this.state="default",this.imageData=[];var e=this.renderer.getEncodedImage(null);e&&this.saveListener&&this.saveListener(e,{phrases:[this.prompt],negative_phrases:[this.negativePrompt],model:this.model}),this.dirty=!1}},{key:"destroy",value:function(){return this.renderer.isMasked()&&this.renderer.deleteMask(),this.renderer.setCursor(void 0),this.worker.destroy(),!0}}]),n}(v.a),B=function(e){var t=e.generator,n=e.image,s=e.renderer,i=e.tool,c=Object(f.useState)(4),o=Object(r.a)(c,2),u=o[0],l=o[1],h=Object(f.useState)(!1),d=Object(r.a)(h,2),m=d[0],p=d[1],b=Object(f.useState)(.35),j=Object(r.a)(b,2),v=j[0],x=j[1],O=Object(f.useState)(n.params.prompt||""),w=Object(r.a)(O,2),k=w[0],C=w[1],M=Object(f.useState)(n.params.negative_prompt||""),D=Object(r.a)(M,2),T=D[0],R=D[1],H=Object(f.useState)("swinir"==n.model||"stable_diffusion"==n.model?"Epic Diffusion":n.model),B=Object(r.a)(H,2),W=B[0],Y=B[1],X=Object(f.useState)(!1),U=Object(r.a)(X,2),K=U[0],J=U[1],q=Object(f.useState)(i.state),Z=Object(r.a)(q,2),G=Z[0],V=Z[1],$=Object(f.useState)(i.renderer.isMasked()),Q=Object(r.a)($,2),ee=Q[0],te=Q[1],ne=Object(f.useState)(0),ae=Object(r.a)(ne,2),re=ae[0],se=ae[1],ie=Object(f.useState)(null),ce=Object(r.a)(ie,2),oe=ce[0],ue=ce[1],le=Object(f.useState)(!1),he=Object(r.a)(le,2),de=he[0],fe=he[1],me=Object(f.useState)([]),pe=Object(r.a)(me,2),ge=pe[0],be=pe[1];i.onChangeState(V),i.onChangeMask(te),i.onProgress(se),i.onError(ue),i.onDirty(p),Object(f.useEffect)((function(){n.params.loras&&n.params.loras.length>0?Object(A.b)(n.params.loras).then((function(e){be(e)})):be([])}),[n]);var je=i.selectionTool.getArgs().selectionOverlay,ve=u;return je&&(ve=Object(I.a)(u,je.width,je.height)),"processing"==G||"uploading"==G?Object(E.jsxs)("div",{style:{marginTop:"16px"},children:[Object(E.jsx)("i",{className:"fa fa-spinner fa-spin"}),"\xa0"," ","processing"===G?"Enhancing...":"Uploading...",Object(E.jsx)("br",{}),Object(E.jsx)(S.a,{progress:re})]}):Object(E.jsxs)("div",{style:{marginTop:"16px",marginBottom:"8px",marginLeft:"16px"},children:[oe&&Object(E.jsxs)("div",{className:"alert alert-danger",role:"alert",children:[Object(E.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:function(){return ue(null)},children:Object(E.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),oe]}),"select"===G&&Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)("p",{children:[Object(E.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Move the selection rectangle to the area that you want to enhance"]}),Object(E.jsx)(y.a,{renderer:s,tool:i.selectionTool,lockAspectRatio:!0})]}),"default"===G&&Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)("p",{children:[Object(E.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Confirm the parameters below and continue"]}),Object(E.jsxs)("div",{className:"form-group",children:[Object(E.jsxs)("label",{htmlFor:"prompt",children:["Prompt\xa0",Object(E.jsx)(P.a,{onClick:function(){return C(n.params.prompt||"")}})]}),Object(E.jsx)("input",{type:"text",className:"form-control",id:"prompt",value:k,onChange:function(e){C(e.target.value)}}),Object(E.jsx)("small",{className:"form-text text-muted",children:"Customize the text prompt here"})]}),ge.length>0&&Object(E.jsx)(z.a,{prompt:k,selectedLoras:ge,onAddTrigger:function(e){var t=[k];k.length>0&&!k.endsWith(",")&&t.push(", "),t.push(e),C(t.join(""))}}),Object(E.jsxs)("div",{className:"form-group",children:[Object(E.jsxs)("label",{htmlFor:"negative-prompt",children:["Negative Prompt\xa0",Object(E.jsx)(P.a,{onClick:function(){return R(n.params.negative_prompt||"")}})]}),Object(E.jsx)("input",{type:"text",className:"form-control",id:"negative-prompt",value:T,onChange:function(e){R(e.target.value)}}),Object(E.jsx)("small",{className:"form-text text-muted",children:"Customize the negative text prompt here"})]}),Object(E.jsxs)("div",{className:"form-group",children:[Object(E.jsxs)("label",{htmlFor:"count",children:["Count: ",u]}),Object(E.jsx)("input",{type:"range",className:"form-control-range",id:"count",min:"1",max:"10",step:"1",value:u,onChange:function(e){l(parseInt(e.target.value))}}),Object(E.jsx)("small",{className:"form-text text-muted",children:"Number of enhancement options"})]}),Object(E.jsxs)("div",{className:"form-group",children:[Object(E.jsxs)("label",{htmlFor:"variation-strength",children:["Variation Strength:"," ",Math.round(100*v),"%"]}),Object(E.jsx)("input",{type:"range",className:"form-control-range",id:"variation-strength",min:"0",max:"1",step:"0.05",value:v,onChange:function(e){x(parseFloat(e.target.value))}}),Object(E.jsx)("small",{className:"form-text text-muted",children:"How much variation to use"})]}),Object(E.jsxs)("div",{className:"form-group",children:[Object(E.jsx)("label",{htmlFor:"model",children:"Model"}),Object(E.jsx)("div",{children:Object(E.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",onClick:function(){return J(!0)},children:[W,"\xa0",Object(E.jsx)("i",{className:"fas fa-caret-down"})]})}),Object(E.jsx)("small",{className:"form-text text-muted",children:"Select the model to use"})]}),Object(E.jsxs)("div",{className:"form-group",children:[Object(E.jsx)("label",{htmlFor:"loras",children:"Loras"}),Object(E.jsxs)("div",{children:[ge.map((function(e){return Object(E.jsx)(F.a,{lora:e,onRemove:function(e){return function(e){var t=ge.filter((function(t){return t.config.name!==e.config.name}));be(t)}(e)}},e.lora.name)})),ge.length<5&&Object(E.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",style:{marginLeft:"8px"},onClick:function(){return fe(!0)},children:[Object(E.jsx)("i",{className:"fas fa-plus"}),"\xa0Add Lora"]})]})]}),Object(E.jsx)("div",{className:"form-group",children:Object(E.jsx)(N.a,{imagesCost:ve})})]}),"erase"===G&&Object(E.jsxs)("p",{children:[Object(E.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Erase any undesired sections before saving"]}),"mask"===G&&Object(E.jsx)(_,{onConfirm:function(){return i.state="default"},onRevert:function(){i.deleteMask()},tool:i.pencilTool}),Object(E.jsxs)("div",{className:"form-group",children:["select"===G&&Object(E.jsxs)("button",{type:"button",className:"btn btn-primary btn-sm",onClick:function(){i.state="default"},style:{marginRight:"8px"},children:[Object(E.jsx)("i",{className:"fa fa-magic"}),"\xa0 Continue"]}),("default"===G&&i.selectSupported()||"confirm"===G||"erase"===G)&&Object(E.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){i.cancel()},style:{marginRight:"8px"},children:[Object(E.jsx)("i",{className:"fa fa-times"}),"\xa0 Revert"]}),("confirm"===G||"erase"===G)&&Object(E.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){return i.confirm()},style:{marginRight:"8px"},children:[Object(E.jsx)("i",{className:"fa fa-save"}),"\xa0 Save"]}),"confirm"===G&&Object(E.jsx)(E.Fragment,{children:Object(E.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){return i.erase()},style:{marginRight:"8px"},children:[Object(E.jsx)("i",{className:"fa fa-eraser"}),"\xa0 Erase"]})}),"default"===G&&Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){i.updateArgs({count:u,variationStrength:v,prompt:k,negativePrompt:T,model:W,loras:ge.map((function(e){return e.config}))}),i.submit(t,n)},style:{marginRight:"8px"},children:[Object(E.jsx)("i",{className:"fa fa-magic"}),"\xa0 Enhance"]}),Object(E.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){return i.mask()},style:{marginRight:"8px"},children:[Object(E.jsx)("i",{className:"fa fa-cut"}),"\xa0 Mask"]}),ee&&Object(E.jsxs)("button",{className:"btn btn-danger btn-sm",onClick:function(){return i.deleteMask()},style:{marginRight:"8px"},children:[Object(E.jsx)("i",{className:"fa fa-cut"}),"\xa0 Unmask"]})]})]}),Object(E.jsx)(g.a,{when:m,message:"Are you sure you want to leave? Your changes will be lost."}),K&&Object(E.jsx)(L.a,{onCancel:function(){return J(!1)},onSelectModel:function(e){Y(e),J(!1)},initialSelectedModel:W,inpainting:!1}),de&&Object(E.jsx)(A.a,{onCancel:function(){return fe(!1)},onConfirm:function(e){return function(e){be([].concat(Object(a.a)(ge),[e])),fe(!1)}(e)}})]})}},18:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return u}));var a=n(24),r=n(15),s=n(16),i=function(){function e(t){Object(r.a)(this,e),this.displayName=void 0,this.width=void 0,this.height=void 0,this.id=void 0,this.displayName=t.displayName,this.width=t.width,this.height=t.height,this.id=t.id}return Object(s.a)(e,[{key:"scale",value:function(t){var n=this.width*t,a=this.height*t;return new e({id:this.id,displayName:this.displayName,width:64*Math.ceil(n/64),height:64*Math.ceil(a/64)})}}]),e}(),c=5,o=[{displayName:"4:1",width:1024,height:256,id:0},{displayName:"3:1",width:768,height:256,id:1},{displayName:"2:1",width:640,height:320,id:2},{displayName:"3:2",width:576,height:384,id:3},{displayName:"5:4",width:640,height:512,id:4},{displayName:"1:1",width:512,height:512,id:5},{displayName:"4:5",width:512,height:640,id:6},{displayName:"2:3",width:384,height:576,id:7},{displayName:"1:2",width:320,height:640,id:8},{displayName:"1:3",width:256,height:768,id:9},{displayName:"1:4",width:256,height:1024,id:10}].map((function(e){return new i(e)}));function u(e,t){var n=e/t,r=Object(a.a)(o);return r.sort((function(e,t){var a=e.width/e.height,r=t.width/t.height;return Math.abs(a-n)-Math.abs(r-n)})),r[0]}},205:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return k}));var a=n(2),r=n.n(a),s=n(4),i=n(5),c=n(3),o=n(0),u=n(17),l=n(13),h=n.n(l),d=n(230),f=(n(262),n(206)),m=n(38),p=n(164),g=n(90),b=n(161),j=n(218),v=n(162),x=n(220),O=n(54),y=n(1),w=h.a.create();delete w.defaults.headers.common.Authorization;var k=function(t){var n=t.generator,a=t.localImages,l=t.imageClient,h=Object(o.useState)(!1),k=Object(c.a)(h,2),C=k[0],S=k[1],I=[{name:"inpaint",iconClass:"fas fa-paint-brush",constructor:function(e){return new v.b(e)},defaultArgs:{},renderControls:function(e,t){return e.onShowSelectionControls(S),Object(y.jsx)(v.a,{tool:e,renderer:t,generator:n,image:M})}},{name:"enhance",iconClass:"fas fa-magic",constructor:function(e){return new p.b(e)},defaultArgs:{variationStrength:.75},renderControls:function(e,t){return e.onShowSelectionControls(S),Object(y.jsx)(p.a,{tool:e,renderer:t,image:M,generator:n})}},{name:"pencil",iconClass:"fas fa-pencil-alt",constructor:function(e){return new g.b(e,"base")},defaultArgs:{},renderControls:function(e,t){return Object(y.jsx)(g.a,{tool:e,renderer:t,colors:g.c})}},{name:"smudge",iconClass:"fas fa-hand-pointer",constructor:function(e){return new b.b(e)},defaultArgs:{},renderControls:function(e,t){return Object(y.jsx)(b.a,{tool:e,renderer:t})}},{name:"import-export",iconClass:"fas fa-file-import",constructor:function(e){return new m.a(e,"import-export")},defaultArgs:{},renderControls:function(e,t){return Object(y.jsx)(j.a,{renderer:t,tool:e})}},{name:"augment",iconClass:"fas fa-image",constructor:function(e){return new m.a(e,"augment")},defaultArgs:{},renderControls:function(e,t){return Object(y.jsx)(x.a,{renderer:t,tool:e,generator:n,image:M})}}],N=Object(o.useState)(null),L=Object(c.a)(N,2),M=L[0],D=L[1],E=Object(o.useState)(null),T=Object(c.a)(E,2),_=T[0],P=T[1],A=Object(o.useState)(null),z=Object(c.a)(A,2),F=z[0],R=z[1],H=Object(o.useState)(null),B=Object(c.a)(H,2),W=B[0],Y=B[1],X=Object(o.useState)(!1),U=Object(c.a)(X,2),K=U[0],J=U[1],q=Object(o.useState)(!1),Z=Object(c.a)(q,2),G=Z[0],V=Z[1],$=Object(o.useState)(null),Q=Object(c.a)($,2),ee=Q[0],te=Q[1],ne=Object(u.i)().id,ae=Object(u.g)(),re=Object(o.useRef)(null),se=function(e){if(_){if(F&&!F.destroy())return;var t=e.constructor(_);R(t),Y(e),t.onSaveImage((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};console.log("Saving image..."),ie(e,t)}))}},ie=function(){var e=Object(i.a)(r.a.mark((function e(t,n){var i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M&&t){e.next=2;break}throw new Error("Cannot save new image without existing image");case 2:if(_){e.next=4;break}throw new Error("Cannot save new image without renderer");case 4:return te("Saving image..."),e.prev=5,i=Object(s.a)(Object(s.a)({},M),{},{params:Object(s.a)(Object(s.a)({},M.params),{},{width:_.getWidth(),height:_.getHeight()}),id:d.a(),imageData:"data:image/png;base64,".concat(t)}),e.next=9,a.saveImage(i);case 9:D(i),ae.replace("/image-editor/".concat(i.id));case 11:return e.prev=11,te(null),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[5,,11,14]])})));return function(t,n){return e.apply(this,arguments)}}();function ce(e){return e.preventDefault(),!0}return Object(o.useEffect)((function(){function t(){return(t=Object(i.a)(r.a.mark((function t(){var n,s,i,c,o,u,h,d;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.getImage(ne);case 2:if(n=t.sent,s="",!n){t.next=9;break}D(n),s=n.imageData,t.next=20;break;case 9:return t.next=11,l.loadImage(ne);case 11:return i=t.sent,D(i),c="https://aibrush2-filestore.s3.us-west-2.amazonaws.com/".concat(ne,".image.png"),t.next=16,w.get(c,{responseType:"arraybuffer"});case 16:o=t.sent,u=e.from(o.data,"binary"),h=u.toString("base64"),s="data:image/png;base64,".concat(h);case 20:(d=new Image).src=s,d.onload=function(){if(re.current){var e=Object(f.a)(re.current);e.setBaseImage(d),P(e)}else console.error("Failed to get canvas")};case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}M||function(){t.apply(this,arguments)}()}),[M,ne]),Object(o.useEffect)((function(){M&&F&&"upscale"==F.name&&M.params.width*M.params.height>=4194304&&se(I[0])}),[M,F]),Object(o.useEffect)((function(){_&&(se(I[0]),_.onSnapshot((function(){J(_.canUndo()),V(_.canRedo())})))}),[_]),Object(o.useEffect)((function(){if(re.current){var e=function(e){F&&(e.preventDefault(),F.onWheel(e))};return re.current.addEventListener("wheel",e),function(){var t;null===(t=re.current)||void 0===t||t.removeEventListener("wheel",e)}}}),[F,re.current]),Object(o.useEffect)((function(){if(_){var e=function(){var e=.85*window.innerWidth,t=window.innerHeight;window.innerWidth<=992&&(e=window.innerWidth,t=.85*window.innerHeight),_.updateCanvasSize(e,t)};return window.addEventListener("resize",e),e(),_.resetView(),function(){window.removeEventListener("resize",e)}}}),[_]),Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{className:"row",children:Object(y.jsx)("div",{className:"col-12",children:Object(y.jsxs)("h1",{style:{fontSize:"40px",textAlign:"left"},children:[Object(y.jsx)("i",{style:{cursor:"pointer"},onClick:function(){return ae.push("/images/".concat(ne))},className:"fas fa-chevron-left"}),"\xa0 AI Edit"]})})}),Object(y.jsxs)("div",{className:"row",style:{marginTop:"32px",paddingBottom:"120px"},children:[Object(y.jsx)("div",{className:"col-lg-3",style:{textAlign:"left",marginBottom:"8px"},children:_&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{style:{marginBottom:"16px"},children:I.map((function(e){return function(e){if(!M)return null;var t="btn btn-secondary light-button image-editor-tool-button";return F&&F.name==e.name&&(t="btn btn-primary image-editor-tool-button"),Object(y.jsx)(y.Fragment,{children:Object(y.jsx)("button",{style:{margin:"4px"},className:t,onClick:function(){return se(e)},children:Object(y.jsx)("i",{className:e.iconClass})})})}(e)}))}),F&&W&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h4",{style:{marginLeft:"16px"},children:F.name.charAt(0).toUpperCase()+F.name.slice(1)}),W.renderControls(F,_)]}),(G||K)&&Object(y.jsx)("div",{className:"form-group",children:Object(y.jsxs)("div",{className:"btn-group",children:[Object(y.jsx)("button",{className:"btn btn-primary image-popup-button",disabled:!_||!K,onClick:function(){return _&&_.undo()},children:Object(y.jsx)("i",{className:"fas fa-undo"})}),Object(y.jsx)("button",{className:"btn btn-primary image-popup-button",disabled:!_||!G,onClick:function(){return _&&_.redo()},children:Object(y.jsx)("i",{className:"fas fa-redo"})})]})})]})}),Object(y.jsxs)("div",{className:"col-lg-9",children:[Object(y.jsx)("div",{style:{verticalAlign:"middle"},children:Object(y.jsxs)("div",{children:[Object(y.jsx)("canvas",{style:{cursor:"none",touchAction:"none",userSelect:"none"},width:768,height:512,ref:re,className:"image-editor-canvas",onMouseDown:function(e){return ce(e)&&F&&F.onMouseDown(e)},onMouseMove:function(e){return ce(e)&&F&&F.onMouseMove(e)},onMouseUp:function(e){return ce(e)&&F&&F.onMouseUp(e)},onMouseLeave:function(e){return ce(e)&&F&&F.onMouseLeave(e)},onTouchStart:function(e){return ce(e)&&F&&F.onTouchStart(e)},onTouchMove:function(e){return ce(e)&&F&&F.onTouchMove(e)},onTouchEnd:function(e){return ce(e)&&F&&F.onTouchEnd(e)}}),C&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("button",{className:"btn btn-secondary canvas-select-left",onClick:function(){return F.select("left")},children:Object(y.jsx)("i",{className:"fas fa-chevron-left"})}),Object(y.jsx)("button",{className:"btn btn-secondary canvas-select-right",onClick:function(){return F.select("right")},children:Object(y.jsx)("i",{className:"fas fa-chevron-right"})})]})]})}),Object(y.jsx)("div",{className:"row",children:Object(y.jsxs)("button",{className:"btn btn-primary",style:{position:"absolute",left:"50%",transform:"translate(-50%, 0)"},onClick:function(){_&&_.resetView()},children:[Object(y.jsx)("i",{className:"fas fa-search-plus"}),"\xa0 Reset View"]})})]})]}),ee&&Object(y.jsx)(O.a,{show:!0,title:"Please Wait",children:ee})]})}}).call(this,n(103).Buffer)},206:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(15),r=n(16),s=function(){function e(t){Object(a.a)(this,e),this.canvas=t,this.undoStack=[],this.redoStack=[],this.currentSnapshot=void 0,this.backgroundLayer=void 0,this.baseImageLayer=void 0,this.editLayer=void 0,this.maskLayer=void 0,this.selectionOverlay=void 0,this.selectionOverlayPreview=void 0,this.hasSelection=!1,this.cursor=void 0,this.zoom=void 0,this.offsetX=void 0,this.offsetY=void 0,this.width=0,this.height=0,this.snapshotListener=null,this.backgroundLayer=document.createElement("canvas"),this.backgroundLayer.width=t.width,this.backgroundLayer.height=t.height,this.baseImageLayer=document.createElement("canvas"),this.editLayer=document.createElement("canvas"),this.zoom=1,this.offsetX=0,this.offsetY=0}return Object(r.a)(e,[{key:"updateCanvasSize",value:function(e,t){this.canvas.width=e,this.canvas.height=t,this.backgroundLayer.width=e,this.backgroundLayer.height=t,this.initializeBackgroundLayer(),this.render()}},{key:"undo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.undoStack.length>0&&this.currentSnapshot){var t=this.undoStack.pop();e&&this.redoStack.push(this.currentSnapshot),this.currentSnapshot=t;var n=this.baseImageLayer.getContext("2d");n&&(n.clearRect(0,0,this.baseImageLayer.width,this.baseImageLayer.height),n.putImageData(t,0,0),this.render()),this.notifySnapshotListener()}}},{key:"redo",value:function(){if(this.redoStack.length>0&&this.currentSnapshot){this.undoStack.push(this.currentSnapshot);var e=this.redoStack.pop();this.currentSnapshot=e;var t=this.baseImageLayer.getContext("2d");t&&(t.putImageData(e,0,0),this.render()),this.notifySnapshotListener()}}},{key:"clearRedoStack",value:function(){this.redoStack=[],this.notifySnapshotListener()}},{key:"canUndo",value:function(){return!this.hasSelection&&this.undoStack.length>0}},{key:"canRedo",value:function(){return!this.hasSelection&&this.redoStack.length>0}},{key:"onSnapshot",value:function(e){this.snapshotListener=e}},{key:"snapshot",value:function(){var e=this.baseImageLayer.getContext("2d");if(e){var t=e.getImageData(0,0,this.baseImageLayer.width,this.baseImageLayer.height);this.currentSnapshot?(this.undoStack.push(this.currentSnapshot),this.currentSnapshot=t,this.redoStack.length>0&&(this.redoStack=[]),this.undoStack.length>10&&this.undoStack.shift()):this.currentSnapshot=t,this.notifySnapshotListener()}}},{key:"notifySnapshotListener",value:function(){this.snapshotListener&&this.snapshotListener()}},{key:"render",value:function(){var e=this.canvas.getContext("2d");e&&(e.clearRect(0,0,this.width,this.height),e.drawImage(this.backgroundLayer,0,0),e.setTransform(this.zoom,0,0,this.zoom,this.offsetX*this.zoom,this.offsetY*this.zoom),e.drawImage(this.baseImageLayer,0,0),e.drawImage(this.editLayer,0,0),this.maskLayer&&(e.globalAlpha=.3,e.drawImage(this.maskLayer,0,0),e.globalAlpha=1),this.drawOverlay(e,this.width,this.height),e.setTransform(1,0,0,1,0,0))}},{key:"createMask",value:function(){this.maskLayer=document.createElement("canvas"),this.maskLayer.width=this.width,this.maskLayer.height=this.height,this.resetMask()}},{key:"resetMask",value:function(){if(this.maskLayer){var e=this.maskLayer.getContext("2d");e&&(e.fillStyle="#000000",e.fillRect(0,0,this.width,this.height)),this.render()}}},{key:"invertMask",value:function(){if(this.maskLayer){var e=this.maskLayer.getContext("2d");if(e){for(var t=e.getImageData(0,0,this.width,this.height),n=0;n<t.data.length;n+=4)t.data[n]=255-t.data[n],t.data[n+1]=255-t.data[n+1],t.data[n+2]=255-t.data[n+2];e.putImageData(t,0,0)}this.render()}}},{key:"deleteMask",value:function(){this.maskLayer=void 0,this.render()}},{key:"isMasked",value:function(){return void 0!==this.maskLayer}},{key:"getCanvas",value:function(){return this.canvas}},{key:"initializeBackgroundLayer",value:function(){var e=this.backgroundLayer.getContext("2d");if(e){var t=e.createPattern(this.createCheckeredPattern(20,20,"#808080","#AAAAAA"),"repeat");t&&(e.fillStyle=t,e.fillRect(0,0,this.backgroundLayer.width,this.backgroundLayer.height))}}},{key:"createCheckeredPattern",value:function(e,t,n,a){var r=document.createElement("canvas");r.width=e,r.height=t;var s=r.getContext("2d");return s&&(s.fillStyle=n,s.fillRect(0,0,e,t),s.fillStyle=a,s.fillRect(0,0,e/2,t/2),s.fillRect(e/2,t/2,e/2,t/2)),r}},{key:"setBaseImage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.baseImageLayer.getContext("2d");n&&(this.initializeBackgroundLayer(),this.baseImageLayer.width=e.width,this.baseImageLayer.height=e.height,this.editLayer.width=e.width,this.editLayer.height=e.height,this.maskLayer=void 0,this.width=e.width,this.height=e.height,n.drawImage(e,0,0),t&&this.setSelectionOverlay({x:(e.width-512)/2,y:(e.height-512)/2,width:512,height:512}),this.resetView(),this.snapshot())}},{key:"resetView",value:function(){var e,t,n;this.width/this.height>this.canvas.width/this.canvas.height?(e=this.canvas.width/this.width,t=0,n=(this.height-this.canvas.height/e)/-2):(e=this.canvas.height/this.height,n=0,t=(this.width-this.canvas.width/e)/-2),this.updateZoomAndOffset(e,t,n)}},{key:"setEditImage",value:function(e){this.hasSelection=!!e;var t=this.editLayer.getContext("2d");t&&this.selectionOverlay&&(t.clearRect(0,0,this.editLayer.width,this.editLayer.height),e&&t.putImageData(e,this.selectionOverlay.x,this.selectionOverlay.y),this.hasSelection=!!e,this.render()),this.notifySnapshotListener()}},{key:"drawOverlay",value:function(e,t,n){var a=Math.max(this.width/512,this.height/512);e&&(e.strokeStyle="white",e.lineWidth=a,e.strokeRect(0,0,t,n),!this.hasSelection&&this.selectionOverlay&&(e.strokeStyle="white",e.lineWidth=a,e.strokeRect(this.selectionOverlay.x,this.selectionOverlay.y,this.selectionOverlay.width,this.selectionOverlay.height)),!this.hasSelection&&this.selectionOverlayPreview&&(e.strokeStyle="cyan",e.lineWidth=a,e.strokeRect(this.selectionOverlayPreview.x,this.selectionOverlayPreview.y,this.selectionOverlayPreview.width,this.selectionOverlayPreview.height)),this.cursor&&("circle"===this.cursor.type?(e.lineWidth=a,e.strokeStyle=this.cursor.color,e.beginPath(),e.arc(this.cursor.x,this.cursor.y,this.cursor.radius,0,2*Math.PI),e.stroke()):"circle-fill"===this.cursor.type?(e.fillStyle=this.cursor.color,e.strokeStyle=this.cursor.color,e.beginPath(),e.arc(this.cursor.x,this.cursor.y,this.cursor.radius,0,2*Math.PI),e.stroke(),e.globalAlpha=.5,e.beginPath(),e.arc(this.cursor.x,this.cursor.y,this.cursor.radius,0,2*Math.PI),e.fill(),e.globalAlpha=1):"crosshairs"==this.cursor.type?(e.strokeStyle=this.cursor.color,e.lineWidth=a,e.beginPath(),e.moveTo(this.cursor.x-this.cursor.radius,this.cursor.y),e.lineTo(this.cursor.x+this.cursor.radius,this.cursor.y),e.moveTo(this.cursor.x,this.cursor.y-this.cursor.radius),e.lineTo(this.cursor.x,this.cursor.y+this.cursor.radius),e.stroke()):"colorpicker"===this.cursor.type&&(e.lineWidth=.75*this.cursor.radius,e.strokeStyle=this.cursor.color,e.beginPath(),e.arc(this.cursor.x,this.cursor.y,this.cursor.radius,0,2*Math.PI),e.stroke(),e.lineWidth=a,e.strokeStyle="black",e.beginPath(),e.moveTo(this.cursor.x-this.cursor.radius,this.cursor.y),e.lineTo(this.cursor.x+this.cursor.radius,this.cursor.y),e.moveTo(this.cursor.x,this.cursor.y-this.cursor.radius),e.lineTo(this.cursor.x,this.cursor.y+this.cursor.radius),e.stroke())))}},{key:"setSelectionOverlay",value:function(e){this.selectionOverlay=e,this.render()}},{key:"setSelectionOverlayPreview",value:function(e){this.selectionOverlayPreview=e,this.render()}},{key:"setCursor",value:function(e){this.cursor=e,this.render()}},{key:"getSelectionOverlay",value:function(){return this.selectionOverlay}},{key:"getZoom",value:function(){return this.zoom}},{key:"getOffsetX",value:function(){return this.offsetX}},{key:"getOffsetY",value:function(){return this.offsetY}},{key:"updateZoomAndOffset",value:function(e,t,n){this.zoom=e,this.offsetX=t,this.offsetY=n,this.render()}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"imageDataToEncodedImage",value:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");if(n){n.putImageData(e,0,0);var a=t.toDataURL("image/png");return t.remove(),a.split(",")[1]}}},{key:"getEncodedImage",value:function(e){var t=this.getImageData(e);if(t)return this.imageDataToEncodedImage(t)}},{key:"convertErasureToMask",value:function(e){for(var t=e,n=0;n<e.data.length;n+=4){e.data[n+3]<255?(t.data[n]=255,t.data[n+1]=255,t.data[n+2]=255,t.data[n+3]=255):(t.data[n]=0,t.data[n+1]=0,t.data[n+2]=0,t.data[n+3]=255)}return t}},{key:"getEncodedMask",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"base",n=this.getImageData(e,t);if(n){if("base"===t){var a=this.convertErasureToMask(n);return this.imageDataToEncodedImage(a)}return this.imageDataToEncodedImage(n)}}},{key:"getImageData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"base";e||(e={x:0,y:0,width:this.width,height:this.height});var n="base"===t?this.baseImageLayer:this.maskLayer;if(n){var a=n.getContext("2d");if(a){var r=a.getImageData(e.x,e.y,e.width,e.height);return r}}}},{key:"commitSelection",value:function(){var e=this.baseImageLayer.getContext("2d");e&&(e.drawImage(this.editLayer,0,0),this.setEditImage(null),this.snapshot())}},{key:"drawPoint",value:function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"base",s="base"===r?this.editLayer:this.maskLayer;if(s){var i=s.getContext("2d");i&&(i.fillStyle=a,i.beginPath(),i.arc(e,t,n/2,0,2*Math.PI),i.fill()),this.render()}}},{key:"erasePoint",value:function(e,t,n){if(!this.selectionOverlay)throw new Error("No selection overlay");var a=this.baseImageLayer.getContext("2d");if(a){for(var r=a.getImageData(e-n/2,t-n/2,n,n),s=0;s<r.data.length;s+=4){var i=s/4%n,c=Math.floor(s/4/n),o=i-n/2+e,u=this.selectionOverlay.x;u>0&&(u+=10);var l=this.selectionOverlay.x+this.selectionOverlay.width;l<this.width&&(l-=10);var h=this.selectionOverlay.y;h>0&&(h+=10);var d=this.selectionOverlay.y+this.selectionOverlay.height;d<this.canvas.height&&(d-=10);var f=c-n/2+t,m=o>u&&o<l&&(f>h&&f<d);if(!this.selectionOverlay||m)Math.sqrt(Math.pow(i-n/2,2)+Math.pow(c-n/2,2))<n/2&&(r.data[s+3]=0)}a.putImageData(r,e-n/2,t-n/2)}}},{key:"drawLine",value:function(e,t,n,a,r,s){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"base",c="base"===i?this.editLayer:this.maskLayer;if(c){var o=c.getContext("2d");o&&(o.strokeStyle=s,o.lineWidth=r,o.lineCap="round",o.beginPath(),o.moveTo(e,t),o.lineTo(n,a),o.stroke()),this.render()}}},{key:"smudgeLine",value:function(e,t,n,a,r,s){var i={x:n-e,y:a-t},c=Math.sqrt(i.x*i.x+i.y*i.y);i.x/=c,i.y/=c;var o=this.editLayer.getContext("2d");if(o)for(var u=0;u<c;u++){for(var l=e+u*i.x,h=t+u*i.y,d=o.getImageData(l-r/2,h-r/2,r,r),f=0,m=0,p=0,g=0,b=0;b<d.height;b++)for(var j=0;j<d.width;j++){var v=4*(b*d.width+j);if(Math.sqrt((j-r/2)*(j-r/2)+(b-r/2)*(b-r/2))<=r/2)f+=d.data[v],m+=d.data[v+1],p+=d.data[v+2],g++}for(var x=f/g,O=m/g,y=p/g,w=0;w<d.height;w++)for(var k=0;k<d.width;k++){var C=4*(w*d.width+k);Math.sqrt((k-r/2)*(k-r/2)+(w-r/2)*(w-r/2))<=r/2&&(d.data[C]=x*s+d.data[C]*(1-s),d.data[C+1]=O*s+d.data[C+1]*(1-s),d.data[C+2]=y*s+d.data[C+2]*(1-s))}o.putImageData(d,l-r/2,h-r/2)}this.render()}},{key:"getPixel",value:function(e,t){var n=this.baseImageLayer.getContext("2d");if(n){var a=n.getImageData(e,t,1,1).data;return"#"+("000000"+function(e,t,n){if(e>255||t>255||n>255)throw"Invalid color component";return(e<<16|t<<8|n).toString(16)}(a[0],a[1],a[2])).slice(-6)}return"#000000"}},{key:"copyEditImageFromBaseImage",value:function(){var e=this.editLayer.getContext("2d");e&&e.drawImage(this.baseImageLayer,0,0),this.render(),this.hasSelection=!0,this.notifySnapshotListener()}},{key:"expandToOverlay",value:function(){if(!this.selectionOverlay)throw new Error("No selection overlay");var e=Math.min(0,this.selectionOverlay.x),t=Math.min(0,this.selectionOverlay.y),n=Math.max(this.selectionOverlay.x+this.selectionOverlay.width,this.baseImageLayer.width)-e,a=Math.max(this.selectionOverlay.y+this.selectionOverlay.height,this.baseImageLayer.height)-t,r=document.createElement("canvas");r.width=n,r.height=a;var s=r.getContext("2d");s&&s.drawImage(this.baseImageLayer,Math.max(0,-1*this.selectionOverlay.x),Math.max(0,-1*this.selectionOverlay.y)),this.selectionOverlay.x<0&&(this.selectionOverlay.x=0),this.selectionOverlay.y<0&&(this.selectionOverlay.y=0),console.log("new Canvas size: ".concat(n," x ").concat(a)),this.setBaseImage(r,!1)}}]),e}();function i(e){return new s(e)}},218:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(3),r=n(0),s=n(74),i=n.n(s),c=n(219),o=n.n(c),u=n(1),l=function(e){var t=e.renderer,n=e.tool,s=Object(r.useState)(),c=Object(a.a)(s,2),l=c[0],h=c[1];return l?Object(u.jsxs)("div",{className:"form-group",style:{marginTop:"16px"},children:[Object(u.jsxs)("button",{className:"btn btn-primary",onClick:function(){h(void 0);var e=new Image,n="data:image/png;base64,"+l;e.src=n,e.onload=function(){t.setBaseImage(e)}},children:[Object(u.jsx)("i",{className:"fas fa-times"}),"\xa0 Revert"]}),Object(u.jsxs)("button",{className:"btn btn-primary",onClick:function(){if(h(void 0),n.saveListener){var e=t.getEncodedImage(null);e&&n.saveListener(e)}},style:{marginLeft:"8px"},children:[Object(u.jsx)("i",{className:"fas fa-save"}),"\xa0 Save"]})]}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("div",{className:"form-group",style:{marginTop:"16px"},children:Object(u.jsxs)("label",{id:"loadimage-wrapper",className:"btn btn-primary ",style:{display:"inline"},children:[Object(u.jsx)("i",{className:"fas fa-upload"}),"\xa0 Import Image",Object(u.jsx)("input",{id:"loadimage",type:"file",style:{display:"none"},onChange:function(e){var n=e.target.files;n&&n.length>0&&i()(n[0],(function(e){var n=t.getEncodedImage(null);h(n),t.setBaseImage(e)}),{canvas:!1})}})]})}),Object(u.jsx)("div",{className:"form-group",children:Object(u.jsxs)("button",{className:"btn btn-primary",onClick:function(){!function(){var e=t.getEncodedImage(null);if(e){for(var n=atob(e),a=new ArrayBuffer(n.length),r=new Uint8Array(a),s=0;s<n.length;s++)r[s]=n.charCodeAt(s);var i=new Blob([r],{type:"image/png"});o()(i,"image.png")}}()},style:{marginLeft:"8px"},children:[Object(u.jsx)("i",{className:"fas fa-download"}),"\xa0 Export Image"]})})]})}},22:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return l})),n.d(t,"g",(function(){return h})),n.d(t,"j",(function(){return d})),n.d(t,"h",(function(){return f})),n.d(t,"f",(function(){return m})),n.d(t,"e",(function(){return p})),n.d(t,"c",(function(){return g})),n.d(t,"a",(function(){return b})),n.d(t,"d",(function(){return j})),n.d(t,"i",(function(){return v}));var a=n(2),r=n.n(a),s=n(4),i=n(5),c=n(15),o=n(16),u=n(13);n.n(u).a.create();function l(e){return new Promise((function(t,n){var a=new Image;a.onload=function(){var e=document.createElement("canvas");try{e.width=a.width,e.height=a.height;var n=e.getContext("2d");if(!n)throw new Error("Could not get canvas context");n.drawImage(a,0,0);var r=e.toDataURL("image/jpeg");t(r.split(",")[1])}finally{e.remove()}},a.src="data:image/png;base64,".concat(e)}))}function h(e){return new Promise((function(t,n){var a=e.imageData,r=new Image;r.src=a,r.onload=function(){t(r)}}))}function d(e){if(!(e.width*e.height>262144))return null;var t=document.createElement("canvas");try{t.width=e.width,t.height=e.height;var n=t.getContext("2d");if(!n)throw new Error("Could not get canvas context");n.putImageData(e,0,0);for(var a=Math.min(e.width,e.height,512),r=Math.ceil(e.width/(a-32)),s=Math.ceil(e.height/(a-32)),i=[],c=0;c<r;c++){i.push([]);for(var o=0;o<s;o++){var u=c*(a-32),l=o*(a-32),h=Math.min(u+a,e.width),d=Math.min(l+a,e.height),f=n.getImageData(u,l,h-u,d-l);i[c].push(f)}}return{numTilesX:r,numTilesY:s,tileSize:a,imageWidth:e.width,imageHeight:e.height,tiles:i}}finally{t.remove()}}function f(e){var t=document.createElement("canvas");try{t.width=e.imageWidth,t.height=e.imageHeight;var n=t.getContext("2d");if(!n)throw new Error("Could not get canvas context");for(var a=0;a<e.numTilesX;a++)for(var r=0;r<e.numTilesY;r++){var s=m(e.tiles[a][r]);n.drawImage(s,a*(e.tileSize-64),r*(e.tileSize-64))}return n.getImageData(0,0,e.imageWidth,e.imageHeight)}finally{t.remove()}}function m(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");if(!n)throw new Error("Could not get canvas context");return n.putImageData(e,0,0),t}function p(e){var t=64*Math.ceil(e.width/64),n=64*Math.ceil(e.height/64);return t==e.width&&n==e.height?e:function(e,t,n){var a=document.createElement("canvas");try{a.width=t,a.height=n;var r=a.getContext("2d");if(!r)throw new Error("Could not get canvas context");return r.drawImage(e,0,0,t,n),a}finally{e.remove()}}(e,t,n)}function g(e,t,n){var a=document.createElement("canvas");try{a.width=t,a.height=n;var r=a.getContext("2d");return r.fillStyle=e,r.fillRect(0,0,t,n),a.toDataURL().split(",")[1]}finally{a.remove()}}var b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;Object(c.a)(this,e),this.workers=[],this.callbacks={},this.cursor=0;for(var n=0;n<t;n++)this.workers[n]=new Worker("".concat("","/workers/imageutil.js")),this.workers[n].addEventListener("message",this.onMessage.bind(this))}return Object(o.a)(e,[{key:"onMessage",value:function(e){var t=e.data;this.callbacks[t.id](e),delete this.callbacks[t.id]}},{key:"processRequest",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.callbacks[t.id]=function(t){e(t.data)},n.workers[n.cursor].postMessage(Object(s.a)({},t)),n.cursor=(n.cursor+1)%n.workers.length})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){for(var e in this.workers)this.workers[e].terminate()}}]),e}();function j(e){return new Promise((function(t,n){var a=new Image;e.startsWith("data:image")||(e="data:image/png;base64,".concat(e)),a.src=e,a.onload=function(){t(a)}}))}function v(e,t,n,a){return new Promise((function(r,s){var i=document.createElement("canvas");i.width=t,i.height=n;var c=new Image;c.src="data:image/".concat(a,";base64,").concat(e),c.onload=function(){var e=i.getContext("2d");if(!e)throw new Error("Could not create canvas context");i.width=t,i.height=n,e.drawImage(c,0,0,c.width,c.height,0,0,t,n);var a=i.toDataURL("image/${format}").split(",")[1];r(a)}}))}}).call(this,n(103).Buffer)},220:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var a=n(2),r=n.n(a),s=n(5),i=n(3),c=n(0),o=n(13),u=n.n(o),l=n(73),h=n(53),d=n(22),f=n(100),m=n(19),p=n.n(m),g=n(79),b=n(59),j=n(1),v=(u.a.create(),function(e){var t=e.renderer,n=e.tool,a=e.generator,o=e.image,u=Object(c.useState)(),m=Object(i.a)(u,2),v=m[0],x=m[1],O=Object(c.useState)(null),y=Object(i.a)(O,2),w=y[0],k=y[1],C=Object(c.useState)(),S=Object(i.a)(C,2),I=S[0],N=S[1],L=Object(c.useState)(null),M=Object(i.a)(L,2),D=M[0],E=M[1],T=Object(c.useState)(0),_=Object(i.a)(T,2),P=_[0],A=_[1];Object(c.useEffect)((function(){var e=new d.a;return N(e),function(){e.destroy()}}),[]);var z=function(){var e=Object(s.a)(r.a.mark((function e(t,n){var s,i,c,o,u,f,m,g;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I){e.next=2;break}throw new Error("Image worker not initialized");case 2:return s=Object(d.f)(t),i=s.toDataURL("image/png").split(",")[1],s.remove(),c=p()().valueOf(),e.next=8,a.augmentImage({augmentation:n,image:{imageData:i}});case 8:o=e.sent;case 9:if(o.status===h.a.Completed){e.next=23;break}return e.next=12,Object(l.a)(2e3);case 12:return e.next=14,a.checkAugmentation(o);case 14:if((o=e.sent).status!==h.a.Error){e.next=17;break}throw new Error("Augmentation failed");case 17:if(!(p()().valueOf()-c>6e4)){e.next=21;break}return e.next=20,a.client.deleteInterrogationRequest(o.id);case 20:throw new Error("Augmentation timed out");case 21:e.next=9;break;case 23:return i=o.imageData,e.next=26,Object(d.d)(i);case 26:return u=e.sent,s=document.createElement("canvas"),f="upscale"===n?2:1,s.width=t.width*f,s.height=t.height*f,(m=s.getContext("2d")).drawImage(u,0,0,s.width,s.height),g=m.getImageData(0,0,s.width,s.height),s.remove(),e.abrupt("return",g);case 36:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=Object(s.a)(r.a.mark((function e(n){var a,s,i,c,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k(n),E(null),e.prev=2,a=t.getEncodedImage(null),x(a),s=t.getImageData(null)){e.next=8;break}return e.abrupt("return");case 8:return s.width%64+s.height%64!==0&&(i=Object(d.e)(Object(d.f)(s)),s=i.getContext("2d").getImageData(0,0,i.width,i.height)),e.next=11,z(s,n);case 11:c=e.sent,o=Object(d.f)(c),t.setBaseImage(o),o.remove(),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(2),E(e.t0.message||"Augmentation failed"),A(p()().valueOf());case 21:return e.prev=21,k(null),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[2,17,21,24]])})));return function(t){return e.apply(this,arguments)}}();if(w)return Object(j.jsxs)("div",{className:"form-group",style:{marginTop:"16px"},children:[Object(j.jsx)("i",{className:"fas fa-spinner fa-spin"}),"\xa0"," ","upscale"===w?"Upscaling...":"Restoring faces..."]});if(v)return Object(j.jsxs)("div",{className:"form-group",style:{marginTop:"16px"},children:[Object(j.jsx)(f.a,{message:D,timestamp:P}),Object(j.jsxs)("button",{className:"btn btn-primary",onClick:function(){x(void 0);var e=new Image,n="data:image/png;base64,"+v;e.src=n,e.onload=function(){t.setBaseImage(e)}},children:[Object(j.jsx)("i",{className:"fas fa-times"}),"\xa0 Revert"]}),Object(j.jsxs)("button",{className:"btn btn-primary",onClick:function(){if(x(void 0),n.saveListener){var e=t.getEncodedImage(null);e&&n.saveListener(e)}},style:{marginLeft:"8px"},children:[Object(j.jsx)("i",{className:"fas fa-save"}),"\xa0 Save"]})]});if(t.getWidth()*t.getHeight()>4194304)return Object(j.jsx)("div",{style:{marginTop:"16px"},children:"This image is too large to augment."});var R=Object(g.a)(1,o.params.width,o.params.height);return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(f.a,{message:D,timestamp:P}),Object(j.jsx)("div",{className:"form-group",style:{marginTop:"16px"},children:Object(j.jsxs)("button",{className:"btn btn-primary",onClick:function(){F("upscale")},style:{marginLeft:"8px"},children:[Object(j.jsx)("i",{className:"fas fa-arrows-alt"}),"\xa0 Upscale Image 2x"]})}),Object(j.jsx)("div",{className:"form-group",style:{marginTop:"16px"},children:Object(j.jsxs)("button",{className:"btn btn-primary",onClick:function(){F("face_restore")},style:{marginLeft:"8px"},children:[Object(j.jsx)("i",{className:"fas fa-smile"}),"\xa0 Restore Faces"]})}),Object(j.jsx)("div",{className:"form-group",style:{marginTop:"16px"},children:Object(j.jsx)(b.a,{imagesCost:R})})]})})},223:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(3),r=n(0),s=n(1),i=function(e){var t=e.pendingCount,n=e.processingCount,i=e.onClick,c=Object(r.useState)(!1),o=Object(a.a)(c,2),u=o[0],l=o[1],h=Object(s.jsx)("i",{style:{marginTop:"20px"},className:"fa fa-hourglass-half"});return n>0&&(h=Object(s.jsx)("i",{style:{marginTop:"20px"},className:"fa fa-cog fa-spin"})),Object(s.jsxs)("div",{onMouseEnter:function(){return l(!0)},onMouseLeave:function(){return l(!1)},style:{backgroundImage:"url(/images/default.png)",backgroundSize:"contain",width:"128px",height:"128px",margin:"8px",float:"left",cursor:"pointer"},onClick:i,children:[u&&Object(s.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.5)",color:"black",width:"100%",height:"100%",lineHeight:"1",fontSize:"20px"},children:[Object(s.jsx)("br",{}),t>0&&Object(s.jsxs)("div",{style:{marginBottom:"24px"},children:[t," pending"]}),n>0&&Object(s.jsxs)("div",{children:[n," processing"]})]}),!u&&Object(s.jsx)("div",{style:{background:"rgba(255, 255, 255, 0.3)",color:"#555",width:"100%",height:"100%",fontSize:"80px"},children:h})]})}},224:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n(0);var a=n(21),r=n(1),s=function(e){var t=e.jobs,n=e.onDeleteJob,s=e.onCancel,i=e.show;function c(e){return"pending"===e.status?Object(r.jsx)("i",{className:"fa fa-hourglass-half"}):"processing"===e.status?Object(r.jsx)("i",{className:"fa fa-cog fa-spin"}):void 0}var o=Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{style:{marginBottom:"8px"},children:[Object(r.jsx)("div",{style:{display:"inline-block",width:"100px"},children:"Status"}),Object(r.jsx)("div",{style:{display:"inline-block",width:"200px"},children:"Prompt"}),Object(r.jsx)("div",{style:{display:"inline-block",width:"50px"},children:"Count"}),Object(r.jsx)("div",{style:{display:"inline-block",width:"100px"},children:"Action"})]}),t.map((function(e){return Object(r.jsxs)("div",{style:{marginBottom:"8px"},children:[Object(r.jsxs)("div",{style:{display:"inline-block",width:"100px"},children:[c(e),"\xa0",e.status]}),Object(r.jsx)("div",{style:{display:"inline-block",width:"200px"},children:(t=e.params.prompt||"",t.length>35?t.substring(0,35)+"...":t)}),Object(r.jsx)("div",{style:{display:"inline-block",width:"50px"},children:e.count}),Object(r.jsx)("div",{style:{display:"inline-block",width:"100px"},children:Object(r.jsxs)("button",{className:"btn btn-danger btn-sm image-popup-delete-button",onClick:function(){return n(e)},children:[Object(r.jsx)("i",{className:"fa fa-trash"}),"\xa0Delete"]})})]},e.id);var t}))]});return Object(r.jsxs)(a.a,{show:i,onHide:s,children:[Object(r.jsx)(a.a.Header,{closeButton:!0,children:Object(r.jsx)(a.a.Title,{children:"Pending Jobs"})}),Object(r.jsx)(a.a.Body,{children:o}),Object(r.jsx)(a.a.Footer,{children:Object(r.jsx)("button",{className:"btn btn-secondary",onClick:s,children:"Close"})})]})}},225:function(e,t,n){"use strict";n(0);var a=n(21),r=n(57),s=n(17),i=n(44),c=n(1);t.a=function(e){var t=e.show,n=e.onHide,o=Object(s.g)();return Object(c.jsxs)(a.a,{show:t,onHide:n,centered:!0,children:[Object(c.jsx)(a.a.Header,{closeButton:!0,children:Object(c.jsx)(a.a.Title,{children:"Out of Credits"})}),Object(c.jsxs)(a.a.Body,{children:["Oops! It looks like you've run out of credits for today. But don't worry, you'll receive 100 free credits tomorrow to continue creating amazing images. Can't wait? Check out our affordable ",Object(c.jsx)(i.b,{to:"/pricing",children:"pricing options"})," to get instant access to more credits and unleash your creativity without limits!"]}),Object(c.jsxs)(a.a.Footer,{children:[Object(c.jsx)(r.a,{variant:"secondary",onClick:n,children:"Close"}),Object(c.jsx)(r.a,{variant:"primary",onClick:function(){n(),o.push("/pricing")},children:"Visit Pricing Page"})]})]})}},226:function(e,t,n){"use strict";var a=n(3),r=n(0),s=n(21),i=n(57),c=n(17),o=n(1);t.a=function(e){var t=e.paymentStatus,n=Object(r.useState)(!1),u=Object(a.a)(n,2),l=u[0],h=u[1],d=Object(c.g)();Object(r.useEffect)((function(){t&&h(!0)}),[t]);var f=function(){h(!1),d.push("/")};return Object(o.jsxs)(s.a,{show:l,onHide:f,children:[Object(o.jsx)(s.a.Header,{closeButton:!0,children:Object(o.jsx)(s.a.Title,{children:"Payment Status"})}),Object(o.jsx)(s.a.Body,{children:"success"===t?"Payment succeeded!":"Payment canceled."}),Object(o.jsx)(s.a.Footer,{children:Object(o.jsx)(i.a,{variant:"secondary",onClick:f,children:"Close"})})]})}},227:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var a=n(2),r=n.n(a),s=n(5),i=n(15),c=n(16),o=n(13),u=n.n(o),l="https://stablehorde.net/api",h=function(){function t(e){Object(i.a)(this,t),this.apiKey=e}return Object(c.a)(t,[{key:"updateApiKey",value:function(e){this.apiKey=e}},{key:"initiateImageGeneration",value:function(){var e=Object(s.a)(r.a.mark((function e(t,n){var a,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.api_key=this.apiKey,e.next=3,u.a.post("".concat(l,"/v2/generate/async"),t,{headers:{"Content-Type":"application/json",apiKey:this.apiKey},onUploadProgress:n});case 3:return a=e.sent,s=a.data,i=s.id,e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkImageJob",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n,a,s,i,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.get("".concat(l,"/v2/generate/check/").concat(t),{headers:{apiKey:this.apiKey}});case 2:return n=e.sent,e.next=5,n.data;case 5:return a=e.sent,console.log(JSON.stringify(a)),s=a.waiting+a.processing+a.restarted+a.finished,i=a.processing>0?"processing":a.done?"completed":"pending",c=a.finished/s,e.abrupt("return",{status:i,progress:c});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchImageResults",value:function(){var t=Object(s.a)(r.a.mark((function t(n){var a,i,c;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.get("".concat(l,"/v2/generate/status/").concat(n),{headers:{apiKey:this.apiKey}});case 2:return a=t.sent,t.next=5,a.data;case 5:if(!(i=t.sent).faulted){t.next=8;break}throw new Error("Something went wrong when generating the request");case 8:return c=i.generations.map(function(){var t=Object(s.a)(r.a.mark((function t(n){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.censored){t.next=2;break}return t.abrupt("return",{censored:!0});case 2:return t.next=4,u.a.get(n.img,{responseType:"arraybuffer"});case 4:return a=t.sent,t.abrupt("return",{imageData:e.from(a.data),censored:!1,seed:n.seed});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.abrupt("return",Promise.all(c));case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"deleteImageRequest",value:function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.delete("".concat(l,"/v2/generate/status/").concat(t),{headers:{apiKey:this.apiKey}});case 2:console.log("Request with ID: ".concat(t," has been deleted."));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initiateAlchemistImageInterrogation",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n,a,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.post("".concat(l,"/v2/interrogate/async"),t,{headers:{"Content-Type":"application/json",apiKey:this.apiKey}});case 2:return n=e.sent,a=n.data,s=a.id,e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkInterrogationStatus",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.get("".concat(l,"/v2/interrogate/status/").concat(t),{headers:{apiKey:this.apiKey}});case 2:return n=e.sent,e.next=5,n.data;case 5:return a=e.sent,console.log(JSON.stringify(a)),e.abrupt("return",a.state);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchInterrogationResult",value:function(){var t=Object(s.a)(r.a.mark((function t(n){var a,s,i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.get("".concat(l,"/v2/interrogate/status/").concat(n),{headers:{apiKey:this.apiKey}});case 2:return a=t.sent,t.next=5,a.data;case 5:if(s=t.sent,console.log("alchemy results: "+JSON.stringify(s)),void 0===s.forms[0].result.nsfw){t.next=9;break}return t.abrupt("return",s.forms[0].result.nsfw);case 9:return t.next=11,u.a.get(s.forms[0].result[s.forms[0].form],{responseType:"arraybuffer"});case 11:return i=t.sent,t.abrupt("return",e.from(i.data));case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"deleteInterrogationRequest",value:function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.delete("".concat(l,"/v2/interrogate/status/").concat(t),{headers:{apiKey:this.apiKey}});case 2:console.log("Request with ID: ".concat(t," has been deleted."));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}()}).call(this,n(103).Buffer)},236:function(e,t,n){},238:function(e,t,n){},239:function(e,t,n){},26:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a,r,s,i,c,o,u,l=n(15),h=(n(16),n(32)),d=n(33),f=(n(2),n(4),n(5),n(13),n(27),n(228));"https://www.aibrush.art".replace(/\/+$/,""),Error;!function(e){e.Gauge="gauge",e.Count="count"}(a||(a={})),function(e){e.Ok="ok"}(r||(r={})),function(e){e.Canny="canny",e.Hed="hed",e.Depth="depth",e.Normal="normal",e.Openpose="openpose",e.Seg="seg",e.Scribble="scribble",e.Fakescribbles="fakescribbles",e.Hough="hough"}(s||(s={})),function(e){e.FaceRestore="face_restore",e.RemoveBackground="remove_background",e.Upscale="upscale"}(i||(i={})),function(e){e.Pending="pending",e.Processing="processing",e.Completed="completed",e.Saved="saved",e.Error="error",e.Deleted="deleted"}(c||(c={})),function(e){e.Idle="idle",e.Active="active"}(o||(o={})),function(e){e.Idle="idle",e.Active="active"}(u||(u={}))},262:function(e,t,n){},29:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return o}));var a=n(15),r=n(16),s=function(){function e(t,n){Object(a.a)(this,e),this.key=void 0,this.listSize=void 0,this.key=t,this.listSize=n}return Object(r.a)(e,[{key:"getRecentItems",value:function(){var e=localStorage.getItem(this.key);return e?JSON.parse(e):[]}},{key:"saveRecentItems",value:function(e){localStorage.setItem(this.key,JSON.stringify(e))}},{key:"addItem",value:function(e){var t,n=this.getRecentItems(),a=n.indexOf(e);return-1!==a&&n.splice(a,1),n.unshift(e),n.length>this.listSize&&(t=n.pop()),this.saveRecentItems(n),t}},{key:"getItems",value:function(){return this.getRecentItems()}},{key:"clear",value:function(){this.saveRecentItems([])}}]),e}(),i=new s("recent-models",20),c=new s("recent-negative-prompts",20),o=(new s("recent-positive-prompts",20),new s("recent-loras",200))},38:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(15),r=n(16),s=function(){function e(t){Object(a.a)(this,e),this.renderer=t,this.startTouches=void 0,this.startZoom=1,this.startOffsetX=0,this.startOffsetY=0,this.startTouches=null}return Object(r.a)(e,[{key:"onWheel",value:function(e){var t=this.renderer.getZoom(),n=this.renderer.getZoom(),a=this.renderer.getOffsetX(),r=this.renderer.getOffsetY(),s=this.translateMouseToCanvasCoordinates(e.offsetX,e.offsetY);e.deltaY<0?n+=.1*n:n-=.1*n,n=Math.max(.1,Math.min(n,8));var i=s.x- -a,c=s.y- -r;a-=i*(n/t)-i,r-=c*(n/t)-c,this.renderer.updateZoomAndOffset(n,a,r)}},{key:"onPan",value:function(e){var t=e.movementX,n=e.movementY,a=e.target.getBoundingClientRect();t=t/a.width*this.renderer.getCanvas().width,n=n/a.height*this.renderer.getCanvas().height;var r=this.renderer.getZoom(),s=this.renderer.getOffsetX(),i=this.renderer.getOffsetY();s+=t/r,i+=n/r,this.renderer.updateZoomAndOffset(r,s,i)}},{key:"onTouchStart",value:function(e){2===e.touches.length&&(this.startTouches=e.touches,this.startZoom=this.renderer.getZoom(),this.startOffsetX=this.renderer.getOffsetX(),this.startOffsetY=this.renderer.getOffsetY())}},{key:"onTouchMove",value:function(e){if(this.startTouches){var t=this.renderer.getCanvas().getBoundingClientRect(),n=this.startTouches[0],a=this.startTouches[1],r=e.touches[0],s=e.touches[1],i=Math.sqrt(Math.pow(n.clientX-a.clientX,2)+Math.pow(n.clientY-a.clientY,2)),c=Math.sqrt(Math.pow(r.clientX-s.clientX,2)+Math.pow(r.clientY-s.clientY,2)),o=this.startZoom*(c/i),u=(n.clientX+a.clientX)/2,l=(n.clientY+a.clientY)/2,h=(r.clientX+s.clientX)/2,d=(r.clientY+s.clientY)/2,f=this.translateMouseToCanvasCoordinates(u-t.left,l-t.top),m=this.translateMouseToCanvasCoordinates(h-t.left,d-t.top),p=this.startOffsetX,g=this.startOffsetY,b=m.x-f.x,j=m.y-f.y,v=m.x- -this.renderer.getOffsetX(),x=m.y- -this.renderer.getOffsetY();p-=v*(o/this.startZoom)-v-b*(c/i),g-=x*(o/this.startZoom)-x-j*(c/i),this.renderer.updateZoomAndOffset(o,p,g)}}},{key:"onTouchEnd",value:function(e){this.startTouches=null}},{key:"translateMouseToCanvasCoordinates",value:function(e,t,n,a,r){var s=e,i=t;n=n||this.renderer.getZoom(),a=a||this.renderer.getOffsetX(),r=r||this.renderer.getOffsetY(),s/=n,i/=n;var c=this.renderer.getCanvas().getBoundingClientRect();return s=s/c.width*this.renderer.getCanvas().width,i=i/c.height*this.renderer.getCanvas().height,{x:s=Math.round(s-a),y:i=Math.round(i-r)}}},{key:"translateCanvasToMouseCoordinates",value:function(e,t,n,a,r){n=n||this.renderer.getZoom(),e+=a=a||this.renderer.getOffsetX(),t+=r=r||this.renderer.getOffsetY(),e*=n,t*=n;var s=this.renderer.getCanvas().getBoundingClientRect();return{x:e=Math.round(e/this.renderer.getWidth()*s.width),y:t=Math.round(t/this.renderer.getHeight()*s.height)}}}]),e}(),i=function(){function e(t,n){Object(a.a)(this,e),this.renderer=t,this.name=n,this.saveListener=function(){},this.touchHandle=void 0,this.zoomHelper=void 0,this._pinchZooming=!1,this._panning=!1,this.zoomHelper=new s(t)}return Object(r.a)(e,[{key:"getArgs",value:function(){return JSON.parse(localStorage.getItem("tool_args_".concat(this.name))||"{}")}},{key:"updateArgs",value:function(e){localStorage.setItem("tool_args_".concat(this.name),JSON.stringify(e))}},{key:"onMouseDown",value:function(e){1===e.button&&(this._panning=!0)}},{key:"onMouseMove",value:function(e){this._panning&&this.zoomHelper.onPan(e);var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this._updateCursor(n,a)}},{key:"_updateCursor",value:function(e,t){this.renderer.setCursor({color:"white",radius:10,type:"crosshairs",x:e,y:t})}},{key:"onMouseUp",value:function(e){this._panning&&(this._panning=!1)}},{key:"onMouseLeave",value:function(e){}},{key:"onTouchStart",value:function(e){var t=this;this.touchHandle&&window.clearTimeout(this.touchHandle);for(var n=[],a=0;a<e.touches.length;a++){var r=e.touches[a];n.push({identifier:r.identifier,clientX:r.clientX,clientY:r.clientY,pageX:r.pageX,pageY:r.pageY,screenX:r.screenX,screenY:r.screenY,target:null})}e={touches:n},this.touchHandle=window.setTimeout((function(){if(t.touchHandle=void 0,2===e.touches.length)t._pinchZooming=!0,t.zoomHelper.onTouchStart(e);else{var n=t.renderer.getCanvas().getBoundingClientRect(),a=e.touches[0];a&&t.onMouseDown({type:"touch",button:0,nativeEvent:{offsetX:a.clientX-n.left,offsetY:a.clientY-n.top}})}}),200)}},{key:"onTouchMove",value:function(e){if(2===e.touches.length)this.zoomHelper.onTouchMove(e);else{var t=this.renderer.getCanvas().getBoundingClientRect(),n=e.touches[0];n&&this.onMouseMove({type:"touch",button:0,nativeEvent:{offsetX:n.clientX-t.left,offsetY:n.clientY-t.top}})}}},{key:"onTouchEnd",value:function(e){this._pinchZooming?(this._pinchZooming=!1,this.zoomHelper.onTouchEnd(e)):this.onMouseUp({button:0,type:"touch"})}},{key:"onKeyDown",value:function(e){}},{key:"onKeyUp",value:function(e){}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e)}},{key:"destroy",value:function(){return!0}},{key:"onShowSelectionControls",value:function(e){}},{key:"select",value:function(e){}},{key:"onSaveImage",value:function(e){this.saveListener=e}}]),e}()},391:function(e,t,n){},403:function(e,t){},408:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(41),i=n.n(s),c=(n(236),n(2)),o=n.n(c),u=n(5),l=n(3),h=n(44),d=n(17),f=(n(238),n(239),n(4)),m=n(15),p=n(16),g=n(19),b=n.n(g),j=function(){function e(){Object(m.a)(this,e),this.db=null}return Object(p.a)(e,[{key:"init",value:function(){var e=this;return console.log("Initializing local images store"),new Promise((function(t,n){console.log("Opening indexeddb");var a=indexedDB.open("aibrush",4);a.onupgradeneeded=function(e){console.log("Upgrading local images store");var t,n,r=a.result;r.objectStoreNames.contains("images")?t=null===(n=a.transaction)||void 0===n?void 0:n.objectStore("images"):t=r.createObjectStore("images",{keyPath:"id"});t.createIndex("updated_at","updated_at",{unique:!1}),t.createIndex("deleted_at","deleted_at",{unique:!1}),console.log("Local images store updated")},a.onsuccess=function(n){e.db=a.result,console.log("Local images store initialized"),t()},a.onerror=function(e){console.error("error opening indexeddb",e),n(e)}}))}},{key:"hydrateImage",value:function(e){if(!e)return e;if(!e.params){var t=e;e.params={prompt:t.phrases.join(", "),negative_prompt:t.negative_phrases.join(", "),width:t.width,height:t.height,denoising_strength:t.stable_diffusion_strength,steps:t.iterations}}return e}},{key:"getImage",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r,s=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=2;break}throw new Error("not initialized");case 2:return n=this.db.transaction(["images"]),a=n.objectStore("images"),r=a.get(t),e.abrupt("return",new Promise((function(e,t){r.onsuccess=function(t){e(s.hydrateImage(r.result))},r.onerror=function(e){console.error("error getting image",e),t(e)}})));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveImage",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=2;break}throw new Error("not initialized");case 2:return e.next=4,this.cleanupDeletedImages();case 4:return n=this.db.transaction(["images"],"readwrite"),a=n.objectStore("images"),r=a.put(Object(f.a)(Object(f.a)({},t),{},{updated_at:b()().valueOf()})),e.abrupt("return",new Promise((function(e,t){r.onsuccess=function(t){e()},r.onerror=function(e){console.error("error saving image",e),t(e)}})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hardDeleteImage",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=2;break}throw new Error("not initialized");case 2:return n=this.db.transaction(["images"],"readwrite"),a=n.objectStore("images"),r=a.delete(t),e.abrupt("return",new Promise((function(e,n){r.onsuccess=function(n){console.log("image ".concat(t," permanently deleted")),e()},r.onerror=function(e){console.error("error deleting image",e),n(e)}})));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteImage",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=2;break}throw new Error("not initialized");case 2:return e.next=4,this.getImage(t);case 4:if(n=e.sent){e.next=8;break}return console.error("image not found",t),e.abrupt("return");case 8:if(!n.deleted_at&&"completed"===n.status){e.next=10;break}return e.abrupt("return",this.hardDeleteImage(t));case 10:return a=this.db.transaction(["images"],"readwrite"),r=a.objectStore("images"),s=r.put(Object(f.a)(Object(f.a)({},n),{},{deleted_at:b()().valueOf()})),e.abrupt("return",new Promise((function(e,t){s.onsuccess=function(t){e()},s.onerror=function(e){console.error("error deleting image",e),t(e)}})));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"listImages",value:function(){var e=Object(u.a)(o.a.mark((function e(t,n,a,r){var s,i,c,u,l,h=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=2;break}throw new Error("not initialized");case 2:return s=this.db.transaction(["images"]),i=s.objectStore("images"),c=i.index("updated_at"),u="next"==n?IDBKeyRange.lowerBound(t):IDBKeyRange.upperBound(t),l=c.openCursor(u,n),e.abrupt("return",new Promise((function(e,t){var n=[];l.onsuccess=function(t){var s=l.result;if(s){var i=h.hydrateImage(s.value),c=(i.params.prompt||"").toLowerCase();i.deleted_at||r&&!c.includes(r.toLowerCase())||n.push(i),n.length<a?s.continue():e(n)}else e(n)},l.onerror=function(e){console.error("error listing images",e),t(e)}})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"clearImages",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=2;break}throw new Error("not initialized");case 2:return t=this.db.transaction(["images"],"readwrite"),n=t.objectStore("images"),a=n.clear(),e.abrupt("return",new Promise((function(e,t){a.onsuccess=function(t){e()},a.onerror=function(e){console.error("error clearing images",e),t(e)}})));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDeletedImages",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=2;break}throw new Error("not initialized");case 2:return n=this.db.transaction(["images"]),a=n.objectStore("images"),r=a.index("deleted_at"),s=r.openCursor(t?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(1),t?"prev":"next"),e.abrupt("return",new Promise((function(e,t){var n=[];s.onsuccess=function(t){var a=s.result;if(a){var r=a.value;n.length<50&&r.deleted_at&&n.push(a.value),a.continue()}else e(n)},s.onerror=function(e){console.error("error listing images",e),t(e)}})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clearDeletedImages",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,a=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=2;break}throw new Error("not initialized");case 2:return e.next=4,this.getDeletedImages();case 4:t=e.sent;case 5:if(!(t.length>0)){e.next=14;break}return n=t.map((function(e){return a.hardDeleteImage(e.id)})),e.next=9,Promise.all(n);case 9:return e.next=11,this.getDeletedImages();case 11:t=e.sent,e.next=5;break;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cleanupDeletedImages",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,a=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDeletedImages(b()().subtract(1,"hours").valueOf());case 2:t=e.sent;case 3:if(!(t.length>0)){e.next=12;break}return n=t.map((function(e){return a.hardDeleteImage(e.id)})),e.next=7,Promise.all(n);case 7:return e.next=9,this.getDeletedImages(b()().subtract(1,"hours").valueOf());case 9:t=e.sent,e.next=3;break;case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),v=n(205),x=n(163),O=n(82),y=n(54),w=n(1),k=function(e){var t=e.localImages,n=Object(a.useState)([]),r=Object(l.a)(n,2),s=r[0],i=r[1],c=Object(a.useState)(!1),h=Object(l.a)(c,2),m=h[0],p=h[1],g=Object(d.g)(),b=function(){var e=Object(u.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getDeletedImages();case 2:n=e.sent,i(n);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(u.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(s.filter((function(e){return e.id!==n.id}))),e.next=3,t.deleteImage(n.id);case 3:s.length<=5&&b();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),e.prev=1,e.next=4,t.clearDeletedImages();case 4:i([]);case 5:return e.prev=5,p(!1),e.finish(5);case 8:case"end":return e.stop()}}),e,null,[[1,,5,8]])})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=Object(u.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(s.filter((function(e){return e.id!==n.id}))),e.next=3,t.saveImage(Object(f.a)(Object(f.a)({},n),{},{deleted_at:void 0}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){b()}),[t]),Object(w.jsxs)("div",{children:[Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{className:"row",children:Object(w.jsxs)("div",{className:"col-12",children:[Object(w.jsxs)("h1",{style:{fontSize:"40px",textAlign:"left"},children:[Object(w.jsx)("i",{style:{cursor:"pointer"},onClick:function(){return g.goBack()},className:"fas fa-chevron-left"}),"\xa0 Deleted Images"]}),Object(w.jsxs)("button",{className:"btn btn-danger btn-sm image-popup-delete-button",onClick:v,style:{float:"right",marginRight:"8px"},children:[Object(w.jsx)("i",{className:"fa fa-trash"}),"\xa0Delete All"]})]})}),Object(w.jsxs)("div",{className:"row",style:{marginTop:"32px"},children:[Object(w.jsx)("div",{className:"col-sm-2 offset-sm-2",children:"Image"}),Object(w.jsx)("div",{className:"col-sm-8",children:"Action"})]}),s.map((function(e){return Object(w.jsxs)("div",{className:"row",style:{marginTop:"16px",borderBottom:"1px solid #303030"},children:[Object(w.jsx)("div",{className:"col-sm-2 offset-sm-2",children:Object(w.jsx)(O.a,{image:e,censorNSFW:!0})}),Object(w.jsxs)("div",{className:"col-sm-8",style:{paddingTop:"64px",paddingBottom:"64px"},children:[Object(w.jsxs)("button",{className:"btn btn-danger btn-sm image-popup-delete-button",onClick:function(){return j(e)},style:{marginRight:"8px"},children:[Object(w.jsx)("i",{className:"fa fa-trash"}),"\xa0Delete"]}),Object(w.jsxs)("button",{className:"btn btn-primary btn-sm image-popup-restore-button",onClick:function(){return x(e)},children:[Object(w.jsx)("i",{className:"fa fa-undo"}),"\xa0Restore"]})]})]},e.id)}))]}),Object(w.jsx)(y.a,{show:m,title:"Deleting Images",children:"Please wait while we delete all images..."})]})},C=n(24),S=n(27),I=n(125),N=n.n(I),L=n(126),M=n(128),D=n(122),E=new(function(){function e(){Object(m.a)(this,e),this.kvstore=void 0,this.kvstore=new D.a({dbName:"saved-images",storeName:"images"})}return Object(p.a)(e,[{key:"listImages",value:function(){var e=Object(u.a)(o.a.mark((function e(t,n,a,r){var s,i,c,u,l,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.listImages({cursor:n,limit:r,filter:a});case 2:s=e.sent,i=[],[],c=Object(S.a)(s.images),e.prev=6,c.s();case 8:if((u=c.n()).done){e.next=21;break}return l=u.value,e.next=12,this.kvstore.getItem(l.id);case 12:if(!(h=e.sent)||h.updated_at!==l.updated_at){e.next=17;break}i.push(h),e.next=19;break;case 17:return e.next=19,this.kvstore.setItem(l.id,l);case 19:e.next=8;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(6),c.e(e.t0);case 26:return e.prev=26,c.f(),e.finish(26);case 29:return e.abrupt("return",i);case 30:case"end":return e.stop()}}),e,this,[[6,23,26,29]])})));return function(t,n,a,r){return e.apply(this,arguments)}}()}]),e}()),T=function(e){var t=e.imageClient,n=Object(a.useState)(null),r=Object(l.a)(n,2),s=r[0],i=r[1],c=Object(a.useState)([]),h=Object(l.a)(c,2),f=h[0],m=h[1],p=Object(a.useState)(null),g=Object(l.a)(p,2),j=(g[0],g[1]),v=Object(a.useState)(!0),x=Object(l.a)(v,2),y=x[0],k=x[1],I=Object(a.useState)(""),D=Object(l.a)(I,2),T=D[0],_=D[1],P=Object(a.useState)(""),A=Object(l.a)(P,2),z=A[0],F=A[1],R=Object(a.useState)(!0),H=Object(l.a)(R,2),B=H[0],W=H[1],Y=Object(d.i)().id,X=Object(d.g)();Object(a.useEffect)((function(){var e=setTimeout((function(){_(z)}),500);return function(){clearTimeout(e)}}),[z]),Object(a.useEffect)((function(){if(Y){var e=f.find((function(e){return e.id===Y}));e&&i(e),t.loadImage(Y).then((function(e){i(e)}))}else i(null)}),[Y]),Object(a.useEffect)((function(){(function(){var e=Object(u.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Initial load images"),j(null),k(!0),e.prev=3,e.next=6,E.listImages(t,void 0,T,100);case 6:return(n=e.sent)&&(console.log("Initial load images",n.length),m(n.sort(U))),e.abrupt("return",0);case 11:e.prev=11,e.t0=e.catch(3),j("Could not load images"),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(){return e.apply(this,arguments)}})()()}),[t,T]);var U=function(e,t){return t.updated_at-e.updated_at},K=function(){var e=Object(u.a)(o.a.mark((function e(){var n,a,r,s,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=b()().valueOf(),a=void 0,r=Object(S.a)(f);try{for(r.s();!(s=r.n()).done;)(i=s.value).updated_at<n&&(n=i.updated_at,a=i.id)}catch(o){r.e(o)}finally{r.f()}return e.next=6,E.listImages(t,a,T,100);case 6:(c=e.sent)&&c.length>0?m((function(e){var t=e.reduce((function(e,t){return e[t.id]=t,e}),{});return c=(c||[]).filter((function(e){return!t[e.id]})),[].concat(Object(C.a)(e),Object(C.a)(c||[])).sort(U)})):k(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:X.push({pathname:"/",search:"?parent=".concat(t.id)});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=function(e){X.push("/saved/".concat(e.id))},Z=function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:X.push("/image-editor/".concat(t.id));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("h1",{style:{fontSize:"40px",textAlign:"left"},children:"Welcome to AiBrush - Saved"}),Object(w.jsxs)("div",{className:"saved-images",style:{marginTop:"48px",paddingBottom:"48px"},children:[Object(w.jsx)("div",{style:{textAlign:"left"},children:Object(w.jsxs)("div",{className:"input-group",style:{marginBottom:"16px"},children:[Object(w.jsx)("input",{style:{},value:z,type:"search",className:"form-control image-search",placeholder:"Search...",onChange:function(e){return F(e.target.value)}}),Object(w.jsx)("div",{style:{float:"right"},children:Object(w.jsx)(w.Fragment,{children:Object(w.jsxs)("button",{style:{display:"inline"},className:"btn btn-primary image-popup-button",onClick:function(){return W(!B)},children:[!B&&Object(w.jsx)("i",{className:"fas fa-eye"}),B&&Object(w.jsx)("i",{className:"fas fa-eye-slash"})]})})})]})}),Object(w.jsx)(L.a,{dataLength:f.length,next:K,hasMore:y,loader:Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("hr",{}),Object(w.jsx)("h4",{children:"Loading..."})]}),children:f.map((function(e){return Object(w.jsx)(O.a,{image:e,onClick:function(e){return q(e)},censorNSFW:B},e.id)}))})]}),s&&Object(w.jsx)(M.a,{image:s,onClose:function(){return X.push("/saved")},onFork:function(e){J(e)},censorNSFW:B,onEdit:Z,onSwipe:function(e,t){var n=f.findIndex((function(t){return t.id===e.id}));if(-1!==n){var a=n+t;if(!(a<0||a>=f.length)){var r=f[a];q(r)}}}}),Object(w.jsx)(N.a,{})]})},_=n(74),P=n.n(_),A=n(22),z=n(230),F=function(){var e=Object(a.useState)(),t=Object(l.a)(e,2),n=t[0],r=t[1],s=Object(a.useState)(),i=Object(l.a)(s,2),c=i[0],h=i[1],d=Object(a.useState)(),f=Object(l.a)(d,2),m=f[0],p=f[1];Object(a.useEffect)((function(){var e=new A.a;return p(e),function(){e.destroy()}}),[]);var g=function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");if(!n)throw new Error("Could not get canvas context");return n.putImageData(e,0,0),t},b=function(e){console.log("upscaling image data",e.width,e.height);var t=document.createElement("canvas");t.width=2*e.width,t.height=2*e.height;var n=t.getContext("2d");if(!n)throw new Error("Could not get canvas context");var a=g(e);return n.drawImage(a,0,0,t.width,t.height),t},j=function(){var e=Object(u.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=2;break}throw new Error("Image worker not initialized");case 2:(n=t.target.files)&&n.length>0&&P()(n[0],function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,s,i,c,u,l,d,f,p,j,v,x,O,y;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(n=t).toDataURL("image/png"),r(a),!(s=n.getContext("2d"))){e.next=37;break}if(i=s.getImageData(0,0,n.width,n.height),c=Object(A.j)(i)){e.next=10;break}return h(a),e.abrupt("return");case 10:console.log("splitResult",{numTilesX:c.numTilesX,numTilesY:c.numTilesY,tileSize:c.tileSize}),c.tileSize*=2,c.imageWidth*=2,c.imageHeight*=2,u=0;case 15:if(!(u<c.numTilesX)){e.next=32;break}l=0;case 17:if(!(l<c.numTilesY)){e.next=29;break}return d=c.tiles[u][l],f=b(d),p=f.getContext("2d").getImageData(0,0,f.width,f.height),j=z.a(),e.next=24,m.processRequest({id:j,alphaMode:"none",feather:!0,width:c.imageWidth,height:c.imageHeight,pixels:p.data,selectionOverlay:{x:u*(c.tileSize-64),y:l*(c.tileSize-64),width:f.width,height:f.height},upscale:!0,featherWidth:64});case 24:v=e.sent,c.tiles[u][l]=new ImageData(v.pixels,f.width,f.height);case 26:l++,e.next=17;break;case 29:u++,e.next=15;break;case 32:x=Object(A.h)(c),console.log("upscaled image data size",x.width,x.height),O=g(x),y=O.toDataURL("image/png"),h(y);case 37:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{canvas:!0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(w.jsxs)("div",{children:[Object(w.jsx)("input",{type:"file",onChange:j}),n&&c&&Object(w.jsxs)("div",{children:["Original:",Object(w.jsx)("br",{}),Object(w.jsx)("img",{src:n}),Object(w.jsx)("br",{}),"Upscaled:",Object(w.jsx)("br",{}),Object(w.jsx)("img",{src:c})]})]})},R=n(13),H=n.n(R),B=function(){var e=Object(u.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H.a.get("https://raw.githubusercontent.com/db0/AI-Horde-image-model-reference/main/stable_diffusion.json");case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W={waiting:"pending",processing:"processing",done:"completed"},Y=null,X=null;function U(){return K.apply(this,arguments)}function K(){return(K=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B();case 2:t=e.sent,Y={},Object.keys(t).forEach((function(e){var n=t[e];n.trigger&&(Y[e]=n.trigger)}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e,t){return q.apply(this,arguments)}function q(){return(q=Object(u.a)(o.a.mark((function e(t,n){var a,r,s,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===X||b()().diff(X,"minutes")>60)){e.next=4;break}return e.next=3,U();case 3:X=b()();case 4:if(!Y[n]){e.next=24;break}a=Y[n],r=Object(S.a)(a),e.prev=7,r.s();case 9:if((s=r.n()).done){e.next=15;break}if(i=s.value,!t.toLocaleLowerCase().includes(i.toLocaleLowerCase())){e.next=13;break}return e.abrupt("return",t);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return e.abrupt("return","".concat(a[0],", ").concat(t));case 24:return e.abrupt("return",t);case 25:case"end":return e.stop()}}),e,null,[[7,17,20,23]])})))).apply(this,arguments)}var Z={upscale:"RealESRGAN_x4plus",face_restore:"GFPGAN",remove_background:"strip_background"};function G(e){return e?e.replace(/[:()\d]+(\.\d+)?/g,""):e}function V(e,t){var n="###",a=1e3-n.length;if(!t)return e.substring(0,1e3);var r=e.length,s=t.length;if(r+s<=a)return"".concat(e).concat(n).concat(t);var i=Math.floor(a/2);return r<=i?s=a-r:r=s<=i?a-s:s=i,e=e.substring(0,r),t=t.substring(0,s),"".concat(e).concat(n).concat(t)}var $=function(){function e(t){Object(m.a)(this,e),this.client=t}return Object(p.a)(e,[{key:"generateImages",value:function(){var e=Object(u.a)(o.a.mark((function e(t,n){var a,r,s,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(t.params.prompt||"",t.model);case 2:return a=(a=e.sent).trim(),r=(r=G(t.params.negative_prompt||"")).trim(),a=V(a,r),[],s={params:{n:t.count,width:t.params.width||512,height:t.params.height||512,steps:t.params.steps||20,karras:!0,sampler_name:"k_euler",cfg_scale:t.params.cfg_scale||7.5,denoising_strength:t.params.denoising_strength||.75,hires_fix:!1,post_processing:[],control_type:t.params.controlnet_type||void 0,seed:t.params.seed||void 0,loras:t.params.loras&&t.params.loras.map((function(e){return{name:e.name,model:e.strength,clip:e.strength}}))},prompt:a,nsfw:!0,censor_nsfw:!1,trusted_workers:!1,slow_workers:!1,r2:!0,models:[t.model],source_processing:"img2img"},t.encoded_image&&(s.source_image=t.encoded_image),t.encoded_mask&&(s.source_mask=t.encoded_mask,-1!==t.model.toLocaleLowerCase().indexOf("inpainting")&&(s.source_processing="inpainting",s.params.karras=!1,s.params.steps=50)),e.next=13,this.client.initiateImageGeneration(s,n);case 13:if(i=e.sent){e.next=16;break}throw new Error("Failed to initiate image generation");case 16:return e.abrupt("return",{id:i,model:t.model,params:t.params,status:"pending",created_at:b()().valueOf(),progress:0,count:t.count});case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkGenerationJob",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r,s,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=JSON.parse(JSON.stringify(t)),e.next=3,this.client.checkImageJob(t.id);case 3:if(n=e.sent,t.status=n.status,t.progress=n.progress,"completed"!==t.status){e.next=15;break}return console.log("job is completed"),t.images=[],e.next=11,this.client.fetchImageResults(t.id);case 11:a=e.sent,console.log("fetch image results",a.length),r=Object(S.a)(a);try{for(r.s();!(s=r.n()).done;)i=s.value,c={id:z.a(),status:i.censored?"error":"completed",error:i.censored?"Image was censored":void 0,imageData:"data:image/webp;base64,".concat(i.imageData.toString("base64")),nsfw:!1,model:t.model,params:Object(f.a)(Object(f.a)({},t.params),{},{seed:i.seed}),created_at:b()().valueOf(),updated_at:b()().valueOf()},t.images.push(c)}catch(o){r.e(o)}finally{r.f()}case 15:return console.log("checkGenerationJob: job status",t.status),e.abrupt("return",t);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkGenerationJobs",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=JSON.parse(JSON.stringify(t)),n=t.map((function(e){return a.checkGenerationJob(e)})),e.abrupt("return",Promise.all(n));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"augmentImage",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=JSON.parse(JSON.stringify(t.image))).status="pending",a={forms:[{name:Z[t.augmentation]}],source_image:t.image.imageData,slow_workers:!1,trusted_workers:!1},console.log("alchemist payload",a),e.prev=4,e.next=7,this.client.initiateAlchemistImageInterrogation(a);case 7:if(r=e.sent){e.next=13;break}return console.error("Failed to initiate alchemist image interrogation"),n.status="error",n.error="Failed to initiate alchemist image interrogation",e.abrupt("return",n);case 13:n.id=r,e.next=21;break;case 16:e.prev=16,e.t0=e.catch(4),console.error("Failed to augment image",e.t0),n.status="error",n.error=e.t0.message;case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,this,[[4,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"checkAugmentation",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=JSON.parse(JSON.stringify(t)),e.prev=1,e.next=4,this.client.checkInterrogationStatus(t.id);case 4:if(n=e.sent,t.status=W[n]||n,"completed"!==t.status){e.next=11;break}return e.next=9,this.client.fetchInterrogationResult(t.id);case 9:"boolean"===typeof(a=e.sent)?t.nsfw=a:"object"===typeof a&&(r=a.toString("base64"),s="data:image/webp;base64,".concat(r),t.imageData=s);case 11:e.next=18;break;case 13:e.prev=13,e.t0=e.catch(1),console.error("image failed",e.t0),t.status="error",t.error=e.t0.message;case 18:return e.abrupt("return",t);case 19:case"end":return e.stop()}}),e,this,[[1,13]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Q=n(227),ee=n(21),te=n(68),ne=n(57),ae=function(e){var t=e.client,n=Object(a.useState)(null),r=Object(l.a)(n,2),s=r[0],i=r[1],c=Object(a.useState)(null),h=Object(l.a)(c,2),d=(h[0],h[1]),f=Object(a.useState)(!1),m=Object(l.a)(f,2),p=m[0],g=m[1],b=Object(a.useState)(""),j=Object(l.a)(b,2),v=j[0],x=j[1],O=Object(a.useState)(null),y=Object(l.a)(O,2),k=y[0],C=y[1];Object(a.useEffect)((function(){!function(){var e=localStorage.getItem("user"),n=localStorage.getItem("apiKey");e&&n&&(i(JSON.parse(e)),d(n),x(n),t.updateApiKey(n))}()}),[]);var S=function(){var e=Object(u.a)(o.a.mark((function e(){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H.a.get("https://stablehorde.net/api/v2/find_user",{headers:{accept:"application/json","Client-Agent":"unknown:0:unknown",apikey:v}});case 3:n=e.sent,a=n.data,i(a),d(v),localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("apiKey",v),t.updateApiKey(v),g(!1),C(null),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),C("Invalid API key");case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}}();return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsxs)("span",{style:{cursor:"pointer",color:"#00f0f0"},className:"top-button",onClick:function(){return g(!0)},children:[Object(w.jsx)("i",{className:"fas fa-user"}),"\xa0",s?"".concat(s.username):"Anonymous"]}),Object(w.jsxs)(ee.a,{show:p,onHide:function(){return g(!1)},children:[Object(w.jsx)(ee.a.Header,{closeButton:!0,children:Object(w.jsx)(ee.a.Title,{children:"Enter API Key"})}),Object(w.jsxs)(ee.a.Body,{children:[Object(w.jsxs)("p",{children:[Object(w.jsx)("i",{className:"fas fa-info-circle"}),"\xa0 You can register to get an API key at\xa0",Object(w.jsx)("a",{target:"_blank",href:"https://aihorde.net/register",children:"https://aihorde.net/register"})]}),Object(w.jsxs)(te.a,{children:[Object(w.jsxs)(te.a.Group,{controlId:"formApiKey",children:[Object(w.jsx)(te.a.Label,{children:"API Key"}),Object(w.jsx)(te.a.Control,{type:"text",placeholder:"Enter API Key",value:v,onChange:function(e){return x(e.target.value)}})]}),k&&Object(w.jsx)("p",{style:{color:"red"},children:k})]})]}),Object(w.jsxs)(ee.a.Footer,{children:[Object(w.jsx)(ne.a,{variant:"secondary",onClick:function(){return g(!1)},children:"Cancel"}),Object(w.jsx)(ne.a,{variant:"primary",onClick:S,children:"Save"})]})]})]})},re=function(){function e(t,n){Object(m.a)(this,e),this.baseUrl=void 0,this.manifestId=void 0,this.manifest=null,this.baseUrl=t,this.manifestId=n}return Object(p.a)(e,[{key:"loadManifest",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.manifest||!this.manifestId){e.next=6;break}return e.next=3,H.a.get("".concat(this.baseUrl,"/").concat(this.manifestId,".json"));case 3:t=e.sent,this.manifest=t.data,this.manifest.imageIds=this.manifest.imageIds.reverse();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"listImages",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r,s,i,c,u,l,h,d,f,m,p,g,b=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadManifest();case 2:if(this.manifest){e.next=4;break}return e.abrupt("return",{images:[]});case 4:if(n=t.cursor,a=void 0===n?"":n,r=t.limit,s=void 0===r?10:r,i=t.filter,c=void 0===i?"":i,u=this.manifest.imageIds,!(-1===(l=a?u.indexOf(a)+1:0)||l>u.length)){e.next=9;break}throw new Error("Invalid cursor");case 9:h=[],d=void 0;case 11:if(!(h.length<s&&l<u.length)){e.next=23;break}return f=l+(s-h.length),m=u.slice(l,f),e.next=16,Promise.all(m.map((function(e){return b.loadImage(e)})));case 16:p=e.sent,g=p.filter((function(e){return(e.params.prompt||"").toLowerCase().includes(c.toLowerCase())})),h=[].concat(Object(C.a)(h),Object(C.a)(g)),l=f,d=u[f],e.next=11;break;case 23:return e.abrupt("return",{images:h,nextCursor:d});case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadImage",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H.a.get("".concat(this.baseUrl,"/").concat(t,".json"));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),se=new j,ie=new Q.a(localStorage.getItem("apiKey")||"0000000000"),ce=new $(ie);var oe=new re("https://aibrush2-filestore.s3.amazonaws.com",function(){var e=localStorage.getItem("manifest_id")||void 0;return e||((e=new URLSearchParams(window.location.search).get("manifest_id")||void 0)&&localStorage.setItem("manifest_id",e),e)}());var ue=function(){var e=Object(a.useState)(!1),t=Object(l.a)(e,2),n=t[0],r=t[1],s=function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App.init"),e.next=3,se.init();case 3:console.log("App.init: localImages.init"),r(!0);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){s()}),[]),Object(w.jsxs)("div",{className:"App",children:[!n&&Object(w.jsx)("div",{className:"row",children:Object(w.jsx)("div",{className:"col-lg-12",children:Object(w.jsx)("div",{className:"spinner-border text-primary"})})}),n&&Object(w.jsx)(h.a,{children:Object(w.jsxs)("div",{className:"container",children:[Object(w.jsxs)("div",{className:"row",children:[Object(w.jsx)("div",{className:"col-lg-12",children:Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(h.b,{className:"btn btn-primary top-button",to:"/saved",children:Object(w.jsx)("i",{className:"fas fa-save"})}),Object(w.jsx)(h.b,{className:"btn btn-primary top-button",to:"/",children:Object(w.jsx)("i",{className:"fas fa-home"})}),Object(w.jsx)("a",{className:"btn btn-primary top-button",href:"https://discord.gg/HYcFpDeqKJ",target:"_blank",children:Object(w.jsx)("i",{className:"fab fa-discord"})}),Object(w.jsx)("a",{className:"btn btn-primary top-button",href:"https://github.com/wolfgangmeyers/aibrush-2",target:"_blank",children:Object(w.jsx)("i",{className:"fab fa-github"})}),Object(w.jsx)(ae,{client:ie})]})}),Object(w.jsx)("div",{className:"col-lg-12",style:{textAlign:"right"}})]}),Object(w.jsxs)(d.d,{children:[Object(w.jsx)(d.b,{path:"/",exact:!0,children:Object(w.jsx)(x.a,{localImages:se,generator:ce,imageClient:oe})}),Object(w.jsx)(d.b,{path:"/images/:id",children:Object(w.jsx)(x.a,{localImages:se,generator:ce,imageClient:oe})}),Object(w.jsx)(d.b,{path:"/saved",exact:!0,children:Object(w.jsx)(T,{imageClient:oe})}),Object(w.jsx)(d.b,{path:"/saved/:id",exact:!0,children:Object(w.jsx)(T,{imageClient:oe})}),Object(w.jsx)(d.b,{path:"/image-editor/:id",children:Object(w.jsx)(v.a,{generator:ce,localImages:se,imageClient:oe})}),Object(w.jsx)(d.b,{path:"/local-deleted-images",children:Object(w.jsx)(k,{localImages:se})}),Object(w.jsx)(d.b,{path:"/testpage",children:Object(w.jsx)(F,{})})]}),Object(w.jsxs)("div",{style:{position:"fixed",bottom:"0",left:"0",width:"100%",height:"50px",paddingTop:"16px",backgroundColor:"#000000"},children:[Object(w.jsx)("a",{href:"https://www.termsfeed.com/live/4f40dfff-6360-40cb-82bd-ac31dcb250e8",target:"_blank",children:"Privacy Policy"}),Object(w.jsx)("a",{href:"https://www.termsfeed.com/live/03dfa444-2227-4654-954d-98a6dbe297fd",target:"_blank",style:{marginLeft:"20px"},children:"Terms of Service"}),Object(w.jsx)("a",{href:"mailto:admin@aibrush.art",style:{marginLeft:"20px"},children:"Contact"}),Object(w.jsxs)("span",{style:{float:"right",marginRight:"50px"},children:["Powered by the"," ",Object(w.jsx)("a",{href:"https://stablehorde.net/",target:"_blank",children:"Stable Horde"})]})]})]})})]})},le=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,416)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),s(e),i(e)}))};i.a.render(Object(w.jsx)(r.a.StrictMode,{children:Object(w.jsx)(ue,{})}),document.getElementById("root")),le()},53:function(e,t,n){"use strict";n.d(t,"a",(function(){return a.a}));var a=n(26);n(15),n(16)},54:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n(0);var a=n(21),r=n(1),s=function(e){var t=e.show,n=e.title,s=e.children;return Object(r.jsxs)(a.a,{show:t,backdrop:"static",keyboard:!1,children:[Object(r.jsx)(a.a.Header,{closeButton:!0,children:Object(r.jsx)(a.a.Title,{children:n||"Processing"})}),Object(r.jsx)(a.a.Body,{children:s||Object(r.jsx)("div",{className:"d-flex justify-content-center",children:Object(r.jsx)("div",{className:"spinner-border",role:"status",children:Object(r.jsx)("span",{className:"sr-only",children:"Please Wait..."})})})})]})}},56:function(e,t,n){"use strict";n.d(t,"b",(function(){return S})),n.d(t,"a",(function(){return N}));var a=n(2),r=n.n(a),s=n(3),i=n(5),c=n(0),o=n(13),u=n.n(o),l=n(21),h=n(57),d=n(68),f=n(211),m=n(210),p=n.n(m),g=n(414),b=n(209),j=n(415),v=n(27),x=n(15),O=n(16),y=n(122),w=n(29),k=new(function(){function e(){Object(x.a)(this,e),this.kvstore=void 0,this.kvstore=new y.a({dbName:"saved-loras",storeName:"loras"}),this.migrateToIDs()}return Object(O.a)(e,[{key:"migrateToIDs",value:function(){var e=Object(i.a)(r.a.mark((function e(){var t,n,a,s,i,c,o,u,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("migrateToIDs"),t=w.a.getItems(),n=!1,a=Object(v.a)(t),e.prev=4,a.s();case 6:if((s=a.n()).done){e.next=14;break}if(i=s.value,console.log("id",i),i.match(/^\d+$/)){e.next=12;break}return n=!0,e.abrupt("break",14);case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),a.e(e.t0);case 19:return e.prev=19,a.f(),e.finish(19);case 22:if(!n){e.next=50;break}console.log("one-time migration of recent loras to int keys"),w.a.clear(),t.reverse(),c=Object(v.a)(t),e.prev=27,c.s();case 29:if((o=c.n()).done){e.next=42;break}return u=o.value,e.next=33,this.kvstore.getItem(u);case 33:if(!(l=e.sent)){e.next=40;break}return w.a.addItem(l.id.toString()),e.next=38,this.kvstore.deleteItem(u);case 38:return e.next=40,this.kvstore.setItem(l.id.toString(),l);case 40:e.next=29;break;case 42:e.next=47;break;case 44:e.prev=44,e.t1=e.catch(27),c.e(e.t1);case 47:return e.prev=47,c.f(),e.finish(47);case 50:case"end":return e.stop()}}),e,this,[[4,16,19,22],[27,44,47,50]])})));return function(){return e.apply(this,arguments)}}()},{key:"listRecentLoras",value:function(){var e=Object(i.a)(r.a.mark((function e(){var t,n,a,s,i,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=w.a.getItems(),n=[],a=Object(v.a)(t),e.prev=3,a.s();case 5:if((s=a.n()).done){e.next=13;break}return i=s.value,e.next=9,this.kvstore.getItem(i);case 9:(c=e.sent)&&n.push(c);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),a.e(e.t0);case 18:return e.prev=18,a.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,this,[[3,15,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"getLora",value:function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getLora",t),e.next=3,this.kvstore.getItem(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addLora",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id.toString(),e.next=3,this.kvstore.setItem(n,t);case 3:if(!(a=w.a.addItem(n))){e.next=7;break}return e.next=7,this.kvstore.deleteItem(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}()),C=n(1);function S(e){return I.apply(this,arguments)}function I(){return(I=Object(i.a)(r.a.mark((function e(t){var n,a,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return k.getLora(e.name)})));case 2:for(n=e.sent,a=[],s=0;s<n.length;s++)n[s]&&(i=t[s],a.push({config:i,lora:n[s]}));return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=function(e){var t=e.onConfirm,n=e.onCancel,a=Object(c.useState)(""),o=Object(s.a)(a,2),m=o[0],v=o[1],x=Object(c.useState)(1),O=Object(s.a)(x,2),y=O[0],w=O[1],S=Object(c.useState)(null),I=Object(s.a)(S,2),N=I[0],L=I[1],M=Object(c.useState)([]),D=Object(s.a)(M,2),E=D[0],T=D[1],_=Object(c.useState)(null),P=Object(s.a)(_,2),A=P[0],z=P[1],F=Object(c.useState)(!1),R=Object(s.a)(F,2),H=R[0],B=R[1],W=Object(c.useCallback)(Object(i.a)(r.a.mark((function e(){var t,n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(null===(t=m.match(/(\d+)/))||void 0===t?void 0:t[0])||m){e.next=4;break}return z("Invalid input"),e.abrupt("return");case 4:return B(!0),e.prev=5,e.next=8,u.a.get("https://civitai.com/api/v1/models/".concat(n));case 8:a=e.sent,L(a.data),z(null),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),z("Failed to fetch data");case 16:return e.prev=16,B(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[5,13,16,19]])}))),[m]);Object(c.useEffect)((function(){(function(){var e=Object(i.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.listRecentLoras();case 2:t=e.sent,T(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var Y=E.filter((function(e){return e.name.toLowerCase().includes(m.toLowerCase())||e.id.toString()===m}));return Object(C.jsxs)(l.a,{show:!0,onHide:n,size:"xl",children:[Object(C.jsx)(l.a.Header,{closeButton:!0,children:Object(C.jsx)(l.a.Title,{children:"Enter LORA URL or Model Number"})}),Object(C.jsxs)(l.a.Body,{children:[!N&&Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)(d.a,{onSubmit:function(e){e.preventDefault(),W()},children:Object(C.jsxs)(d.a.Group,{as:g.a,children:[Object(C.jsx)(b.a,{sm:10,children:Object(C.jsx)(d.a.Control,{type:"text",placeholder:"Enter LORA URL or Model Number",value:m,onChange:function(e){v(e.target.value)}})}),Object(C.jsx)(b.a,{sm:2,children:Object(C.jsx)(h.a,{variant:"primary",onClick:W,disabled:H||!m,children:H?"Loading...":"Search"})})]})}),Object(C.jsx)("h5",{className:"mt-3",children:"Recently Used Loras:"}),Object(C.jsx)(j.a,{style:{maxHeight:"500px",overflowY:"auto"},children:Y.map((function(e,t){return Object(C.jsx)(j.a.Item,{action:!0,onClick:function(){return L(e)},children:e.name},t)}))})]}),N&&Object(C.jsxs)(d.a.Group,{as:g.a,children:[Object(C.jsxs)(d.a.Label,{column:!0,sm:2,children:["Strength: ",y]}),Object(C.jsx)(b.a,{sm:10,children:Object(C.jsx)(d.a.Control,{type:"range",min:0,max:5,step:.1,value:y,onChange:function(e){return w(parseFloat(e.target.value))}})})]}),A?Object(C.jsx)(f.a,{variant:"danger",children:A}):N?Object(C.jsxs)("div",{children:[Object(C.jsx)("h5",{children:N.name}),Object(C.jsx)("div",{dangerouslySetInnerHTML:{__html:p.a.sanitize(N.description)}}),Object(C.jsxs)("p",{children:["Allow Commercial Use: ",N.allowCommercialUse]}),Object(C.jsxs)("p",{children:["Creator: ",N.creator.username]}),Object(C.jsx)("h6",{children:"Tags:"}),Object(C.jsx)("div",{style:{marginBottom:"16px"},children:N.tags.map((function(e,t){return Object(C.jsxs)("span",{children:[e,t<N.tags.length-1&&", "]},t)}))}),Object(C.jsx)("h6",{children:"Model Versions:"}),N.modelVersions.slice(0,1).map((function(e,t){return Object(C.jsxs)("div",{children:[Object(C.jsx)("strong",{children:e.name}),Object(C.jsxs)("p",{children:["Base Model: ",e.baseModel]}),Object(C.jsx)("strong",{children:"Trained Words:"}),Object(C.jsx)("ul",{children:e.trainedWords.map((function(e,t){return Object(C.jsx)("li",{children:e},t)}))}),Object(C.jsx)("strong",{children:"Images:"}),Object(C.jsx)("div",{className:"row",children:e.images.map((function(e,t){return Object(C.jsx)("div",{className:"col-sm-4 col-md-3",children:Object(C.jsx)("div",{className:"thumbnail",children:Object(C.jsx)("img",{src:e.url,alt:"",style:{maxWidth:"100%",height:"auto",marginBottom:"16px"}})})},t)}))})]},t)}))]}):null]}),Object(C.jsxs)(l.a.Footer,{children:[Object(C.jsx)(h.a,{variant:"secondary",onClick:n,children:"Cancel"}),Object(C.jsx)(h.a,{variant:"primary",disabled:!N,onClick:function(){return k.addLora(N),void t({config:{name:"".concat(N.id),strength:y},lora:N})},children:"OK"})]})]})}},59:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(1),r=function(e){e.imagesCost;return Object(a.jsx)(a.Fragment,{})}},66:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(1),r=function(e){var t=e.progress;return Object(a.jsx)("div",{className:"progress",style:{height:"20px",marginTop:"16px"},children:Object(a.jsxs)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(100*t,"%")},"aria-valuenow":100*t,"aria-valuemin":0,"aria-valuemax":100,children:[Math.round(100*t),"%"]})})}},73:function(e,t,n){"use strict";function a(e){return new Promise((function(t){return window.setTimeout(t,e)}))}n.d(t,"a",(function(){return a}))},79:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));function a(e,t,n){return Math.max(e*Math.floor(t*n/262144),1)}},80:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(1),r=function(e){var t=e.onRemove,n=e.lora;return Object(a.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",style:{marginLeft:"8px",cursor:"default"},children:[n.lora.name,"\xa0",Object(a.jsx)("i",{className:"fas fa-times",style:{cursor:"pointer"},onClick:function(){return t(n)}})]})}},81:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(27),r=n(229),s=n(231),i=n(1),c=function(e){var t,n=e.prompt,c=e.selectedLoras,o=e.onAddTrigger,u=[],l=Object(a.a)(c);try{for(l.s();!(t=l.n()).done;){var h,d=t.value,f=Object(a.a)(d.lora.modelVersions[0].trainedWords);try{for(f.s();!(h=f.n()).done;){var m=h.value;-1===n.toLowerCase().indexOf(m.toLowerCase())&&-1===u.indexOf(m)&&u.push(m)}}catch(g){f.e(g)}finally{f.f()}}}catch(g){l.e(g)}finally{l.f()}var p=function(e){return Object(i.jsx)(r.a,{id:"button-tooltip",children:e})};return Object(i.jsxs)("div",{style:{textAlign:"left",padding:"8px"},children:[Object(i.jsx)("h5",{children:"Available Triggers"}),u.map((function(e,t){return Object(i.jsx)(s.a,{placement:"top",overlay:p(e),children:Object(i.jsxs)("span",{className:"badge bg-secondary me-2",style:{cursor:"pointer",marginRight:"8px"},onClick:function(){return o(e)},children:[Object(i.jsx)("i",{className:"fas fa-plus ms-2"}),"\xa0",e.length>20?e.slice(0,20)+"...":e]})},t)}))]})}},82:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n(0);var a=n(26),r=n(1),s=function(e){var t=e.image,n=e.censorNSFW,s=e.bulkDelete,i=e.onClick,c="https://aibrush2-filestore.s3.amazonaws.com/".concat(t.id,".thumbnail.png?updated_at=").concat(t.updated_at),o=t.label||"";""===t.label&&(o=t.params.prompt||""),-1!==o.indexOf(",")&&(o=o.substring(0,o.indexOf(",")));var u="image-thumbnail";s&&(u+=" bulk-delete");var l="url(".concat(c,"), url(/images/default.png)");return t.imageData&&(l="url(".concat(t.imageData,"), url(/images/default.png)")),Object(r.jsxs)("div",{className:u,style:{backgroundImage:l,backgroundRepeat:"no-repeat",backgroundPosition:"center",filter:t.nsfw&&n?"blur(8px)":void 0},onClick:function(){return i&&i(t)},children:[!s&&Object(r.jsx)("div",{className:"image-thumbnail-label",children:o}),s&&Object(r.jsx)("div",{className:"image-thumbnail-label",children:Object(r.jsx)("input",{type:"checkbox",style:{width:"20px",height:"20px",marginLeft:"16px",marginTop:"16px"},checked:!0,readOnly:!0})}),t.status===a.a.Pending&&Object(r.jsx)("div",{className:"image-thumbnail-pending",children:Object(r.jsx)("i",{style:{marginTop:"20px"},className:"fa fa-hourglass-half"})}),t.status===a.a.Processing&&Object(r.jsx)("div",{className:"image-thumbnail-pending",children:Object(r.jsx)("i",{style:{marginTop:"20px"},className:"fa fa-cog fa-spin"})})]})}},83:function(e,t,n){"use strict";n.d(t,"b",(function(){return D})),n.d(t,"a",(function(){return T}));var a=n(24),r=n(2),s=n.n(r),i=n(5),c=n(3),o=n(0),u=n(53),l=n(18),h=n(74),d=n.n(h),f=n(115),m=n(22),p=["canny","hed","depth","normal","openpose","seg","scribble","fakescribbles","hough"],g=n(68),b=n(207),j=n(89),v=n(208),x=n(1),O=function(e){var t=e.seed,n=e.setSeed,a=Object(o.useState)(!1),r=Object(c.a)(a,2),s=r[0],i=r[1];return Object(x.jsxs)(g.a,{children:[Object(x.jsx)(b.a,{children:Object(x.jsx)(j.a,{type:"checkbox",label:"Use Custom Seed",checked:s,onChange:function(e){return i(!s),void n(s?"":Math.floor(1e9*Math.random()).toString())}})}),s&&Object(x.jsx)(b.a,{children:Object(x.jsx)(v.a,{type:"text",placeholder:"Enter seed",value:t,onChange:function(e){return n(e.target.value)}})})]})},y=n(84),w=n(79),k=n(59),C=n(29),S=n(91),I=function(e){var t=e.value,n=e.onChange,a=e.history,r=Object(o.useState)(!1),s=Object(c.a)(r,2),i=s[0],u=s[1];return Object(x.jsxs)("div",{children:[Object(x.jsx)(v.a,{value:t,onChange:function(e){n(e.target.value)},onClick:function(){u(!i)},onBlur:function(){setTimeout((function(){return u(!1)}),200)}}),Object(x.jsxs)(S.a,{show:i,onSelect:function(e){e&&n(e),u(!1)},children:[Object(x.jsx)(S.a.Toggle,{variant:"success",id:"dropdown-basic",style:{height:"0px",padding:"0px",visibility:"hidden",position:"absolute"}}),Object(x.jsx)(S.a.Menu,{style:{width:"100%",overflow:"hidden"},children:a.map((function(e,t){return Object(x.jsx)(S.a.Item,{eventKey:e,children:e},t)}))})]})]})},N=n(56),L=n(80),M=n(81);function D(){return{params:{prompt:"",negative_prompt:E(),width:512,height:512,steps:20,denoising_strength:.75},label:"",encoded_image:"",encoded_mask:"",model:"Epic Diffusion",count:4}}function E(){return C.c.getItems()[0]||"low quality, distorted, deformed, dull, boring, plain, ugly, noise"}var T=function(e){var t=e.parent,n=e.creating,r=e.onSubmit,h=e.onCancel,g=e.onEdit,b=Object(o.useState)(""),j=Object(c.a)(b,2),v=j[0],S=j[1],T=Object(o.useState)(E()),_=Object(c.a)(T,2),P=_[0],A=_[1],z=Object(o.useState)(4),F=Object(c.a)(z,2),R=F[0],H=F[1],B=Object(o.useState)(.75),W=Object(c.a)(B,2),Y=W[0],X=W[1],U=Object(o.useState)(l.a),K=Object(c.a)(U,2),J=K[0],q=K[1],Z=Object(o.useState)(null),G=Object(c.a)(Z,2),V=G[0],$=G[1],Q=Object(o.useState)(!1),ee=Object(c.a)(Q,2),te=ee[0],ne=ee[1],ae=Object(o.useState)(""),re=Object(c.a)(ae,2),se=re[0],ie=re[1],ce=Object(o.useState)("Epic Diffusion"),oe=Object(c.a)(ce,2),ue=oe[0],le=oe[1],he=Object(o.useState)(!1),de=Object(c.a)(he,2),fe=de[0],me=de[1],pe=Object(o.useState)(),ge=Object(c.a)(pe,2),be=ge[0],je=ge[1],ve=Object(o.useState)(7.5),xe=Object(c.a)(ve,2),Oe=xe[0],ye=xe[1],we=Object(o.useState)(""),ke=Object(c.a)(we,2),Ce=ke[0],Se=ke[1],Ie=Object(o.useState)(1),Ne=Object(c.a)(Ie,2),Le=Ne[0],Me=Ne[1],De=Object(o.useState)(!1),Ee=Object(c.a)(De,2),Te=Ee[0],_e=Ee[1],Pe=Object(o.useState)([]),Ae=Object(c.a)(Pe,2),ze=Ae[0],Fe=Ae[1],Re=l.b[l.a],He=Object(o.useState)(l.b[l.a]),Be=Object(c.a)(He,2),We=Be[0],Ye=Be[1],Xe=Object(o.useState)(Re.width),Ue=Object(c.a)(Xe,2),Ke=Ue[0],Je=Ue[1],qe=Object(o.useState)(Re.height),Ze=Object(c.a)(qe,2),Ge=Ze[0],Ve=Ze[1],$e=function(){S(""),A(C.c.getItems()[0]||E),ne(!1),$(null),q(l.a),Ye(l.b[l.a]),ie(""),Se("")},Qe=function(){var e=Object(i.a)(s.a.mark((function e(n){var a,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P&&C.c.addItem(P),n.preventDefault(),(a=D()).params.prompt=v||"",a.params.negative_prompt=P||"",a.count=Ce?1:R,a.parent=V||void 0,a.params.denoising_strength=Y,a.nsfw=!0,a.model=ue,a.temporary=!0,a.params.controlnet_type=be,a.params.cfg_scale=Oe,a.params.seed=Ce||void 0,a.params.loras=ze.map((function(e){return e.config})),t?(i=Object(l.c)(t.params.width,t.params.height).scale(Le),a.params.width=i.width,a.params.height=i.height):(c=Object(l.c)(We.width,We.height).scale(Le),a.params.width=c.width,a.params.height=c.height),!se){e.next=20;break}return e.next=19,Object(m.i)(se,a.params.width,a.params.height,"png");case 19:a.encoded_image=e.sent;case 20:$e(),r(a);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),et=function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.files&&t.target.files[0]){e.next=3;break}return e.abrupt("return");case 3:d()(n,(function(e){if(e instanceof HTMLCanvasElement){var t=e.width,n=e.height,a=Object(l.c)(t,n),r=document.createElement("canvas");r.width=t,r.height=n;var s=r.getContext("2d");if(s){s.drawImage(e,0,0,r.width,r.height);var i=r.toDataURL("image/png").split(",")[1];ie(i),q(l.b.findIndex((function(e){return e.id===a.id}))),Ye(a),Je(t),Ve(n),r.remove()}}}),{maxWidth:4096,maxHeight:4096,canvas:!0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(o.useEffect)((function(){if(t){var e=t.imageData;e&&ie(e.split(",")[1]),S(t.params.prompt||""),A(t.params.negative_prompt||E()),H(4),$(t.id),ne(!0),X(t.params.denoising_strength||.75),le(t.model),ye(t.params.cfg_scale||7.5),t.params.loras&&t.params.loras.length>0?Object(N.b)(t.params.loras).then((function(e){Fe(e)})):ze.length>0&&Fe([])}else $e()}),[t]),Object(o.useEffect)((function(){se||je(void 0)}),[se]);var tt=We.scale(Le),nt=Object(w.a)(R,tt.width,tt.height);return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("form",{onSubmit:Qe,children:Object(x.jsxs)("div",{className:"homepage-prompt",children:[Object(x.jsxs)("div",{className:"input-group",children:[Object(x.jsx)("input",{className:"form-control prompt",placeholder:"What would you like to create?",value:v,onChange:function(e){return S(e.target.value)}}),Object(x.jsx)("div",{className:"input-group-append",children:Object(x.jsxs)("button",{type:"submit",className:"btn btn-secondary light-button",style:{marginLeft:"8px"},disabled:!v||n,children:[!n&&Object(x.jsx)("i",{className:"fas fa-paint-brush"}),n&&Object(x.jsx)("i",{className:"fas fa-spinner fa-spin"})]})})]}),ze.length>0&&Object(x.jsx)(M.a,{prompt:v,selectedLoras:ze,onAddTrigger:function(e){var t=[v];v.length>0&&!v.endsWith(",")&&t.push(", "),t.push(e),S(t.join(""))}}),!Ce&&Object(x.jsxs)("div",{className:"form-group",style:{marginTop:"8px"},children:[Object(x.jsxs)("label",{htmlFor:"count",children:["Count: ",R]}),Object(x.jsx)("input",{type:"range",className:"form-control-range",id:"count",min:"1",max:"20",value:R,onChange:function(e){return H(parseInt(e.target.value))}}),Object(x.jsx)("span",{className:"helptext",children:"This is how many images you want to generate"})]}),Object(x.jsx)(k.a,{imagesCost:nt}),Object(x.jsxs)("div",{style:{marginTop:"24px"},children:[Object(x.jsx)("a",{href:"javascript:void(0)",onClick:function(){return ne(!te)},style:{color:"white",textDecoration:"underline"},children:"Advanced"}),"\xa0",te?Object(x.jsx)("i",{className:"fas fa-chevron-up"}):Object(x.jsx)("i",{className:"fas fa-chevron-down"})]}),te&&Object(x.jsxs)("div",{className:"homepage-prompt-advanced",children:[se&&Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("label",{children:"Init Image"}),Object(x.jsx)("img",{style:{display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"100%"},src:"data:image/png;base64,".concat(se)})]}),!t&&!se&&Object(x.jsx)(f.a,{aspectRatio:J,onChange:function(e){q(e),Ye(l.b[e])}}),Object(x.jsx)("div",{className:"form-group",children:Object(x.jsxs)("div",{style:{display:"block",maxWidth:se?"350px":"180px",marginTop:"40px",marginRight:"auto",marginLeft:"auto"},children:[Object(x.jsxs)("label",{id:"loadimage-wrapper",className:"btn btn-primary ",style:{display:"inline"},children:[Object(x.jsx)("i",{className:"fas fa-upload"}),"\xa0",se||t?"Replace":"Upload",Object(x.jsx)("input",{id:"loadimage",type:"file",style:{display:"none"},onChange:et})]}),se&&Object(x.jsxs)("label",{className:"btn btn-secondary",onClick:function(){return ie("")},style:{display:"inline"},children:[Object(x.jsx)("i",{className:"fas fa-trash"}),"\xa0 Remove"]})]})}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("label",{htmlFor:"model",children:"Model"}),Object(x.jsx)("div",{children:Object(x.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",onClick:function(){return me(!0)},children:[ue,"\xa0",Object(x.jsx)("i",{className:"fas fa-caret-down"})]})})]}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("label",{htmlFor:"loras",children:"Loras"}),Object(x.jsxs)("div",{children:[ze.map((function(e){return Object(x.jsx)(L.a,{lora:e,onRemove:function(e){return function(e){Fe(ze.filter((function(t){return t.config.name!==e.config.name})))}(e)}},e.lora.name)})),ze.length<5&&Object(x.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",style:{marginLeft:"8px"},onClick:function(){return _e(!0)},children:[Object(x.jsx)("i",{className:"fas fa-plus"}),"\xa0Add Lora"]})]})]}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("label",{htmlFor:"negativePrompt",children:"Negative Prompt"}),Object(x.jsx)(I,{history:C.c.getItems(),value:P,onChange:A}),Object(x.jsx)("span",{className:"helptext",children:'Try descriptive words like "blurry" or "distorted"'})]}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsxs)("label",{htmlFor:"size",children:["Size: ",tt.width," x"," ",tt.height]}),Object(x.jsx)("input",{type:"range",className:"form-control-range",id:"size",min:"1",max:"2",step:"0.1",value:Le,onChange:function(e){return Me(parseFloat(e.target.value))}}),Object(x.jsx)("span",{className:"helptext",children:"This allows you to adjust the size of your images. Larger images cost more credits."})]}),(V||se)&&Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsxs)("label",{htmlFor:"variationStrength",children:["Variation Strength:\xa0",(100*Y).toFixed(0),"%"]}),Object(x.jsx)("input",{type:"range",className:"form-control-range",id:"variationStrength",min:"0.05",max:"0.95",step:"0.05",value:Y,onChange:function(e){return X(parseFloat(e.target.value))}}),Object(x.jsx)("span",{className:"helptext",children:"This is how much variation you want to see from the parent image"})]}),se&&Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("label",{htmlFor:"controlNetType",children:"Control Net Type"}),Object(x.jsxs)("select",{className:"form-control",id:"controlNetType",value:be,onChange:function(e){return je(e.target.value)},children:[Object(x.jsx)("option",{value:"",children:"None"}),p.map((function(e){return Object(x.jsx)("option",{value:e,children:e},"type-".concat(e))}))]}),Object(x.jsxs)("span",{className:"helptext",children:["Controlnet is an advanced way of controlling the output of image generation. You can read more about it"," ",Object(x.jsx)("a",{target:"_blank",href:"https://bootcamp.uxdesign.cc/controlnet-and-stable-diffusion-a-game-changer-for-ai-image-generation-83555cb942fc",children:"here."})]})]}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsxs)("label",{children:["CFG Scale: ",Oe.toFixed(1)]}),Object(x.jsx)("input",{type:"range",className:"form-control-range",min:"1",max:"20",step:"0.5",value:Oe,onChange:function(e){return ye(parseFloat(e.target.value))}}),Object(x.jsx)("span",{className:"helptext",children:"Adjust the CFG scale to control how much the image looks like the prompt."})]}),Object(x.jsx)(O,{seed:Ce,setSeed:Se}),Object(x.jsx)("div",{className:"form-group",style:{minHeight:"20px"},children:Object(x.jsxs)("div",{className:"float-right",children:[t&&Object(x.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",onClick:function(){$e(),h()},children:[Object(x.jsx)("i",{className:"fas fa-times"}),"\xa0CANCEL"]}),Object(x.jsxs)("button",{type:"submit",className:"btn btn-primary",style:{marginLeft:"8px"},disabled:!v||n,children:[!n&&Object(x.jsx)("i",{className:"fas fa-paint-brush"}),n&&Object(x.jsx)("i",{className:"fas fa-spinner fa-spin"}),"\xa0PAINT"]}),Object(x.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",onClick:function(){P&&C.c.addItem(P);var e=D();e.params.prompt=v||"",e.params.negative_prompt=P||"",e.count=1,e.parent=V||void 0,e.params.denoising_strength=Y,e.status=u.a.Completed,e.params.width=Ke,e.params.height=Ge,e.params.cfg_scale=Oe,e.nsfw=!1,e.model=ue,se&&(e.encoded_image=se),$e(),g(e)},style:{marginLeft:"8px"},disabled:!v||n,children:[Object(x.jsx)("i",{className:"fas fa-edit"}),"\xa0EDIT"]})]})})]})]})}),fe&&Object(x.jsx)(y.a,{onCancel:function(){return me(!1)},onSelectModel:function(e){le(e),me(!1)},initialSelectedModel:ue,inpainting:!1}),Te&&Object(x.jsx)(N.a,{onCancel:function(){return _e(!1)},onConfirm:function(e){return function(e){Fe([].concat(Object(a.a)(ze),[e])),_e(!1)}(e)}})]})}},84:function(e,t,n){"use strict";var a=n(3),r=n(0),s=n(21),i=n(68),c=n(414),o=n(209),u=n(57),l=n(13),h=n.n(l),d=n(415),f=n(1),m=function(e){var t=e.models,n=e.onSelectModel,s=e.selectedModel,i=Object(r.useState)(window.innerWidth<576?.3*window.innerHeight:.7*window.innerHeight),c=Object(a.a)(i,2),o=c[0],u=c[1];return Object(r.useEffect)((function(){var e=function(){var e=.7*window.innerHeight;window.innerWidth<576&&(e=.3*window.innerHeight),u(e)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(f.jsx)(d.a,{style:{maxHeight:"".concat(o,"px"),overflowY:"auto",border:"1px solid #808080",marginBottom:"8px"},children:t.map((function(e){return Object(f.jsx)(d.a.Item,{active:s===e.name,onClick:function(){return n(e)},style:{cursor:"pointer"},children:e.name},e.name)}))})},p=n(15),g=n(16),b=new(function(){function e(){Object(p.a)(this,e),this.storage=void 0,this.storage=window.localStorage}return Object(g.a)(e,[{key:"setItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3600,a={value:t,expiry:Date.now()+1e3*n};this.storage.setItem(e,JSON.stringify(a))}},{key:"getItem",value:function(e){try{var t=this.storage.getItem(e);if(!t)return null;var n=JSON.parse(t);return Date.now()>n.expiry?(this.storage.removeItem(e),null):n.value}catch(a){return console.error(a),null}}},{key:"removeItem",value:function(e){this.storage.removeItem(e)}},{key:"clear",value:function(){this.storage.clear()}}]),e}());var j=n(29);h.a.create(),t.a=function(e){var t=e.initialSelectedModel,n=e.onSelectModel,l=e.onCancel,d=e.inpainting,p=function(e,t){var n=Object(r.useState)((function(){var n=b.getItem(e);return null!==n?n:t})),s=Object(a.a)(n,2),i=s[0],c=s[1];return Object(r.useEffect)((function(){b.setItem(e,i)}),[e,i]),[i,c]}("models",[]),g=Object(a.a)(p,2),v=g[0],x=g[1],O=Object(r.useState)(null),y=Object(a.a)(O,2),w=y[0],k=y[1],C=Object(r.useState)(""),S=Object(a.a)(C,2),I=S[0],N=S[1],L=v.filter((function(e){return e.inpainting===d&&e.name.toLowerCase().includes(I.toLowerCase())}));return Object(r.useEffect)((function(){var e=function(e,t){j.b.addItem(e.name);var n=j.b.getItems(),a={};n.forEach((function(e,t){a[e]=t}));var r=t.sort((function(e,t){var n=a[e.name],r=a[t.name];return void 0===n&&void 0===r?0:void 0===n?1:void 0===r?-1:n-r}));x(r)};if(v&&0!==v.length){var n=v.find((function(e){return e.name===t}))||v[0];k(n),e(n,v)}else h.a.get("https://raw.githubusercontent.com/Haidra-Org/AI-Horde-image-model-reference/main/stable_diffusion.json").then((function(n){var a=n.data,r=a[t]||Object.values(a)[0];k(r),e(r,Object.values(a))}))}),[v]),Object(r.useEffect)((function(){t&&j.b.addItem(t)}),[t]),Object(f.jsx)(f.Fragment,{children:Object(f.jsxs)(s.a,{show:!0,onHide:l,size:"xl",children:[Object(f.jsx)(s.a.Header,{closeButton:!0,children:Object(f.jsx)(s.a.Title,{children:"Select Model"})}),Object(f.jsxs)(s.a.Body,{children:[Object(f.jsx)(i.a.Control,{type:"text",placeholder:"Search",value:I,onChange:function(e){N(e.target.value)}}),Object(f.jsxs)(c.a,{className:"mt-3",children:[Object(f.jsx)(o.a,{sm:4,children:Object(f.jsx)(m,{models:L,onSelectModel:function(e){k(e)},selectedModel:(null===w||void 0===w?void 0:w.name)||""})}),Object(f.jsx)(o.a,{sm:8,children:w&&Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("h5",{children:w.name}),Object(f.jsx)("p",{children:w.description}),w.showcases&&w.showcases.length>0&&Object(f.jsx)("img",{src:w.showcases[0],alt:"Showcase",style:{width:"70%"}})]})})]})]}),Object(f.jsxs)(s.a.Footer,{children:[Object(f.jsx)(u.a,{variant:"secondary",onClick:l,children:"Cancel"}),Object(f.jsx)(u.a,{variant:"primary",onClick:function(){console.log("Selected model:",w),w&&n(w.name)},disabled:!w,children:"Select"})]})]})})}},88:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(231),r=n(229),s=n(1),i=function(e){var t=e.onClick;return Object(s.jsx)(a.a,{placement:"top",overlay:Object(s.jsx)(r.a,{id:"reset-tooltip",children:"Reset to Default"}),children:Object(s.jsx)("i",{className:"fa fa-sync",style:{cursor:"pointer"},onClick:t})})}},90:function(e,t,n){"use strict";n.d(t,"c",(function(){return b})),n.d(t,"b",(function(){return j})),n.d(t,"a",(function(){return v}));var a=n(3),r=n(24),s=n(15),i=n(16),c=n(60),o=n(30),u=n(32),l=n(33),h=n(0),d=n(38),f=n(123),m=n(127),p=(n(391),n(1)),g=function(e){var t=e.color,n=e.onColorSelected,r=Object(h.useState)(!1),s=Object(a.a)(r,2),i=s[0],c=s[1],o=Object(h.useState)(t),u=Object(a.a)(o,2),l=u[0],d=u[1];return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("button",{className:"color-picker",onClick:function(){c(!i),i&&n(l)},children:Object(p.jsx)("i",{className:"fas fa-plus"})}),i?Object(p.jsxs)("div",{style:{position:"absolute",zIndex:2},children:[Object(p.jsx)("div",{style:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},onClick:function(){c(!1),i&&n(l)}}),Object(p.jsx)(m.a,{color:l,onChange:function(e){return d(e.hex)},onChangeComplete:function(e){return d(e.hex)}})]}):null]})},b=["#FFFFFF","#5A2C02","#386EB6","#6B31A1","#CB2C26","#000000","#888888","#50B050","#FBDB37","#E88D2D"],j=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e,a){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b[0],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"pencil";return Object(s.a)(this,n),(r=t.call(this,e,c)).layer=a,r.brushColor=i,r.brushSize=10,r.panning=!1,r.isDrawing=!1,r.lastX=0,r.lastY=0,r.colorPicking=!1,r.lastPickedColor="#000000",r._dirty=!1,r.dirtyListener=void 0,r.colorPickedListener=void 0,r}return Object(i.a)(n,[{key:"dirty",get:function(){return this._dirty},set:function(e){this._dirty=e,this.dirtyListener&&this.dirtyListener(e)}},{key:"sync",value:function(){this.colorPicking?this.renderer.setCursor({x:this.lastX,y:this.lastY,radius:this.renderer.getWidth()/20,color:this.lastPickedColor,type:"colorpicker"}):this.renderer.setCursor({x:this.lastX,y:this.lastY,radius:this.brushSize/2,color:this.brushColor,type:"circle-fill"})}},{key:"updateArgs",value:function(e){Object(c.a)(Object(o.a)(n.prototype),"updateArgs",this).call(this,e),this.brushSize=e.brushSize||10,this.brushColor=e.brushColor||b[0],this.sync()}},{key:"onMouseDown",value:function(e){if(!this.colorPicking){if(0===e.button){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.renderer.drawPoint(n,a,this.brushSize,this.brushColor,this.layer),this.isDrawing=!0,this.lastX=n,this.lastY=a,this.dirty=!0}else 1===e.button&&(this.panning=!0);this.sync()}}},{key:"onMouseMove",value:function(e){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.colorPicking?this.lastPickedColor=this.renderer.getPixel(n,a):this.panning?this.zoomHelper.onPan(e):this.isDrawing&&(this.renderer.drawLine(this.lastX,this.lastY,n,a,this.brushSize,this.brushColor,this.layer),this.dirty=!0),this.lastX=n,this.lastY=a,this.sync()}},{key:"onMouseUp",value:function(e){0===e.button?(this.isDrawing=!1,this.colorPicking&&(this.colorPicking=!1,this.brushColor=this.lastPickedColor,this.colorPickedListener&&this.colorPickedListener(this.lastPickedColor))):1===e.button&&(this.panning=!1),this.sync()}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e),this.sync()}},{key:"cancel",value:function(){this.renderer.setEditImage(null),this.dirty=!1}},{key:"confirm",value:function(){this.renderer.commitSelection();var e=this.renderer.getEncodedImage(null);e&&this.saveListener&&this.saveListener(e),this.dirty=!1}},{key:"onSaveImage",value:function(e){this.saveListener=e}},{key:"onDirty",value:function(e){this.dirtyListener=e}},{key:"destroy",value:function(){return this.dirty&&this.renderer.commitSelection(),!0}},{key:"beginColorpicker",value:function(){this.colorPicking=!0,this.sync()}},{key:"onColorPicked",value:function(e){this.colorPickedListener=e}}]),n}(d.a);var v=function(e){e.renderer;var t=e.tool,n=e.colors,s=Object(h.useState)(10),i=Object(a.a)(s,2),c=i[0],o=i[1],u=Object(h.useState)(n[0]),l=Object(a.a)(u,2),d=l[0],m=l[1],b=Object(h.useState)(n),j=Object(a.a)(b,2),v=j[0],x=j[1],O=Object(h.useState)(!1),y=Object(a.a)(O,2),w=y[0],k=y[1];t.onDirty(k),Object(h.useEffect)((function(){t.updateArgs({brushSize:c,brushColor:d,palette:v})}),[c,d,v]);var C=function(e){m(e),x(function(e,t){return-1===e.indexOf(t)&&(e=[t].concat(Object(r.a)(e))),e.length>30&&(e=e.slice(0,30)),e}(v,e))};return t.onColorPicked(C),Object(p.jsxs)("div",{style:{marginTop:"16px"},children:[Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsxs)("label",{style:{width:"100%"},children:["Brush size",Object(p.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[c,"px"]})]}),Object(p.jsx)("input",{type:"range",className:"form-control-range",min:"1",max:"100",value:c,onChange:function(e){return o(parseInt(e.target.value))}})]}),Object(p.jsxs)("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:[v.map((function(e,t){return Object(p.jsx)(f.a,{selectedColor:d,color:e,onClick:function(e){return m(e)},onColorSelected:function(e){return C(e)}},t)})),Object(p.jsx)("button",{className:"color-picker",onClick:function(){return t.beginColorpicker()},children:Object(p.jsx)("i",{className:"fas fa-eye-dropper"})}),Object(p.jsx)(g,{color:d,onColorSelected:function(e){return C(e)}})]}),Object(p.jsxs)("div",{className:"form-group",style:{marginTop:"16px",visibility:w?"visible":"hidden"},children:[Object(p.jsx)("button",{className:"btn btn-secondary",onClick:function(){return t.cancel()},children:"Revert"}),Object(p.jsx)("button",{className:"btn btn-primary",onClick:function(){return t.confirm()},style:{marginLeft:"8px"},children:"Save"})]})]})}},98:function(e,t,n){"use strict";n.d(t,"b",(function(){return b})),n.d(t,"a",(function(){return j}));var a=n(3),r=n(4),s=n(15),i=n(16),c=n(60),o=n(30),u=n(32),l=n(33),h=n(0),d=n(38),f=n(115),m=n(99),p=n(18),g=n(1),b=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e,"select")).selectionOverlay=void 0,a.selectionOverlayPreview=void 0,a.outpaint=void 0,a.panning=!1,a}return Object(i.a)(n,[{key:"updateArgs",value:function(e){e=Object(r.a)(Object(r.a)({},this.getArgs()),e),Object(c.a)(Object(o.a)(n.prototype),"updateArgs",this).call(this,e),this.selectionOverlay=e.selectionOverlay||{x:0,y:0,width:512,height:512},this.outpaint=e.outpaint,this.outpaint||(this.selectionOverlay=this.clamp(this.selectionOverlay)),this.sync()}},{key:"clamp",value:function(e){var t=this.renderer.getWidth(),n=this.renderer.getHeight(),a=e.x,r=e.y,s=e.width,i=e.height;return a=Math.max(0,Math.min(a,t-this.selectionOverlay.width)),r=Math.max(0,Math.min(r,n-e.height)),{x:a=Math.min(a,t-e.width),y:r=Math.min(r,n-e.height),width:s=Math.min(s,t),height:i=Math.min(i,n)}}},{key:"sync",value:function(){this.renderer.setSelectionOverlay(this.selectionOverlay),this.renderer.setSelectionOverlayPreview(this.selectionOverlayPreview)}},{key:"onMouseDown",value:function(e){"touch"==e.type?this.onMouseMove(e):0===e.button?(this.selectionOverlay=this.selectionOverlayPreview,this.selectionOverlayPreview=void 0,this.sync(),this.updateArgs({selectionOverlay:this.selectionOverlay})):1===e.button&&(this.panning=!0)}},{key:"onMouseMove",value:function(e){this.renderer.getWidth(),this.renderer.getHeight();if(this.panning)this.zoomHelper.onPan(e);else{var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;n=16*Math.round(n/16),a=16*Math.round(a/16),n-=256,a-=256,this.selectionOverlayPreview={x:n,y:a,width:this.selectionOverlay.width,height:this.selectionOverlay.height},this.outpaint||(this.selectionOverlayPreview=this.clamp(this.selectionOverlayPreview)),this.sync()}}},{key:"onMouseUp",value:function(e){0===e.button&&"touch"==e.type&&(this.selectionOverlay=this.selectionOverlayPreview,this.selectionOverlayPreview=void 0,this.sync(),this.updateArgs({selectionOverlay:this.selectionOverlay})),this.panning=!1}},{key:"onMouseLeave",value:function(e){this.selectionOverlayPreview=void 0,this.panning=!1,this.sync()}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e)}},{key:"destroy",value:function(){return this.renderer.setSelectionOverlayPreview(void 0),!0}}]),n}(d.a),j=function(e){var t=e.renderer,n=e.tool,r=e.lockAspectRatio,s=e.outpaint,i=Object(m.a)(t.getWidth(),t.getHeight()),c=Object(h.useState)(p.a),o=Object(a.a)(c,2),u=o[0],l=o[1],d=Object(h.useState)(1),b=Object(a.a)(d,2),j=b[0],v=b[1];function x(e,a){var r=n.getArgs(),i=p.b[e];if(r.selectionOverlay){var c=r.selectionOverlay.width-i.width*a,o=r.selectionOverlay.height-i.height*a;r.selectionOverlay.width=Math.round(i.width*a),r.selectionOverlay.height=Math.round(i.height*a),r.selectionOverlay.x+=c/2,r.selectionOverlay.y+=o/2,s||(r.selectionOverlay.x=Math.round(Math.max(0,Math.min(r.selectionOverlay.x,t.getWidth()-r.selectionOverlay.width))),r.selectionOverlay.y=Math.round(Math.max(0,Math.min(r.selectionOverlay.y,t.getHeight()-r.selectionOverlay.height))))}n.updateArgs({selectionOverlay:r.selectionOverlay})}return Object(h.useEffect)((function(){if(0===Object(m.a)(t.getWidth(),t.getHeight())&&r){var e=Object(p.c)(t.getWidth(),t.getHeight());l(e.id),n.updateArgs({selectionOverlay:{x:0,y:0,width:e.width,height:e.height},outpaint:s})}else{var a=n.getArgs();if(a.selectionOverlay){var i=Object(p.c)(a.selectionOverlay.width,a.selectionOverlay.height);l(i.id),v(a.selectionOverlay.width/i.width),n.updateArgs(a)}else a.selectionOverlay={x:0,y:0,width:p.b[u].width,height:p.b[u].height},a.outpaint=s,n.updateArgs(a)}}),[n]),Object(g.jsxs)(g.Fragment,{children:[i>0&&Object(g.jsx)(f.a,{aspectRatio:u,onChange:function(e){x(e,j),l(e)}}),Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsxs)("label",{htmlFor:"size",style:{width:"100%"},children:["Size",Object(g.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[Math.round(100*j),"%"]})]}),Object(g.jsx)("input",{type:"range",className:"form-control-range",id:"size",min:"1",max:"2",step:"0.1",value:j,onChange:function(e){x(u,parseFloat(e.target.value)),v(parseFloat(e.target.value))}})]})]})}},99:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(18);function r(e,t){for(var n=0;n<a.b.length;n++){var r=a.b[n];if(e*t<=r.width*r.height)return 0}e/=2,t/=2;for(var s=0;s<a.b.length;s++){var i=a.b[s];if(e*t<=i.width*i.height)return 1}return 2}}},[[408,1,2]]]);
//# sourceMappingURL=main.6c37ab64.chunk.js.map